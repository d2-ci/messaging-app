(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{567:function(e,t,s){},587:function(e,t,s){},598:function(e,t,s){},605:function(e,t,s){e.exports={center:"App_center__1snml",error:"App_error__1usCm"}},607:function(e,t,s){},609:function(e,t,s){"use strict";s.r(t);var a=s(1),i=s.n(a),r=s(193),n=s(255),o=s.n(n),l=s(7),c=s(323),p=s.n(c),d=s(201),h=s(231),g=p()({palette:{negative:h.pinkA200,blue50:h.blue50,primary1Color:"#1D8BF1",primary2Color:h.blue100,primary3Color:h.blue300,primary4Color:h.blue500,accent1Color:h.grey50,accent2Color:h.grey100,accent3Color:h.grey300,accent4Color:h.grey500,followUp:h.orange500,darkGray:h.grey700,superDarkGray:h.grey900,textColor:h.darkBlack,alternateTextColor:h.white,canvasColor:h.white,borderColor:h.grey300,clockCircleColor:Object(d.fade)(h.darkBlack,.07),shadowColor:h.fullBlack}}),m=s(4),u=s.n(m),y=s(456),C=s(297),v=s.n(C);const E="SET_CURRENT_USER",f="SET_CURRENT_USER_SUCCESS",T="SET_CURRENT_USER_ERROR",S="LOAD_MESSAGE_CONVERSATIONS",k="MESSAGE_CONVERSATIONS_LOAD_SUCCESS",b="MESSAGE_CONVERSATIONS_DELETE_SUCCESS",M="MESSAGE_CONVERSATIONS_DELETE_ERROR",x="MESSAGE_CONVERSATION_UPDATE_SUCCESS",w="MESSAGE_CONVERSATION_UPDATE_ERROR",I="SEND_MESSAGE_SUCCESS",F="SEND_MESSAGE_ERROR",R="SET_FILTER",A="DISPLAY_SNACK_MESSAGE;",O="CLEAR_SNACK_MESSAGE",_="SET_CHECKED",U="SET_ALL_CHECKED",N="CLEAR_CHECKED",D="SET_SELECTED_MESSAGE_TYPE",L="CLEAR_SELECTED_MESSAGE_CONVERSATION",G="SET_SELECTED_MESSAGE_CONVERSATION",j="SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS",P="UPDATE_INPUT_FIELDS",V="SET_IN_FEEDBACK_RECIPIENT_GROUP",W="SET_DISPLAY_TIME_DIFF_SUCCESS",q="ADD_RECIPIENT_BY_ID_SUCCESS",B="ADD_ATTACHMENT",H="ADD_ATTACHMENT_SUCCESS",Y="ADD_ATTACHMENT_ERROR",z="REMOVE_ATTACHMENT",K="CLEAR_ATTACHMENTS",X="CANCEL_ATTACHMENT",J="SET_DHIS2_CORE_VERSION";var Q=s(370),Z=s.n(Q),$=s(564),ee=s.n($);const te="Roboto, Helvetica, Arial, sans-serif",se="NEUTRAL",ae="POSITIVE",ie="NEGATIVE";function re(e,t){const s=e.length;for(let a=0;a<s;a++)if(e[a].id===t)return a}function ne(e,t){let s=null;return function(){const a=this,i=arguments;clearTimeout(s),s=setTimeout((function(){e.apply(a,i)}),t)}}function oe(e){return e>30}function le(e){return{resource:"organisationUnits",params:{fields:["id","displayName"],pageSize:10,filter:["displayName:token:".concat(e),"users:gte:1"]}}}function ce(e){return{resource:"userGroups",params:{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e)]}}}const pe=["id","displayName","subject","messageType","lastSender[id, displayName]","assignee[id, displayName]","status","priority","lastUpdated","read","lastMessage","followUp"],de=["*","assignee[id, displayName]","messages[*,sender[id,displayName]","attachments[id, name, contentLength]]","userMessages[user[id, displayName]]"];let he=null;const ge=async({messageType:e,page:t,messageFilter:s,status:a,priority:i,assignedToMeFilter:r,markedForFollowUpFilter:n,unreadFilter:o,currentUser:l})=>{const c=["messageType:eq:".concat(e)];a&&c.push("status:eq:".concat(a)),i&&c.push("priority:eq:".concat(i)),n&&c.push("followUp:eq:true"),o&&c.push("read:eq:false"),r&&c.push("assignee.id:eq:".concat(l.id));const p={resource:"messageConversations",params:{filter:c,pageSize:35,page:t,fields:pe,order:"lastMessage:desc",queryString:s}},{messageConversations:d}=await he.query({messageConversations:p});return d},me=async(e,t)=>{const s=t?{resource:"messageConversations/".concat(e,"/assign"),type:"create",params:{userId:t}}:{resource:"messageConversations",id:"".concat(e,"/assign"),type:"delete"};return await he.mutate(s)},ue=async({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i})=>{var r,n,o;const l=function({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i}){const r=function({searchValue:e,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:s,dhis2CoreVersion:a}){if(function(e){return e>34}(a))return{resource:t?"userLookup/feedbackRecipients":"userLookup",params:{query:e}};{const a=["displayName:token:".concat(e)];return t&&a.push("userGroups.id:eq:".concat(s)),{resource:"users",params:{filter:a,pageSize:10}}}}({searchValue:e,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i});return t?{users:r}:{users:r,organisationUnits:le(e),userGroups:ce(e)}}({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i}),c=await he.query(l);return{users:null===(r=c.users)||void 0===r?void 0:r.users,organisationUnits:null===c||void 0===c||null===(n=c.organisationUnits)||void 0===n?void 0:n.organisationUnits,userGroups:null===c||void 0===c||null===(o=c.userGroups)||void 0===o?void 0:o.userGroups}},ye=({users:e,userGroups:t,organisationUnits:s,messageConversationId:a})=>he.mutate({resource:"messageConversations/".concat(a,"/recipients"),type:"create",data:{users:e,userGroups:t,organisationUnits:s}});var Ce=s(11),ve=s.n(Ce);const Ee=(e,t)=>({type:e,payload:t}),fe=e=>async t=>{t(Ee(G));try{const s=await(async({id:e})=>{const{messageConversation:t}=await he.query({messageConversation:{resource:"messageConversations",id:e,params:{fields:de}}});return t})(e);t(Ee(j,{messageConversation:s}))}catch(s){t(Ee("SET_SELECTED_MESSAGE_CONVERSATION_ERROR",{error:s}))}},Te=(e,t,s=!1)=>async(a,i)=>{const r=[],n=i(),{messageFilter:o,statusFilter:l,priorityFilter:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}=n.messaging;e=e||n.messaging.selectedMessageType,t=t||n.messaging.selectedMessageType.id,a(Ee(S,{messageType:e,loadMore:s}));try{for(let t=1;t<=e.page;t++){const s=ge({messageType:e.id,page:t,messageFilter:o,status:l,priority:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}).then((e=>({messageConversations:e.messageConversations,pager:e.pager})));r.push(s)}const s=await Promise.all(r),i=await(async e=>{const{messageConversations:t}=await he.query({messageConversations:{resource:"messageConversations",params:{fields:["read"],filter:["read:eq:false","messageType:eq:".concat(e)],pageSize:1}}});return t.pager.total})(e.id),n=s.reduce(((e,t)=>e.concat(t.messageConversations)),[]);a(Ee(k,{messageConversations:n,pager:s[s.length-1].pager,messageType:e,selectedMessageType:t,nrOfUnread:i}))}catch(m){a(Ee("MESSAGE_CONVERSATIONS_LOAD_ERROR",{error:m}))}},Se=(e,t,s)=>async a=>{try{await("read"===e?(r=t,he.mutate({resource:"messageConversations/read",type:"create",data:r})):(i=t,he.mutate({resource:"messageConversations/unread",type:"create",data:i}))),a(Ee("MARK_MESSAGE_CONVERSATIONS_SUCCESS",{messageType:s,page:1})),a(Te())}catch(n){a(Ee("MARK_MESSAGE_CONVERSATIONS_ERROR",{error:n}))}var i,r},ke=e=>async t=>{t(Ee(B,e));try{const s=await(e=>he.mutate({resource:"fileResources",type:"create",params:{domain:"MESSAGE_ATTACHMENT"},data:{file:e}}))(e);t(Ee(H,{id:s.response.fileResource.id,name:e.name,contentLength:s.response.fileResource.contentLength}))}catch(s){t(Ee(Y,{error:s}))}},be=()=>Ee(N),Me=()=>Ee(L),xe=({message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a})=>Ee(A,{message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a}),we=(e,t)=>Ee(R,{filter:e,filterType:t}),Ie=(e,t,s)=>Ee(P,{subject:e,input:t,recipients:s}),Fe=()=>Ee(K),Re=e=>Ee(D,{messageTypeId:e}),Ae=e=>Ee(z,{attachmentId:e}),Oe=e=>Ee(X,{attachmentName:e});var _e=s(205);const Ue={NEGATIVE:g.palette.negative,NEUTRAL:g.palette.primary1Color,POSITIVE:g.palette.alternateTextColor};class Ne extends a.Component{constructor(e){var t,s,a;super(e),a=()=>{this.props.clearSnackMessage(),this.setState({show:!1}),this.props.onSnackRequestClose&&this.props.onSnackRequestClose()},(s="closeMessage")in(t=this)?Object.defineProperty(t,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[s]=a,this.state={show:!1}}componentDidUpdate(e,t){!t.show&&this.props.message&&this.setState({show:!0})}render(){return i.a.createElement(v.a,{open:""!==this.props.message&&this.state.show,message:this.props.message||"Missing snackbar message",autoHideDuration:4e3,onRequestClose:this.closeMessage,action:this.props.onSnackActionClick&&"undo",onActionClick:()=>{this.props.onSnackActionClick(),this.setState({show:!1})},contentStyle:{color:Ue[this.props.type]},style:{pointerEvents:"none",whiteSpace:"nowrap"},bodyStyle:{pointerEvents:"initial",maxWidth:"none"}})}}var De=Object(_e.a)(Object(r.c)((e=>({message:e.messaging.snackMessage,type:e.messaging.snackType,onSnackActionClick:e.messaging.onSnackActionClick,onSnackRequestClose:e.messaging.onSnackRequestClose})),{clearSnackMessage:()=>Ee(O)}),_e.b)(Ne),Le=s(600),Ge=s(204),je=s.n(Ge),Pe=s(599),Ve=s.n(Pe),We=s(5),qe=s.n(We),Be=s(377),He=Object(Be.a)(),Ye=s(375),ze=s.n(Ye),Ke=s(374),Xe=s.n(Ke),Je=s(197),Qe=s.n(Je),Ze=s(200),$e=s.n(Ze),et=s(250),tt=s.n(et),st=s(190),at=s.n(st),it=s(223),rt=s.n(it),nt=s(249),ot=s.n(nt),lt=s(289),ct=s.n(lt),pt=s(573),dt=s.n(pt),ht=s(568),gt=s.n(ht);s(567);const mt=({dataDirection:e,attachment:t,removeAttachment:s,downloadAttachment:a,cancelAttachment:r})=>i.a.createElement(Qe.a,{className:"attachment__button",backgroundColor:g.palette.accent2Color,label:"".concat(t.name," (").concat(parseFloat(parseInt(t.contentLength,10)/1e6).toFixed(2)," MB)"),labelPosition:"after",onClick:()=>{"download"===e?a(t):t.loading?r(t.name):s(t)},icon:"download"===e?i.a.createElement(gt.a,null):i.a.createElement(dt.a,null)},t.loading&&i.a.createElement(ct.a,{className:"attachment__progress",mode:"indeterminate"}));var ut=({dataDirection:e,attachments:t,style:s,removeAttachment:a,downloadAttachment:r,cancelAttachment:n})=>i.a.createElement("div",{className:"attachment",style:{...s}},t.map(((t,s)=>i.a.createElement(mt,{key:"".concat(t.name,"-").concat(s),dataDirection:e,attachment:t,removeAttachment:a,downloadAttachment:r,cancelAttachment:n})))),yt=s(574),Ct=s.n(yt);const vt={canvas:e=>({backgroundColor:e,padding:"16px 16px 16px 16px"}),innerCanvas:{margin:"",paddingBottom:"0px"},cardText:{padding:"16px 0px 16px 0px",fontFamily:te,whiteSpace:"pre-wrap",wordBreak:"break-word"},fromFormat:{fontFamily:te},datePlacement:{display:"flex",justifyContent:"flex-end",marginRight:"10px"},dateFormat:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:te}};var Et=({displayTimeDiff:e,message:t,currentUser:s,lastMessage:a,downloadAttachment:r,cancelAttachment:n,enableAttachments:o})=>{const l=t.sender?s&&s.id===t.sender.id?"me":t.sender.displayName:"system",c=ve()(),p=ve()(t.created).add(e);return i.a.createElement("div",{style:vt.canvas(g.palette.canvasColor)},i.a.createElement("div",{style:vt.innerCanvas},i.a.createElement("div",{style:vt.fromFormat},t.internal?qe.a.t("Internal message from ".concat(l)):qe.a.t("Message from ".concat(l))),i.a.createElement("div",{placement:"bottom",style:vt.datePlacement},i.a.createElement("div",{style:vt.dateFormat},c.diff(p,"hours")<72?"".concat(p.from(c),", ").concat(p.format("HH:mm")):c.year()===p.year()?p.format("MMM DD, HH:mm"):p.format("MMM DD, YYYY HH:mm"))),o&&i.a.createElement(ut,{dataDirection:"download",style:{paddingLeft:0},attachments:t.attachments,downloadAttachment:r,cancelAttachment:n}),i.a.createElement(ot.a,{style:vt.cardText},i.a.createElement(Ct.a,null,t.text))),!a&&i.a.createElement(rt.a,null))},ft=s(248),Tt=s(253),St=s.n(Tt),kt=s(202),bt=s.n(kt),Mt=s(588),xt=s.n(Mt);s(587);const wt=e=>t=>{const s=t.target.files;s.length>0&&e(s[0])};var It=({addAttachment:e})=>i.a.createElement(Qe.a,{className:"attachment__upload-button",label:qe.a.t("Upload attachment"),labelPosition:"after",containerElement:"label",icon:i.a.createElement(xt.a,null)},i.a.createElement("input",{className:"attachment__upload-button--input",type:"file",onChange:wt(e)}));function Ft(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Rt extends a.Component{constructor(e){super(e),Ft(this,"replyMessage",(e=>{const{input:t,selectedMessageConversation:s,selectedMessageType:a}=this.props;this.props.replyMessage({message:t,internalReply:e,messageConversation:s,messageType:a}),this.wipeInput()})),Ft(this,"wipeInput",(()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),this.setState({inputError:!1})})),Ft(this,"texFieldUpdate",((e,t)=>{this.props.updateInputFields("",t,[])})),Ft(this,"handleDiscard",(()=>{const e=qe.a.t("Reply discarded");this.setState({discardState:!0}),this.props.displaySnackMessage({message:e,onSnackActionClick:()=>this.setState({discardState:!1}),onSnackRequestClose:()=>{this.setState({discardState:!1}),this.wipeInput()},snackType:"NEGATIVE"}),this.setState({expanded:!1})})),this.state={discardState:!1}}componentWillUnmount(){this.wipeInput()}render(){return i.a.createElement(ft.Card,{style:{marginTop:"5px"},expanded:!0},i.a.createElement(ft.CardText,{style:{padding:"0px 0px 0px 16px"}},i.a.createElement(bt.a,{key:this.props.messageConversation.id,id:this.props.messageConversation.id,rows:5,underlineShow:!1,value:this.state.discardState?"":this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:qe.a.t("Message"),onChange:this.texFieldUpdate}),this.props.enableAttachments&&!this.state.discardState&&i.a.createElement(ut,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(ft.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(St.a,{primary:!0,label:qe.a.t("Reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!1)}),this.props.isInFeedbackRecipientGroup&&"TICKET"===this.props.selectedMessageType.id&&i.a.createElement(Qe.a,{primary:!0,label:qe.a.t("Internal reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!0)}),i.a.createElement(Qe.a,{label:qe.a.t("Discard"),disabled:""===this.props.input||this.state.discardState,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(It,{addAttachment:e=>{this.props.addAttachment(e)}}),")")))}}var At=Object(_e.a)(Object(r.c)((e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes,input:e.messaging.input,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments,enableAttachments:oe(e.messaging.dhis2CoreVersion)})),{replyMessage:({message:e,internalReply:t,messageConversation:s,messageType:a})=>async(i,r)=>{try{const{id:n}=s,o=r().messaging.attachments.map((e=>e.id));await(async({message:e,internalReply:t,attachments:s,id:a})=>{const i={internal:t};return s.length>0&&(i.attachments=s),await he.mutate({resource:"messageConversations/".concat(a),type:"create",params:i,data:e})})({message:e,internalReply:t,attachments:o,id:n}),i(Ee("REPLY_MESSAGE_SUCCESS",{messageConversation:s,messageType:a,page:1})),i(Te()),i(fe(s))}catch(n){i(Ee("REPLY_MESSAGE_ERROR",{error:n}))}},setSelectedMessageType:Re,updateInputFields:Ie,displaySnackMessage:xe,addAttachment:ke,removeAttachment:Ae,cancelAttachment:Oe},null,{pure:!1}))(Rt),Ot=s(589),_t=s.n(Ot);function Ut(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class Nt extends a.Component{constructor(...e){super(...e),Ut(this,"state",{input:"",searchResult:[],searchOnlyUsers:this.props.searchOnlyUsers,searchOnlyFeedbackRecipients:this.props.searchOnlyFeedbackRecipients,lastSearch:"",errorText:void 0}),Ut(this,"debouncedSearch",ne(this.search.bind(this),300)),Ut(this,"onSuggestionClick",(e=>{if(void 0!==this.props.onSuggestionClick)this.props.onSuggestionClick(e);else{this.wipeInput(),this.debouncedSearch("");!this.props.recipients.find((t=>t.id===e.id))&&this.props.updateRecipients([...this.props.recipients,this.state.searchResult.find((t=>t.id===e.id))])}})),Ut(this,"onRemoveChip",(e=>{this.props.updateRecipients(this.props.recipients.filter((t=>t.id!==e)))})),Ut(this,"wipeInput",(()=>{this.setState({input:"",searchResult:[]})})),Ut(this,"updateInput",(e=>{this.debouncedSearch(e),this.setState({input:e})}))}search(e){if(!this.state.searchResult.find((t=>t.displayName===e))&&""!==e&&e.length>=2){const{feedbackRecipientsId:t,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a,dhis2CoreVersion:i}=this.props;ue({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a,feedbackRecipientsId:t,dhis2CoreVersion:i}).then((({users:e,userGroups:t,organisationUnits:s})=>{const a=e=>t=>({...t,type:e});let i=e.map(a("user"));this.state.searchOnlyUsers||(i=i.concat(t.map(a("userGroup"))).concat(s.map(a("organisationUnit")))),this.setState({searchResult:i,errorText:0===i.length?qe.a.t("No results found"):void 0})}))}else this.setState({lastSearch:e,searchResult:""!==this.state.lastSearch&&""===e||e.length<2?[]:this.state.searchResult,errorText:""!==e&&e.length<2?qe.a.t("Please enter at least ".concat(2," characters")):this.state.searchWarning})}render(){return i.a.createElement("div",{style:{...this.props.style,height:this.props.inputHeight}},i.a.createElement(_t.a,{style:{marginBottom:16},disabled:void 0!==this.props.disabled&&this.props.disabled,errorText:this.props.errorText||this.state.errorText,value:this.props.recipients,fullWidth:!0,openOnFocus:!0,searchText:this.state.input,floatingLabelText:this.props.label,dataSource:this.state.searchResult,dataSourceConfig:{text:"displayName",value:"id"},onUpdateInput:this.updateInput,onRequestAdd:e=>this.onSuggestionClick(e),onRequestDelete:e=>this.onRemoveChip(e)}))}}var Dt=Object(r.c)((e=>({dhis2CoreVersion:e.messaging.dhis2CoreVersion})))(Nt);const Lt={subheaderTitle:{height:"32px",color:"black",paddingLeft:0,paddingRight:16},subheader:(e,t)=>({height:"32px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:0,color:e,fontWeight:t})};var Gt=({showTitle:e,title:t,label:s,color:a,fontWeight:r})=>{const n=s&&"NONE"!==s?"Assignee"===t?s:"".concat(s.charAt(0)).concat(s.toLowerCase().substr(1,s.length)):"-";return i.a.createElement("div",{style:{flex:2,paddingLeft:10,maxWidth:200}},e&&i.a.createElement(je.a,{style:Lt.subheaderTitle}," ",t," "),i.a.createElement(je.a,{style:Lt.subheader(a,r)},n))};const jt={canvas:{flex:"3 0",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)",paddingTop:"10px"},innerCanvas:{display:"flex",flexDirection:"column",margin:"0px 10px 0px 10px"},header:{display:"flex"},iconButton:{display:"flex",alignSelf:"center"},subjectSubheader:{display:"flex",alignSelf:"center",fontSize:"20px",fontFamily:te},participantsCanvas:{display:"flex",flexDirection:"column"},participants:{paddingLeft:"12px",paddingTop:"10px",display:"flex",flexWrap:"wrap"},chip:{height:"32px",marginRight:"3px",marginBottom:"3px"},participantAddRow:{display:"flex"},participantsSuggestionField:{paddingLeft:"12px",marginBottom:"0px",flex:1},participantsAdd:{alignSelf:"flex-end",marginBottom:"28px",paddingLeft:"12px"},messagesCanvas:{marginBottom:"50px",display:"flex",flexDirection:"column",backgroundColor:g.palette.accent2Color,margin:"0px 10px 10px 10px"},messagesInnerCanvas:{padding:"0px"}};function Pt(){return(Pt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function Vt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Wt=["TICKET","VALIDATION_RESULT"];class qt extends a.Component{constructor(e){super(e),Vt(this,"backToList",(()=>{const{clearSelectedMessageConversation:e,messageConversation:t}=this.props;He.push("/".concat(t.messageType)),e()})),Vt(this,"addRecipients",(()=>{const e=this.state.recipients.filter((e=>"user"===e.type)),t=this.state.recipients.filter((e=>"userGroup"===e.type)),s=this.state.recipients.filter((e=>"organisationUnit"===e.type)),{messageConversation:a,selectedMessageType:i}=this.props;this.props.addRecipients({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i}),this.setState({recipients:[]})})),Vt(this,"updateRecipients",(e=>{this.setState({recipients:e})})),this.state={recipients:[],cursor:"auto"}}render(){const{messageConversation:e,currentUser:t}=this.props,s=e.messages,a=!!(Wt.indexOf(e.messageType)+1),r=e.userMessages.slice(0,30).map((e=>!t.id||this.state.recipientsExpanded||t.id!==e.user.id?e.user.displayName:qe.a.t("me"))),n=e.userMessages.length;return n>30&&r.push(" + ".concat(n-30)),i.a.createElement("div",{id:"messageconversation",style:jt.canvas},i.a.createElement("div",{style:jt.innerCanvas},i.a.createElement("div",{style:jt.header},i.a.createElement($e.a,{style:jt.iconButton,tooltipPosition:"bottom-right",onClick:this.backToList,tooltip:qe.a.t("Show all messages")},i.a.createElement(Xe.a,null)),i.a.createElement(je.a,{style:jt.subjectSubheader},e.subject),this.props.displayExtendedChoices&&i.a.createElement(Gt,{color:g.palette.darkGray,showTitle:!0,title:qe.a.t("Status"),label:e.status}),this.props.displayExtendedChoices&&i.a.createElement(Gt,{color:g.palette.darkGray,showTitle:!0,title:qe.a.t("Priority"),label:e.priority}),a&&i.a.createElement(Gt,{color:g.palette.darkGray,showTitle:!0,title:qe.a.t("Assignee"),label:e.assignee?e.assignee.displayName:void 0})),i.a.createElement("div",{style:jt.participantsCanvas},i.a.createElement(je.a,{style:{paddingLeft:"12px",paddingTop:"10px"}},qe.a.t("Participants")),i.a.createElement("div",{style:jt.participants},r.map((e=>i.a.createElement(tt.a,{key:e,style:jt.chip},e))))),i.a.createElement("div",{style:jt.participantAddRow},i.a.createElement(Dt,{style:jt.participantsSuggestionField,label:qe.a.t("Add participants to conversation"),messageConversation:e,recipients:this.state.recipients,updateRecipients:this.updateRecipients,limitSearchArray:e.userMessages}),i.a.createElement("div",{style:jt.participantsAdd},i.a.createElement(Qe.a,{icon:i.a.createElement(ze.a,null),onClick:()=>this.addRecipients(),label:qe.a.t("Add")})))),i.a.createElement("div",{style:jt.messagesCanvas},i.a.createElement(at.a,{style:jt.messagesInnerCanvas},s.map(((t,r)=>i.a.createElement(Et,{key:t.id,displayTimeDiff:this.props.displayTimeDiff,message:t,messageConversation:e,notification:a,currentUser:this.state.currentUser,lastMessage:r+1===s.length,downloadAttachment:s=>this.props.downloadAttachment(e.id,t.id,s.id),cancelAttachment:this.props.cancelAttachment,enableAttachments:this.props.enableAttachments})))),i.a.createElement(At,Pt({},this.props,{messageConversation:e}))))}}var Bt=Object(r.c)((e=>({currentUser:e.messaging.currentUser,selectedMessageType:e.messaging.selectedMessageType,displayTimeDiff:e.messaging.displayTimeDiff,enableAttachments:oe(e.messaging.dhis2CoreVersion)})),{addRecipients:({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i})=>async r=>{try{const{id:n}=a;await ye({users:e,userGroups:t,organisationUnits:s,messageConversationId:n}),r(Ee("ADD_RECIPIENTS_SUCCESS",{messageConversation:a,messageType:i,page:1})),r(fe(a))}catch(n){r(Ee("ADD_RECIPIENTS_ERROR",{error:n}))}},downloadAttachment:(e,t,s)=>a=>{((e,t,s)=>{const a=ee.a.join(he.link.baseUrl,he.link.apiPath,"messageConversations",e,t,"attachments",s),i=document.createElement("a");i.href=a,i.download=a.split("/").pop(),i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)})(e,t,s),a(Ee("DOWNLOAD_ATTACHMENT_SUCCESS"))},cancelAttachment:Oe,clearSelectedMessageConversation:Me})(qt),Ht=s(290),Yt=s(303),zt=s.n(Yt),Kt=s(251),Xt=s.n(Kt),Jt=s(278),Qt=s.n(Jt);function Zt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class $t extends a.Component{constructor(e){super(e),Zt(this,"onClick",(()=>{this.props.onClick()})),Zt(this,"onMouseEnter",(()=>{this.setHoverText(),this.setState({cursor:"pointer"})})),Zt(this,"onMouseLeave",(()=>{this.setNeutralText(),this.setState({cursor:"auto"})})),Zt(this,"setNeutralText",(()=>this.setTextColor(g.palette.accent2Color))),Zt(this,"setHoverText",(()=>this.setTextColor(g.palette.accent3Color))),Zt(this,"setTextColor",(e=>{this.setState({backgroundColor:e})})),Zt(this,"getBackgroundColor",((e,t)=>e&&t===e.id?g.palette.accent3Color:this.state.backgroundColor)),this.state={backgroundColor:g.palette.accent2Color,textColor:g.palette.darkGray}}render(){return i.a.createElement("div",{role:"presentation",style:{...this.state,backgroundColor:this.getBackgroundColor(this.props.selectedMessageType,this.props.messageType.id),cursor:this.state.cursor,alignItems:"center",height:"49px",display:"flex",flexDirection:"row",justifyContent:"space-between"},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:()=>this.onClick()},i.a.createElement(je.a,{style:{marginLeft:"5px",fontSize:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?"18px":"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?g.palette.primary1Color:this.state.textColor}},qe.a.t(this.props.messageType.displayName)),this.props.loading?i.a.createElement(Xt.a,{style:{marginRight:"10px"},color:g.palette.primary1Color,size:24}):this.props.messageType.unread>0&&i.a.createElement(Qt.a,{style:{marginTop:"12px",marginRight:"5px"},badgeContent:this.props.messageType.unread>100?"99+":this.props.messageType.unread,secondary:!0,badgeStyle:{backgroundColor:"#439E8E"}}))}}var es=$t;const ts={canvas:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"calc(100vh - 95px)",borderLeftStyle:"solid",borderLeftWidth:"0.5px",borderLeftColor:g.palette.accent4Color,borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:g.palette.accent4Color,overflowY:"auto",overflowX:"hidden",minWidth:"200px"}};class ss extends a.Component{constructor(e){super(e),this.props.setSelectedMessageType(this.props.match.params.messageType)}render(){const e=this.props.messageTypes;return i.a.createElement("div",{style:ts.canvas},i.a.createElement(Ht.List,{style:{padding:"0px"}},e&&e.map((e=>i.a.createElement("div",{key:e.id},i.a.createElement(es,{messageType:e,onClick:()=>{this.props.setSelectedMessageType(e.id),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),He.push("/".concat(e.id))},selectedMessageType:this.props.selectedMessageType,loading:e.loading}),i.a.createElement(rt.a,null))))),i.a.createElement(zt.a,{style:{width:"",margin:"20px"},label:"".concat(qe.a.t("Auto refresh")," (").concat(ve()(this.props.refreshTimer).format("mm:ss"),")"),toggled:this.props.autoRefresh,onToggle:()=>this.props.setAutoRefresh(!this.props.autoRefresh)}))}}var as=Object(_e.a)(Object(r.c)((e=>({selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes})),{setSelectedMessageType:Re,clearCheckedIds:be},null,{pure:!1}))(ss);const is={overflowY:"scroll",overflowX:"hidden",borderRightWidth:"1px",borderRightColor:g.palette.accent4Color,height:"calc(100vh - 95px)"},rs={paddingLeft:"0px",fontSize:"20px"};var ns=s(224),os=s.n(ns);const ls="16px",cs={canvas:e=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",alignSelf:"center",boxShadow:"none",borderBottom:"1px solid #dfdfdf"}),checkBox:{flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:"12px"},sender:{fontFamily:te,fontSize:ls,flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"black",paddingLeft:10,alignSelf:"center"},subject:{flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:te,fontSize:ls,color:"black",paddingLeft:10},extendedLabel:{flex:2,color:"black",fontSize:ls,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 0 0 10px"}};class ps extends a.Component{constructor(e){super(e),this.state={cursor:"auto",allChecked:!1}}componentDidUpdate(){this.state.allChecked&&this.props.checkedIds.length<this.props.messages.length&&this.setState({allChecked:!1})}render(){const e=this.props.displayExtendedChoices;return i.a.createElement(at.a,{style:cs.canvas(g.palette.canvasColor)},i.a.createElement(os.a,{checked:this.state.allChecked,style:cs.checkBox,onCheck:()=>{this.state.allChecked?this.props.clearCheckedIds():this.props.setAllChecked(this.props.messages.map((e=>({id:e.id})))),this.setState({allChecked:!this.state.allChecked})}}),i.a.createElement("div",{style:cs.sender},qe.a.t("Sender")),i.a.createElement(je.a,{style:cs.subject},qe.a.t("Subject")),e&&i.a.createElement(je.a,{style:cs.extendedLabel},qe.a.t("Status")),e&&i.a.createElement(je.a,{style:cs.extendedLabel},qe.a.t("Priority")),this.props.notification&&i.a.createElement(je.a,{style:cs.extendedLabel},qe.a.t("Assignee")),i.a.createElement(je.a,{style:cs.extendedLabel},qe.a.t("Date")))}}var ds=Object(_e.a)(Object(r.c)((e=>({checkedIds:e.messaging.checkedIds,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup})),{setAllChecked:e=>Ee(U,{messageConversationIds:e}),clearCheckedIds:be}))(ps),hs=s(590),gs=s.n(hs);function ms(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const us={container:(e,t,s)=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",cursor:s,boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",boxShadow:"none",borderBottom:"1px solid #dfdfdf",flexWrap:t?"nowrap":"wrap"}),checkBox:e=>({flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:e?12:6}),flag:{color:g.palette.followUp,marginRight:4},sender:(e,t)=>({fontFamily:te,fontSize:"14px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",color:"black",paddingLeft:e?10:0,fontWeight:t}),subject:(e,t,s)=>({flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingLeft:10,fontFamily:te,color:t,fontWeight:s,order:e?"inherit":10,marginTop:e?0:-10,flexBasis:e?"0%":"100%"}),dateFormat:(e,t,s)=>({flex:2,fontFamily:te,paddingLeft:e?10:0,paddingRight:e?0:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:e?"":"end",color:t,fontWeight:s})};class ys extends a.Component{constructor(e){super(e),ms(this,"onClick",(e=>{this.props.setSelectedMessageConversation(e),e&&!e.read&&this.props.markMessageConversations("read",[e.id],this.props.selectedMessageType),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),He.push("/".concat(e.messageType,"/").concat(e.id))})),ms(this,"onMouseEnter",(()=>this.setState({cursor:"pointer",backgroundColor:g.palette.accent2Color}))),ms(this,"onMouseLeave",(()=>this.setState({cursor:"auto",backgroundColor:g.palette.canvasColor}))),ms(this,"getBackgroundColor",((e,t)=>{const s=this.props.selectedMessageConversation&&e.id===this.props.selectedMessageConversation.id;return t&&!s?g.palette.blue50:s?g.palette.accent3Color:this.state.backgroundColor})),this.state={backgroundColor:g.palette.canvasColor,cursor:"auto"}}render(){const e=this.props.messageConversation,t=e.lastSender?e.lastSender.displayName:this.props.selectedMessageType.displayName,s=!!this.props.checkedIds.find((t=>t.id===e.id)),a=this.props.displayExtendedChoices,r=this.props.displayTimeDiff,n=ve()(),o=ve()(e.lastMessage).add(r),l=e.read?"":"bold",c=this.props.messageConversation.read?"black":g.palette.darkGray,p=this.getBackgroundColor(e,s);return i.a.createElement(at.a,{style:us.container(p,this.props.wideview,this.state.cursor),onClick:t=>{void 0!==t.target.innerText&&""!==t.target.innerText&&!this.props.settingSelectedMessageConversation&&(this.onClick(e),this.props.checkedIds.length>0&&this.props.clearCheckedIds(),!this.props.wideview||void 0===this.props.messageFilter&&void 0===this.props.priorityFilter&&void 0===this.props.statusFilter||this.props.setFilter(void 0,"MESSAGE"))},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},i.a.createElement(os.a,{checked:s,style:us.checkBox(this.props.wideview),onCheck:()=>{this.props.setChecked(e,!s)}}),i.a.createElement("div",{style:us.sender(this.props.wideview,l)},e.followUp&&i.a.createElement(gs.a,{style:us.flag}),i.a.createElement("span",null,t)),i.a.createElement(je.a,{style:us.subject(this.props.wideview,c,l)},e.subject),a&&i.a.createElement(Gt,{showTitle:!1,title:qe.a.t("Status"),color:c,fontWeight:l,label:e.status}),a&&i.a.createElement(Gt,{showTitle:!1,title:qe.a.t("Priority"),color:c,fontWeight:l,label:e.priority}),this.props.notification&&this.props.wideview&&i.a.createElement(Gt,{showTitle:!1,title:qe.a.t("Assignee"),color:c,fontWeight:l,label:e.assignee?e.assignee.displayName:void 0}),i.a.createElement(je.a,{style:us.dateFormat(this.props.wideview,c,l)},n.diff(o,"hours")<72?o.from(n):n.year()===o.year()?o.format("MMM DD"):o.format("ll")))}}var Cs=Object(_e.a)(Object(r.c)((e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,checkedIds:e.messaging.checkedIds,displayTimeDiff:e.messaging.displayTimeDiff,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,attachments:e.messaging.attachments})),{setChecked:(e,t)=>Ee(_,{messageConversation:e,selectedValue:t}),setSelectedMessageConversation:fe,markMessageConversations:Se,clearCheckedIds:be,setFilter:we,updateInputFields:Ie,clearAttachments:Fe},null,{pure:!1}))(ys);function vs(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Es=["VALIDATION_RESULT","TICKET"],fs={canvas:e=>({flex:"1 0",maxWidth:e?"none":"350px",minWidth:e?"none":"250px",borderRightStyle:e?"":"solid",...is}),loading:{backgroundColor:g.palette.accent2Color,height:"".concat(50,"px"),transition:"all 0.2s ease-in-out",display:"flex",justifyContent:"center"}};class Ts extends a.Component{constructor(...e){super(...e),vs(this,"onScroll",(e=>{const t=document.getElementById("messagelist");!this.props.selectedMessageType.loading&&this.isBottom(t)&&e.loaded<e.total&&this.props.loadMessageConversations(e,e.id,!0)})),vs(this,"debouncedOnScroll",ne(this.onScroll,150)),vs(this,"isBottom",(e=>e.scrollHeight-e.scrollTop<window.outerHeight))}render(){const e=function(e){if(!Array.isArray(e))return;const t=new Set;return e.filter((e=>!t.has(e.id)&&(t.add(e.id),!0)))}(this.props.messageConversations[this.props.selectedMessageType.id]),t=this.props.selectedMessageType?this.props.selectedMessageType:"",s=this.props.selectedMessageConversation?this.props.selectedMessageConversation.id:"",a=!!(Es.indexOf(t.id)+1);return i.a.createElement("div",{id:"messagelist",onScroll:()=>this.debouncedOnScroll(this.props.selectedMessageType),style:fs.canvas(this.props.wideview)},this.props.wideview&&i.a.createElement(ds,{notification:a,displayExtendedChoices:this.props.displayExtendedChoices,messages:e}),e&&0!==e.length?e.map((e=>i.a.createElement(Cs,{key:e.id,messageConversation:e,wideview:this.props.wideview,selectedValue:s,notification:a,displayExtendedChoices:this.props.displayExtendedChoices}))):!this.props.selectedMessageType.loading&&i.a.createElement(je.a,null,qe.a.t("No ".concat(t.displayName.toLowerCase()," messages"))),this.props.selectedMessageType.loading&&i.a.createElement("div",{style:fs.loading},i.a.createElement(Xt.a,{style:{marginTop:"10px"},color:g.palette.primary1Color})))}}var Ss=Object(_e.a)(Object(r.c)((e=>({messageTypes:e.messaging.messageTypes,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,messageConversations:e.messaging.messageConversations,selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType})),{loadMessageConversations:Te},null,{pure:!1}))(Ts),ks=s(292),bs=s.n(ks);function Ms(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const xs={canvas:{flex:"3 0",margin:"10px",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)"},messageTypeField:{display:"flex",flexDirection:"row"},messageType:{width:"300px",marginTop:"10px"}};class ws extends a.Component{constructor(e){super(e),Ms(this,"subjectUpdate",((e,t)=>{this.props.updateInputFields(t,this.props.input,this.props.recipients)})),Ms(this,"inputUpdate",((e,t)=>{this.props.updateInputFields(this.props.subject,t,this.props.recipients)})),Ms(this,"updateRecipients",(e=>{this.props.updateInputFields(this.props.subject,this.props.input,e)})),Ms(this,"sendMessage",(()=>{const e=this.state.isMessageFeedback?"TICKET":"PRIVATE",t=this.props.messageTypes.find((t=>t.id===e));if(this.state.isMessageFeedback)this.props.sendFeedbackMessage(t),He.push("/TICKET");else{const e=this.props.recipients.filter((e=>"user"===e.type)),s=this.props.recipients.filter((e=>"userGroup"===e.type)),a=this.props.recipients.filter((e=>"organisationUnit"===e.type));this.props.sendMessage({users:e,userGroups:s,organisationUnits:a,messageType:t}),He.push("/PRIVATE")}})),Ms(this,"wipeInput",(()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments()})),Ms(this,"handleDiscard",(()=>{const e=qe.a.t("Message discarded");this.props.displaySnackMessage({message:e,onSnackActionClick:()=>He.push("/PRIVATE/create"),onSnackRequestClose:()=>this.wipeInput(),snackType:"NEGATIVE"}),He.push("/PRIVATE")})),this.state={isMessageFeedback:!1}}componentDidMount(){const{addRecipientByUserId:e}=this.props,{messageId:t,recipientId:s}=this.props.match.params;"create"===t&&s&&e(s)}render(){const e=""===this.props.subject||""===this.props.input||!this.state.isMessageFeedback&&0===this.props.recipients.length,t=""===this.props.subject&&""===this.props.input&&!this.state.isMessageFeedback&&0===this.props.recipients.length;return i.a.createElement("div",{style:xs.canvas},i.a.createElement(je.a,{style:rs}," ",qe.a.t("Create")),i.a.createElement(ft.Card,null,i.a.createElement(ft.CardText,null,i.a.createElement(Dt,{style:{margin:"0px"},label:qe.a.t("To"),disabled:this.state.isMessageFeedback,recipients:this.state.isMessageFeedback?[{id:"id",displayName:qe.a.t("Feedback recipient group")}]:this.props.recipients,updateRecipients:this.updateRecipients,inputHeight:"100px"}),i.a.createElement("div",{style:xs.messageTypeField},i.a.createElement("div",{style:xs.messageType},i.a.createElement(bs.a,{label:qe.a.t("Private message"),checked:!this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}})),i.a.createElement("div",{style:xs.messageType},i.a.createElement(bs.a,{label:qe.a.t("Feedback message"),checked:this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}}))),i.a.createElement(bt.a,{floatingLabelText:qe.a.t("Subject"),fullWidth:!0,value:this.props.subject,onChange:this.subjectUpdate}),i.a.createElement(bt.a,{key:"createMessage",id:"createMessage",rows:5,underlineShow:!1,value:this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:qe.a.t("Message"),onChange:this.inputUpdate}),this.props.enableAttachments&&i.a.createElement(ut,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(ft.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(St.a,{primary:!0,disabled:e,label:qe.a.t("Send"),onClick:()=>this.sendMessage()}),i.a.createElement(Qe.a,{label:qe.a.t("Discard"),disabled:t,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(It,{addAttachment:e=>{this.props.addAttachment(e)}})))))}}var Is=Object(_e.a)(Object(r.c)((e=>({messageTypes:e.messaging.messageTypes,subject:e.messaging.subject,input:e.messaging.input,recipients:e.messaging.recipients,attachments:e.messaging.attachments,enableAttachments:oe(e.messaging.dhis2CoreVersion)})),{sendMessage:({users:e,userGroups:t,organisationUnits:s,messageType:a})=>async(i,r)=>{try{const{messaging:{subject:n,input:o,attachments:l}}=r();await(({subject:e,users:t,userGroups:s,organisationUnits:a,text:i,attachments:r})=>he.mutate({resource:"messageConversations",type:"create",data:{subject:e,users:t,userGroups:s,organisationUnits:a,text:i,attachments:r}}))({subject:n,users:e,userGroups:t,organisationUnits:s,text:o,attachments:l}),i(Ee(I,{messageType:a,page:1})),i(Te())}catch(n){i(Ee(F,{error:n}))}},sendFeedbackMessage:e=>async(t,s)=>{const a=s();try{await(i=a.messaging.subject,r=a.messaging.input,he.mutate({resource:"messageConversations/feedback",type:"create",params:{subject:i},data:r})),t(Ee(I,{messageType:e,page:1})),t(Te())}catch(n){t(Ee(F,{error:n}))}var i,r},displaySnackMessage:xe,updateInputFields:Ie,addAttachment:ke,removeAttachment:Ae,cancelAttachment:Oe,addRecipientByUserId:e=>async t=>{try{const s=await(async e=>{const{user:t}=await he.query({user:{resource:"users",id:e,params:{fields:"id,displayName"}}});return{...t,type:"user"}})(e);t(Ee(q,s))}catch(s){console.error(s)}}},null,{pure:!1}))(ws),Fs=s(597),Rs=s.n(Fs),As=s(596),Os=s.n(As),_s=s(295),Us=s.n(_s),Ns=s(221),Ds=s.n(Ns),Ls=s(233),Gs=s.n(Ls),js=s(252),Ps=s.n(js),Vs=s(349),Ws=s.n(Vs),qs=s(376),Bs=s.n(qs);var Hs={STATUS:[{key:"NONE",value:"NONE",primaryText:qe.a.t("No status")},{key:"OPEN",value:"OPEN",primaryText:qe.a.t("Open")},{key:"PENDING",value:"PENDING",primaryText:qe.a.t("Pending")},{key:"INVALID",value:"INVALID",primaryText:qe.a.t("Invalid")},{key:"SOLVED",value:"SOLVED",primaryText:qe.a.t("Solved")}],PRIORITY:[{key:"NONE",value:"NONE",primaryText:qe.a.t("No priority")},{key:"HIGH",value:"HIGH",primaryText:qe.a.t("High")},{key:"MEDIUM",value:"MEDIUM",primaryText:qe.a.t("Medium")},{key:"LOW",value:"LOW",primaryText:qe.a.t("Low")}]},Ys=s(591),zs=s.n(Ys),Ks=s(595),Xs=s.n(Ks),Js=s(592),Qs=s.n(Js),Zs=s(593),$s=s.n(Zs),ea=s(594),ta=s.n(ea),sa=s(235),aa=s.n(sa);function ia(e){return i.a.createElement(r.b.Consumer,null,(t=>i.a.createElement(aa.a,e,i.a.createElement(r.a,{store:t.store},e.children))))}var ra=({open:e,onRequestClose:t,updateMessageConversations:s,messageType:a,feedbackRecipientsId:r})=>i.a.createElement(ia,{open:e,onRequestClose:()=>{t()}},i.a.createElement(Dt,{onSuggestionClick:e=>{s([e.id]),t()},searchOnlyUsers:!0,searchOnlyFeedbackRecipients:"TICKET"===a.id,feedbackRecipientsId:r,recipients:[],key:"suggestionField",label:qe.a.t("Assignee")}));function na(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const oa={canvas:{width:"400px",display:"flex"},extendedChoices:{display:"flex",justifyContent:"flex-start"},nrSelected:{padding:"0px 0px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}};class la extends a.Component{constructor(e){super(e),na(this,"getIds",(()=>this.props.selectedMessageConversation&&0===this.props.checkedIds.length?[this.props.selectedMessageConversation.id]:this.props.checkedIds.map((e=>e.id)))),na(this,"updateMessageConversation",((e,t)=>{const{selectedMessageType:s,selectedMessageConversation:a}=this.props,i=this.getIds();this.props.updateMessageConversations({messageConversationIds:i,identifier:e,value:t,messageType:s,selectedMessageConversation:a}),this.props.checkedIds.length>0&&this.props.clearCheckedIds()})),na(this,"markMessageConversations",(e=>{const t=this.getIds();this.props.markMessageConversations(e,t,this.props.selectedMessageType),this.props.checkedIds.length>0&&this.props.clearCheckedIds()})),na(this,"toggleDialog",(()=>{this.setState({dialogOpen:!this.state.dialogOpen})})),this.state={checkedItems:!1,dialogOpen:!1,assignToOpen:!1}}render(){const e=this.props.selectedMessageConversation,t=this.props.checkedIds.length>0,s=t||void 0!==e,a=i.a.createElement(i.a.Fragment,null,i.a.createElement(Qe.a,{label:qe.a.t("Cancel"),primary:!0,onClick:()=>this.toggleDialog()}),i.a.createElement(Qe.a,{label:qe.a.t("Submit"),primary:!0,keyboardFocused:!0,onClick:()=>{this.props.deleteMessageConversations(this.getIds(),this.props.selectedMessageType),this.props.clearCheckedIds(),this.toggleDialog(),this.props.selectedMessageConversation&&(this.props.clearSelectedMessageConversation(),He.push("/".concat(this.props.selectedMessageType.id)))}})),r=this.props.checkedIds.length>99?"".concat(99,"+"):this.props.checkedIds.length;return s?i.a.createElement("div",{style:oa.canvas},i.a.createElement(ia,{title:qe.a.t("Are you sure you want to delete selected message conversation(s)?"),actions:a,modal:!1,open:this.state.dialogOpen,onRequestClose:this.toggleDialog}),i.a.createElement(ra,{open:this.state.assignToOpen,onRequestClose:()=>this.setState({assignToOpen:!this.state.assignToOpen}),updateMessageConversations:e=>this.updateMessageConversation("ASSIGNEE",e),messageType:this.props.selectedMessageType,feedbackRecipientsId:this.props.feedbackRecipientsId}),i.a.createElement("div",{style:oa.extendedChoices},i.a.createElement($e.a,{tooltip:qe.a.t("Delete selected"),onClick:()=>{this.toggleDialog()}},i.a.createElement(Qs.a,null)),i.a.createElement($e.a,{tooltip:qe.a.t("Mark selected as unread"),onClick:()=>{this.markMessageConversations("unread")}},i.a.createElement($s.a,null)),i.a.createElement($e.a,{tooltip:qe.a.t("Mark selected as read"),onClick:()=>{this.markMessageConversations("read")}},i.a.createElement(ta.a,null)),this.props.displayExtendedChoices&&i.a.createElement($e.a,{onClick:()=>this.setState({assignToOpen:!this.state.assignToOpen}),tooltip:qe.a.t("Assign selected")},i.a.createElement(Xs.a,null)),i.a.createElement(Ps.a,{iconButtonElement:i.a.createElement($e.a,null,i.a.createElement(Bs.a,null)),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"}},i.a.createElement(Ds.a,{key:"markFollowUp",value:"markFollowUp",primaryText:qe.a.t("Mark for followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!0)}),i.a.createElement(Ds.a,{key:"clearFollowUp",value:"clearFollowUp",primaryText:qe.a.t("Clear followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!1)}),this.props.displayExtendedChoices&&i.a.createElement(rt.a,null),this.props.displayExtendedChoices&&i.a.createElement(Ds.a,{key:"clearAssigned",value:"clearAssigned",primaryText:qe.a.t("Clear assignee"),onClick:()=>this.updateMessageConversation("ASSIGNEE",void 0)}),this.props.displayExtendedChoices&&i.a.createElement(Ds.a,{primaryText:qe.a.t("Set status"),key:"setStatus",rightIcon:i.a.createElement(zs.a,null),menuItems:Hs.STATUS.map((e=>i.a.createElement(Ds.a,{key:"".concat(e.key,"_status"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("STATUS",e.key)})))}),this.props.displayExtendedChoices&&i.a.createElement(Ds.a,{primaryText:qe.a.t("Set priority"),key:"setPriority",rightIcon:i.a.createElement(zs.a,null),menuItems:Hs.PRIORITY.map((e=>i.a.createElement(Ds.a,{key:"".concat(e.key,"_priority"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("PRIORITY",e.key)})))}))),t&&i.a.createElement(Gs.a,{style:oa.nrSelected},"".concat(r," ").concat(qe.a.t("selected")))):i.a.createElement("div",null)}}var ca=Object(_e.a)(Object(r.c)((e=>({selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,checkedIds:e.messaging.checkedIds,feedbackRecipientsId:e.messaging.feedbackRecipientsId})),{clearCheckedIds:be,clearSelectedMessageConversation:Me,deleteMessageConversations:(e,t)=>async(s,a)=>{try{const i=a(),{currentUser:r}=i.messaging,n=e.map((e=>((e,t)=>he.mutate({resource:"messageConversations/".concat(e,"/").concat(t),type:"delete"}))(e,r.id)));await Promise.all(n),s(Ee(b,{messageType:t,page:1})),s(Te())}catch(i){s(Ee(M,{error:i}))}},updateMessageConversations:({messageConversationIds:e,identifier:t,value:s,messageType:a,selectedMessageConversation:i})=>async r=>{if("FOLLOW_UP"===t)try{await((e,t)=>he.mutate({resource:"messageConversations/".concat(t?"followup":"unfollowup"),type:"create",data:e}))(e,s),r(Ee(x,{messageType:a,page:1,identifier:t})),r(Te())}catch(n){r(Ee(w,{error:n}))}else{const i=e.map((e=>{let i;switch(t){case"STATUS":i=((e,t)=>he.mutate({resource:"messageConversations/".concat(e,"/status"),type:"create",params:{messageConversationStatus:t}}))(e,s);break;case"PRIORITY":i=((e,t)=>he.mutate({resource:"messageConversations/".concat(e,"/priority"),type:"create",params:{messageConversationPriority:t}}))(e,s);break;case"ASSIGNEE":i=void 0!==s&&"VALIDATION_RESULT"===a.id?ye({users:s.map((e=>({id:e}))),userGroups:[],organisationUnits:[],messageConversationId:e}).then((()=>me(e,s))):me(e,s);break;default:Z.a.error("Unexpected identifier for updateMessageConversations")}return i}));try{await Promise.all(i),r(Ee(x,{messageType:a,page:1,identifier:t})),r(Te())}catch(n){r(Ee(w,{error:n}))}}i&&r(fe(i))},markMessageConversations:Se},null,{pure:!1}))(la);function pa(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const da={canvas:e=>({display:"flex",justifyContent:"flex-start",alignItems:"center",backgroundColor:e?g.palette.blue50:g.palette.accent2Color,zIndex:10}),checkedOption:{display:"flex",justifyContent:"flex-start",minWidth:"200px",margin:"6px 0"},filterControl:{flex:2,height:"48px",marginRight:16,maxWidth:256},rightHandCanvas:{flex:"2 0",display:"flex",paddingLeft:16},ie11Spacer:{flexGrow:1},iconMenu:{width:"30px",display:"flex"}};class ha extends a.Component{constructor(...e){super(...e),pa(this,"state",{lastMessageFilter:""}),pa(this,"debouncedSearch",ne(this.search,300))}search(e){this.props.selectedMessageType&&this.state.lastMessageFilter!==e&&(this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id),this.setState({lastMessageFilter:e}))}componentDidUpdate(e){e.selectedMessageType&&this.props.selectedMessageType.id!==e.selectedMessageType.id&&(this.debouncedSearch(""),void 0!==this.props.messageFilter&&this.props.setFilter(void 0,"MESSAGE"),void 0!==this.props.statusFilter&&this.props.setFilter(void 0,"STATUS"),void 0!==this.props.priorityFilter&&this.props.setFilter(void 0,"PRIORITY"),this.props.assignedToMeFilter&&this.props.setFilter(!1,"ASSIGNED_TO_ME"),this.props.markedForFollowUpFilter&&this.props.setFilter(!1,"MARKED_FOR_FOLLOWUP"),this.props.unreadFilter&&this.props.setFilter(!1,"UNREAD")),void 0===this.props.selectedMessageType||this.props.selectedMessageType.loading||e.statusFilter===this.props.statusFilter&&e.priorityFilter===this.props.priorityFilter&&e.assignedToMeFilter===this.props.assignedToMeFilter&&e.markedForFollowUpFilter===this.props.markedForFollowUpFilter&&e.unreadFilter===this.props.unreadFilter&&void 0!==e.selectedMessageType&&e.selectedMessageType.id===this.props.selectedMessageType.id||this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id)}render(){const e=this.props.id,t=this.props.displayExtendedChoices,s=this.props.checkedOptions,a=!this.props.wideview||void 0===this.props.selectedMessageConversation&&"create"!==e;return i.a.createElement(at.a,{style:da.canvas(s)},i.a.createElement("div",null,!s&&i.a.createElement(Qe.a,{style:da.checkedOption,icon:i.a.createElement(ze.a,null),onClick:()=>He.push("/PRIVATE/create"),label:qe.a.t("Compose")}),s&&i.a.createElement(Qe.a,{style:da.checkedOption,icon:i.a.createElement(Xe.a,null),onClick:()=>this.props.clearCheckedIds(),label:qe.a.t("Deselect all")})),i.a.createElement(ca,{displayExtendedChoices:t}),i.a.createElement("div",{style:da.rightHandCanvas},i.a.createElement("div",{style:da.ie11Spacer}),t&&a&&!s&&i.a.createElement(Us.a,{style:da.filterControl,labelStyle:{color:void 0===this.props.statusFilter?"lightGray":"black",top:void 0===this.props.statusFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:g.palette.primary1Color},floatingLabelText:void 0===this.props.statusFilter?qe.a.t("Status"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.statusFilter?"-15px":"0px"},value:this.props.statusFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"STATUS")}},i.a.createElement(Ds.a,{key:null,value:null,primaryText:""}),Hs.STATUS.map((e=>i.a.createElement(Ds.a,{key:e.key,value:e.value,primaryText:e.primaryText})))),t&&a&&!s&&i.a.createElement(Us.a,{style:da.filterControl,labelStyle:{color:void 0===this.props.priorityFilter?"lightGray":"black",top:void 0===this.props.priorityFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:g.palette.primary1Color},floatingLabelText:void 0===this.props.priorityFilter?qe.a.t("Priority"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.priorityFilter?"-15px":"0px"},value:this.props.priorityFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"PRIORITY")}},i.a.createElement(Ds.a,{key:null,value:null,primaryText:""}),Hs.PRIORITY.map((e=>i.a.createElement(Ds.a,{key:e.key,value:e.value,primaryText:e.primaryText})))),!s&&a&&i.a.createElement(bt.a,{style:da.filterControl,fullWidth:!0,hintText:qe.a.t("Search"),value:this.props.messageFilter||"",onChange:(e,t)=>{this.debouncedSearch(t),this.props.setFilter(t,"MESSAGE")},type:"search"}),!s&&a&&i.a.createElement(Ps.a,{iconButtonElement:i.a.createElement($e.a,null,i.a.createElement(Bs.a,null)),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},style:da.iconMenu,menuStyle:{overflowX:"hidden"}},i.a.createElement(Gs.a,{style:{padding:"0px 16px"}},qe.a.t("Set filter")),this.props.displayExtendedChoices&&i.a.createElement(Ws.a,{style:{padding:"0px 16px"},key:"assignedToMeFilter",label:qe.a.t("Assigned to me"),checked:this.props.assignedToMeFilter,onClick:()=>{this.props.setFilter(!this.props.assignedToMeFilter,"ASSIGNED_TO_ME")}}),i.a.createElement(Ws.a,{style:{padding:"0px 16px"},key:"markedForFollowUpFilter",label:qe.a.t("Marked for followup"),checked:this.props.markedForFollowUpFilter,onClick:()=>{this.props.setFilter(!this.props.markedForFollowUpFilter,"MARKED_FOR_FOLLOWUP")}}),i.a.createElement(Ws.a,{style:{padding:"0px 16px"},key:"unreadFilter",label:qe.a.t("Unread messages"),checked:this.props.unreadFilter,onClick:()=>{this.props.setFilter(!this.props.unreadFilter,"UNREAD")}})),i.a.createElement(Qe.a,{style:{width:"50px",alignSelf:"center"},icon:this.props.wideview?i.a.createElement(Rs.a,null):i.a.createElement(Os.a,null),onClick:()=>this.props.toogleWideview()})))}}var ga=ha;s(598);function ma(){return(ma=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function ua(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ya=["TICKET","VALIDATION_RESULT"],Ca=3e5,va=1e4;class Ea extends a.Component{constructor(e){super(e),ua(this,"setAutoRefresh",(e=>{!e&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),e&&(this.intervalId=setInterval(this.tick,va)),this.setState({autoRefresh:e,refreshTimer:Ca})})),ua(this,"tick",(()=>{this.state.refreshTimer-va<=0?(this.refresh(),this.setState({refreshTimer:Ca})):this.setState((e=>({refreshTimer:e.refreshTimer-va})))})),ua(this,"refresh",(()=>{this.props.messageTypes.map((e=>this.props.loadMessageConversations(e,this.props.selectedMessageType))),this.props.selectedMessageConversation&&this.props.setSelectedMessageConversation(this.props.selectedMessageConversation)})),ua(this,"toogleWideview",(()=>{this.setState({wideview:!this.state.wideview})})),this.intervalId=null,this.state={autoRefresh:!1,checkedItems:!1,refreshTimer:Ca,wideview:!0}}componentDidMount(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(t&&t!==e&&"create"!==t){const e={id:t};this.props.setSelectedMessageConversation(e)}(async e=>{const{configuration:{feedbackRecipients:t}}=await he.query({configuration:{resource:"configuration"}});return{authorized:e.authorities.includes("ALL")||e.userGroups.some((({id:e})=>e===t.id)),feedbackRecipientsId:t.id}})(this.props.currentUser).then((e=>this.props.setIsInFeedbackRecipientGroup(e))),this.props.messageTypes.map((t=>this.props.loadMessageConversations(t,e))),this.props.setDisplayTimeDiff()}componentDidUpdate(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(!this.props.settingSelectedMessageConversation&&t&&e!==t&&"create"!==t&&(void 0===this.props.selectedMessageConversation||t!==this.props.selectedMessageConversation.id)){const e={id:t};this.props.setSelectedMessageConversation(e)}e===t&&e!==this.props.selectedMessageType.id&&this.props.setSelectedMessageType(e),e!==t&&"create"!==t||void 0===this.props.selectedMessageConversation||this.props.clearSelectedMessageConversation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId)}render(){const e=this.props.match.params.messageId,t=!!this.props.selectedMessageType&&!!(ya.indexOf(this.props.selectedMessageType.id)+1)&&this.props.isInFeedbackRecipientGroup;return i.a.createElement("div",{className:"messaging-center"},i.a.createElement(ga,ma({},this.props,{id:e,wideview:this.state.wideview,displayExtendedChoices:t,toogleWideview:this.toogleWideview})),i.a.createElement("div",{className:"messaging-center__main-content"},i.a.createElement(as,ma({},this.props,{drawerOpen:this.state.drawerOpen,messageTypes:this.props.messageTypes,autoRefresh:this.state.autoRefresh,refreshTimer:this.state.refreshTimer,setAutoRefresh:this.setAutoRefresh})),void 0===this.props.selectedMessageConversation&&!(this.state.wideview&&"create"===e)&&i.a.createElement(Ss,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),"create"===e&&i.a.createElement(Is,ma({},this.props,{wideview:this.state.wideview})),void 0!==this.props.selectedMessageConversation&&!this.state.wideview&&i.a.createElement(Ss,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),this.props.selectedMessageConversation&&"create"!==e?void 0!==this.props.selectedMessageConversation&&i.a.createElement(Bt,ma({},this.props,{messageConversation:this.props.selectedMessageConversation,wideview:this.state.wideview,disableLink:!0,displayExtendedChoices:t})):!this.state.wideview&&"create"!==e&&i.a.createElement("div",{className:"messaging-center__no-message-selected"},i.a.createElement(je.a,{style:rs},qe.a.t("Select a message")),i.a.createElement(Ve.a,{style:{color:g.palette.primary1Color,width:120,height:120}}))))}}var fa=Object(_e.a)(Object(r.c)((e=>({currentUser:e.messaging.currentUser,snackMessage:e.messaging.snackMessage,messageTypes:e.messaging.messageTypes,messageConversations:e.messaging.messageConversations,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,assignedToMeFilter:e.messaging.assignedToMeFilter,markedForFollowUpFilter:e.messaging.markedForFollowUpFilter,unreadFilter:e.messaging.unreadFilter,selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,checkedIds:e.messaging.checkedIds,checkedOptions:e.messaging.checkedIds.length>0,loaded:e.messaging.loaded,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments})),{loadMessageConversations:Te,setIsInFeedbackRecipientGroup:e=>Ee(V,{isInFeedbackRecipientGroup:e}),clearCheckedIds:be,setSelectedMessageConversation:fe,setSelectedMessageType:Re,clearSelectedMessageConversation:Me,updateInputFields:Ie,setFilter:we,setDisplayTimeDiff:()=>async e=>{try{const t=await(async()=>{const{systemInfo:e}=await he.query({systemInfo:{resource:"system/info"}});return e.serverDate})(),s=ve()().diff(ve()(t))-5e3;e(Ee(W,s))}catch(t){e(Ee("SET_DISPLAY_TIME_DIFF_ERROR",{error:t}))}},clearAttachments:Fe},null,{pure:!1}))(Ea);var Ta=()=>i.a.createElement(Le.c,{history:He},i.a.createElement("div",null,i.a.createElement(Le.b,{exact:!0,path:"/",component:()=>i.a.createElement(Le.a,{to:"/PRIVATE"})}),i.a.createElement(Le.b,{path:"/:messageType/:messageId?/:recipientId?",component:fa}))),Sa=s(605),ka=s.n(Sa);var ba=Object(r.c)((e=>({currentUser:e.messaging.currentUser})),{setCurrentUser:()=>async e=>{e(Ee(E));try{const{currentUser:t}=await he.query({currentUser:{resource:"me",params:{fields:["id","authorities","userGroups[id]"]}}});e(Ee(f,t))}catch{e(Ee(T,"Could not load current user"))}},setDhis2CoreVersion:e=>Ee(J,e)})((({currentUser:e,setCurrentUser:t,setDhis2CoreVersion:s})=>{const{loading:r,error:n}=e,{serverVersion:o}=Object(l.c)();return Object(a.useEffect)((()=>{s(o.minor),t()}),[]),r?i.a.createElement("div",{className:ka.a.center},i.a.createElement(y.a,{size:48})):n?i.a.createElement("div",{className:u()(ka.a.center,ka.a.error)},n):i.a.createElement("div",null,i.a.createElement(De,null),i.a.createElement(Ta,null))})),Ma=s(309),xa=s(606);var wa=[{id:"PRIVATE",displayName:"Inbox",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"VALIDATION_RESULT",displayName:"Validation",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"TICKET",displayName:"Ticket",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"SYSTEM",displayName:"System",unread:0,loaded:0,loading:!1,total:0,page:1}];const Ia={currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null},messageConversations:{},messageTypes:wa,selectedMessageType:void 0,selectedMessageConversation:void 0,settingSelectedMessageConversation:!1,checkedIds:[],messageFilter:void 0,statusFilter:void 0,priorityFilter:void 0,assignedToMeFilter:!1,markedForFollowUpFilter:!1,unreadFilter:!1,isInFeedbackRecipientGroup:!1,feedbackRecipientsId:void 0,displayTimeDiff:0,subject:"",input:"",recipients:[],attachments:[],snackMessage:"",onSnackActionClick:void 0,onSnackRequestClose:void 0,snackType:se};var Fa=function(e=Ia,t){const s=e.messageTypes,a=e.attachments;switch(t.type){case E:return{...e,currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null}};case f:return{...e,currentUser:{loading:!1,error:null,id:t.payload.id,authorities:t.payload.authorities,userGroups:t.payload.userGroups}};case T:return{...e,currentUser:{loading:!1,error:t.payload,id:null,authorities:null,userGroups:null}};case W:return{...e,displayTimeDiff:t.payload};case k:{const a=s.find((e=>e.id===t.payload.messageType.id));a.loaded=t.payload.messageConversations.length,a.total=t.payload.pager.total,a.unread=t.payload.nrOfUnread,a.page=t.payload.pager.page,a.loading=!1,wa.splice([re(s,a.id)],1,a);const i=t.payload.selectedMessageType===a.id&&(t.payload.selectedMessageType===e.selectedMessageType||void 0===e.selectedMessageType);return{...e,messageTypes:wa,messageConversations:{...e.messageConversations,[a.id]:t.payload.messageConversations},selectedMessageType:i?a:e.selectedMessageType}}case w:return{...e,snackMessage:t.payload.error.message,snackType:ie};case x:{let s="";switch(t.payload.identifier){case"STATUS":s=qe.a.t("Successfully updated status");break;case"PRIORITY":s=qe.a.t("Successfully updated priority");break;case"ASSIGNEE":s=qe.a.t("Successfully updated assignee");break;case"FOLLOW_UP":s=qe.a.t("Successfully changed followup");break;default:Z.a.error("Unexpected identifier for updateMessageConversations success")}return{...e,snackMessage:s,snackType:ae}}case F:case M:return{...e,snackMessage:t.payload.error.message,snackType:ie};case b:return{...e,snackMessage:qe.a.t("Successfully deleted message conversation(s)"),snackType:ae};case A:return{...e,snackMessage:t.payload.message,snackType:t.payload.snackType,onSnackActionClick:t.payload.onSnackActionClick,onSnackRequestClose:t.payload.onSnackRequestClose};case O:return{...e,snackMessage:"",snackType:se};case _:{const s=t.payload.messageConversation;let a=e.checkedIds;return t.payload.selectedValue?a.push(s):a=a.filter((e=>e.id!==s.id)),{...e,checkedIds:a}}case U:return{...e,checkedIds:t.payload.messageConversationIds};case N:return{...e,checkedIds:[]};case j:return{...e,selectedMessageConversation:t.payload.messageConversation,settingSelectedMessageConversation:!1};case G:return{...e,settingSelectedMessageConversation:!0};case L:return{...e,selectedMessageConversation:void 0};case D:return{...e,checkedIds:[],selectedMessageType:s.find((e=>e.id===t.payload.messageTypeId)),selectedMessageConversations:e.messageConversations[t.payload.messageTypeId],selectedMessageConversation:void 0};case P:return{...e,subject:t.payload.subject,input:t.payload.input,recipients:t.payload.recipients};case q:return{...e,recipients:[...e.recipients,t.payload]};case R:return{...e,messageFilter:"MESSAGE"===t.payload.filterType?t.payload.filter:e.messageFilter,statusFilter:"STATUS"===t.payload.filterType?t.payload.filter:e.statusFilter,priorityFilter:"PRIORITY"===t.payload.filterType?t.payload.filter:e.priorityFilter,assignedToMeFilter:"ASSIGNED_TO_ME"===t.payload.filterType?t.payload.filter:e.assignedToMeFilter,markedForFollowUpFilter:"MARKED_FOR_FOLLOWUP"===t.payload.filterType?t.payload.filter:e.markedForFollowUpFilter,unreadFilter:"UNREAD"===t.payload.filterType?t.payload.filter:e.unreadFilter};case S:{const s=t.payload.messageType;s.loading=!0,t.payload.loadMore&&s.page++,wa[re(wa,s.id)]=s;const a=e.selectedMessageType;return a&&(a.loading=!0,t.payload.loadMore&&a.page++),{...e,messageTypes:wa,selectedMessageType:a}}case V:return{...e,isInFeedbackRecipientGroup:t.payload.isInFeedbackRecipientGroup.authorized,feedbackRecipientsId:t.payload.isInFeedbackRecipientGroup.feedbackRecipientsId};case H:return{...e,attachments:e.attachments.map((e=>e.name===t.payload.name?{id:t.payload.id,name:e.name,contentLength:e.contentLength,loading:!1}:e))};case Y:return{...e,attachments:a.filter((e=>e.id!==t.payload.attachmentId)),snackMessage:t.payload.error.message,snackType:ie};case B:return{...e,attachments:e.attachments.concat({name:t.payload.name,contentLength:t.payload.size,loading:!0})};case z:return{...e,attachments:a.filter((e=>e.id!==t.payload.attachmentId))};case X:return{...e,attachments:a.filter((e=>e.name!==t.payload.attachmentName))};case K:return{...e,attachments:[]};case J:return{...e,dhis2CoreVersion:t.payload};default:return e}};const Ra=[xa.a],Aa=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Ma.d,Oa=Object(Ma.c)({messaging:Fa});var _a=Object(Ma.e)(Oa,Aa(Object(Ma.a)(...Ra)));s(607),s(22);t.default=()=>{const e=Object(l.d)();return he=e,i.a.createElement(r.a,{store:_a},i.a.createElement(o.a,{muiTheme:g},i.a.createElement(ba,null)))}}}]);
//# sourceMappingURL=app.fd470d2e.chunk.js.map