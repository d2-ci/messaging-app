(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{753:function(e,t,s){},773:function(e,t,s){},784:function(e,t,s){},794:function(e,t,s){},800:function(e,t,s){"use strict";s.r(t);var a=s(1),i=s.n(a),n=s(7),r=s(795),o=s(423),l=s(190),c=s(301),p=s.n(c);var d=s(390),h=s.n(d),g=s(313);const m="Roboto, Helvetica, Arial, sans-serif";function u(e,t){const s=e.length;for(let a=0;a<s;a++)if(e[a].id===t)return a}function y(e,t){let s=null;return function(){const a=this,i=arguments;clearTimeout(s),s=setTimeout((function(){e.apply(a,i)}),t)}}function E(e){return e>30}const C=({messageType:e,page:t,messageFilter:s,status:a,priority:i,assignedToMeFilter:n,markedForFollowUpFilter:r,unreadFilter:o})=>{const l=["messageType:eq:".concat(e)];return"undefined"!==typeof a&&l.push("status:eq:".concat(a)),"undefined"!==typeof i&&l.push("priority:eq:".concat(i)),r&&l.push("followUp:eq:true"),o&&l.push("read:eq:false"),Object(g.getInstance)().then(e=>(n&&l.push("assignee.id:eq:".concat(e.currentUser.id)),e.Api.getApi().get("messageConversations?pageSize=".concat(35,"&page=").concat(t).concat(""!==s&&void 0!==s?"&queryString=".concat(s):""),{fields:["id, displayName, subject, messageType, lastSender[id, displayName], assignee[id, displayName], status, priority, lastUpdated, read, lastMessage, followUp"],order:"lastMessage:desc",filter:l}))).then(e=>({messageConversations:e.messageConversations,pager:e.pager})).catch(e=>{throw e})},S=(e,t)=>Object(g.getInstance)().then(s=>void 0===t?s.Api.getApi().delete("messageConversations/".concat(e,"/assign")):s.Api.getApi().post("messageConversations/".concat(e,"/assign?userId=").concat(t))).then(e=>e).catch(e=>{throw e}),T=({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a})=>Object(g.getInstance)().then(t=>{if(t.system.version.minor>34){const a=s?"userLookup/feedbackRecipients":"userLookup";return t.Api.getApi().get("".concat(a,"?query=").concat(e))}{const i=["displayName:token:".concat(e)];return s&&i.push("userGroups.id:eq:".concat(a)),t.Api.getApi().get("users",{pageSize:10,filter:i})}}).then(({users:s})=>t?{users:s,undefined:void 0}:(e=>Object(g.getInstance)().then(t=>t.Api.getApi().get("userGroups",{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e)]})).then(e=>e).catch(e=>{throw e}))(e).then(({userGroups:t})=>(e=>Object(g.getInstance)().then(t=>t.Api.getApi().get("organisationUnits",{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e),"users:gte:1"]})).then(e=>e).catch(e=>{throw e}))(e).then(({organisationUnits:e})=>({users:s,userGroups:t,organisationUnits:e})))).catch(e=>{throw e}),v=({users:e,userGroups:t,organisationUnits:s,messageConversationId:a})=>Object(g.getInstance)().then(i=>i.Api.getApi().post("messageConversations/".concat(a,"/recipients"),{users:e,userGroups:t,organisationUnits:s})).catch(e=>{throw e});const f=e=>Object(g.getInstance)().then(t=>t.Api.getApi().post("/fileResources?domain=MESSAGE_ATTACHMENT",function(e){const t=new FormData;return t.append("file",e),t}(e))).catch(e=>{throw e});const k=(e,t,s)=>Object(g.getInstance)().then(a=>{const i=a.Api.getApi().baseUrl;return function(e){const t=document.createElement("a");t.href=e,t.setAttribute("target","_blank"),document.body.appendChild(t),t.click()}("".concat(i,"/messageConversations/").concat(e,"/").concat(t,"/attachments/").concat(s))}).catch(e=>{throw e});var M=s(10),A=s.n(M);const b=(e,t)=>({type:e,payload:t}),x=e=>async t=>{t(b("SET_SELECTED_MESSAGE_CONVERSATION"));try{const s=await(e=>Object(g.getInstance)().then(t=>t.Api.getApi().get("messageConversations/".concat(e.id),{fields:["*,assignee[id, displayName],messages[*,sender[id,displayName],attachments[id, name, contentLength]],userMessages[user[id, displayName]]"]})).then(e=>e).catch(e=>{throw e}))(e);t(b("SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS",{messageConversation:s}))}catch(s){t(b("SET_SELECTED_MESSAGE_CONVERSATION_ERROR",{error:s}))}},I=(e,t,s=!1)=>async(a,i)=>{const n=[],r=i(),{messageFilter:o,statusFilter:l,priorityFilter:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h}=r.messaging;e=e||r.messaging.selectedMessageType,t=t||r.messaging.selectedMessageType.id,a(b("LOAD_MESSAGE_CONVERSATIONS",{messageType:e,loadMore:s}));try{for(let t=1;t<=e.page;t++){const s=C({messageType:e.id,page:t,messageFilter:o,status:l,priority:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h}).then(e=>({messageConversations:e.messageConversations,pager:e.pager}));n.push(s)}const s=await Promise.all(n),i=await(e=>Object(g.getInstance)().then(t=>t.Api.getApi().get("messageConversations",{fields:"read",filter:["read:eq:false","messageType:eq:".concat(e)]})).then(e=>e.pager.total).catch(e=>{throw e}))(e.id),r=s.reduce((e,t)=>e.concat(t.messageConversations),[]);a(b("MESSAGE_CONVERSATIONS_LOAD_SUCCESS",{messageConversations:r,pager:s[s.length-1].pager,messageType:e,selectedMessageType:t,nrOfUnread:i}))}catch(m){a(b("MESSAGE_CONVERSATIONS_LOAD_ERROR",{error:m}))}},w=(e,t,s)=>async a=>{try{await("read"===e?(n=t,Object(g.getInstance)().then(e=>e.Api.getApi().post("messageConversations/read",n)).then(e=>e).catch(e=>{throw e})):(i=t,Object(g.getInstance)().then(e=>e.Api.getApi().post("messageConversations/unread",i)).then(e=>e).catch(e=>{throw e}))),a(b("MARK_MESSAGE_CONVERSATIONS_SUCCESS",{messageType:s,page:1})),a(I())}catch(r){a(b("MARK_MESSAGE_CONVERSATIONS_ERROR",{error:r}))}var i,n},R=e=>async t=>{t(b("ADD_ATTACHMENT",e));try{const s=await f(e);t(b("ADD_ATTACHMENT_SUCCESS",{id:s.response.fileResource.id,name:e.name,contentLength:s.response.fileResource.contentLength}))}catch(s){t(b("ADD_ATTACHMENT_ERROR",{error:s}))}},F=()=>b("CLEAR_CHECKED"),O=()=>b("CLEAR_SELECTED_MESSAGE_CONVERSATION"),_=({message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a})=>b("DISPLAY_SNACK_MESSAGE;",{message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a}),N=(e,t)=>b("SET_FILTER",{filter:e,filterType:t}),D=(e,t,s)=>b("UPDATE_INPUT_FIELDS",{subject:e,input:t,recipients:s}),U=()=>b("CLEAR_ATTACHMENTS"),L=e=>b("SET_SELECTED_MESSAGE_TYPE",{messageTypeId:e}),G=e=>b("REMOVE_ATTACHMENT",{attachmentId:e}),j=e=>b("CANCEL_ATTACHMENT",{attachmentName:e});var P=s(193),V=s(369),H=s.n(V),W=s(197),B=s(227),q=H()({palette:{negative:B.pinkA200,blue50:B.blue50,primary1Color:"#1D8BF1",primary2Color:B.blue100,primary3Color:B.blue300,primary4Color:B.blue500,accent1Color:B.grey50,accent2Color:B.grey100,accent3Color:B.grey300,accent4Color:B.grey500,followUp:B.orange500,darkGray:B.grey700,superDarkGray:B.grey900,textColor:B.darkBlack,alternateTextColor:B.white,canvasColor:B.white,borderColor:B.grey300,clockCircleColor:Object(W.fade)(B.darkBlack,.07),shadowColor:B.fullBlack}});const Y={NEGATIVE:q.palette.negative,NEUTRAL:q.palette.primary1Color,POSITIVE:q.palette.alternateTextColor};class K extends a.Component{constructor(e){super(e),this.closeMessage=()=>{this.props.clearSnackMessage(),this.setState({show:!1}),this.props.onSnackRequestClose&&this.props.onSnackRequestClose()},this.state={show:!1}}componentDidUpdate(e,t){!t.show&&this.props.message&&this.setState({show:!0})}render(){return i.a.createElement(p.a,{open:""!==this.props.message&&this.state.show,message:this.props.message||"Missing snackbar message",autoHideDuration:4e3,onRequestClose:this.closeMessage,action:this.props.onSnackActionClick&&"undo",onActionClick:()=>{this.props.onSnackActionClick(),this.setState({show:!1})},contentStyle:{color:Y[this.props.type]},style:{pointerEvents:"none",whiteSpace:"nowrap"},bodyStyle:{pointerEvents:"initial",maxWidth:"none"}})}}var z=Object(P.a)(Object(l.b)(e=>({message:e.messaging.snackMessage,type:e.messaging.snackType,onSnackActionClick:e.messaging.onSnackActionClick,onSnackRequestClose:e.messaging.onSnackRequestClose}),{clearSnackMessage:()=>b("CLEAR_SNACK_MESSAGE")}),P.b)(K),X=s(796),J=s(0),Q=s(196),Z=s.n(Q),$=s(785),ee=s.n($),te=s(5),se=s.n(te),ae=s(797),ie=Object(ae.a)(),ne=s(420),re=s.n(ne),oe=s(419),le=s.n(oe),ce=s(186),pe=s.n(ce),de=s(191),he=s.n(de),ge=s(245),me=s.n(ge),ue=s(179),ye=s.n(ue),Ee=s(215),Ce=s.n(Ee),Se=s(244),Te=s.n(Se),ve=s(290),fe=s.n(ve),ke=s(759),Me=s.n(ke),Ae=s(754),be=s.n(Ae);s(753);const xe=({dataDirection:e,attachment:t,removeAttachment:s,downloadAttachment:a,cancelAttachment:n})=>i.a.createElement(pe.a,{className:"attachment__button",backgroundColor:q.palette.accent2Color,label:"".concat(t.name," (").concat(parseFloat(parseInt(t.contentLength,10)/1e6).toFixed(2)," MB)"),labelPosition:"after",onClick:()=>{"download"===e?a(t):t.loading?n(t.name):s(t)},icon:"download"===e?i.a.createElement(be.a,null):i.a.createElement(Me.a,null)},t.loading&&i.a.createElement(fe.a,{className:"attachment__progress",mode:"indeterminate"}));var Ie=({dataDirection:e,attachments:t,style:s,removeAttachment:a,downloadAttachment:n,cancelAttachment:r})=>i.a.createElement("div",{className:"attachment",style:{...s}},t.map((t,s)=>i.a.createElement(xe,{key:"".concat(t.name,"-").concat(s),dataDirection:e,attachment:t,removeAttachment:a,downloadAttachment:n,cancelAttachment:r}))),we=s(760),Re=s.n(we);const Fe={canvas:e=>({backgroundColor:e,padding:"16px 16px 16px 16px"}),innerCanvas:{margin:"",paddingBottom:"0px"},cardText:{padding:"16px 0px 16px 0px",fontFamily:m,whiteSpace:"pre-wrap",wordBreak:"break-word"},fromFormat:{fontFamily:m},datePlacement:{display:"flex",justifyContent:"flex-end",marginRight:"10px"},dateFormat:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:m}};var Oe=({displayTimeDiff:e,message:t,currentUser:s,lastMessage:a,downloadAttachment:n,cancelAttachment:r,enableAttachments:o})=>{const l=t.sender?s&&s.id===t.sender.id?"me":t.sender.displayName:"system",c=A()(),p=A()(t.created).add(e);return i.a.createElement("div",{style:Fe.canvas(q.palette.canvasColor)},i.a.createElement("div",{style:Fe.innerCanvas},i.a.createElement("div",{style:Fe.fromFormat},t.internal?se.a.t("Internal message from ".concat(l)):se.a.t("Message from ".concat(l))),i.a.createElement("div",{placement:"bottom",style:Fe.datePlacement},i.a.createElement("div",{style:Fe.dateFormat},c.diff(p,"hours")<72?"".concat(p.from(c),", ").concat(p.format("HH:mm")):c.year()===p.year()?p.format("MMM DD, HH:mm"):p.format("MMM DD, YYYY HH:mm"))),o&&i.a.createElement(Ie,{dataDirection:"download",style:{paddingLeft:0},attachments:t.attachments,downloadAttachment:n,cancelAttachment:r}),i.a.createElement(Te.a,{style:Fe.cardText},i.a.createElement(Re.a,null,t.text))),!a&&i.a.createElement(Ce.a,null))},_e=s(243),Ne=s(248),De=s.n(Ne),Ue=s(194),Le=s.n(Ue),Ge=s(774),je=s.n(Ge);s(773);const Pe=e=>t=>{const s=t.target.files;s.length>0&&e(s[0])};var Ve=({addAttachment:e})=>i.a.createElement(pe.a,{className:"attachment__upload-button",label:se.a.t("Upload attachment"),labelPosition:"after",containerElement:"label",icon:i.a.createElement(je.a,null)},i.a.createElement("input",{className:"attachment__upload-button--input",type:"file",onChange:Pe(e)}));class He extends a.Component{constructor(e){super(e),this.replyMessage=e=>{const{input:t,selectedMessageConversation:s,selectedMessageType:a}=this.props;this.props.replyMessage({message:t,internalReply:e,messageConversation:s,messageType:a}),this.wipeInput()},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),this.setState({inputError:!1})},this.texFieldUpdate=(e,t)=>{this.props.updateInputFields("",t,[])},this.handleDiscard=()=>{const e=se.a.t("Reply discarded");this.setState({discardState:!0}),this.props.displaySnackMessage({message:e,onSnackActionClick:()=>this.setState({discardState:!1}),onSnackRequestClose:()=>{this.setState({discardState:!1}),this.wipeInput()},snackType:"NEGATIVE"}),this.setState({expanded:!1})},this.state={discardState:!1}}componentWillUnmount(){this.wipeInput()}render(){return i.a.createElement(_e.Card,{style:{marginTop:"5px"},expanded:!0},i.a.createElement(_e.CardText,{style:{padding:"0px 0px 0px 16px"}},i.a.createElement(Le.a,{key:this.props.messageConversation.id,id:this.props.messageConversation.id,rows:5,underlineShow:!1,value:this.state.discardState?"":this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:se.a.t("Message"),onChange:this.texFieldUpdate}),this.props.enableAttachments&&!this.state.discardState&&i.a.createElement(Ie,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(_e.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(De.a,{primary:!0,label:se.a.t("Reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!1)}),this.props.isInFeedbackRecipientGroup&&"TICKET"===this.props.selectedMessageType.id&&i.a.createElement(pe.a,{primary:!0,label:se.a.t("Internal reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!0)}),i.a.createElement(pe.a,{label:se.a.t("Discard"),disabled:""===this.props.input||this.state.discardState,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(Ve,{addAttachment:e=>{this.props.addAttachment(e)}}),")")))}}var We=Object(P.a)(Object(l.b)(e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes,input:e.messaging.input,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments,enableAttachments:E(e.messaging.dhis2CoreVersion)}),{replyMessage:({message:e,internalReply:t,messageConversation:s,messageType:a})=>async(i,n)=>{try{const{id:r}=s,o=n().messaging.attachments.map(e=>e.id);await(({message:e,internalReply:t,attachments:s,id:a})=>Object(g.getInstance)().then(i=>i.Api.getApi().post("messageConversations/".concat(a,"?internal=").concat(t).concat(s.length>0?"&attachments=".concat(s):""),e,{headers:{"Content-Type":"text/plain"}})).catch(e=>{throw e}))({message:e,internalReply:t,attachments:o,id:r}),i(b("REPLY_MESSAGE_SUCCESS",{messageConversation:s,messageType:a,page:1})),i(I()),i(x(s))}catch(r){i(b("REPLY_MESSAGE_ERROR",{error:r}))}},setSelectedMessageType:L,updateInputFields:D,displaySnackMessage:_,addAttachment:R,removeAttachment:G,cancelAttachment:j},null,{pure:!1}))(He),Be=s(775),qe=s.n(Be);class Ye extends a.Component{constructor(...e){super(...e),this.state={input:"",searchResult:[],searchOnlyUsers:this.props.searchOnlyUsers,searchOnlyFeedbackRecipients:this.props.searchOnlyFeedbackRecipients,lastSearch:"",errorText:void 0},this.debouncedSearch=y(this.search.bind(this),300),this.onSuggestionClick=e=>{if(void 0!==this.props.onSuggestionClick)this.props.onSuggestionClick(e);else{this.wipeInput(),this.debouncedSearch("");!this.props.recipients.find(t=>t.id===e.id)&&this.props.updateRecipients([...this.props.recipients,this.state.searchResult.find(t=>t.id===e.id)])}},this.onRemoveChip=e=>{this.props.updateRecipients(this.props.recipients.filter(t=>t.id!==e))},this.wipeInput=()=>{this.setState({input:"",searchResult:[]})},this.updateInput=e=>{this.debouncedSearch(e),this.setState({input:e})}}search(e){if(!this.state.searchResult.find(t=>t.displayName===e)&&""!==e&&e.length>=2){const{feedbackRecipientsId:t,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a}=this.props;T({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a,feedbackRecipientsId:t}).then(({users:e,userGroups:t,organisationUnits:s})=>{const a=e=>t=>({...t,type:e});let i=e.map(a("user"));this.state.searchOnlyUsers||(i=i.concat(t.map(a("userGroup"))).concat(s.map(a("organisationUnit")))),this.setState({searchResult:i,errorText:0===i.length?se.a.t("No results found"):void 0})})}else this.setState({lastSearch:e,searchResult:""!==this.state.lastSearch&&""===e||e.length<2?[]:this.state.searchResult,errorText:""!==e&&e.length<2?se.a.t("Please enter at least ".concat(2," characters")):this.state.searchWarning})}render(){return i.a.createElement("div",{style:{...this.props.style,height:this.props.inputHeight}},i.a.createElement(qe.a,{style:{marginBottom:16},disabled:void 0!==this.props.disabled&&this.props.disabled,errorText:this.props.errorText||this.state.errorText,value:this.props.recipients,fullWidth:!0,openOnFocus:!0,searchText:this.state.input,floatingLabelText:this.props.label,dataSource:this.state.searchResult,dataSourceConfig:{text:"displayName",value:"id"},onUpdateInput:this.updateInput,onRequestAdd:e=>this.onSuggestionClick(e),onRequestDelete:e=>this.onRemoveChip(e)}))}}var Ke=Ye;const ze={subheaderTitle:{height:"32px",color:"black",paddingLeft:0,paddingRight:16},subheader:(e,t)=>({height:"32px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:0,color:e,fontWeight:t})};var Xe=({showTitle:e,title:t,label:s,color:a,fontWeight:n})=>{const r=s&&"NONE"!==s?"Assignee"===t?s:"".concat(s.charAt(0)).concat(s.toLowerCase().substr(1,s.length)):"-";return i.a.createElement("div",{style:{flex:2,paddingLeft:10,maxWidth:200}},e&&i.a.createElement(Z.a,{style:ze.subheaderTitle}," ",t," "),i.a.createElement(Z.a,{style:ze.subheader(a,n)},r))};const Je={canvas:{flex:"3 0",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)",paddingTop:"10px"},innerCanvas:{display:"flex",flexDirection:"column",margin:"0px 10px 0px 10px"},header:{display:"flex"},iconButton:{display:"flex",alignSelf:"center"},subjectSubheader:{display:"flex",alignSelf:"center",fontSize:"20px",fontFamily:m},participantsCanvas:{display:"flex",flexDirection:"column"},participants:{paddingLeft:"12px",paddingTop:"10px",display:"flex",flexWrap:"wrap"},chip:{height:"32px",marginRight:"3px",marginBottom:"3px"},participantAddRow:{display:"flex"},participantsSuggestionField:{paddingLeft:"12px",marginBottom:"0px",flex:1},participantsAdd:{alignSelf:"flex-end",marginBottom:"28px",paddingLeft:"12px"},messagesCanvas:{marginBottom:"50px",display:"flex",flexDirection:"column",backgroundColor:q.palette.accent2Color,margin:"0px 10px 10px 10px"},messagesInnerCanvas:{padding:"0px"}};const Qe=["TICKET","VALIDATION_RESULT"];class Ze extends a.Component{constructor(e){super(e),this.backToList=()=>{const{clearSelectedMessageConversation:e,messageConversation:t}=this.props;ie.push("/".concat(t.messageType)),e()},this.addRecipients=()=>{const e=this.state.recipients.filter(e=>"user"===e.type),t=this.state.recipients.filter(e=>"userGroup"===e.type),s=this.state.recipients.filter(e=>"organisationUnit"===e.type),{messageConversation:a,selectedMessageType:i}=this.props;this.props.addRecipients({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i}),this.setState({recipients:[]})},this.updateRecipients=e=>{this.setState({recipients:e})},this.state={recipients:[],currentUser:void 0,cursor:"auto"}}componentDidMount(){Object(g.getInstance)().then(e=>{this.setState({currentUser:e.currentUser})})}render(){const{messageConversation:e}=this.props,t=e.messages,s=!!(Qe.indexOf(e.messageType)+1),a=e.userMessages.slice(0,30).map(e=>"undefined"===typeof this.state.currentUser||this.state.recipientsExpanded||this.state.currentUser.id!==e.user.id?e.user.displayName:se.a.t("me")),n=e.userMessages.length;return n>30&&a.push(" + ".concat(n-30)),i.a.createElement("div",{id:"messageconversation",style:Je.canvas},i.a.createElement("div",{style:Je.innerCanvas},i.a.createElement("div",{style:Je.header},i.a.createElement(he.a,{style:Je.iconButton,tooltipPosition:"bottom-right",onClick:this.backToList,tooltip:se.a.t("Show all messages")},i.a.createElement(le.a,null)),i.a.createElement(Z.a,{style:Je.subjectSubheader},e.subject),this.props.displayExtendedChoices&&i.a.createElement(Xe,{color:q.palette.darkGray,showTitle:!0,title:se.a.t("Status"),label:e.status}),this.props.displayExtendedChoices&&i.a.createElement(Xe,{color:q.palette.darkGray,showTitle:!0,title:se.a.t("Priority"),label:e.priority}),s&&i.a.createElement(Xe,{color:q.palette.darkGray,showTitle:!0,title:se.a.t("Assignee"),label:e.assignee?e.assignee.displayName:void 0})),i.a.createElement("div",{style:Je.participantsCanvas},i.a.createElement(Z.a,{style:{paddingLeft:"12px",paddingTop:"10px"}},se.a.t("Participants")),i.a.createElement("div",{style:Je.participants},a.map(e=>i.a.createElement(me.a,{key:e,style:Je.chip},e)))),i.a.createElement("div",{style:Je.participantAddRow},i.a.createElement(Ke,{style:Je.participantsSuggestionField,label:se.a.t("Add participants to conversation"),messageConversation:e,recipients:this.state.recipients,updateRecipients:this.updateRecipients,limitSearchArray:e.userMessages}),i.a.createElement("div",{style:Je.participantsAdd},i.a.createElement(pe.a,{icon:i.a.createElement(re.a,null),onClick:()=>this.addRecipients(),label:se.a.t("Add")})))),i.a.createElement("div",{style:Je.messagesCanvas},i.a.createElement(ye.a,{style:Je.messagesInnerCanvas},t.map((a,n)=>i.a.createElement(Oe,{key:a.id,displayTimeDiff:this.props.displayTimeDiff,message:a,messageConversation:e,notification:s,currentUser:this.state.currentUser,lastMessage:n+1===t.length,downloadAttachment:t=>this.props.downloadAttachment(e.id,a.id,t.id),cancelAttachment:this.props.cancelAttachment,enableAttachments:this.props.enableAttachments}))),i.a.createElement(We,Object.assign({},this.props,{messageConversation:e}))))}}var $e=Object(P.a)(Object(l.b)(e=>({selectedMessageType:e.messaging.selectedMessageType,displayTimeDiff:e.messaging.displayTimeDiff,enableAttachments:E(e.messaging.dhis2CoreVersion)}),{addRecipients:({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i})=>async n=>{try{const{id:r}=a;await v({users:e,userGroups:t,organisationUnits:s,messageConversationId:r}),n(b("ADD_RECIPIENTS_SUCCESS",{messageConversation:a,messageType:i,page:1})),n(x(a))}catch(r){n(b("ADD_RECIPIENTS_ERROR",{error:r}))}},downloadAttachment:(e,t,s)=>async a=>{try{await k(e,t,s),a(b("DOWNLOAD_ATTACHMENT_SUCCESS"))}catch(i){a(b("DOWNLOAD_ATTACHMENT_ERROR",{error:i}))}},cancelAttachment:j,clearSelectedMessageConversation:O},null,{pure:!1}))(Ze),et=s(291),tt=s(307),st=s.n(tt),at=s(246),it=s.n(at),nt=s(279),rt=s.n(nt);class ot extends a.Component{constructor(e){super(e),this.onClick=()=>{this.props.onClick()},this.onMouseEnter=()=>{this.setHoverText(),this.setState({cursor:"pointer"})},this.onMouseLeave=()=>{this.setNeutralText(),this.setState({cursor:"auto"})},this.setNeutralText=()=>this.setTextColor(q.palette.accent2Color),this.setHoverText=()=>this.setTextColor(q.palette.accent3Color),this.setTextColor=e=>{this.setState({backgroundColor:e})},this.getBackgroundColor=(e,t)=>e&&t===e.id?q.palette.accent3Color:this.state.backgroundColor,this.state={backgroundColor:q.palette.accent2Color,textColor:q.palette.darkGray}}render(){return i.a.createElement("div",{role:"presentation",style:{...this.state,backgroundColor:this.getBackgroundColor(this.props.selectedMessageType,this.props.messageType.id),cursor:this.state.cursor,alignItems:"center",height:"49px",display:"flex",flexDirection:"row",justifyContent:"space-between"},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:()=>this.onClick()},i.a.createElement(Z.a,{style:{marginLeft:"5px",fontSize:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?"18px":"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?q.palette.primary1Color:this.state.textColor}},se.a.t(this.props.messageType.displayName)),this.props.loading?i.a.createElement(it.a,{style:{marginRight:"10px"},color:q.palette.primary1Color,size:24}):this.props.messageType.unread>0&&i.a.createElement(rt.a,{style:{marginTop:"12px",marginRight:"5px"},badgeContent:this.props.messageType.unread>100?"99+":this.props.messageType.unread,secondary:!0,badgeStyle:{backgroundColor:"#439E8E"}}))}}var lt=ot;const ct={canvas:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"calc(100vh - 95px)",borderLeftStyle:"solid",borderLeftWidth:"0.5px",borderLeftColor:q.palette.accent4Color,borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:q.palette.accent4Color,overflowY:"auto",overflowX:"hidden",minWidth:"200px"}};class pt extends a.Component{constructor(e){super(e),this.props.setSelectedMessageType(this.props.match.params.messageType)}render(){const e=this.props.messageTypes;return i.a.createElement("div",{style:ct.canvas},i.a.createElement(et.List,{style:{padding:"0px"}},e&&e.map(e=>i.a.createElement("div",{key:e.id},i.a.createElement(lt,{messageType:e,onClick:()=>{this.props.setSelectedMessageType(e.id),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),ie.push("/".concat(e.id))},selectedMessageType:this.props.selectedMessageType,loading:e.loading}),i.a.createElement(Ce.a,null)))),i.a.createElement(st.a,{style:{width:"",margin:"20px"},label:"".concat(se.a.t("Auto refresh")," (").concat(A()(this.props.refreshTimer).format("mm:ss"),")"),toggled:this.props.autoRefresh,onToggle:()=>this.props.setAutoRefresh(!this.props.autoRefresh)}))}}var dt=Object(P.a)(Object(l.b)(e=>({selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes}),{setSelectedMessageType:L,clearCheckedIds:F},null,{pure:!1}))(pt);const ht={overflowY:"scroll",overflowX:"hidden",borderRightWidth:"1px",borderRightColor:q.palette.accent4Color,height:"calc(100vh - 95px)"},gt={paddingLeft:"0px",fontSize:"20px"};var mt=s(216),ut=s.n(mt);const yt={canvas:e=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",alignSelf:"center",boxShadow:"none",borderBottom:"1px solid #dfdfdf"}),checkBox:{flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:"12px"},sender:{fontFamily:m,fontSize:"16px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"black",paddingLeft:10,alignSelf:"center"},subject:{flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:m,fontSize:"16px",color:"black",paddingLeft:10},extendedLabel:{flex:2,color:"black",fontSize:"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 0 0 10px"}};class Et extends a.Component{constructor(e){super(e),this.state={cursor:"auto",allChecked:!1}}componentDidUpdate(){this.state.allChecked&&this.props.checkedIds.length<this.props.messages.length&&this.setState({allChecked:!1})}render(){const e=this.props.displayExtendedChoices;return i.a.createElement(ye.a,{style:yt.canvas(q.palette.canvasColor)},i.a.createElement(ut.a,{checked:this.state.allChecked,style:yt.checkBox,onCheck:()=>{this.state.allChecked?this.props.clearCheckedIds():this.props.setAllChecked(this.props.messages.map(e=>({id:e.id}))),this.setState({allChecked:!this.state.allChecked})}}),i.a.createElement("div",{style:yt.sender},se.a.t("Sender")),i.a.createElement(Z.a,{style:yt.subject},se.a.t("Subject")),e&&i.a.createElement(Z.a,{style:yt.extendedLabel},se.a.t("Status")),e&&i.a.createElement(Z.a,{style:yt.extendedLabel},se.a.t("Priority")),this.props.notification&&i.a.createElement(Z.a,{style:yt.extendedLabel},se.a.t("Assignee")),i.a.createElement(Z.a,{style:yt.extendedLabel},se.a.t("Date")))}}var Ct=Object(P.a)(Object(l.b)(e=>({checkedIds:e.messaging.checkedIds,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup}),{setAllChecked:e=>b("SET_ALL_CHECKED",{messageConversationIds:e}),clearCheckedIds:F}))(Et),St=s(776),Tt=s.n(St);const vt={container:(e,t,s)=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",cursor:s,boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",boxShadow:"none",borderBottom:"1px solid #dfdfdf",flexWrap:t?"nowrap":"wrap"}),checkBox:e=>({flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:e?12:6}),flag:{color:q.palette.followUp,marginRight:4},sender:(e,t)=>({fontFamily:m,fontSize:"14px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",color:"black",paddingLeft:e?10:0,fontWeight:t}),subject:(e,t,s)=>({flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingLeft:10,fontFamily:m,color:t,fontWeight:s,order:e?"inherit":10,marginTop:e?0:-10,flexBasis:e?"0%":"100%"}),dateFormat:(e,t,s)=>({flex:2,fontFamily:m,paddingLeft:e?10:0,paddingRight:e?0:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:e?"":"end",color:t,fontWeight:s})};class ft extends a.Component{constructor(e){super(e),this.onClick=e=>{this.props.setSelectedMessageConversation(e),e&&!e.read&&this.props.markMessageConversations("read",[e.id],this.props.selectedMessageType),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),ie.push("/".concat(e.messageType,"/").concat(e.id))},this.onMouseEnter=()=>this.setState({cursor:"pointer",backgroundColor:q.palette.accent2Color}),this.onMouseLeave=()=>this.setState({cursor:"auto",backgroundColor:q.palette.canvasColor}),this.getBackgroundColor=(e,t)=>{const s=this.props.selectedMessageConversation&&e.id===this.props.selectedMessageConversation.id;return t&&!s?q.palette.blue50:s?q.palette.accent3Color:this.state.backgroundColor},this.state={backgroundColor:q.palette.canvasColor,cursor:"auto"}}render(){const e=this.props.messageConversation,t=e.lastSender?e.lastSender.displayName:this.props.selectedMessageType.displayName,s=!!this.props.checkedIds.find(t=>t.id===e.id),a=this.props.displayExtendedChoices,n=this.props.displayTimeDiff,r=A()(),o=A()(e.lastMessage).add(n),l=e.read?"":"bold",c=this.props.messageConversation.read?"black":q.palette.darkGray,p=this.getBackgroundColor(e,s);return i.a.createElement(ye.a,{style:vt.container(p,this.props.wideview,this.state.cursor),onClick:t=>{void 0!==t.target.innerText&&""!==t.target.innerText&&!this.props.settingSelectedMessageConversation&&(this.onClick(e),this.props.checkedIds.length>0&&this.props.clearCheckedIds(),!this.props.wideview||void 0===this.props.messageFilter&&void 0===this.props.priorityFilter&&void 0===this.props.statusFilter||this.props.setFilter(void 0,"MESSAGE"))},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},i.a.createElement(ut.a,{checked:s,style:vt.checkBox(this.props.wideview),onCheck:()=>{this.props.setChecked(e,!s)}}),i.a.createElement("div",{style:vt.sender(this.props.wideview,l)},e.followUp&&i.a.createElement(Tt.a,{style:vt.flag}),i.a.createElement("span",null,t)),i.a.createElement(Z.a,{style:vt.subject(this.props.wideview,c,l)},e.subject),a&&i.a.createElement(Xe,{showTitle:!1,title:se.a.t("Status"),color:c,fontWeight:l,label:e.status}),a&&i.a.createElement(Xe,{showTitle:!1,title:se.a.t("Priority"),color:c,fontWeight:l,label:e.priority}),this.props.notification&&this.props.wideview&&i.a.createElement(Xe,{showTitle:!1,title:se.a.t("Assignee"),color:c,fontWeight:l,label:e.assignee?e.assignee.displayName:void 0}),i.a.createElement(Z.a,{style:vt.dateFormat(this.props.wideview,c,l)},r.diff(o,"hours")<72?o.from(r):r.year()===o.year()?o.format("MMM DD"):o.format("ll")))}}var kt=Object(P.a)(Object(l.b)(e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,checkedIds:e.messaging.checkedIds,displayTimeDiff:e.messaging.displayTimeDiff,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,attachments:e.messaging.attachments}),{setChecked:(e,t)=>b("SET_CHECKED",{messageConversation:e,selectedValue:t}),setSelectedMessageConversation:x,markMessageConversations:w,clearCheckedIds:F,setFilter:N,updateInputFields:D,clearAttachments:U},null,{pure:!1}))(ft);const Mt=["VALIDATION_RESULT","TICKET"],At={canvas:e=>({flex:"1 0",maxWidth:e?"none":"350px",minWidth:e?"none":"250px",borderRightStyle:e?"":"solid",...ht}),loading:{backgroundColor:q.palette.accent2Color,height:"".concat(50,"px"),transition:"all 0.2s ease-in-out",display:"flex",justifyContent:"center"}};class bt extends a.Component{constructor(...e){super(...e),this.onScroll=e=>{const t=document.getElementById("messagelist");!this.props.selectedMessageType.loading&&this.isBottom(t)&&e.loaded<e.total&&this.props.loadMessageConversations(e,e.id,!0)},this.debouncedOnScroll=y(this.onScroll,150),this.isBottom=e=>e.scrollHeight-e.scrollTop<window.outerHeight}render(){const e=function(e){if(!Array.isArray(e))return;const t=new Set;return e.filter(e=>!t.has(e.id)&&(t.add(e.id),!0))}(this.props.messageConversations[this.props.selectedMessageType.id]),t=this.props.selectedMessageType?this.props.selectedMessageType:"",s=this.props.selectedMessageConversation?this.props.selectedMessageConversation.id:"",a=!!(Mt.indexOf(t.id)+1);return i.a.createElement("div",{id:"messagelist",onScroll:()=>this.debouncedOnScroll(this.props.selectedMessageType),style:At.canvas(this.props.wideview)},this.props.wideview&&i.a.createElement(Ct,{notification:a,displayExtendedChoices:this.props.displayExtendedChoices,messages:e}),e&&0!==e.length?e.map(e=>i.a.createElement(kt,{key:e.id,messageConversation:e,wideview:this.props.wideview,selectedValue:s,notification:a,displayExtendedChoices:this.props.displayExtendedChoices})):!this.props.selectedMessageType.loading&&i.a.createElement(Z.a,null,se.a.t("No ".concat(t.displayName.toLowerCase()," messages"))),this.props.selectedMessageType.loading&&i.a.createElement("div",{style:At.loading},i.a.createElement(it.a,{style:{marginTop:"10px"},color:q.palette.primary1Color})))}}var xt=Object(P.a)(Object(l.b)(e=>({messageTypes:e.messaging.messageTypes,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,messageConversations:e.messaging.messageConversations,selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType}),{loadMessageConversations:I},null,{pure:!1}))(bt),It=s(296),wt=s.n(It);const Rt={canvas:{flex:"3 0",margin:"10px",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)"},messageTypeField:{display:"flex",flexDirection:"row"},messageType:{width:"300px",marginTop:"10px"}};class Ft extends a.Component{constructor(e){super(e),this.subjectUpdate=(e,t)=>{this.props.updateInputFields(t,this.props.input,this.props.recipients)},this.inputUpdate=(e,t)=>{this.props.updateInputFields(this.props.subject,t,this.props.recipients)},this.updateRecipients=e=>{this.props.updateInputFields(this.props.subject,this.props.input,e)},this.sendMessage=()=>{const e=this.state.isMessageFeedback?"TICKET":"PRIVATE",t=this.props.messageTypes.find(t=>t.id===e);if(this.state.isMessageFeedback)this.props.sendFeedbackMessage(t),ie.push("/TICKET");else{const e=this.props.recipients.filter(e=>"user"===e.type),s=this.props.recipients.filter(e=>"userGroup"===e.type),a=this.props.recipients.filter(e=>"organisationUnit"===e.type);this.props.sendMessage({users:e,userGroups:s,organisationUnits:a,messageType:t}),ie.push("/PRIVATE")}},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments()},this.handleDiscard=()=>{const e=se.a.t("Message discarded");this.props.displaySnackMessage({message:e,onSnackActionClick:()=>ie.push("/PRIVATE/create"),onSnackRequestClose:()=>this.wipeInput(),snackType:"NEGATIVE"}),ie.push("/PRIVATE")},this.state={isMessageFeedback:!1}}componentDidMount(){const{addRecipientByUserId:e}=this.props,{messageId:t,recipientId:s}=this.props.match.params;"create"===t&&s&&e(s)}render(){const e=""===this.props.subject||""===this.props.input||!this.state.isMessageFeedback&&0===this.props.recipients.length,t=""===this.props.subject&&""===this.props.input&&!this.state.isMessageFeedback&&0===this.props.recipients.length;return i.a.createElement("div",{style:Rt.canvas},i.a.createElement(Z.a,{style:gt}," ",se.a.t("Create")),i.a.createElement(_e.Card,null,i.a.createElement(_e.CardText,null,i.a.createElement(Ke,{style:{margin:"0px"},label:se.a.t("To"),disabled:this.state.isMessageFeedback,recipients:this.state.isMessageFeedback?[{id:"id",displayName:se.a.t("Feedback recipient group")}]:this.props.recipients,updateRecipients:this.updateRecipients,inputHeight:"100px"}),i.a.createElement("div",{style:Rt.messageTypeField},i.a.createElement("div",{style:Rt.messageType},i.a.createElement(wt.a,{label:se.a.t("Private message"),checked:!this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}})),i.a.createElement("div",{style:Rt.messageType},i.a.createElement(wt.a,{label:se.a.t("Feedback message"),checked:this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}}))),i.a.createElement(Le.a,{floatingLabelText:se.a.t("Subject"),fullWidth:!0,value:this.props.subject,onChange:this.subjectUpdate}),i.a.createElement(Le.a,{key:"createMessage",id:"createMessage",rows:5,underlineShow:!1,value:this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:se.a.t("Message"),onChange:this.inputUpdate}),this.props.enableAttachments&&i.a.createElement(Ie,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(_e.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(De.a,{primary:!0,disabled:e,label:se.a.t("Send"),onClick:()=>this.sendMessage()}),i.a.createElement(pe.a,{label:se.a.t("Discard"),disabled:t,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(Ve,{addAttachment:e=>{this.props.addAttachment(e)}})))))}}var Ot=Object(P.a)(Object(l.b)(e=>({messageTypes:e.messaging.messageTypes,subject:e.messaging.subject,input:e.messaging.input,recipients:e.messaging.recipients,attachments:e.messaging.attachments,enableAttachments:E(e.messaging.dhis2CoreVersion)}),{sendMessage:({users:e,userGroups:t,organisationUnits:s,messageType:a})=>async(i,n)=>{try{const{messaging:{subject:r,input:o,attachments:l}}=n();await(({subject:e,users:t,userGroups:s,organisationUnits:a,text:i,attachments:n})=>Object(g.getInstance)().then(r=>r.Api.getApi().post("messageConversations",{subject:e,users:t,userGroups:s,organisationUnits:a,attachments:n,text:i})).catch(e=>{throw e}))({subject:r,users:e,userGroups:t,organisationUnits:s,text:o,attachments:l}),i(b("SEND_MESSAGE_SUCCESS",{messageType:a,page:1})),i(I())}catch(r){i(b("SEND_MESSAGE_ERROR",{error:r}))}},sendFeedbackMessage:e=>async(t,s)=>{const a=s();try{await(i=a.messaging.subject,n=a.messaging.input,Object(g.getInstance)().then(e=>e.Api.getApi().post("messageConversations/feedback?subject=".concat(i),n,{headers:{"Content-Type":"text/plain"}})).then(e=>e).catch(e=>{throw e})),t(b("SEND_MESSAGE_SUCCESS",{messageType:e,page:1})),t(I())}catch(r){t(b("SEND_MESSAGE_ERROR",{error:r}))}var i,n},displaySnackMessage:_,updateInputFields:D,addAttachment:R,removeAttachment:G,cancelAttachment:j,addRecipientByUserId:e=>async t=>{try{const s=await(e=>Object(g.getInstance)().then(t=>t.Api.getApi().get("users/".concat(e),{fields:"id,displayName"})).then(({id:e,displayName:t})=>({id:e,displayName:t,type:"user"})).catch(e=>{throw e}))(e);t(b("ADD_RECIPIENT_BY_ID_SUCCESS",s))}catch(s){console.error(s)}}},null,{pure:!1}))(Ft),_t=s(783),Nt=s.n(_t),Dt=s(782),Ut=s.n(Dt),Lt=s(299),Gt=s.n(Lt),jt=s(213),Pt=s.n(jt),Vt=s(225),Ht=s.n(Vt),Wt=s(247),Bt=s.n(Wt),qt=s(362),Yt=s.n(qt),Kt=s(421),zt=s.n(Kt);var Xt={STATUS:[{key:"NONE",value:"NONE",primaryText:se.a.t("No status")},{key:"OPEN",value:"OPEN",primaryText:se.a.t("Open")},{key:"PENDING",value:"PENDING",primaryText:se.a.t("Pending")},{key:"INVALID",value:"INVALID",primaryText:se.a.t("Invalid")},{key:"SOLVED",value:"SOLVED",primaryText:se.a.t("Solved")}],PRIORITY:[{key:"NONE",value:"NONE",primaryText:se.a.t("No priority")},{key:"HIGH",value:"HIGH",primaryText:se.a.t("High")},{key:"MEDIUM",value:"MEDIUM",primaryText:se.a.t("Medium")},{key:"LOW",value:"LOW",primaryText:se.a.t("Low")}]},Jt=s(217),Qt=s.n(Jt),Zt=s(777),$t=s.n(Zt),es=s(781),ts=s.n(es),ss=s(778),as=s.n(ss),is=s(779),ns=s.n(is),rs=s(780),os=s.n(rs);var ls=({open:e,onRequestClose:t,updateMessageConversations:s,messageType:a,feedbackRecipientsId:n})=>i.a.createElement(Qt.a,{open:e,onRequestClose:()=>{t()}},i.a.createElement(Ke,{onSuggestionClick:e=>{s([e.id]),t()},searchOnlyUsers:!0,searchOnlyFeedbackRecipients:"TICKET"===a.id,feedbackRecipientsId:n,recipients:[],key:"suggestionField",label:se.a.t("Assignee")}));const cs={canvas:{width:"400px",display:"flex"},extendedChoices:{display:"flex",justifyContent:"flex-start"},nrSelected:{padding:"0px 0px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}};class ps extends a.Component{constructor(e){super(e),this.getIds=()=>this.props.selectedMessageConversation&&0===this.props.checkedIds.length?[this.props.selectedMessageConversation.id]:this.props.checkedIds.map(e=>e.id),this.updateMessageConversation=(e,t)=>{const{selectedMessageType:s,selectedMessageConversation:a}=this.props,i=this.getIds();this.props.updateMessageConversations({messageConversationIds:i,identifier:e,value:t,messageType:s,selectedMessageConversation:a}),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.markMessageConversations=e=>{const t=this.getIds();this.props.markMessageConversations(e,t,this.props.selectedMessageType),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.toggleDialog=()=>{this.setState({dialogOpen:!this.state.dialogOpen})},this.state={checkedItems:!1,dialogOpen:!1,assignToOpen:!1}}render(){const e=this.props.selectedMessageConversation,t=this.props.checkedIds.length>0,s=t||void 0!==e,a=i.a.createElement(i.a.Fragment,null,i.a.createElement(pe.a,{label:se.a.t("Cancel"),primary:!0,onClick:()=>this.toggleDialog()}),i.a.createElement(pe.a,{label:se.a.t("Submit"),primary:!0,keyboardFocused:!0,onClick:()=>{this.props.deleteMessageConversations(this.getIds(),this.props.selectedMessageType),this.props.clearCheckedIds(),this.toggleDialog(),this.props.selectedMessageConversation&&(this.props.clearSelectedMessageConversation(),ie.push("/".concat(this.props.selectedMessageType.id)))}})),n=this.props.checkedIds.length>99?"".concat(99,"+"):this.props.checkedIds.length;return s?i.a.createElement("div",{style:cs.canvas},i.a.createElement(Qt.a,{title:se.a.t("Are you sure you want to delete selected message conversation(s)?"),actions:a,modal:!1,open:this.state.dialogOpen,onRequestClose:this.toggleDialog}),i.a.createElement(ls,{open:this.state.assignToOpen,onRequestClose:()=>this.setState({assignToOpen:!this.state.assignToOpen}),updateMessageConversations:e=>this.updateMessageConversation("ASSIGNEE",e),messageType:this.props.selectedMessageType,feedbackRecipientsId:this.props.feedbackRecipientsId}),i.a.createElement("div",{style:cs.extendedChoices},i.a.createElement(he.a,{tooltip:se.a.t("Delete selected"),onClick:()=>{this.toggleDialog()}},i.a.createElement(as.a,null)),i.a.createElement(he.a,{tooltip:se.a.t("Mark selected as unread"),onClick:()=>{this.markMessageConversations("unread")}},i.a.createElement(ns.a,null)),i.a.createElement(he.a,{tooltip:se.a.t("Mark selected as read"),onClick:()=>{this.markMessageConversations("read")}},i.a.createElement(os.a,null)),this.props.displayExtendedChoices&&i.a.createElement(he.a,{onClick:()=>this.setState({assignToOpen:!this.state.assignToOpen}),tooltip:se.a.t("Assign selected")},i.a.createElement(ts.a,null)),i.a.createElement(Bt.a,{iconButtonElement:i.a.createElement(he.a,null,i.a.createElement(zt.a,null)),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"}},i.a.createElement(Pt.a,{key:"markFollowUp",value:"markFollowUp",primaryText:se.a.t("Mark for followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!0)}),i.a.createElement(Pt.a,{key:"clearFollowUp",value:"clearFollowUp",primaryText:se.a.t("Clear followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!1)}),this.props.displayExtendedChoices&&i.a.createElement(Ce.a,null),this.props.displayExtendedChoices&&i.a.createElement(Pt.a,{key:"clearAssigned",value:"clearAssigned",primaryText:se.a.t("Clear assignee"),onClick:()=>this.updateMessageConversation("ASSIGNEE",void 0)}),this.props.displayExtendedChoices&&i.a.createElement(Pt.a,{primaryText:se.a.t("Set status"),key:"setStatus",rightIcon:i.a.createElement($t.a,null),menuItems:Xt.STATUS.map(e=>i.a.createElement(Pt.a,{key:"".concat(e.key,"_status"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("STATUS",e.key)}))}),this.props.displayExtendedChoices&&i.a.createElement(Pt.a,{primaryText:se.a.t("Set priority"),key:"setPriority",rightIcon:i.a.createElement($t.a,null),menuItems:Xt.PRIORITY.map(e=>i.a.createElement(Pt.a,{key:"".concat(e.key,"_priority"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("PRIORITY",e.key)}))}))),t&&i.a.createElement(Ht.a,{style:cs.nrSelected},"".concat(n," ").concat(se.a.t("selected")))):i.a.createElement("div",null)}}var ds=Object(P.a)(Object(l.b)(e=>({selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,checkedIds:e.messaging.checkedIds,feedbackRecipientsId:e.messaging.feedbackRecipientsId}),{clearCheckedIds:F,clearSelectedMessageConversation:O,deleteMessageConversations:(e,t)=>async s=>{try{const a=e.map(e=>(e=>Object(g.getInstance)().then(t=>t.Api.getApi().delete("messageConversations/".concat(e,"/").concat(t.currentUser.id))).then(e=>e).catch(e=>{throw e}))(e));await Promise.all(a),s(b("MESSAGE_CONVERSATIONS_DELETE_SUCCESS",{messageType:t,page:1})),s(I())}catch(a){s(b("MESSAGE_CONVERSATIONS_DELETE_ERROR",{error:a}))}},updateMessageConversations:({messageConversationIds:e,identifier:t,value:s,messageType:a,selectedMessageConversation:i})=>async n=>{if("FOLLOW_UP"===t)try{await((e,t)=>Object(g.getInstance)().then(s=>s.Api.getApi().post("messageConversations/".concat(t?"followup":"unfollowup"),e)).then(e=>e).catch(e=>{throw e}))(e,s),n(b("MESSAGE_CONVERSATION_UPDATE_SUCCESS",{messageType:a,page:1,identifier:t})),n(I())}catch(r){n(b("MESSAGE_CONVERSATION_UPDATE_ERROR",{error:r}))}else{const i=e.map(e=>{let i;switch(t){case"STATUS":i=((e,t)=>Object(g.getInstance)().then(s=>s.Api.getApi().post("messageConversations/".concat(e,"/status?messageConversationStatus=").concat(t))).then(e=>e).catch(e=>{throw e}))(e,s);break;case"PRIORITY":i=((e,t)=>Object(g.getInstance)().then(s=>s.Api.getApi().post("messageConversations/".concat(e,"/priority?messageConversationPriority=").concat(t))).then(e=>e).catch(e=>{throw e}))(e,s);break;case"ASSIGNEE":i=void 0!==s&&"VALIDATION_RESULT"===a.id?v({users:s.map(e=>({id:e})),userGroups:[],organisationUnits:[],messageConversationId:e}).then(()=>S(e,s)):S(e,s);break;default:h.a.error("Unexpected identifier for updateMessageConversations")}return i});try{await Promise.all(i),n(b("MESSAGE_CONVERSATION_UPDATE_SUCCESS",{messageType:a,page:1,identifier:t})),n(I())}catch(r){n(b("MESSAGE_CONVERSATION_UPDATE_ERROR",{error:r}))}}i&&n(x(i))},markMessageConversations:w},null,{pure:!1}))(ps);const hs={canvas:e=>({display:"flex",justifyContent:"flex-start",alignItems:"center",backgroundColor:e?q.palette.blue50:q.palette.accent2Color,zIndex:10}),checkedOption:{display:"flex",justifyContent:"flex-start",minWidth:"200px",margin:"6px 0"},filterControl:{flex:2,height:"48px",marginRight:16,maxWidth:256},rightHandCanvas:{flex:"2 0",display:"flex",paddingLeft:16},ie11Spacer:{flexGrow:1},iconMenu:{width:"30px",display:"flex"}};class gs extends a.Component{constructor(...e){super(...e),this.state={lastMessageFilter:""},this.debouncedSearch=y(this.search,300)}search(e){this.props.selectedMessageType&&this.state.lastMessageFilter!==e&&(this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id),this.setState({lastMessageFilter:e}))}componentDidUpdate(e){e.selectedMessageType&&this.props.selectedMessageType.id!==e.selectedMessageType.id&&(this.debouncedSearch(""),void 0!==this.props.messageFilter&&this.props.setFilter(void 0,"MESSAGE"),void 0!==this.props.statusFilter&&this.props.setFilter(void 0,"STATUS"),void 0!==this.props.priorityFilter&&this.props.setFilter(void 0,"PRIORITY"),this.props.assignedToMeFilter&&this.props.setFilter(!1,"ASSIGNED_TO_ME"),this.props.markedForFollowUpFilter&&this.props.setFilter(!1,"MARKED_FOR_FOLLOWUP"),this.props.unreadFilter&&this.props.setFilter(!1,"UNREAD")),void 0===this.props.selectedMessageType||this.props.selectedMessageType.loading||e.statusFilter===this.props.statusFilter&&e.priorityFilter===this.props.priorityFilter&&e.assignedToMeFilter===this.props.assignedToMeFilter&&e.markedForFollowUpFilter===this.props.markedForFollowUpFilter&&e.unreadFilter===this.props.unreadFilter&&void 0!==e.selectedMessageType&&e.selectedMessageType.id===this.props.selectedMessageType.id||this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id)}render(){const e=this.props.id,t=this.props.displayExtendedChoices,s=this.props.checkedOptions,a=!this.props.wideview||void 0===this.props.selectedMessageConversation&&"create"!==e;return i.a.createElement(ye.a,{style:hs.canvas(s)},i.a.createElement("div",null,!s&&i.a.createElement(pe.a,{style:hs.checkedOption,icon:i.a.createElement(re.a,null),onClick:()=>ie.push("/PRIVATE/create"),label:se.a.t("Compose")}),s&&i.a.createElement(pe.a,{style:hs.checkedOption,icon:i.a.createElement(le.a,null),onClick:()=>this.props.clearCheckedIds(),label:se.a.t("Deselect all")})),i.a.createElement(ds,{displayExtendedChoices:t}),i.a.createElement("div",{style:hs.rightHandCanvas},i.a.createElement("div",{style:hs.ie11Spacer}),t&&a&&!s&&i.a.createElement(Gt.a,{style:hs.filterControl,labelStyle:{color:void 0===this.props.statusFilter?"lightGray":"black",top:void 0===this.props.statusFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:q.palette.primary1Color},floatingLabelText:void 0===this.props.statusFilter?se.a.t("Status"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.statusFilter?"-15px":"0px"},value:this.props.statusFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"STATUS")}},i.a.createElement(Pt.a,{key:null,value:null,primaryText:""}),Xt.STATUS.map(e=>i.a.createElement(Pt.a,{key:e.key,value:e.value,primaryText:e.primaryText}))),t&&a&&!s&&i.a.createElement(Gt.a,{style:hs.filterControl,labelStyle:{color:void 0===this.props.priorityFilter?"lightGray":"black",top:void 0===this.props.priorityFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:q.palette.primary1Color},floatingLabelText:void 0===this.props.priorityFilter?se.a.t("Priority"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.priorityFilter?"-15px":"0px"},value:this.props.priorityFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"PRIORITY")}},i.a.createElement(Pt.a,{key:null,value:null,primaryText:""}),Xt.PRIORITY.map(e=>i.a.createElement(Pt.a,{key:e.key,value:e.value,primaryText:e.primaryText}))),!s&&a&&i.a.createElement(Le.a,{style:hs.filterControl,fullWidth:!0,hintText:se.a.t("Search"),value:this.props.messageFilter||"",onChange:(e,t)=>{this.debouncedSearch(t),this.props.setFilter(t,"MESSAGE")},type:"search"}),!s&&a&&i.a.createElement(Bt.a,{iconButtonElement:i.a.createElement(he.a,null,i.a.createElement(zt.a,null)),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},style:hs.iconMenu,menuStyle:{overflowX:"hidden"}},i.a.createElement(Ht.a,{style:{padding:"0px 16px"}},se.a.t("Set filter")),this.props.displayExtendedChoices&&i.a.createElement(Yt.a,{style:{padding:"0px 16px"},key:"assignedToMeFilter",label:se.a.t("Assigned to me"),checked:this.props.assignedToMeFilter,onClick:()=>{this.props.setFilter(!this.props.assignedToMeFilter,"ASSIGNED_TO_ME")}}),i.a.createElement(Yt.a,{style:{padding:"0px 16px"},key:"markedForFollowUpFilter",label:se.a.t("Marked for followup"),checked:this.props.markedForFollowUpFilter,onClick:()=>{this.props.setFilter(!this.props.markedForFollowUpFilter,"MARKED_FOR_FOLLOWUP")}}),i.a.createElement(Yt.a,{style:{padding:"0px 16px"},key:"unreadFilter",label:se.a.t("Unread messages"),checked:this.props.unreadFilter,onClick:()=>{this.props.setFilter(!this.props.unreadFilter,"UNREAD")}})),i.a.createElement(pe.a,{style:{width:"50px",alignSelf:"center"},icon:this.props.wideview?i.a.createElement(Nt.a,null):i.a.createElement(Ut.a,null),onClick:()=>this.props.toogleWideview()})))}}var ms=gs;s(784);const us=["TICKET","VALIDATION_RESULT"];class ys extends a.Component{constructor(e){super(e),this.setAutoRefresh=e=>{!e&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),e&&(this.intervalId=setInterval(this.tick,1e4)),this.setState({autoRefresh:e,refreshTimer:3e5})},this.tick=()=>{this.state.refreshTimer-1e4<=0?(this.refresh(),this.setState({refreshTimer:3e5})):this.setState(e=>({refreshTimer:e.refreshTimer-1e4}))},this.refresh=()=>{this.props.messageTypes.map(e=>this.props.loadMessageConversations(e,this.props.selectedMessageType)),this.props.selectedMessageConversation&&this.props.setSelectedMessageConversation(this.props.selectedMessageConversation)},this.toogleWideview=()=>{this.setState({wideview:!this.state.wideview})},this.intervalId=null,this.state={autoRefresh:!1,checkedItems:!1,refreshTimer:3e5,wideview:!0}}componentDidMount(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(this.props.setDhis2CoreVersion(this.context.d2.system.version.minor),t&&t!==e&&"create"!==t){const e={id:t};this.props.setSelectedMessageConversation(e)}Object(g.getInstance)().then(e=>e.Api.getApi().get("me",{fields:"userGroups[id]"})).then(e=>Object(g.getInstance)().then(e=>({configuration:e.Api.getApi().get("configuration").then(e=>e),instance:e})).then(({configuration:t,instance:s})=>{const a=(i=s.currentUser.authorities,Array.from(i[Object.getOwnPropertySymbols(i)[0]]));var i;return t.then(t=>({authorized:a.includes("ALL")||!!e.userGroups.find(e=>e.id===t.feedbackRecipients.id),feedbackRecipientsId:t.feedbackRecipients.id}))}).catch(e=>{throw e})).catch(e=>{throw e}).then(e=>this.props.setIsInFeedbackRecipientGroup(e)),this.props.messageTypes.map(t=>this.props.loadMessageConversations(t,e)),this.props.setDisplayTimeDiff()}componentDidUpdate(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(!this.props.settingSelectedMessageConversation&&t&&e!==t&&"create"!==t&&(void 0===this.props.selectedMessageConversation||t!==this.props.selectedMessageConversation.id)){const e={id:t};this.props.setSelectedMessageConversation(e)}e===t&&e!==this.props.selectedMessageType.id&&this.props.setSelectedMessageType(e),e!==t&&"create"!==t||void 0===this.props.selectedMessageConversation||this.props.clearSelectedMessageConversation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId)}render(){const e=this.props.match.params.messageId,t=!!this.props.selectedMessageType&&!!(us.indexOf(this.props.selectedMessageType.id)+1)&&this.props.isInFeedbackRecipientGroup;return i.a.createElement("div",{className:"messaging-center"},i.a.createElement(ms,Object.assign({},this.props,{id:e,wideview:this.state.wideview,displayExtendedChoices:t,toogleWideview:this.toogleWideview})),i.a.createElement("div",{className:"messaging-center__main-content"},i.a.createElement(dt,Object.assign({},this.props,{drawerOpen:this.state.drawerOpen,messageTypes:this.props.messageTypes,autoRefresh:this.state.autoRefresh,refreshTimer:this.state.refreshTimer,setAutoRefresh:this.setAutoRefresh})),void 0===this.props.selectedMessageConversation&&!(this.state.wideview&&"create"===e)&&i.a.createElement(xt,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),"create"===e&&i.a.createElement(Ot,Object.assign({},this.props,{wideview:this.state.wideview})),void 0!==this.props.selectedMessageConversation&&!this.state.wideview&&i.a.createElement(xt,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),this.props.selectedMessageConversation&&"create"!==e?void 0!==this.props.selectedMessageConversation&&i.a.createElement($e,Object.assign({},this.props,{messageConversation:this.props.selectedMessageConversation,wideview:this.state.wideview,disableLink:!0,displayExtendedChoices:t})):!this.state.wideview&&"create"!==e&&i.a.createElement("div",{className:"messaging-center__no-message-selected"},i.a.createElement(Z.a,{style:gt},se.a.t("Select a message")),i.a.createElement(ee.a,{style:{color:q.palette.primary1Color,width:120,height:120}}))))}}ys.contextTypes={d2:J.default.object};var Es=Object(P.a)(Object(l.b)(e=>({snackMessage:e.messaging.snackMessage,messageTypes:e.messaging.messageTypes,messageConversations:e.messaging.messageConversations,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,assignedToMeFilter:e.messaging.assignedToMeFilter,markedForFollowUpFilter:e.messaging.markedForFollowUpFilter,unreadFilter:e.messaging.unreadFilter,selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,checkedIds:e.messaging.checkedIds,checkedOptions:e.messaging.checkedIds.length>0,loaded:e.messaging.loaded,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments}),{loadMessageConversations:I,setIsInFeedbackRecipientGroup:e=>b("SET_IN_FEEDBACK_RECIPIENT_GROUP",{isInFeedbackRecipientGroup:e}),clearCheckedIds:F,setSelectedMessageConversation:x,setSelectedMessageType:L,clearSelectedMessageConversation:O,updateInputFields:D,setFilter:N,setDisplayTimeDiff:()=>async e=>{try{const t=await Object(g.getInstance)().then(e=>e.Api.getApi().get("system/info")).then(e=>e.serverDate).catch(e=>{throw e}),s=A()().diff(A()(t))-5e3;e(b("SET_DISPLAY_TIME_DIFF_SUCCESS",s))}catch(t){e(b("SET_DISPLAY_TIME_DIFF_ERROR",{error:t}))}},clearAttachments:U,setDhis2CoreVersion:e=>b("SET_DHIS2_CORE_VERSION",e)},null,{pure:!1}))(ys);var Cs=()=>i.a.createElement(X.c,{history:ie},i.a.createElement("div",null,i.a.createElement(X.b,{exact:!0,path:"/",component:()=>i.a.createElement(X.a,{to:"/PRIVATE"})}),i.a.createElement(X.b,{path:"/:messageType/:messageId?/:recipientId?",component:Es})));var Ss=()=>i.a.createElement("div",null,i.a.createElement(z,null),i.a.createElement(Cs,null)),Ts=s(388),vs=s(792);s(793);var fs=[{id:"PRIVATE",displayName:"Inbox",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"VALIDATION_RESULT",displayName:"Validation",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"TICKET",displayName:"Ticket",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"SYSTEM",displayName:"System",unread:0,loaded:0,loading:!1,total:0,page:1}];const ks={messageConversations:{},messageTypes:fs,selectedMessageType:void 0,selectedMessageConversation:void 0,settingSelectedMessageConversation:!1,checkedIds:[],messageFilter:void 0,statusFilter:void 0,priorityFilter:void 0,assignedToMeFilter:!1,markedForFollowUpFilter:!1,unreadFilter:!1,isInFeedbackRecipientGroup:!1,feedbackRecipientsId:void 0,displayTimeDiff:0,subject:"",input:"",recipients:[],attachments:[],snackMessage:"",onSnackActionClick:void 0,onSnackRequestClose:void 0,snackType:"NEUTRAL"};var Ms=function(e=ks,t){const s=e.messageTypes,a=e.attachments;switch(t.type){case"SET_DISPLAY_TIME_DIFF_SUCCESS":return{...e,displayTimeDiff:t.payload};case"MESSAGE_CONVERSATIONS_LOAD_SUCCESS":{const a=s.find(e=>e.id===t.payload.messageType.id);a.loaded=t.payload.messageConversations.length,a.total=t.payload.pager.total,a.unread=t.payload.nrOfUnread,a.page=t.payload.pager.page,a.loading=!1,fs.splice([u(s,a.id)],1,a);const i=t.payload.selectedMessageType===a.id&&(t.payload.selectedMessageType===e.selectedMessageType||void 0===e.selectedMessageType);return{...e,messageTypes:fs,messageConversations:{...e.messageConversations,[a.id]:t.payload.messageConversations},selectedMessageType:i?a:e.selectedMessageType}}case"MESSAGE_CONVERSATION_UPDATE_ERROR":return{...e,snackMessage:t.payload.error.message,snackType:"NEGATIVE"};case"MESSAGE_CONVERSATION_UPDATE_SUCCESS":{let s="";switch(t.payload.identifier){case"STATUS":s=se.a.t("Successfully updated status");break;case"PRIORITY":s=se.a.t("Successfully updated priority");break;case"ASSIGNEE":s=se.a.t("Successfully updated assignee");break;case"FOLLOW_UP":s=se.a.t("Successfully changed followup");break;default:h.a.error("Unexpected identifier for updateMessageConversations success")}return{...e,snackMessage:s,snackType:"POSITIVE"}}case"SEND_MESSAGE_ERROR":case"MESSAGE_CONVERSATIONS_DELETE_ERROR":return{...e,snackMessage:t.payload.error.message,snackType:"NEGATIVE"};case"MESSAGE_CONVERSATIONS_DELETE_SUCCESS":return{...e,snackMessage:se.a.t("Successfully deleted message conversation(s)"),snackType:"POSITIVE"};case"DISPLAY_SNACK_MESSAGE;":return{...e,snackMessage:t.payload.message,snackType:t.payload.snackType,onSnackActionClick:t.payload.onSnackActionClick,onSnackRequestClose:t.payload.onSnackRequestClose};case"CLEAR_SNACK_MESSAGE":return{...e,snackMessage:"",snackType:"NEUTRAL"};case"SET_CHECKED":{const s=t.payload.messageConversation;let a=e.checkedIds;return t.payload.selectedValue?a.push(s):a=a.filter(e=>e.id!==s.id),{...e,checkedIds:a}}case"SET_ALL_CHECKED":return{...e,checkedIds:t.payload.messageConversationIds};case"CLEAR_CHECKED":return{...e,checkedIds:[]};case"SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS":return{...e,selectedMessageConversation:t.payload.messageConversation,settingSelectedMessageConversation:!1};case"SET_SELECTED_MESSAGE_CONVERSATION":return{...e,settingSelectedMessageConversation:!0};case"CLEAR_SELECTED_MESSAGE_CONVERSATION":return{...e,selectedMessageConversation:void 0};case"SET_SELECTED_MESSAGE_TYPE":return{...e,checkedIds:[],selectedMessageType:s.find(e=>e.id===t.payload.messageTypeId),selectedMessageConversations:e.messageConversations[t.payload.messageTypeId],selectedMessageConversation:void 0};case"UPDATE_INPUT_FIELDS":return{...e,subject:t.payload.subject,input:t.payload.input,recipients:t.payload.recipients};case"ADD_RECIPIENT_BY_ID_SUCCESS":return{...e,recipients:[...e.recipients,t.payload]};case"SET_FILTER":return{...e,messageFilter:"MESSAGE"===t.payload.filterType?t.payload.filter:e.messageFilter,statusFilter:"STATUS"===t.payload.filterType?t.payload.filter:e.statusFilter,priorityFilter:"PRIORITY"===t.payload.filterType?t.payload.filter:e.priorityFilter,assignedToMeFilter:"ASSIGNED_TO_ME"===t.payload.filterType?t.payload.filter:e.assignedToMeFilter,markedForFollowUpFilter:"MARKED_FOR_FOLLOWUP"===t.payload.filterType?t.payload.filter:e.markedForFollowUpFilter,unreadFilter:"UNREAD"===t.payload.filterType?t.payload.filter:e.unreadFilter};case"LOAD_MESSAGE_CONVERSATIONS":{const s=t.payload.messageType;s.loading=!0,t.payload.loadMore&&s.page++,fs[u(fs,s.id)]=s;const a=e.selectedMessageType;return a&&(a.loading=!0,t.payload.loadMore&&a.page++),{...e,messageTypes:fs,selectedMessageType:a}}case"SET_IN_FEEDBACK_RECIPIENT_GROUP":return{...e,isInFeedbackRecipientGroup:t.payload.isInFeedbackRecipientGroup.authorized,feedbackRecipientsId:t.payload.isInFeedbackRecipientGroup.feedbackRecipientsId};case"ADD_ATTACHMENT_SUCCESS":return{...e,attachments:e.attachments.map(e=>e.name===t.payload.name?{id:t.payload.id,name:e.name,contentLength:e.contentLength,loading:!1}:e)};case"ADD_ATTACHMENT_ERROR":return{...e,attachments:a.filter(e=>e.id!==t.payload.attachmentId),snackMessage:t.payload.error.message,snackType:"NEGATIVE"};case"ADD_ATTACHMENT":return{...e,attachments:e.attachments.concat({name:t.payload.name,contentLength:t.payload.size,loading:!0})};case"REMOVE_ATTACHMENT":return{...e,attachments:a.filter(e=>e.id!==t.payload.attachmentId)};case"CANCEL_ATTACHMENT":return{...e,attachments:a.filter(e=>e.name!==t.payload.attachmentName)};case"CLEAR_ATTACHMENTS":return{...e,attachments:[]};case"SET_DHIS2_CORE_VERSION":return{...e,dhis2CoreVersion:t.payload};default:return e}};const As=[vs.a],bs=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||Ts.d;const xs=Object(Ts.c)({messaging:Ms});var Is=Object(Ts.e)(xs,bs(Object(Ts.a)(...As))),ws=s(293),Rs=s.n(ws);class Fs extends i.a.Component{constructor(...e){super(...e),this.getChildContext=()=>({d2:this.props.d2}),this.render=()=>i.a.createElement(Rs.a,{muiTheme:q},this.props.children)}}Fs.childContextTypes={d2:J.default.object};var Os=Fs;s(794),s(17);t.default=()=>{const{baseUrl:e}=Object(n.b)(),{d2:t}=Object(r.a)({d2Config:{schemas:["messageConversation"],baseUrl:"".concat(e,"/api")}});return t?i.a.createElement(l.a,{store:Is},i.a.createElement(Os,{d2:t},i.a.createElement(Ss,null))):i.a.createElement(Os,null,i.a.createElement("div",{className:"page-loader-wrap"},i.a.createElement(o.a,{size:48})))}}}]);
//# sourceMappingURL=app.8f949e65.chunk.js.map