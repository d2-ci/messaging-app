(window.webpackJsonp=window.webpackJsonp||[]).push([[0],{220:function(e){e.exports={Messaging:"","Upload attachment":"",Assignee:"","No results found":"",Compose:"","Deselect all":"",Status:"",Priority:"",Search:"","Set filter":"","Assigned to me":"","Marked for followup":"","Unread messages":"",Cancel:"",Submit:"","Are you sure you want to delete selected message conversation(s)?":"","Delete selected":"","Mark selected as unread":"","Mark selected as read":"","Assign selected":"","Mark for followup":"","Clear followup":"","Clear assignee":"","Set status":"","Set priority":"",selected:"",Sender:"",Subject:"",Date:"","Auto refresh":"","Message discarded":"",Create:"",To:"","Feedback recipient group":"","Private message":"","Feedback message":"",Message:"",Send:"",Discard:"",me:"","Show all messages":"",Participants:"","Add participants to conversation":"",Add:"","Reply discarded":"",Reply:"","Internal reply":"","Select a message":"","No status":"",Open:"",Pending:"",Invalid:"",Solved:"","No priority":"",High:"",Medium:"",Low:"","Successfully updated status":"","Successfully updated priority":"","Successfully updated assignee":"","Successfully changed followup":"","Successfully deleted message conversation(s)":""}},222:function(e,t,a){e.exports=a(484)},392:function(e,t,a){},416:function(e,t,a){},446:function(e,t,a){},483:function(e,t,a){},484:function(e,t,a){"use strict";a.r(t);var s=a(13),n=a.n(s),r=a(32),i=a(0),o=a.n(i),c=a(28);Boolean("localhost"===window.location.hostname||"[::1]"===window.location.hostname||window.location.hostname.match(/^127(?:\.(?:25[0-5]|2[0-4][0-9]|[01]?[0-9][0-9]?)){3}$/));var l=a(24),p=a(1),d=a.n(p),u=a(219),g=a.n(u),h=a(15),m=a(20),f=a(18),y=a(16),v=a(17),C=a(195),b=a.n(C),E="LOAD_MESSAGE_CONVERSATIONS",T="MESSAGE_CONVERSATIONS_LOAD_SUCCESS",k="MESSAGE_CONVERSATIONS_DELETE_SUCCESS",S="MESSAGE_CONVERSATIONS_DELETE_ERROR",x="MESSAGE_CONVERSATION_UPDATE_SUCCESS",M="MESSAGE_CONVERSATION_UPDATE_ERROR",O="SEND_MESSAGE_ERROR",w="SET_FILTER",A="DISPLAY_SNACK_MESSAGE;",I="CLEAR_SNACK_MESSAGE",F="SET_CHECKED",R="SET_ALL_CHECKED",j="CLEAR_CHECKED",_="SET_SELECTED_MESSAGE_TYPE",N="CLEAR_SELECTED_MESSAGE_CONVERSATION",U="SET_SELECTED_MESSAGE_CONVERSATION",D="SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS",L="UPDATE_INPUT_FIELDS",G="SET_IN_FEEDBACK_RECIPIENT_GROUP",P="SET_DISPLAY_TIME_DIFF_SUCCESS",V="ADD_RECIPIENT_BY_ID_SUCCESS",W="ADD_ATTACHMENT",B="ADD_ATTACHMENT_SUCCESS",H="ADD_ATTACHMENT_ERROR",q="REMOVE_ATTACHMENT",Y="CLEAR_ATTACHMENTS",z="CANCEL_ATTACHMENT",K="SET_DHIS2_CORE_VERSION",X=a(91),J=a.n(X),$=a(12),Q="Roboto, Helvetica, Arial, sans-serif",Z="NEUTRAL",ee="POSITIVE",te="NEGATIVE",ae=function(e){var t=e.messageType,a=e.page,s=e.messageFilter,n=e.status,r=e.priority,i=e.assignedToMeFilter,o=e.markedForFollowUpFilter,c=e.unreadFilter,l=["messageType:eq:".concat(t)];return"undefined"!==typeof n&&l.push("status:eq:".concat(n)),"undefined"!==typeof r&&l.push("priority:eq:".concat(r)),o&&l.push("followUp:eq:true"),c&&l.push("read:eq:false"),Object($.getInstance)().then(function(e){return i&&l.push("assignee.id:eq:".concat(e.currentUser.id)),e.Api.getApi().get("messageConversations?pageSize=".concat(35,"&page=").concat(a).concat(""!==s&&void 0!==s?"&queryString=".concat(s):""),{fields:["id, displayName, subject, messageType, lastSender[id, displayName], assignee[id, displayName], status, priority, lastUpdated, read, lastMessage, followUp"],order:"lastMessage:desc",filter:l})}).then(function(e){return{messageConversations:e.messageConversations,pager:e.pager}}).catch(function(e){throw e})},se=function(e){return Object($.getInstance)().then(function(t){return t.Api.getApi().get("messageConversations/".concat(e.id),{fields:["*,assignee[id, displayName],messages[*,sender[id,displayName],attachments[id, name, contentLength]],userMessages[user[id, displayName]]"]})}).then(function(e){return e}).catch(function(e){throw e})},ne=function(e,t){return Object($.getInstance)().then(function(a){return a.Api.getApi().post("messageConversations/".concat(e,"/status?messageConversationStatus=").concat(t))}).then(function(e){return e}).catch(function(e){throw e})},re=function(e,t){return Object($.getInstance)().then(function(a){return a.Api.getApi().post("messageConversations/".concat(e,"/priority?messageConversationPriority=").concat(t))}).then(function(e){return e}).catch(function(e){throw e})},ie=function(e,t){return Object($.getInstance)().then(function(a){return void 0===t?a.Api.getApi().delete("messageConversations/".concat(e,"/assign")):a.Api.getApi().post("messageConversations/".concat(e,"/assign?userId=").concat(t))}).then(function(e){return e}).catch(function(e){throw e})},oe=function(e,t){return Object($.getInstance)().then(function(a){return a.Api.getApi().post("messageConversations/".concat(t?"followup":"unfollowup"),e)}).then(function(e){return e}).catch(function(e){throw e})},ce=function(e){return Object($.getInstance)().then(function(t){return t.Api.getApi().get("messageConversations",{fields:"read",filter:["read:eq:false","messageType:eq:".concat(e)]})}).then(function(e){return e.pager.total}).catch(function(e){throw e})},le=function(e){var t=e.subject,a=e.users,s=e.userGroups,n=e.organisationUnits,r=e.text,i=e.attachments,o=e.id;return Object($.getInstance)().then(function(e){return e.Api.getApi().post("messageConversations",{id:o,subject:t,users:a,userGroups:s,organisationUnits:n,attachments:i,text:r})}).then(function(){return{messageConversationId:o}}).catch(function(e){throw e})},pe=function(e,t){return Object($.getInstance)().then(function(a){return a.Api.getApi().post("messageConversations/feedback?subject=".concat(e),t,{headers:{"Content-Type":"text/plain"}})}).then(function(e){return e}).catch(function(e){throw e})},de=function(e){var t=e.message,a=e.internalReply,s=e.attachments,n=e.id;return Object($.getInstance)().then(function(e){return e.Api.getApi().post("messageConversations/".concat(n,"?internal=").concat(a).concat(s.length>0?"&attachments=".concat(s):""),t,{headers:{"Content-Type":"text/plain"}})}).catch(function(e){throw e})},ue=function(e){return Object($.getInstance)().then(function(t){return t.Api.getApi().delete("messageConversations/".concat(e,"/").concat(t.currentUser.id))}).then(function(e){return e}).catch(function(e){throw e})},ge=function(e){return Object($.getInstance)().then(function(t){return t.Api.getApi().post("messageConversations/read",e)}).then(function(e){return e}).catch(function(e){throw e})},he=function(e){return Object($.getInstance)().then(function(t){return t.Api.getApi().post("messageConversations/unread",e)}).then(function(e){return e}).catch(function(e){throw e})},me=function(e){var t=e.searchValue,a=e.searchOnlyUsers,s=e.searchOnlyFeedbackRecipients,n=e.feedbackRecipientsId,r=["displayName:token:".concat(t)];return s&&r.push("userGroups.id:eq:".concat(n)),Object($.getInstance)().then(function(e){return e.Api.getApi().get("users",{pageSize:10,filter:r})}).then(function(e){var s=e.users;return a?{users:s,undefined:void 0}:function(e){return Object($.getInstance)().then(function(t){return t.Api.getApi().get("userGroups",{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e)]})}).then(function(e){return e}).catch(function(e){throw e})}(t).then(function(e){var a=e.userGroups;return function(e){return Object($.getInstance)().then(function(t){return t.Api.getApi().get("organisationUnits",{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e),"users:gte:1"]})}).then(function(e){return e}).catch(function(e){throw e})}(t).then(function(e){var t=e.organisationUnits;return{users:s,userGroups:a,organisationUnits:t}})})}).catch(function(e){throw e})},fe=function(e){var t=e.users,a=e.userGroups,s=e.organisationUnits,n=e.messageConversationId;return Object($.getInstance)().then(function(e){return e.Api.getApi().post("messageConversations/".concat(n,"/recipients"),{users:t,userGroups:a,organisationUnits:s})}).catch(function(e){throw e})},ye=function(e){return Object($.getInstance)().then(function(t){return t.Api.getApi().get("users/".concat(e),{fields:"id,displayName"})}).then(function(e){return{id:e.id,displayName:e.displayName,type:"user"}}).catch(function(e){throw e})};var ve=function(e){return Object($.getInstance)().then(function(t){return t.Api.getApi().post("/fileResources?domain=MESSAGE_ATTACHMENT",function(e){var t=new FormData;return t.append("file",e),t}(e))}).catch(function(e){throw e})};var Ce=function(e,t,a){return Object($.getInstance)().then(function(s){var n=s.Api.getApi().baseUrl;return function(e,t){var a=document.createElement("a");a.href=e,a.setAttribute("target","_blank"),document.body.appendChild(a),a.click()}("".concat(n,"/messageConversations/").concat(e,"/").concat(t,"/attachments/").concat(a))}).catch(function(e){throw e})},be=a(38),Ee=a.n(be),Te=function(e,t){return{type:e,payload:t}},ke=function(e){return function(){var t=Object(r.a)(n.a.mark(function t(a){var s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a(Te(U)),t.prev=1,t.next=4,se(e);case 4:s=t.sent,a(Te(D,{messageConversation:s})),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),a(Te("SET_SELECTED_MESSAGE_CONVERSATION_ERROR",{error:t.t0}));case 11:case"end":return t.stop()}},t,null,[[1,8]])}));return function(e){return t.apply(this,arguments)}}()},Se=function(e,t){var a=arguments.length>2&&void 0!==arguments[2]&&arguments[2];return function(){var s=Object(r.a)(n.a.mark(function s(r,i){var o,c,l,p,d,u,g,h,m,f,y,v,C,b;return n.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:for(o=[],c=i(),l=c.messaging,p=l.messageFilter,d=l.statusFilter,u=l.priorityFilter,g=l.assignedToMeFilter,h=l.markedForFollowUpFilter,m=l.unreadFilter,e=e||c.messaging.selectedMessageType,t=t||c.messaging.selectedMessageType.id,r(Te(E,{messageType:e,loadMore:a})),s.prev=6,f=1;f<=e.page;f++)y=ae({messageType:e.id,page:f,messageFilter:p,status:d,priority:u,assignedToMeFilter:g,markedForFollowUpFilter:h,unreadFilter:m}).then(function(e){return{messageConversations:e.messageConversations,pager:e.pager}}),o.push(y);return s.next=10,Promise.all(o);case 10:return v=s.sent,s.next=13,ce(e.id);case 13:C=s.sent,b=v.reduce(function(e,t){return e.concat(t.messageConversations)},[]),r(Te(T,{messageConversations:b,pager:v[v.length-1].pager,messageType:e,selectedMessageType:t,nrOfUnread:C})),s.next=21;break;case 18:s.prev=18,s.t0=s.catch(6),r(Te("MESSAGE_CONVERSATIONS_LOAD_ERROR",{error:s.t0}));case 21:case"end":return s.stop()}},s,null,[[6,18]])}));return function(e,t){return s.apply(this,arguments)}}()},xe=function(e,t,a){return function(){var s=Object(r.a)(n.a.mark(function s(r){return n.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,"read"===e?ge(t):he(t);case 3:r(Te("MARK_MESSAGE_CONVERSATIONS_SUCCESS",{messageType:a,page:1})),r(Se()),s.next=10;break;case 7:s.prev=7,s.t0=s.catch(0),r(Te("MARK_MESSAGE_CONVERSATIONS_ERROR",{error:s.t0}));case 10:case"end":return s.stop()}},s,null,[[0,7]])}));return function(e){return s.apply(this,arguments)}}()},Me=function(e){return function(){var t=Object(r.a)(n.a.mark(function t(a){var s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return a(Te(W,e)),t.prev=1,t.next=4,ve(e);case 4:s=t.sent,a(Te(B,{id:s.response.fileResource.id,name:e.name,contentLength:s.response.fileResource.contentLength})),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),a(Te(H,{error:t.t0}));case 11:case"end":return t.stop()}},t,null,[[1,8]])}));return function(e){return t.apply(this,arguments)}}()},Oe=function(){return Te(j)},we=function(){return Te(N)},Ae=function(e){var t=e.message,a=e.onSnackActionClick,s=e.onSnackRequestClose,n=e.snackType;return Te(A,{message:t,onSnackActionClick:a,onSnackRequestClose:s,snackType:n})},Ie=function(e,t){return Te(w,{filter:e,filterType:t})},Fe=function(e,t,a){return Te(L,{subject:e,input:t,recipients:a})},Re=function(){return Te(Y)},je=function(e){return Te(_,{messageTypeId:e})},_e=function(e){return Te(q,{attachmentId:e})},Ne=function(e){return Te(z,{attachmentName:e})},Ue=a(26),De=a(129),Le=a.n(De),Ge=a(46),Pe=a(22),Ve=Le()({palette:{negative:Pe.pinkA200,blue50:Pe.blue50,primary1Color:"#1D8BF1",primary2Color:Pe.blue100,primary3Color:Pe.blue300,primary4Color:Pe.blue500,accent1Color:Pe.grey50,accent2Color:Pe.grey100,accent3Color:Pe.grey300,accent4Color:Pe.grey500,followUp:Pe.orange500,darkGray:Pe.grey700,superDarkGray:Pe.grey900,textColor:Pe.darkBlack,alternateTextColor:Pe.white,canvasColor:Pe.white,borderColor:Pe.grey300,clockCircleColor:Object(Ge.fade)(Pe.darkBlack,.07),shadowColor:Pe.fullBlack}}),We={NEGATIVE:Ve.palette.negative,NEUTRAL:Ve.palette.primary1Color,POSITIVE:Ve.palette.alternateTextColor},Be=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).closeMessage=function(){a.props.clearSnackMessage(),a.setState({show:!1}),a.props.onSnackRequestClose&&a.props.onSnackRequestClose()},a.state={show:!1},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidUpdate",value:function(e,t){!t.show&&this.props.message&&this.setState({show:!0})}},{key:"render",value:function(){var e=this;return o.a.createElement(b.a,{open:""!==this.props.message&&this.state.show,message:this.props.message||"Missing snackbar message",autoHideDuration:4e3,onRequestClose:this.closeMessage,action:this.props.onSnackActionClick&&"undo",onActionClick:function(){e.props.onSnackActionClick(),e.setState({show:!1})},contentStyle:{color:We[this.props.type]},style:{pointerEvents:"none",whiteSpace:"nowrap"},bodyStyle:{pointerEvents:"initial",maxWidth:"none"}})}}]),t}(i.Component),He=Object(Ue.a)(Object(l.b)(function(e){return{message:e.messaging.snackMessage,type:e.messaging.snackType,onSnackActionClick:e.messaging.onSnackActionClick,onSnackRequestClose:e.messaging.onSnackRequestClose}},{clearSnackMessage:function(){return Te(I)}}),Ue.b)(Be),qe=a(62),Ye=a(197),ze=(a(377),a(101)),Ke=a(92),Xe=a(11),Je=[{id:"PRIVATE",displayName:"Inbox",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"VALIDATION_RESULT",displayName:"Validation",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"TICKET",displayName:"Ticket",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"SYSTEM",displayName:"System",unread:0,loaded:0,loading:!1,total:0,page:1}];function $e(e,t){for(var a=e.length,s=0;s<a;s++)if(e[s].id===t)return s}function Qe(e,t){var a=null;return function(){var s=this,n=arguments;clearTimeout(a),a=setTimeout(function(){e.apply(s,n)},t)}}function Ze(e){return e>30}var et={messageConversations:{},messageTypes:Je,selectedMessageType:void 0,selectedMessageConversation:void 0,settingSelectedMessageConversation:!1,checkedIds:[],messageFilter:void 0,statusFilter:void 0,priorityFilter:void 0,assignedToMeFilter:!1,markedForFollowUpFilter:!1,unreadFilter:!1,isInFeedbackRecipientGroup:!1,feedbackRecipientsId:void 0,displayTimeDiff:0,subject:"",input:"",recipients:[],attachments:[],snackMessage:"",onSnackActionClick:void 0,onSnackRequestClose:void 0,snackType:Z};var tt=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:et,t=arguments.length>1?arguments[1]:void 0,a=e.messageTypes,s=e.attachments;switch(t.type){case P:return Object(Xe.a)({},e,{displayTimeDiff:t.payload});case T:var n=a.find(function(e){return e.id===t.payload.messageType.id});n.loaded=t.payload.messageConversations.length,n.total=t.payload.pager.total,n.unread=t.payload.nrOfUnread,n.page=t.payload.pager.page,n.loading=!1,Je.splice([$e(a,n.id)],1,n);var r=t.payload.selectedMessageType===n.id&&(t.payload.selectedMessageType===e.selectedMessageType||void 0===e.selectedMessageType);return Object(Xe.a)({},e,{messageTypes:Je,messageConversations:Object(Xe.a)({},e.messageConversations,Object(Ke.a)({},n.id,t.payload.messageConversations)),selectedMessageType:r?n:e.selectedMessageType});case M:return Object(Xe.a)({},e,{snackMessage:t.payload.error.message,snackType:te});case x:var i="";switch(t.payload.identifier){case"STATUS":i=d.a.t("Successfully updated status");break;case"PRIORITY":i=d.a.t("Successfully updated priority");break;case"ASSIGNEE":i=d.a.t("Successfully updated assignee");break;case"FOLLOW_UP":i=d.a.t("Successfully changed followup");break;default:J.a.error("Unexpected identifier for updateMessageConversations success")}return Object(Xe.a)({},e,{snackMessage:i,snackType:ee});case O:case S:return Object(Xe.a)({},e,{snackMessage:t.payload.error.message,snackType:te});case k:return Object(Xe.a)({},e,{snackMessage:d.a.t("Successfully deleted message conversation(s)"),snackType:ee});case A:return Object(Xe.a)({},e,{snackMessage:t.payload.message,snackType:t.payload.snackType,onSnackActionClick:t.payload.onSnackActionClick,onSnackRequestClose:t.payload.onSnackRequestClose});case I:return Object(Xe.a)({},e,{snackMessage:"",snackType:Z});case F:var o=t.payload.messageConversation,c=e.checkedIds;return t.payload.selectedValue?c.push(o):c=c.filter(function(e){return e.id!==o.id}),Object(Xe.a)({},e,{checkedIds:c});case R:return Object(Xe.a)({},e,{checkedIds:t.payload.messageConversationIds});case j:return Object(Xe.a)({},e,{checkedIds:[]});case D:return Object(Xe.a)({},e,{selectedMessageConversation:t.payload.messageConversation,settingSelectedMessageConversation:!1});case U:return Object(Xe.a)({},e,{settingSelectedMessageConversation:!0});case N:return Object(Xe.a)({},e,{selectedMessageConversation:void 0});case _:return Object(Xe.a)({},e,{checkedIds:[],selectedMessageType:a.find(function(e){return e.id===t.payload.messageTypeId}),selectedMessageConversations:e.messageConversations[t.payload.messageTypeId],selectedMessageConversation:void 0});case L:return Object(Xe.a)({},e,{subject:t.payload.subject,input:t.payload.input,recipients:t.payload.recipients});case V:return Object(Xe.a)({},e,{recipients:[].concat(Object(ze.a)(e.recipients),[t.payload])});case w:return Object(Xe.a)({},e,{messageFilter:"MESSAGE"===t.payload.filterType?t.payload.filter:e.messageFilter,statusFilter:"STATUS"===t.payload.filterType?t.payload.filter:e.statusFilter,priorityFilter:"PRIORITY"===t.payload.filterType?t.payload.filter:e.priorityFilter,assignedToMeFilter:"ASSIGNED_TO_ME"===t.payload.filterType?t.payload.filter:e.assignedToMeFilter,markedForFollowUpFilter:"MARKED_FOR_FOLLOWUP"===t.payload.filterType?t.payload.filter:e.markedForFollowUpFilter,unreadFilter:"UNREAD"===t.payload.filterType?t.payload.filter:e.unreadFilter});case E:var l=t.payload.messageType;l.loading=!0,t.payload.loadMore&&l.page++,Je[$e(Je,l.id)]=l;var p=e.selectedMessageType;return p&&(p.loading=!0,t.payload.loadMore&&p.page++),Object(Xe.a)({},e,{messageTypes:Je,selectedMessageType:p});case G:return Object(Xe.a)({},e,{isInFeedbackRecipientGroup:t.payload.isInFeedbackRecipientGroup.authorized,feedbackRecipientsId:t.payload.isInFeedbackRecipientGroup.feedbackRecipientsId});case B:return Object(Xe.a)({},e,{attachments:e.attachments.map(function(e){return e.name===t.payload.name?{id:t.payload.id,name:e.name,contentLength:e.contentLength,loading:!1}:e})});case H:return Object(Xe.a)({},e,{attachments:s.filter(function(e){return e.id!==t.payload.attachmentId}),snackMessage:t.payload.error.message,snackType:te});case W:return Object(Xe.a)({},e,{attachments:e.attachments.concat({name:t.payload.name,contentLength:t.payload.size,loading:!0})});case q:return Object(Xe.a)({},e,{attachments:s.filter(function(e){return e.id!==t.payload.attachmentId})});case z:return Object(Xe.a)({},e,{attachments:s.filter(function(e){return e.name!==t.payload.attachmentName})});case Y:return Object(Xe.a)({},e,{attachments:[]});case K:return Object(Xe.a)({},e,{dhis2CoreVersion:t.payload});default:return e}},at=[Ye.a],st=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||qe.d;var nt=Object(qe.c)({messaging:tt}),rt=Object(qe.e)(nt,st(qe.a.apply(void 0,at))),it=a(215),ot=a(2),ct=a.n(ot),lt=a(21),pt=a.n(lt),dt=a(214),ut=a.n(dt),gt=a(50),ht=Object(gt.a)(),mt=a(95),ft=a.n(mt),yt=a(94),vt=a.n(yt),Ct=a(29),bt=a.n(Ct),Et=a(37),Tt=a.n(Et),kt=a(130),St=a.n(kt),xt=a(31),Mt=a.n(xt),Ot=a(61),wt=a.n(Ot),At=a(131),It=a.n(At),Ft=a(198),Rt=a.n(Ft),jt=a(200),_t=a.n(jt),Nt=a(199),Ut=a.n(Nt),Dt=(a(392),function(e){var t=e.dataDirection,a=e.attachment,s=e.removeAttachment,n=e.downloadAttachment,r=e.cancelAttachment;return o.a.createElement(bt.a,{className:"attachment__button",backgroundColor:Ve.palette.accent2Color,label:"".concat(a.name," (").concat(parseFloat(parseInt(a.contentLength,10)/1e6).toFixed(2)," MB)"),labelPosition:"after",onClick:function(){"download"===t?n(a):a.loading?r(a.name):s(a)},icon:"download"===t?o.a.createElement(Ut.a,null):o.a.createElement(_t.a,null)},a.loading&&o.a.createElement(Rt.a,{className:"attachment__progress",mode:"indeterminate"}))}),Lt=function(e){var t=e.dataDirection,a=e.attachments,s=e.style,n=e.removeAttachment,r=e.downloadAttachment,i=e.cancelAttachment;return o.a.createElement("div",{className:"attachment",style:Object(Xe.a)({},s)},a.map(function(e,a){return o.a.createElement(Dt,{key:"".concat(e.name,"-").concat(a),dataDirection:t,attachment:e,removeAttachment:n,downloadAttachment:r,cancelAttachment:i})}))},Gt=a(201),Pt=a.n(Gt),Vt={canvas:function(e){return{backgroundColor:e,padding:"16px 16px 16px 16px"}},innerCanvas:{margin:"",paddingBottom:"0px"},cardText:{padding:"16px 0px 16px 0px",fontFamily:Q,whiteSpace:"pre-wrap",wordBreak:"break-word"},fromFormat:{fontFamily:Q},datePlacement:{display:"flex",justifyContent:"flex-end",marginRight:"10px"},dateFormat:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:Q}},Wt=function(e){var t=e.displayTimeDiff,a=e.message,s=e.currentUser,n=e.lastMessage,r=e.downloadAttachment,i=e.cancelAttachment,c=e.enableAttachments,l=a.sender?s&&s.id===a.sender.id?"me":a.sender.displayName:"system",p=Ee()(),u=Ee()(a.created).add(t);return o.a.createElement("div",{style:Vt.canvas(Ve.palette.canvasColor)},o.a.createElement("div",{style:Vt.innerCanvas},o.a.createElement("div",{style:Vt.fromFormat},a.internal?d.a.t("Internal message from ".concat(l)):d.a.t("Message from ".concat(l))),o.a.createElement("div",{placement:"bottom",style:Vt.datePlacement},o.a.createElement("div",{style:Vt.dateFormat},p.diff(u,"hours")<72?"".concat(u.from(p),", ").concat(u.format("HH:mm")):p.year()===u.year()?u.format("MMM DD, HH:mm"):u.format("MMM DD, YYYY HH:mm"))),c&&o.a.createElement(Lt,{dataDirection:"download",style:{paddingLeft:0},attachments:a.attachments,downloadAttachment:r,cancelAttachment:i}),o.a.createElement(It.a,{style:Vt.cardText},o.a.createElement(Pt.a,null,a.text))),!n&&o.a.createElement(wt.a,null))},Bt=a(55),Ht=a(93),qt=a.n(Ht),Yt=a(47),zt=a.n(Yt),Kt=a(202),Xt=a.n(Kt),Jt=(a(416),function(e){return function(t){var a=t.target.files;a.length>0&&e(a[0])}}),$t=function(e){var t=e.addAttachment;return o.a.createElement(bt.a,{className:"attachment__upload-button",label:d.a.t("Upload attachment"),labelPosition:"after",containerElement:"label",icon:o.a.createElement(Xt.a,null)},o.a.createElement("input",{className:"attachment__upload-button--input",type:"file",onChange:Jt(t)}))},Qt=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).replyMessage=function(e){var t=a.props,s=t.input,n=t.selectedMessageConversation,r=t.selectedMessageType;a.props.replyMessage({message:s,internalReply:e,messageConversation:n,messageType:r}),a.wipeInput()},a.wipeInput=function(){a.props.updateInputFields("","",[]),a.props.attachments.length>0&&a.props.clearAttachments(),a.setState({inputError:!1})},a.texFieldUpdate=function(e,t){a.props.updateInputFields("",t,[])},a.handleDiscard=function(){var e=d.a.t("Reply discarded"),t=te;a.setState({discardState:!0}),a.props.displaySnackMessage({message:e,onSnackActionClick:function(){return a.setState({discardState:!1})},onSnackRequestClose:function(){a.setState({discardState:!1}),a.wipeInput()},snackType:t}),a.setState({expanded:!1})},a.state={discardState:!1},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentWillUnmount",value:function(){this.wipeInput()}},{key:"render",value:function(){var e=this;return o.a.createElement(Bt.Card,{style:{marginTop:"5px"},expanded:!0},o.a.createElement(Bt.CardText,{style:{padding:"0px 0px 0px 16px"}},o.a.createElement(zt.a,{key:this.props.messageConversation.id,id:this.props.messageConversation.id,rows:5,underlineShow:!1,value:this.state.discardState?"":this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:d.a.t("Message"),onChange:this.texFieldUpdate}),this.props.enableAttachments&&!this.state.discardState&&o.a.createElement(Lt,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:function(t){return e.props.removeAttachment(t.id)},cancelAttachment:this.props.cancelAttachment}),o.a.createElement(Bt.CardActions,{style:{paddingLeft:"0px"}},o.a.createElement(qt.a,{primary:!0,label:d.a.t("Reply"),disabled:""===this.props.input||this.state.discardState,onClick:function(){return e.replyMessage(!1)}}),this.props.isInFeedbackRecipientGroup&&"TICKET"===this.props.selectedMessageType.id&&o.a.createElement(bt.a,{primary:!0,label:d.a.t("Internal reply"),disabled:""===this.props.input||this.state.discardState,onClick:function(){return e.replyMessage(!0)}}),o.a.createElement(bt.a,{label:d.a.t("Discard"),disabled:""===this.props.input||this.state.discardState,onClick:this.handleDiscard}),this.props.enableAttachments&&o.a.createElement($t,{addAttachment:function(t){e.props.addAttachment(t)}}),")")))}}]),t}(i.Component),Zt=Object(Ue.a)(Object(l.b)(function(e){return{selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes,input:e.messaging.input,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments,enableAttachments:Ze(e.messaging.dhis2CoreVersion)}},{replyMessage:function(e){var t=e.message,a=e.internalReply,s=e.messageConversation,i=e.messageType;return function(){var e=Object(r.a)(n.a.mark(function e(r,o){var c,l,p;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=s.id,l=o(),p=l.messaging.attachments.map(function(e){return e.id}),e.next=6,de({message:t,internalReply:a,attachments:p,id:c});case 6:r(Te("REPLY_MESSAGE_SUCCESS",{messageConversation:s,messageType:i,page:1})),r(Se()),r(ke(s)),e.next=14;break;case 11:e.prev=11,e.t0=e.catch(0),r(Te("REPLY_MESSAGE_ERROR",{error:e.t0}));case 14:case"end":return e.stop()}},e,null,[[0,11]])}));return function(t,a){return e.apply(this,arguments)}}()},setSelectedMessageType:je,updateInputFields:Fe,displaySnackMessage:Ae,addAttachment:Me,removeAttachment:_e,cancelAttachment:Ne},null,{pure:!1}))(Qt),ea=a(90),ta=a(203),aa=a.n(ta),sa=300,na=function(e){function t(){var e,a;Object(h.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(f.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(n)))).state={input:"",searchResult:[],searchOnlyUsers:a.props.searchOnlyUsers,searchOnlyFeedbackRecipients:a.props.searchOnlyFeedbackRecipients,lastSearch:"",errorText:void 0},a.debouncedSearch=Qe(a.search.bind(Object(ea.a)(a)),sa),a.onSuggestionClick=function(e){void 0!==a.props.onSuggestionClick?a.props.onSuggestionClick(e):(a.wipeInput(),a.debouncedSearch(""),!a.props.recipients.find(function(t){return t.id===e.id})&&a.props.updateRecipients([].concat(Object(ze.a)(a.props.recipients),[a.state.searchResult.find(function(t){return t.id===e.id})])))},a.onRemoveChip=function(e){a.props.updateRecipients(a.props.recipients.filter(function(t){return t.id!==e}))},a.wipeInput=function(){a.setState({input:"",searchResult:[]})},a.updateInput=function(e){a.debouncedSearch(e),a.setState({input:e})},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"search",value:function(e){var t=this;if(!this.state.searchResult.find(function(t){return t.displayName===e})&&""!==e&&e.length>=2){var a=this.state,s=a.feedbackRecipientsId,n=a.searchOnlyUsers,r=a.searchOnlyFeedbackRecipients;me({searchValue:e,searchOnlyUsers:n,searchOnlyFeedbackRecipients:r,feedbackRecipientsId:s}).then(function(e){var a=e.users,s=e.userGroups,n=e.organisationUnits,r=function(e){return function(t){return Object(Xe.a)({},t,{type:e})}},i=a.map(r("user"));t.state.searchOnlyUsers||(i=i.concat(s.map(r("userGroup"))).concat(n.map(r("organisationUnit")))),t.setState({searchResult:i,errorText:0===i.length?d.a.t("No results found"):void 0})})}else this.setState({lastSearch:e,searchResult:""!==this.state.lastSearch&&""===e||e.length<2?[]:this.state.searchResult,errorText:""!==e&&e.length<2?d.a.t("Please enter at least ".concat(2," characters")):this.state.searchWarning})}},{key:"render",value:function(){var e=this;return o.a.createElement("div",{style:Object(Xe.a)({},this.props.style,{height:this.props.inputHeight})},o.a.createElement(aa.a,{style:{marginBottom:16},disabled:void 0!==this.props.disabled&&this.props.disabled,errorText:this.props.errorText||this.state.errorText,value:this.props.recipients,fullWidth:!0,openOnFocus:!0,searchText:this.state.input,floatingLabelText:this.props.label,dataSource:this.state.searchResult,dataSourceConfig:{text:"displayName",value:"id"},onUpdateInput:this.updateInput,onRequestAdd:function(t){return e.onSuggestionClick(t)},onRequestDelete:function(t){return e.onRemoveChip(t)}}))}}]),t}(i.Component),ra={subheaderTitle:{height:"32px",color:"black",paddingLeft:0,paddingRight:16},subheader:function(e,t){return{height:"32px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:0,color:e,fontWeight:t}}},ia=function(e){var t=e.showTitle,a=e.title,s=e.label,n=e.color,r=e.fontWeight,i=s&&"NONE"!==s?"Assignee"===a?s:"".concat(s.charAt(0)).concat(s.toLowerCase().substr(1,s.length)):"-";return o.a.createElement("div",{style:{flex:2,paddingLeft:10,maxWidth:200}},t&&o.a.createElement(pt.a,{style:ra.subheaderTitle}," ",a," "),o.a.createElement(pt.a,{style:ra.subheader(n,r)},i))},oa={canvas:{flex:"3 0",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)",paddingTop:"10px"},innerCanvas:{display:"flex",flexDirection:"column",margin:"0px 10px 0px 10px"},header:{display:"flex"},iconButton:{display:"flex",alignSelf:"center"},subjectSubheader:{display:"flex",alignSelf:"center",fontSize:"20px",fontFamily:Q},participantsCanvas:{display:"flex",flexDirection:"column"},participants:{paddingLeft:"12px",paddingTop:"10px",display:"flex",flexWrap:"wrap"},chip:{height:"32px",marginRight:"3px",marginBottom:"3px"},participantAddRow:{display:"flex"},participantsSuggestionField:{paddingLeft:"12px",marginBottom:"0px",flex:1},participantsAdd:{alignSelf:"flex-end",marginBottom:"28px",paddingLeft:"12px"},messagesCanvas:{marginBottom:"50px",display:"flex",flexDirection:"column",backgroundColor:Ve.palette.accent2Color,margin:"0px 10px 10px 10px"},messagesInnerCanvas:{padding:"0px"}},ca=["TICKET","VALIDATION_RESULT"],la=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).backToList=function(){var e=a.props,t=e.clearSelectedMessageConversation,s=e.messageConversation;ht.push("/".concat(s.messageType)),t()},a.addRecipients=function(){var e=a.state.recipients.filter(function(e){return"user"===e.type}),t=a.state.recipients.filter(function(e){return"userGroup"===e.type}),s=a.state.recipients.filter(function(e){return"organisationUnit"===e.type}),n=a.props,r=n.messageConversation,i=n.selectedMessageType;a.props.addRecipients({users:e,userGroups:t,organisationUnits:s,messageConversation:r,messageType:i}),a.setState({recipients:[]})},a.updateRecipients=function(e){a.setState({recipients:e})},a.state={recipients:[],currentUser:void 0,cursor:"auto"},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this;Object($.getInstance)().then(function(t){e.setState({currentUser:t.currentUser})})}},{key:"render",value:function(){var e=this,t=this.props.messageConversation,a=t.messages,s=!!(ca.indexOf(t.messageType)+1),n=t.userMessages.slice(0,30).map(function(t){return"undefined"===typeof e.state.currentUser||e.state.recipientsExpanded||e.state.currentUser.id!==t.user.id?t.user.displayName:d.a.t("me")}),r=t.userMessages.length;return r>30&&n.push(" + ".concat(r-30)),o.a.createElement("div",{id:"messageconversation",style:oa.canvas},o.a.createElement("div",{style:oa.innerCanvas},o.a.createElement("div",{style:oa.header},o.a.createElement(Tt.a,{style:oa.iconButton,tooltipPosition:"bottom-right",onClick:this.backToList,tooltip:d.a.t("Show all messages")},o.a.createElement(vt.a,null)),o.a.createElement(pt.a,{style:oa.subjectSubheader},t.subject),this.props.displayExtendedChoices&&o.a.createElement(ia,{color:Ve.palette.darkGray,showTitle:!0,title:d.a.t("Status"),label:t.status}),this.props.displayExtendedChoices&&o.a.createElement(ia,{color:Ve.palette.darkGray,showTitle:!0,title:d.a.t("Priority"),label:t.priority}),s&&o.a.createElement(ia,{color:Ve.palette.darkGray,showTitle:!0,title:d.a.t("Assignee"),label:t.assignee?t.assignee.displayName:void 0})),o.a.createElement("div",{style:oa.participantsCanvas},o.a.createElement(pt.a,{style:{paddingLeft:"12px",paddingTop:"10px"}},d.a.t("Participants")),o.a.createElement("div",{style:oa.participants},n.map(function(e){return o.a.createElement(St.a,{key:e,style:oa.chip},e)}))),o.a.createElement("div",{style:oa.participantAddRow},o.a.createElement(na,{style:oa.participantsSuggestionField,label:d.a.t("Add participants to conversation"),messageConversation:t,recipients:this.state.recipients,updateRecipients:this.updateRecipients,limitSearchArray:t.userMessages}),o.a.createElement("div",{style:oa.participantsAdd},o.a.createElement(bt.a,{icon:o.a.createElement(ft.a,null),onClick:function(){return e.addRecipients()},label:d.a.t("Add")})))),o.a.createElement("div",{style:oa.messagesCanvas},o.a.createElement(Mt.a,{style:oa.messagesInnerCanvas},a.map(function(n,r){return o.a.createElement(Wt,{key:n.id,displayTimeDiff:e.props.displayTimeDiff,message:n,messageConversation:t,notification:s,currentUser:e.state.currentUser,lastMessage:r+1===a.length,downloadAttachment:function(a){return e.props.downloadAttachment(t.id,n.id,a.id)},cancelAttachment:e.props.cancelAttachment,enableAttachments:e.props.enableAttachments})})),o.a.createElement(Zt,Object.assign({},this.props,{messageConversation:t}))))}}]),t}(i.Component),pa=Object(Ue.a)(Object(l.b)(function(e){return{selectedMessageType:e.messaging.selectedMessageType,displayTimeDiff:e.messaging.displayTimeDiff,enableAttachments:Ze(e.messaging.dhis2CoreVersion)}},{addRecipients:function(e){var t=e.users,a=e.userGroups,s=e.organisationUnits,i=e.messageConversation,o=e.messageType;return function(){var e=Object(r.a)(n.a.mark(function e(r){var c;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,c=i.id,e.next=4,fe({users:t,userGroups:a,organisationUnits:s,messageConversationId:c});case 4:r(Te("ADD_RECIPIENTS_SUCCESS",{messageConversation:i,messageType:o,page:1})),r(ke(i)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r(Te("ADD_RECIPIENTS_ERROR",{error:e.t0}));case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}()},downloadAttachment:function(e,t,a){return function(){var s=Object(r.a)(n.a.mark(function s(r){return n.a.wrap(function(s){for(;;)switch(s.prev=s.next){case 0:return s.prev=0,s.next=3,Ce(e,t,a);case 3:r(Te("DOWNLOAD_ATTACHMENT_SUCCESS")),s.next=9;break;case 6:s.prev=6,s.t0=s.catch(0),r(Te("DOWNLOAD_ATTACHMENT_ERROR",{error:s.t0}));case 9:case"end":return s.stop()}},s,null,[[0,6]])}));return function(e){return s.apply(this,arguments)}}()},cancelAttachment:Ne,clearSelectedMessageConversation:we},null,{pure:!1}))(la),da=a(204),ua=a(205),ga=a.n(ua),ha=a(96),ma=a.n(ha),fa=a(206),ya=a.n(fa),va=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).onClick=function(){a.props.onClick()},a.onMouseEnter=function(){a.setHoverText(),a.setState({cursor:"pointer"})},a.onMouseLeave=function(){a.setNeutralText(),a.setState({cursor:"auto"})},a.setNeutralText=function(){return a.setTextColor(Ve.palette.accent2Color)},a.setHoverText=function(){return a.setTextColor(Ve.palette.accent3Color)},a.setTextColor=function(e){a.setState({backgroundColor:e})},a.getBackgroundColor=function(e,t){return e&&t===e.id?Ve.palette.accent3Color:a.state.backgroundColor},a.state={backgroundColor:Ve.palette.accent2Color,textColor:Ve.palette.darkGray},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this;return o.a.createElement("div",{role:"presentation",style:Object(Xe.a)({},this.state,{backgroundColor:this.getBackgroundColor(this.props.selectedMessageType,this.props.messageType.id),cursor:this.state.cursor,alignItems:"center",height:"49px",display:"flex",flexDirection:"row",justifyContent:"space-between"}),onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:function(){return e.onClick()}},o.a.createElement(pt.a,{style:{marginLeft:"5px",fontSize:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?"18px":"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?Ve.palette.primary1Color:this.state.textColor}},d.a.t(this.props.messageType.displayName)),this.props.loading?o.a.createElement(ma.a,{style:{marginRight:"10px"},color:Ve.palette.primary1Color,size:24}):this.props.messageType.unread>0&&o.a.createElement(ya.a,{style:{marginTop:"12px",marginRight:"5px"},badgeContent:this.props.messageType.unread>100?"99+":this.props.messageType.unread,secondary:!0,badgeStyle:{backgroundColor:"#439E8E"}}))}}]),t}(i.Component),Ca={canvas:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"calc(100vh - 95px)",borderLeftStyle:"solid",borderLeftWidth:"0.5px",borderLeftColor:Ve.palette.accent4Color,borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:Ve.palette.accent4Color,overflowY:"auto",overflowX:"hidden",minWidth:"200px"}},ba=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).props.setSelectedMessageType(a.props.match.params.messageType),a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.messageTypes;return o.a.createElement("div",{style:Ca.canvas},o.a.createElement(da.List,{style:{padding:"0px"}},t&&t.map(function(t){return o.a.createElement("div",{key:t.id},o.a.createElement(va,{messageType:t,onClick:function(){e.props.setSelectedMessageType(t.id),e.props.updateInputFields("","",[]),e.props.attachments.length>0&&e.props.clearAttachments(),ht.push("/".concat(t.id))},selectedMessageType:e.props.selectedMessageType,loading:t.loading}),o.a.createElement(wt.a,null))})),o.a.createElement(ga.a,{style:{width:"",margin:"20px"},label:"".concat(d.a.t("Auto refresh")," (").concat(Ee()(this.props.refreshTimer).format("mm:ss"),")"),toggled:this.props.autoRefresh,onToggle:function(){return e.props.setAutoRefresh(!e.props.autoRefresh)}}))}}]),t}(i.Component),Ea=Object(Ue.a)(Object(l.b)(function(e){return{selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes}},{setSelectedMessageType:je,clearCheckedIds:Oe},null,{pure:!1}))(ba),Ta={overflowY:"scroll",overflowX:"hidden",borderRightWidth:"1px",borderRightColor:Ve.palette.accent4Color,height:"calc(100vh - 95px)"},ka={paddingLeft:"0px",fontSize:"20px"},Sa=a(97),xa=a.n(Sa),Ma={canvas:function(e){return{backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",alignSelf:"center",boxShadow:"none",borderBottom:"1px solid #dfdfdf"}},checkBox:{flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:"12px"},sender:{fontFamily:Q,fontSize:"16px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"black",paddingLeft:10,alignSelf:"center"},subject:{flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:Q,fontSize:"16px",color:"black",paddingLeft:10},extendedLabel:{flex:2,color:"black",fontSize:"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 0 0 10px"}},Oa=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).state={cursor:"auto",allChecked:!1},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidUpdate",value:function(){this.state.allChecked&&this.props.checkedIds.length<this.props.children.length&&this.setState({allChecked:!1})}},{key:"render",value:function(){var e=this,t=this.props.displayExtendedChoices;return o.a.createElement(Mt.a,{style:Ma.canvas(Ve.palette.canvasColor)},o.a.createElement(xa.a,{checked:this.state.allChecked,style:Ma.checkBox,onCheck:function(t,a){e.state.allChecked?e.props.clearCheckedIds():e.props.setAllChecked(e.props.children.map(function(e){return{id:e.id}})),e.setState({allChecked:!e.state.allChecked})}}),o.a.createElement("div",{style:Ma.sender},d.a.t("Sender")),o.a.createElement(pt.a,{style:Ma.subject},d.a.t("Subject")),t&&o.a.createElement(pt.a,{style:Ma.extendedLabel},d.a.t("Status")),t&&o.a.createElement(pt.a,{style:Ma.extendedLabel},d.a.t("Priority")),this.props.notification&&o.a.createElement(pt.a,{style:Ma.extendedLabel},d.a.t("Assignee")),o.a.createElement(pt.a,{style:Ma.extendedLabel},d.a.t("Date")))}}]),t}(i.Component),wa=Object(Ue.a)(Object(l.b)(function(e){return{checkedIds:e.messaging.checkedIds,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup}},{setAllChecked:function(e){return Te(R,{messageConversationIds:e})},clearCheckedIds:Oe}))(Oa),Aa=a(207),Ia=a.n(Aa),Fa={container:function(e,t,a){return{backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",cursor:a,boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",boxShadow:"none",borderBottom:"1px solid #dfdfdf",flexWrap:t?"nowrap":"wrap"}},checkBox:function(e){return{flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:e?12:6}},flag:{color:Ve.palette.followUp,marginRight:4},sender:function(e,t){return{fontFamily:Q,fontSize:"14px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",color:"black",paddingLeft:e?10:0,fontWeight:t}},subject:function(e,t,a){return{flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingLeft:10,fontFamily:Q,color:t,fontWeight:a,order:e?"inherit":10,marginTop:e?0:-10,flexBasis:e?"0%":"100%"}},dateFormat:function(e,t,a){return{flex:2,fontFamily:Q,paddingLeft:e?10:0,paddingRight:e?0:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:e?"":"end",color:t,fontWeight:a}}},Ra=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).onClick=function(e){a.props.setSelectedMessageConversation(e),e&&!e.read&&a.props.markMessageConversations("read",[e.id],a.props.selectedMessageType),a.props.updateInputFields("","",[]),a.props.attachments.length>0&&a.props.clearAttachments(),ht.push("/".concat(e.messageType,"/").concat(e.id))},a.onMouseEnter=function(){return a.setState({cursor:"pointer",backgroundColor:Ve.palette.accent2Color})},a.onMouseLeave=function(){return a.setState({cursor:"auto",backgroundColor:Ve.palette.canvasColor})},a.getBackgroundColor=function(e,t){var s=a.props.selectedMessageConversation&&e.id===a.props.selectedMessageConversation.id;return t&&!s?Ve.palette.blue50:s?Ve.palette.accent3Color:a.state.backgroundColor},a.state={backgroundColor:Ve.palette.canvasColor,cursor:"auto"},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.messageConversation,a=t.lastSender?t.lastSender.displayName:this.props.selectedMessageType.displayName,s=!!this.props.checkedIds.find(function(e){return e.id===t.id}),n=this.props.displayExtendedChoices,r=this.props.displayTimeDiff,i=Ee()(),c=Ee()(t.lastMessage).add(r),l=t.read?"":"bold",p=this.props.messageConversation.read?"black":Ve.palette.darkGray,u=this.getBackgroundColor(t,s);return o.a.createElement(Mt.a,{style:Fa.container(u,this.props.wideview,this.state.cursor),onClick:function(a){var s=void 0!==a.target.innerText&&""!==a.target.innerText;s&&!e.props.settingSelectedMessageConversation&&(e.onClick(t),e.props.checkedIds.length>0&&e.props.clearCheckedIds(),!e.props.wideview||void 0===e.props.messageFilter&&void 0===e.props.priorityFilter&&void 0===e.props.statusFilter||e.props.setFilter(void 0,"MESSAGE"))},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},o.a.createElement(xa.a,{checked:s,style:Fa.checkBox(this.props.wideview),onCheck:function(a,n){e.props.setChecked(t,!s)}}),o.a.createElement("div",{style:Fa.sender(this.props.wideview,l)},t.followUp&&o.a.createElement(Ia.a,{style:Fa.flag}),o.a.createElement("span",null,a)),o.a.createElement(pt.a,{style:Fa.subject(this.props.wideview,p,l)},t.subject),n&&o.a.createElement(ia,{showTitle:!1,title:d.a.t("Status"),color:p,fontWeight:l,label:t.status}),n&&o.a.createElement(ia,{showTitle:!1,title:d.a.t("Priority"),color:p,fontWeight:l,label:t.priority}),this.props.notification&&this.props.wideview&&o.a.createElement(ia,{showTitle:!1,title:d.a.t("Assignee"),color:p,fontWeight:l,label:t.assignee?t.assignee.displayName:void 0}),o.a.createElement(pt.a,{style:Fa.dateFormat(this.props.wideview,p,l)},i.diff(c,"hours")<72?c.from(i):i.year()===c.year()?c.format("MMM DD"):c.format("ll")))}}]),t}(i.Component),ja=Object(Ue.a)(Object(l.b)(function(e){return{selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,checkedIds:e.messaging.checkedIds,displayTimeDiff:e.messaging.displayTimeDiff,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,attachments:e.messaging.attachments}},{setChecked:function(e,t){return Te(F,{messageConversation:e,selectedValue:t})},setSelectedMessageConversation:ke,markMessageConversations:xe,clearCheckedIds:Oe,setFilter:Ie,updateInputFields:Fe,clearAttachments:Re},null,{pure:!1}))(Ra),_a=["VALIDATION_RESULT","TICKET"],Na={canvas:function(e){return Object(Xe.a)({flex:"1 0",maxWidth:e?"none":"350px",minWidth:e?"none":"250px",borderRightStyle:e?"":"solid"},Ta)},loading:{backgroundColor:Ve.palette.accent2Color,height:"".concat(50,"px"),transition:"all 0.2s ease-in-out",display:"flex",justifyContent:"center"}},Ua=function(e){function t(){var e,a;Object(h.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(f.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(n)))).onScroll=function(e){var t=document.getElementById("messagelist");!a.props.selectedMessageType.loading&&a.isBottom(t)&&e.loaded<e.total&&a.props.loadMessageConversations(e,e.id,!0)},a.debouncedOnScroll=Qe(a.onScroll,150),a.isBottom=function(e){return e.scrollHeight-e.scrollTop<window.outerHeight},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=function(e){if(Array.isArray(e)){var t=new Set;return e.filter(function(e){return!t.has(e.id)&&(t.add(e.id),!0)})}}(this.props.messageConversations[this.props.selectedMessageType.id]),a=this.props.selectedMessageType?this.props.selectedMessageType:"",s=this.props.selectedMessageConversation?this.props.selectedMessageConversation.id:"",n=!!(_a.indexOf(a.id)+1);return o.a.createElement("div",{id:"messagelist",onScroll:function(){return e.debouncedOnScroll(e.props.selectedMessageType)},style:Na.canvas(this.props.wideview)},this.props.wideview&&o.a.createElement(wa,{notification:n,displayExtendedChoices:this.props.displayExtendedChoices},t),t&&0!==t.length?t.map(function(t){return o.a.createElement(ja,{key:t.id,messageConversation:t,wideview:e.props.wideview,selectedValue:s,notification:n,displayExtendedChoices:e.props.displayExtendedChoices})}):!this.props.selectedMessageType.loading&&o.a.createElement(pt.a,null,d.a.t("No ".concat(a.displayName.toLowerCase()," messages"))),this.props.selectedMessageType.loading&&o.a.createElement("div",{style:Na.loading},o.a.createElement(ma.a,{style:{marginTop:"10px"},color:Ve.palette.primary1Color})))}}]),t}(i.Component),Da=Object(Ue.a)(Object(l.b)(function(e){return{messageTypes:e.messaging.messageTypes,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,messageConversations:e.messaging.messageConversations,selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType}},{loadMessageConversations:Se},null,{pure:!1}))(Ua),La=a(89),Ga=a(134),Pa=a.n(Ga),Va={canvas:{flex:"3 0",margin:"10px",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)"},messageTypeField:{display:"flex",flexDirection:"row"},messageType:{width:"300px",marginTop:"10px"}},Wa=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).subjectUpdate=function(e,t){a.props.updateInputFields(t,a.props.input,a.props.recipients)},a.inputUpdate=function(e,t){a.props.updateInputFields(a.props.subject,t,a.props.recipients)},a.updateRecipients=function(e){a.props.updateInputFields(a.props.subject,a.props.input,e)},a.sendMessage=function(){var e=a.state.isMessageFeedback?"TICKET":"PRIVATE",t=a.props.messageTypes.find(function(t){return t.id===e});if(a.state.isMessageFeedback)a.props.sendFeedbackMessage(t),ht.push("/TICKET");else{var s=a.props.recipients.filter(function(e){return"user"===e.type}),n=a.props.recipients.filter(function(e){return"userGroup"===e.type}),r=a.props.recipients.filter(function(e){return"organisationUnit"===e.type}),i=Object(La.generateUid)();a.props.sendMessage({users:s,userGroups:n,organisationUnits:r,messageConversationId:i,messageType:t}),ht.push("/PRIVATE")}},a.wipeInput=function(){a.props.updateInputFields("","",[]),a.props.attachments.length>0&&a.props.clearAttachments()},a.handleDiscard=function(){var e=d.a.t("Message discarded"),t=te;a.props.displaySnackMessage({message:e,onSnackActionClick:function(){return ht.push("/PRIVATE/create")},onSnackRequestClose:function(){return a.wipeInput()},snackType:t}),ht.push("/PRIVATE")},a.state={isMessageFeedback:!1},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this.props.addRecipientByUserId,t=this.props.match.params,a=t.messageId,s=t.recipientId;"create"===a&&s&&e(s)}},{key:"render",value:function(){var e=this,t=""===this.props.subject||""===this.props.input||!this.state.isMessageFeedback&&0===this.props.recipients.length,a=""===this.props.subject&&""===this.props.input&&!this.state.isMessageFeedback&&0===this.props.recipients.length;return o.a.createElement("div",{style:Va.canvas},o.a.createElement(pt.a,{style:ka}," ",d.a.t("Create")),o.a.createElement(Bt.Card,null,o.a.createElement(Bt.CardText,null,o.a.createElement(na,{style:{margin:"0px"},label:d.a.t("To"),disabled:this.state.isMessageFeedback,recipients:this.state.isMessageFeedback?[{id:"id",displayName:d.a.t("Feedback recipient group")}]:this.props.recipients,updateRecipients:this.updateRecipients,inputHeight:"100px"}),o.a.createElement("div",{style:Va.messageTypeField},o.a.createElement("div",{style:Va.messageType},o.a.createElement(Pa.a,{label:d.a.t("Private message"),checked:!this.state.isMessageFeedback,onCheck:function(){e.setState({isMessageFeedback:!e.state.isMessageFeedback})}})),o.a.createElement("div",{style:Va.messageType},o.a.createElement(Pa.a,{label:d.a.t("Feedback message"),checked:this.state.isMessageFeedback,onCheck:function(){e.setState({isMessageFeedback:!e.state.isMessageFeedback})}}))),o.a.createElement(zt.a,{floatingLabelText:d.a.t("Subject"),fullWidth:!0,value:this.props.subject,onChange:this.subjectUpdate}),o.a.createElement(zt.a,{key:"createMessage",id:"createMessage",rows:5,underlineShow:!1,value:this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:d.a.t("Message"),onChange:this.inputUpdate}),this.props.enableAttachments&&o.a.createElement(Lt,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:function(t){return e.props.removeAttachment(t.id)},cancelAttachment:this.props.cancelAttachment}),o.a.createElement(Bt.CardActions,{style:{paddingLeft:"0px"}},o.a.createElement(qt.a,{primary:!0,disabled:t,label:d.a.t("Send"),onClick:function(){return e.sendMessage()}}),o.a.createElement(bt.a,{label:d.a.t("Discard"),disabled:a,onClick:this.handleDiscard}),this.props.enableAttachments&&o.a.createElement($t,{addAttachment:function(t){e.props.addAttachment(t)}})))))}}]),t}(i.Component),Ba=Object(Ue.a)(Object(l.b)(function(e){return{messageTypes:e.messaging.messageTypes,subject:e.messaging.subject,input:e.messaging.input,recipients:e.messaging.recipients,attachments:e.messaging.attachments,enableAttachments:Ze(e.messaging.dhis2CoreVersion)}},{sendMessage:function(e){var t=e.users,a=e.userGroups,s=e.organisationUnits,i=e.messageConversationId,o=e.messageType;return function(){var e=Object(r.a)(n.a.mark(function e(r,c){var l,p,d,u,g;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,l=c(),p=l.messaging,d=p.subject,u=p.input,g=p.attachments,e.next=4,le({subject:d,users:t,userGroups:a,organisationUnits:s,text:u,attachments:g,id:i});case 4:r(Te("SEND_MESSAGE_SUCCESS",{messageType:o,page:1})),r(Se()),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),r(Te(O,{error:e.t0}));case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t,a){return e.apply(this,arguments)}}()},sendFeedbackMessage:function(e){return function(){var t=Object(r.a)(n.a.mark(function t(a,s){var r;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return r=s(),t.prev=1,t.next=4,pe(r.messaging.subject,r.messaging.input);case 4:a(Te("SEND_MESSAGE_SUCCESS",{messageType:e,page:1})),a(Se()),t.next=11;break;case 8:t.prev=8,t.t0=t.catch(1),a(Te(O,{error:t.t0}));case 11:case"end":return t.stop()}},t,null,[[1,8]])}));return function(e,a){return t.apply(this,arguments)}}()},displaySnackMessage:Ae,updateInputFields:Fe,addAttachment:Me,removeAttachment:_e,cancelAttachment:Ne,addRecipientByUserId:function(e){return function(){var t=Object(r.a)(n.a.mark(function t(a){var s;return n.a.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return t.prev=0,t.next=3,ye(e);case 3:s=t.sent,a(Te(V,s)),t.next=10;break;case 7:t.prev=7,t.t0=t.catch(0),console.error(t.t0);case 10:case"end":return t.stop()}},t,null,[[0,7]])}));return function(e){return t.apply(this,arguments)}}()}},null,{pure:!1}))(Wa),Ha=a(213),qa=a.n(Ha),Ya=a(212),za=a.n(Ya),Ka=a(135),Xa=a.n(Ka),Ja=a(33),$a=a.n(Ja),Qa=a(78),Za=a.n(Qa),es=a(98),ts=a.n(es),as=a(79),ss=a.n(as),ns=a(99),rs=a.n(ns),is={STATUS:[{key:"NONE",value:"NONE",primaryText:d.a.t("No status")},{key:"OPEN",value:"OPEN",primaryText:d.a.t("Open")},{key:"PENDING",value:"PENDING",primaryText:d.a.t("Pending")},{key:"INVALID",value:"INVALID",primaryText:d.a.t("Invalid")},{key:"SOLVED",value:"SOLVED",primaryText:d.a.t("Solved")}],PRIORITY:[{key:"NONE",value:"NONE",primaryText:d.a.t("No priority")},{key:"HIGH",value:"HIGH",primaryText:d.a.t("High")},{key:"MEDIUM",value:"MEDIUM",primaryText:d.a.t("Medium")},{key:"LOW",value:"LOW",primaryText:d.a.t("Low")}]},os=a(100),cs=a.n(os),ls=a(136),ps=a.n(ls),ds=a(211),us=a.n(ds),gs=a(208),hs=a.n(gs),ms=a(209),fs=a.n(ms),ys=a(210),vs=a.n(ys),Cs=function(e){var t=e.open,a=e.onRequestClose,s=e.updateMessageConversations,n=e.messageType,r=e.feedbackRecipientsId;return o.a.createElement(cs.a,{open:t,onRequestClose:function(){a()}},o.a.createElement(na,{onSuggestionClick:function(e){s([e.id]),a()},searchOnlyUsers:!0,searchOnlyFeedbackRecipients:"TICKET"===n.id,feedbackRecipientsId:r,recipients:[],key:"suggestionField",label:d.a.t("Assignee")}))},bs={canvas:{width:"400px",display:"flex"},extendedChoices:{display:"flex",justifyContent:"flex-start"},nrSelected:{padding:"0px 0px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}},Es=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).getIds=function(){return a.props.selectedMessageConversation&&0===a.props.checkedIds.length?[a.props.selectedMessageConversation.id]:a.props.checkedIds.map(function(e){return e.id})},a.updateMessageConversation=function(e,t){var s=a.props,n=s.selectedMessageType,r=s.selectedMessageConversation,i=a.getIds();a.props.updateMessageConversations({messageConversationIds:i,identifier:e,value:t,messageType:n,selectedMessageConversation:r}),a.props.checkedIds.length>0&&a.props.clearCheckedIds()},a.markMessageConversations=function(e){var t=a.getIds();a.props.markMessageConversations(e,t,a.props.selectedMessageType),a.props.checkedIds.length>0&&a.props.clearCheckedIds()},a.toggleDialog=function(){a.setState({dialogOpen:!a.state.dialogOpen})},a.state={checkedItems:!1,dialogOpen:!1,assignToOpen:!1},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"render",value:function(){var e=this,t=this.props.selectedMessageConversation,a=this.props.checkedIds.length>0,s=a||void 0!==t,n=[o.a.createElement(bt.a,{label:d.a.t("Cancel"),primary:!0,onClick:function(){return e.toggleDialog()}}),o.a.createElement(bt.a,{label:d.a.t("Submit"),primary:!0,keyboardFocused:!0,onClick:function(){e.props.deleteMessageConversations(e.getIds(),e.props.selectedMessageType),e.props.clearCheckedIds(),e.toggleDialog(),e.props.selectedMessageConversation&&(e.props.clearSelectedMessageConversation(),ht.push("/".concat(e.props.selectedMessageType.id)))}})],r=this.props.checkedIds.length>99?"".concat(99,"+"):this.props.checkedIds.length;return s?o.a.createElement("div",{style:bs.canvas},o.a.createElement(cs.a,{title:d.a.t("Are you sure you want to delete selected message conversation(s)?"),actions:n,modal:!1,open:this.state.dialogOpen,onRequestClose:this.toggleDialog}),o.a.createElement(Cs,{open:this.state.assignToOpen,onRequestClose:function(){return e.setState({assignToOpen:!e.state.assignToOpen})},updateMessageConversations:function(t){return e.updateMessageConversation("ASSIGNEE",t)},messageType:this.props.selectedMessageType,feedbackRecipientsId:this.props.feedbackRecipientsId}),o.a.createElement("div",{style:bs.extendedChoices},o.a.createElement(Tt.a,{tooltip:d.a.t("Delete selected"),onClick:function(){e.toggleDialog()}},o.a.createElement(hs.a,null)),o.a.createElement(Tt.a,{tooltip:d.a.t("Mark selected as unread"),onClick:function(){e.markMessageConversations("unread")}},o.a.createElement(fs.a,null)),o.a.createElement(Tt.a,{tooltip:d.a.t("Mark selected as read"),onClick:function(){e.markMessageConversations("read")}},o.a.createElement(vs.a,null)),this.props.displayExtendedChoices&&o.a.createElement(Tt.a,{onClick:function(){return e.setState({assignToOpen:!e.state.assignToOpen})},tooltip:d.a.t("Assign selected")},o.a.createElement(us.a,null)),o.a.createElement(ts.a,{iconButtonElement:o.a.createElement(Tt.a,null,o.a.createElement(rs.a,null)),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"}},o.a.createElement($a.a,{key:"markFollowUp",value:"markFollowUp",primaryText:d.a.t("Mark for followup"),onClick:function(){return e.updateMessageConversation("FOLLOW_UP",!0)}}),o.a.createElement($a.a,{key:"clearFollowUp",value:"clearFollowUp",primaryText:d.a.t("Clear followup"),onClick:function(){return e.updateMessageConversation("FOLLOW_UP",!1)}}),this.props.displayExtendedChoices&&o.a.createElement(wt.a,null),this.props.displayExtendedChoices&&o.a.createElement($a.a,{key:"clearAssigned",value:"clearAssigned",primaryText:d.a.t("Clear assignee"),onClick:function(){return e.updateMessageConversation("ASSIGNEE",void 0)}}),this.props.displayExtendedChoices&&o.a.createElement($a.a,{primaryText:d.a.t("Set status"),key:"setStatus",rightIcon:o.a.createElement(ps.a,null),menuItems:is.STATUS.map(function(t){return o.a.createElement($a.a,{key:"".concat(t.key,"_status"),value:t.value,primaryText:t.primaryText,onClick:function(){return e.updateMessageConversation("STATUS",t.key)}})})}),this.props.displayExtendedChoices&&o.a.createElement($a.a,{primaryText:d.a.t("Set priority"),key:"setPriority",rightIcon:o.a.createElement(ps.a,null),menuItems:is.PRIORITY.map(function(t){return o.a.createElement($a.a,{key:"".concat(t.key,"_priority"),value:t.value,primaryText:t.primaryText,onClick:function(){return e.updateMessageConversation("PRIORITY",t.key)}})})}))),a&&o.a.createElement(Za.a,{style:bs.nrSelected},"".concat(r," ").concat(d.a.t("selected")))):o.a.createElement("div",null)}}]),t}(i.Component),Ts=Object(Ue.a)(Object(l.b)(function(e){return{selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,checkedIds:e.messaging.checkedIds,feedbackRecipientsId:e.messaging.feedbackRecipientsId}},{clearCheckedIds:Oe,clearSelectedMessageConversation:we,deleteMessageConversations:function(e,t){return function(){var a=Object(r.a)(n.a.mark(function a(s){var r;return n.a.wrap(function(a){for(;;)switch(a.prev=a.next){case 0:return a.prev=0,r=e.map(function(e){return ue(e)}),a.next=4,Promise.all(r);case 4:s(Te(k,{messageType:t,page:1})),s(Se()),a.next=11;break;case 8:a.prev=8,a.t0=a.catch(0),s(Te(S,{error:a.t0}));case 11:case"end":return a.stop()}},a,null,[[0,8]])}));return function(e){return a.apply(this,arguments)}}()},updateMessageConversations:function(e){var t=e.messageConversationIds,a=e.identifier,s=e.value,i=e.messageType,o=e.selectedMessageConversation;return function(){var e=Object(r.a)(n.a.mark(function e(r){var c;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:if("FOLLOW_UP"!==a){e.next=13;break}return e.prev=1,e.next=4,oe(t,s);case 4:r(Te(x,{messageType:i,page:1,identifier:a})),r(Se()),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(1),r(Te(M,{error:e.t0}));case 11:e.next=24;break;case 13:return c=t.map(function(e){var t;switch(a){case"STATUS":t=ne(e,s);break;case"PRIORITY":t=re(e,s);break;case"ASSIGNEE":t=void 0!==s&&"VALIDATION_RESULT"===i.id?fe({users:s.map(function(e){return{id:e}}),userGroups:[],organisationUnits:[],messageConversationId:e}).then(function(){return ie(e,s)}):ie(e,s);break;default:J.a.error("Unexpected identifier for updateMessageConversations")}return t}),e.prev=14,e.next=17,Promise.all(c);case 17:r(Te(x,{messageType:i,page:1,identifier:a})),r(Se()),e.next=24;break;case 21:e.prev=21,e.t1=e.catch(14),r(Te(M,{error:e.t1}));case 24:o&&r(ke(o));case 25:case"end":return e.stop()}},e,null,[[1,8],[14,21]])}));return function(t){return e.apply(this,arguments)}}()},markMessageConversations:xe},null,{pure:!1}))(Es),ks=300,Ss={canvas:function(e){return{display:"flex",justifyContent:"flex-start",alignItems:"center",backgroundColor:e?Ve.palette.blue50:Ve.palette.accent2Color,zIndex:10}},checkedOption:{display:"flex",justifyContent:"flex-start",minWidth:"200px",margin:"6px 0"},filterControl:{flex:2,height:"48px",marginRight:16,maxWidth:256},rightHandCanvas:{flex:"2 0",display:"flex",paddingLeft:16},ie11Spacer:{flexGrow:1},iconMenu:{width:"30px",display:"flex"}},xs=function(e){function t(){var e,a;Object(h.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(f.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(n)))).state={lastMessageFilter:""},a.debouncedSearch=Qe(a.search,ks),a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"search",value:function(e){this.props.selectedMessageType&&this.state.lastMessageFilter!==e&&(this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id),this.setState({lastMessageFilter:e}))}},{key:"componentDidUpdate",value:function(e){e.selectedMessageType&&this.props.selectedMessageType.id!==e.selectedMessageType.id&&(this.debouncedSearch(""),void 0!==this.props.messageFilter&&this.props.setFilter(void 0,"MESSAGE"),void 0!==this.props.statusFilter&&this.props.setFilter(void 0,"STATUS"),void 0!==this.props.priorityFilter&&this.props.setFilter(void 0,"PRIORITY"),this.props.assignedToMeFilter&&this.props.setFilter(!1,"ASSIGNED_TO_ME"),this.props.markedForFollowUpFilter&&this.props.setFilter(!1,"MARKED_FOR_FOLLOWUP"),this.props.unreadFilter&&this.props.setFilter(!1,"UNREAD")),void 0===this.props.selectedMessageType||this.props.selectedMessageType.loading||e.statusFilter===this.props.statusFilter&&e.priorityFilter===this.props.priorityFilter&&e.assignedToMeFilter===this.props.assignedToMeFilter&&e.markedForFollowUpFilter===this.props.markedForFollowUpFilter&&e.unreadFilter===this.props.unreadFilter&&void 0!==e.selectedMessageType&&e.selectedMessageType.id===this.props.selectedMessageType.id||this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id)}},{key:"render",value:function(){var e=this,t=this.props.id,a=this.props.displayExtendedChoices,s=this.props.checkedOptions,n=!this.props.wideview||void 0===this.props.selectedMessageConversation&&"create"!==t;return o.a.createElement(Mt.a,{style:Ss.canvas(s)},o.a.createElement("div",null,!s&&o.a.createElement(bt.a,{style:Ss.checkedOption,icon:o.a.createElement(ft.a,null),onClick:function(){return ht.push("/PRIVATE/create")},label:d.a.t("Compose")}),s&&o.a.createElement(bt.a,{style:Ss.checkedOption,icon:o.a.createElement(vt.a,null),onClick:function(){return e.props.clearCheckedIds()},label:d.a.t("Deselect all")})),o.a.createElement(Ts,{displayExtendedChoices:a}),o.a.createElement("div",{style:Ss.rightHandCanvas},o.a.createElement("div",{style:Ss.ie11Spacer}),a&&n&&!s&&o.a.createElement(Xa.a,{style:Ss.filterControl,labelStyle:{color:void 0===this.props.statusFilter?"lightGray":"black",top:void 0===this.props.statusFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:Ve.palette.primary1Color},floatingLabelText:void 0===this.props.statusFilter?d.a.t("Status"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.statusFilter?"-15px":"0px"},value:this.props.statusFilter,onChange:function(t,a,s){e.props.setFilter(null===s?void 0:s,"STATUS")}},o.a.createElement($a.a,{key:null,value:null,primaryText:""}),is.STATUS.map(function(e){return o.a.createElement($a.a,{key:e.key,value:e.value,primaryText:e.primaryText})})),a&&n&&!s&&o.a.createElement(Xa.a,{style:Ss.filterControl,labelStyle:{color:void 0===this.props.priorityFilter?"lightGray":"black",top:void 0===this.props.priorityFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:Ve.palette.primary1Color},floatingLabelText:void 0===this.props.priorityFilter?d.a.t("Priority"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.priorityFilter?"-15px":"0px"},value:this.props.priorityFilter,onChange:function(t,a,s){e.props.setFilter(null===s?void 0:s,"PRIORITY")}},o.a.createElement($a.a,{key:null,value:null,primaryText:""}),is.PRIORITY.map(function(e){return o.a.createElement($a.a,{key:e.key,value:e.value,primaryText:e.primaryText})})),!s&&n&&o.a.createElement(zt.a,{style:Ss.filterControl,fullWidth:!0,hintText:d.a.t("Search"),value:this.props.messageFilter||"",onChange:function(t,a){e.debouncedSearch(a),e.props.setFilter(a,"MESSAGE")},type:"search"}),!s&&n&&o.a.createElement(ts.a,{iconButtonElement:o.a.createElement(Tt.a,null,o.a.createElement(rs.a,null)),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},style:Ss.iconMenu,menuStyle:{overflowX:"hidden"}},o.a.createElement(Za.a,{style:{padding:"0px 16px"}},d.a.t("Set filter")),this.props.displayExtendedChoices&&o.a.createElement(ss.a,{style:{padding:"0px 16px"},key:"assignedToMeFilter",label:d.a.t("Assigned to me"),checked:this.props.assignedToMeFilter,onClick:function(){e.props.setFilter(!e.props.assignedToMeFilter,"ASSIGNED_TO_ME")}}),o.a.createElement(ss.a,{style:{padding:"0px 16px"},key:"markedForFollowUpFilter",label:d.a.t("Marked for followup"),checked:this.props.markedForFollowUpFilter,onClick:function(){e.props.setFilter(!e.props.markedForFollowUpFilter,"MARKED_FOR_FOLLOWUP")}}),o.a.createElement(ss.a,{style:{padding:"0px 16px"},key:"unreadFilter",label:d.a.t("Unread messages"),checked:this.props.unreadFilter,onClick:function(){e.props.setFilter(!e.props.unreadFilter,"UNREAD")}})),o.a.createElement(bt.a,{style:{width:"50px",alignSelf:"center"},icon:this.props.wideview?o.a.createElement(qa.a,null):o.a.createElement(za.a,null),onClick:function(){return e.props.toogleWideview()}})))}}]),t}(i.Component),Ms=(a(446),["TICKET","VALIDATION_RESULT"]),Os=3e5,ws=1e4,As=function(e){function t(e){var a;return Object(h.a)(this,t),(a=Object(f.a)(this,Object(y.a)(t).call(this,e))).setAutoRefresh=function(e){!e&&a.intervalId&&(clearInterval(a.intervalId),a.intervalId=null),e&&(a.intervalId=setInterval(a.tick,ws)),a.setState({autoRefresh:e,refreshTimer:Os})},a.tick=function(){a.state.refreshTimer-ws<=0?(a.refresh(),a.setState({refreshTimer:Os})):a.setState(function(e){return{refreshTimer:e.refreshTimer-ws}})},a.refresh=function(){a.props.messageTypes.map(function(e){return a.props.loadMessageConversations(e,a.props.selectedMessageType)}),a.props.selectedMessageConversation&&a.props.setSelectedMessageConversation(a.props.selectedMessageConversation)},a.toogleWideview=function(){a.setState({wideview:!a.state.wideview})},a.intervalId=null,a.state={autoRefresh:!1,checkedItems:!1,refreshTimer:Os,wideview:!0},a}return Object(v.a)(t,e),Object(m.a)(t,[{key:"componentDidMount",value:function(){var e=this,t=this.props.match.params.messageType,a=this.props.match.params.messageId;if(this.props.setDhis2CoreVersion(this.context.d2.system.version.minor),a&&a!==t&&"create"!==a){var s={id:a};this.props.setSelectedMessageConversation(s)}Object($.getInstance)().then(function(e){return e.Api.getApi().get("me",{fields:"userGroups[id]"})}).then(function(e){return Object($.getInstance)().then(function(e){return{configuration:e.Api.getApi().get("configuration").then(function(e){return e}),instance:e}}).then(function(t){var a,s=t.configuration,n=t.instance,r=(a=n.currentUser.authorities,Array.from(a[Object.getOwnPropertySymbols(a)[0]]));return s.then(function(t){return{authorized:r.includes("ALL")||!!e.userGroups.find(function(e){return e.id===t.feedbackRecipients.id}),feedbackRecipientsId:t.feedbackRecipients.id}})}).catch(function(e){throw e})}).catch(function(e){throw e}).then(function(t){return e.props.setIsInFeedbackRecipientGroup(t)}),this.props.messageTypes.map(function(a){return e.props.loadMessageConversations(a,t)}),this.props.setDisplayTimeDiff()}},{key:"componentDidUpdate",value:function(){var e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(!this.props.settingSelectedMessageConversation&&t&&e!==t&&"create"!==t&&(void 0===this.props.selectedMessageConversation||t!==this.props.selectedMessageConversation.id)){var a={id:t};this.props.setSelectedMessageConversation(a)}e===t&&e!==this.props.selectedMessageType.id&&this.props.setSelectedMessageType(e),e!==t&&"create"!==t||void 0===this.props.selectedMessageConversation||this.props.clearSelectedMessageConversation()}},{key:"componentWillUnmount",value:function(){this.intervalId&&clearInterval(this.intervalId)}},{key:"render",value:function(){var e=this.props.match.params.messageId,t=!!this.props.selectedMessageType&&!!(Ms.indexOf(this.props.selectedMessageType.id)+1)&&this.props.isInFeedbackRecipientGroup;return o.a.createElement("div",{className:"messaging-center"},o.a.createElement(xs,Object.assign({},this.props,{id:e,wideview:this.state.wideview,displayExtendedChoices:t,toogleWideview:this.toogleWideview})),o.a.createElement("div",{className:"messaging-center__main-content"},o.a.createElement(Ea,Object.assign({},this.props,{drawerOpen:this.state.drawerOpen,messageTypes:this.props.messageTypes,autoRefresh:this.state.autoRefresh,refreshTimer:this.state.refreshTimer,setAutoRefresh:this.setAutoRefresh})),void 0===this.props.selectedMessageConversation&&!(this.state.wideview&&"create"===e)&&o.a.createElement(Da,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),"create"===e&&o.a.createElement(Ba,Object.assign({},this.props,{wideview:this.state.wideview})),void 0!==this.props.selectedMessageConversation&&!this.state.wideview&&o.a.createElement(Da,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),this.props.selectedMessageConversation&&"create"!==e?void 0!==this.props.selectedMessageConversation&&o.a.createElement(pa,Object.assign({},this.props,{messageConversation:this.props.selectedMessageConversation,wideview:this.state.wideview,disableLink:!0,displayExtendedChoices:t})):!this.state.wideview&&"create"!==e&&o.a.createElement("div",{className:"messaging-center__no-message-selected"},o.a.createElement(pt.a,{style:ka},d.a.t("Select a message")),o.a.createElement(ut.a,{style:{color:Ve.palette.primary1Color,width:120,height:120}}))))}}]),t}(i.Component);As.contextTypes={d2:ct.a.object};var Is=Object(Ue.a)(Object(l.b)(function(e){return{snackMessage:e.messaging.snackMessage,messageTypes:e.messaging.messageTypes,messageConversations:e.messaging.messageConversations,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,assignedToMeFilter:e.messaging.assignedToMeFilter,markedForFollowUpFilter:e.messaging.markedForFollowUpFilter,unreadFilter:e.messaging.unreadFilter,selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,checkedIds:e.messaging.checkedIds,checkedOptions:e.messaging.checkedIds.length>0,loaded:e.messaging.loaded,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments}},{loadMessageConversations:Se,setIsInFeedbackRecipientGroup:function(e){return Te(G,{isInFeedbackRecipientGroup:e})},clearCheckedIds:Oe,setSelectedMessageConversation:ke,setSelectedMessageType:je,clearSelectedMessageConversation:we,updateInputFields:Fe,setFilter:Ie,setDisplayTimeDiff:function(){return function(){var e=Object(r.a)(n.a.mark(function e(t){var a,s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.prev=0,e.next=3,Object($.getInstance)().then(function(e){return e.Api.getApi().get("system/info")}).then(function(e){return e.serverDate}).catch(function(e){throw e});case 3:a=e.sent,s=Ee()().diff(Ee()(a))-5e3,t(Te(P,s)),e.next=11;break;case 8:e.prev=8,e.t0=e.catch(0),t(Te("SET_DISPLAY_TIME_DIFF_ERROR",{error:e.t0}));case 11:case"end":return e.stop()}},e,null,[[0,8]])}));return function(t){return e.apply(this,arguments)}}()},clearAttachments:Re,setDhis2CoreVersion:function(e){return Te(K,e)}},null,{pure:!1}))(As),Fs=function(){return o.a.createElement(it.c,{history:ht},o.a.createElement("div",null,o.a.createElement(it.b,{exact:!0,path:"/",component:function(){return o.a.createElement(it.a,{to:"/PRIVATE"})}}),o.a.createElement(it.b,{path:"/:messageType/:messageId?/:recipientId?",component:Is})))},Rs=a(218),js=a.n(Rs),_s=function(e){function t(){var e,a;Object(h.a)(this,t);for(var s=arguments.length,n=new Array(s),r=0;r<s;r++)n[r]=arguments[r];return(a=Object(f.a)(this,(e=Object(y.a)(t)).call.apply(e,[this].concat(n)))).getChildContext=function(){return{d2:a.props.d2}},a.render=function(){return o.a.createElement(js.a,{muiTheme:Ve},a.props.children)},a}return Object(v.a)(t,e),t}(o.a.Component);_s.childContextTypes={d2:ct.a.object};var Ns=_s,Us=function(e){var t=e.d2;return o.a.createElement(l.a,{store:rt},o.a.createElement(Ns,{d2:t},o.a.createElement("div",null,o.a.createElement(g.a,{appName:d.a.t("Messaging")}),o.a.createElement(He,null),o.a.createElement(Fs,null))))},Ds=a(220);Ee.a.locale("en"),d.a.addResources("en","messaging-app",Ds),d.a.setDefaultNamespace("messaging-app"),d.a.changeLanguage("en");var Ls=d.a,Gs=function(e){var t=e.keyUiLocale;t&&"en"!==t&&$.config.i18n.sources.add("./i18n/i18n_module_".concat(t,".properties")),$.config.i18n.sources.add("./i18n/i18n_module_en.properties"),Ls.changeLanguage(t)};a(483);(function(){var e=Object(r.a)(n.a.mark(function e(){var t,a,s;return n.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return t={baseUrl:"".concat("..","/api/"),headers:null,schemas:["messageConversation"]},e.next=3,Object($.init)(t);case 3:return a=e.sent,e.next=6,Object($.getUserSettings)();case 6:s=e.sent,Gs(s),Object(c.render)(o.a.createElement(Us,{d2:a}),document.getElementById("root"));case 9:case"end":return e.stop()}},e)}));return function(){return e.apply(this,arguments)}})()(),"serviceWorker"in navigator&&navigator.serviceWorker.ready.then(function(e){e.unregister()})}},[[222,1,2]]]);
//# sourceMappingURL=main.836ed8a9.chunk.js.map