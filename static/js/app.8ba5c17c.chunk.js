(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{753:function(e,t,s){},773:function(e,t,s){},784:function(e,t,s){},792:function(e,t,s){e.exports={center:"App_center__1snml",error:"App_error__1usCm"}},794:function(e,t,s){},800:function(e,t,s){"use strict";s.r(t);var a=s(1),i=s.n(a),n=s(7),r=s(795),o=s(328),l=s(187),c=s(4),p=s.n(c),d=s(301),h=s.n(d);var g=s(390),m=s.n(g),u=s(391);const y="Roboto, Helvetica, Arial, sans-serif";function E(e,t){const s=e.length;for(let a=0;a<s;a++)if(e[a].id===t)return a}function C(e,t){let s=null;return function(){const a=this,i=arguments;clearTimeout(s),s=setTimeout((function(){e.apply(a,i)}),t)}}function S(e){return e>30}const T=["id","displayName","subject","messageType","lastSender[id, displayName]","assignee[id, displayName]","status","priority","lastUpdated","read","lastMessage","followUp"],v=["*","assignee[id, displayName]","messages[*,sender[id,displayName]","attachments[id, name, contentLength]]","userMessages[user[id, displayName]]"];let f=null;const k=async({messageType:e,page:t,messageFilter:s,status:a,priority:i,assignedToMeFilter:n,markedForFollowUpFilter:r,unreadFilter:o,currentUser:l})=>{const c=["messageType:eq:".concat(e)];a&&c.push("status:eq:".concat(a)),i&&c.push("priority:eq:".concat(i)),r&&c.push("followUp:eq:true"),o&&c.push("read:eq:false"),n&&c.push("assignee.id:eq:".concat(l.id));const p={resource:"messageConversations",params:{filter:c,pageSize:35,page:t,fields:T,order:"lastMessage:desc"}};s&&(p.params.queryString=s);const{messageConversations:d}=await f.query({messageConversations:p});return d},M=(e,t)=>Object(u.getInstance)().then(s=>void 0===t?s.Api.getApi().delete("messageConversations/".concat(e,"/assign")):s.Api.getApi().post("messageConversations/".concat(e,"/assign?userId=").concat(t))).then(e=>e).catch(e=>{throw e}),A=({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a})=>Object(u.getInstance)().then(t=>{if(t.system.version.minor>34){const a=s?"userLookup/feedbackRecipients":"userLookup";return t.Api.getApi().get("".concat(a,"?query=").concat(e))}{const i=["displayName:token:".concat(e)];return s&&i.push("userGroups.id:eq:".concat(a)),t.Api.getApi().get("users",{pageSize:10,filter:i})}}).then(({users:s})=>t?{users:s,undefined:void 0}:(e=>Object(u.getInstance)().then(t=>t.Api.getApi().get("userGroups",{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e)]})).then(e=>e).catch(e=>{throw e}))(e).then(({userGroups:t})=>(e=>Object(u.getInstance)().then(t=>t.Api.getApi().get("organisationUnits",{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e),"users:gte:1"]})).then(e=>e).catch(e=>{throw e}))(e).then(({organisationUnits:e})=>({users:s,userGroups:t,organisationUnits:e})))).catch(e=>{throw e}),b=({users:e,userGroups:t,organisationUnits:s,messageConversationId:a})=>Object(u.getInstance)().then(i=>i.Api.getApi().post("messageConversations/".concat(a,"/recipients"),{users:e,userGroups:t,organisationUnits:s})).catch(e=>{throw e});const x=e=>Object(u.getInstance)().then(t=>t.Api.getApi().post("/fileResources?domain=MESSAGE_ATTACHMENT",function(e){const t=new FormData;return t.append("file",e),t}(e))).catch(e=>{throw e});const I=(e,t,s)=>Object(u.getInstance)().then(a=>{const i=a.Api.getApi().baseUrl;return function(e){const t=document.createElement("a");t.href=e,t.setAttribute("target","_blank"),document.body.appendChild(t),t.click()}("".concat(i,"/messageConversations/").concat(e,"/").concat(t,"/attachments/").concat(s))}).catch(e=>{throw e});var R=s(10),w=s.n(R);const F=(e,t)=>({type:e,payload:t}),O=e=>async t=>{t(F("SET_SELECTED_MESSAGE_CONVERSATION"));try{const s=await(async({id:e})=>{const{messageConversation:t}=await f.query({messageConversation:{resource:"messageConversations",id:e,params:{fields:v}}});return t})(e);t(F("SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS",{messageConversation:s}))}catch(s){t(F("SET_SELECTED_MESSAGE_CONVERSATION_ERROR",{error:s}))}},_=(e,t,s=!1)=>async(a,i)=>{const n=[],r=i(),{messageFilter:o,statusFilter:l,priorityFilter:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}=r.messaging;e=e||r.messaging.selectedMessageType,t=t||r.messaging.selectedMessageType.id,a(F("LOAD_MESSAGE_CONVERSATIONS",{messageType:e,loadMore:s}));try{for(let t=1;t<=e.page;t++){const s=k({messageType:e.id,page:t,messageFilter:o,status:l,priority:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}).then(e=>({messageConversations:e.messageConversations,pager:e.pager}));n.push(s)}const s=await Promise.all(n),i=await(e=>Object(u.getInstance)().then(t=>t.Api.getApi().get("messageConversations",{fields:"read",filter:["read:eq:false","messageType:eq:".concat(e)]})).then(e=>e.pager.total).catch(e=>{throw e}))(e.id),r=s.reduce((e,t)=>e.concat(t.messageConversations),[]);a(F("MESSAGE_CONVERSATIONS_LOAD_SUCCESS",{messageConversations:r,pager:s[s.length-1].pager,messageType:e,selectedMessageType:t,nrOfUnread:i}))}catch(m){a(F("MESSAGE_CONVERSATIONS_LOAD_ERROR",{error:m}))}},N=(e,t,s)=>async a=>{try{await("read"===e?(n=t,Object(u.getInstance)().then(e=>e.Api.getApi().post("messageConversations/read",n)).then(e=>e).catch(e=>{throw e})):(i=t,Object(u.getInstance)().then(e=>e.Api.getApi().post("messageConversations/unread",i)).then(e=>e).catch(e=>{throw e}))),a(F("MARK_MESSAGE_CONVERSATIONS_SUCCESS",{messageType:s,page:1})),a(_())}catch(r){a(F("MARK_MESSAGE_CONVERSATIONS_ERROR",{error:r}))}var i,n},U=e=>async t=>{t(F("ADD_ATTACHMENT",e));try{const s=await x(e);t(F("ADD_ATTACHMENT_SUCCESS",{id:s.response.fileResource.id,name:e.name,contentLength:s.response.fileResource.contentLength}))}catch(s){t(F("ADD_ATTACHMENT_ERROR",{error:s}))}},D=()=>F("CLEAR_CHECKED"),L=()=>F("CLEAR_SELECTED_MESSAGE_CONVERSATION"),G=({message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a})=>F("DISPLAY_SNACK_MESSAGE;",{message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a}),j=(e,t)=>F("SET_FILTER",{filter:e,filterType:t}),P=(e,t,s)=>F("UPDATE_INPUT_FIELDS",{subject:e,input:t,recipients:s}),V=()=>F("CLEAR_ATTACHMENTS"),H=e=>F("SET_SELECTED_MESSAGE_TYPE",{messageTypeId:e}),W=e=>F("REMOVE_ATTACHMENT",{attachmentId:e}),B=e=>F("CANCEL_ATTACHMENT",{attachmentName:e});var q=s(198),Y=s(369),K=s.n(Y),z=s(196),X=s(227),J=K()({palette:{negative:X.pinkA200,blue50:X.blue50,primary1Color:"#1D8BF1",primary2Color:X.blue100,primary3Color:X.blue300,primary4Color:X.blue500,accent1Color:X.grey50,accent2Color:X.grey100,accent3Color:X.grey300,accent4Color:X.grey500,followUp:X.orange500,darkGray:X.grey700,superDarkGray:X.grey900,textColor:X.darkBlack,alternateTextColor:X.white,canvasColor:X.white,borderColor:X.grey300,clockCircleColor:Object(z.fade)(X.darkBlack,.07),shadowColor:X.fullBlack}});const Q={NEGATIVE:J.palette.negative,NEUTRAL:J.palette.primary1Color,POSITIVE:J.palette.alternateTextColor};class Z extends a.Component{constructor(e){super(e),this.closeMessage=()=>{this.props.clearSnackMessage(),this.setState({show:!1}),this.props.onSnackRequestClose&&this.props.onSnackRequestClose()},this.state={show:!1}}componentDidUpdate(e,t){!t.show&&this.props.message&&this.setState({show:!0})}render(){return i.a.createElement(h.a,{open:""!==this.props.message&&this.state.show,message:this.props.message||"Missing snackbar message",autoHideDuration:4e3,onRequestClose:this.closeMessage,action:this.props.onSnackActionClick&&"undo",onActionClick:()=>{this.props.onSnackActionClick(),this.setState({show:!1})},contentStyle:{color:Q[this.props.type]},style:{pointerEvents:"none",whiteSpace:"nowrap"},bodyStyle:{pointerEvents:"initial",maxWidth:"none"}})}}var $=Object(q.a)(Object(l.b)(e=>({message:e.messaging.snackMessage,type:e.messaging.snackType,onSnackActionClick:e.messaging.onSnackActionClick,onSnackRequestClose:e.messaging.onSnackRequestClose}),{clearSnackMessage:()=>F("CLEAR_SNACK_MESSAGE")}),q.b)(Z),ee=s(796),te=s(0),se=s(195),ae=s.n(se),ie=s(785),ne=s.n(ie),re=s(5),oe=s.n(re),le=s(797),ce=Object(le.a)(),pe=s(421),de=s.n(pe),he=s(420),ge=s.n(he),me=s(186),ue=s.n(me),ye=s(191),Ee=s.n(ye),Ce=s(245),Se=s.n(Ce),Te=s(179),ve=s.n(Te),fe=s(215),ke=s.n(fe),Me=s(244),Ae=s.n(Me),be=s(290),xe=s.n(be),Ie=s(759),Re=s.n(Ie),we=s(754),Fe=s.n(we);s(753);const Oe=({dataDirection:e,attachment:t,removeAttachment:s,downloadAttachment:a,cancelAttachment:n})=>i.a.createElement(ue.a,{className:"attachment__button",backgroundColor:J.palette.accent2Color,label:"".concat(t.name," (").concat(parseFloat(parseInt(t.contentLength,10)/1e6).toFixed(2)," MB)"),labelPosition:"after",onClick:()=>{"download"===e?a(t):t.loading?n(t.name):s(t)},icon:"download"===e?i.a.createElement(Fe.a,null):i.a.createElement(Re.a,null)},t.loading&&i.a.createElement(xe.a,{className:"attachment__progress",mode:"indeterminate"}));var _e=({dataDirection:e,attachments:t,style:s,removeAttachment:a,downloadAttachment:n,cancelAttachment:r})=>i.a.createElement("div",{className:"attachment",style:{...s}},t.map((t,s)=>i.a.createElement(Oe,{key:"".concat(t.name,"-").concat(s),dataDirection:e,attachment:t,removeAttachment:a,downloadAttachment:n,cancelAttachment:r}))),Ne=s(760),Ue=s.n(Ne);const De={canvas:e=>({backgroundColor:e,padding:"16px 16px 16px 16px"}),innerCanvas:{margin:"",paddingBottom:"0px"},cardText:{padding:"16px 0px 16px 0px",fontFamily:y,whiteSpace:"pre-wrap",wordBreak:"break-word"},fromFormat:{fontFamily:y},datePlacement:{display:"flex",justifyContent:"flex-end",marginRight:"10px"},dateFormat:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:y}};var Le=({displayTimeDiff:e,message:t,currentUser:s,lastMessage:a,downloadAttachment:n,cancelAttachment:r,enableAttachments:o})=>{const l=t.sender?s&&s.id===t.sender.id?"me":t.sender.displayName:"system",c=w()(),p=w()(t.created).add(e);return i.a.createElement("div",{style:De.canvas(J.palette.canvasColor)},i.a.createElement("div",{style:De.innerCanvas},i.a.createElement("div",{style:De.fromFormat},t.internal?oe.a.t("Internal message from ".concat(l)):oe.a.t("Message from ".concat(l))),i.a.createElement("div",{placement:"bottom",style:De.datePlacement},i.a.createElement("div",{style:De.dateFormat},c.diff(p,"hours")<72?"".concat(p.from(c),", ").concat(p.format("HH:mm")):c.year()===p.year()?p.format("MMM DD, HH:mm"):p.format("MMM DD, YYYY HH:mm"))),o&&i.a.createElement(_e,{dataDirection:"download",style:{paddingLeft:0},attachments:t.attachments,downloadAttachment:n,cancelAttachment:r}),i.a.createElement(Ae.a,{style:De.cardText},i.a.createElement(Ue.a,null,t.text))),!a&&i.a.createElement(ke.a,null))},Ge=s(243),je=s(248),Pe=s.n(je),Ve=s(193),He=s.n(Ve),We=s(774),Be=s.n(We);s(773);const qe=e=>t=>{const s=t.target.files;s.length>0&&e(s[0])};var Ye=({addAttachment:e})=>i.a.createElement(ue.a,{className:"attachment__upload-button",label:oe.a.t("Upload attachment"),labelPosition:"after",containerElement:"label",icon:i.a.createElement(Be.a,null)},i.a.createElement("input",{className:"attachment__upload-button--input",type:"file",onChange:qe(e)}));class Ke extends a.Component{constructor(e){super(e),this.replyMessage=e=>{const{input:t,selectedMessageConversation:s,selectedMessageType:a}=this.props;this.props.replyMessage({message:t,internalReply:e,messageConversation:s,messageType:a}),this.wipeInput()},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),this.setState({inputError:!1})},this.texFieldUpdate=(e,t)=>{this.props.updateInputFields("",t,[])},this.handleDiscard=()=>{const e=oe.a.t("Reply discarded");this.setState({discardState:!0}),this.props.displaySnackMessage({message:e,onSnackActionClick:()=>this.setState({discardState:!1}),onSnackRequestClose:()=>{this.setState({discardState:!1}),this.wipeInput()},snackType:"NEGATIVE"}),this.setState({expanded:!1})},this.state={discardState:!1}}componentWillUnmount(){this.wipeInput()}render(){return i.a.createElement(Ge.Card,{style:{marginTop:"5px"},expanded:!0},i.a.createElement(Ge.CardText,{style:{padding:"0px 0px 0px 16px"}},i.a.createElement(He.a,{key:this.props.messageConversation.id,id:this.props.messageConversation.id,rows:5,underlineShow:!1,value:this.state.discardState?"":this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:oe.a.t("Message"),onChange:this.texFieldUpdate}),this.props.enableAttachments&&!this.state.discardState&&i.a.createElement(_e,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(Ge.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(Pe.a,{primary:!0,label:oe.a.t("Reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!1)}),this.props.isInFeedbackRecipientGroup&&"TICKET"===this.props.selectedMessageType.id&&i.a.createElement(ue.a,{primary:!0,label:oe.a.t("Internal reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!0)}),i.a.createElement(ue.a,{label:oe.a.t("Discard"),disabled:""===this.props.input||this.state.discardState,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(Ye,{addAttachment:e=>{this.props.addAttachment(e)}}),")")))}}var ze=Object(q.a)(Object(l.b)(e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes,input:e.messaging.input,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments,enableAttachments:S(e.messaging.dhis2CoreVersion)}),{replyMessage:({message:e,internalReply:t,messageConversation:s,messageType:a})=>async(i,n)=>{try{const{id:r}=s,o=n().messaging.attachments.map(e=>e.id);await(({message:e,internalReply:t,attachments:s,id:a})=>Object(u.getInstance)().then(i=>i.Api.getApi().post("messageConversations/".concat(a,"?internal=").concat(t).concat(s.length>0?"&attachments=".concat(s):""),e,{headers:{"Content-Type":"text/plain"}})).catch(e=>{throw e}))({message:e,internalReply:t,attachments:o,id:r}),i(F("REPLY_MESSAGE_SUCCESS",{messageConversation:s,messageType:a,page:1})),i(_()),i(O(s))}catch(r){i(F("REPLY_MESSAGE_ERROR",{error:r}))}},setSelectedMessageType:H,updateInputFields:P,displaySnackMessage:G,addAttachment:U,removeAttachment:W,cancelAttachment:B},null,{pure:!1}))(Ke),Xe=s(775),Je=s.n(Xe);class Qe extends a.Component{constructor(...e){super(...e),this.state={input:"",searchResult:[],searchOnlyUsers:this.props.searchOnlyUsers,searchOnlyFeedbackRecipients:this.props.searchOnlyFeedbackRecipients,lastSearch:"",errorText:void 0},this.debouncedSearch=C(this.search.bind(this),300),this.onSuggestionClick=e=>{if(void 0!==this.props.onSuggestionClick)this.props.onSuggestionClick(e);else{this.wipeInput(),this.debouncedSearch("");!this.props.recipients.find(t=>t.id===e.id)&&this.props.updateRecipients([...this.props.recipients,this.state.searchResult.find(t=>t.id===e.id)])}},this.onRemoveChip=e=>{this.props.updateRecipients(this.props.recipients.filter(t=>t.id!==e))},this.wipeInput=()=>{this.setState({input:"",searchResult:[]})},this.updateInput=e=>{this.debouncedSearch(e),this.setState({input:e})}}search(e){if(!this.state.searchResult.find(t=>t.displayName===e)&&""!==e&&e.length>=2){const{feedbackRecipientsId:t,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a}=this.props;A({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a,feedbackRecipientsId:t}).then(({users:e,userGroups:t,organisationUnits:s})=>{const a=e=>t=>({...t,type:e});let i=e.map(a("user"));this.state.searchOnlyUsers||(i=i.concat(t.map(a("userGroup"))).concat(s.map(a("organisationUnit")))),this.setState({searchResult:i,errorText:0===i.length?oe.a.t("No results found"):void 0})})}else this.setState({lastSearch:e,searchResult:""!==this.state.lastSearch&&""===e||e.length<2?[]:this.state.searchResult,errorText:""!==e&&e.length<2?oe.a.t("Please enter at least ".concat(2," characters")):this.state.searchWarning})}render(){return i.a.createElement("div",{style:{...this.props.style,height:this.props.inputHeight}},i.a.createElement(Je.a,{style:{marginBottom:16},disabled:void 0!==this.props.disabled&&this.props.disabled,errorText:this.props.errorText||this.state.errorText,value:this.props.recipients,fullWidth:!0,openOnFocus:!0,searchText:this.state.input,floatingLabelText:this.props.label,dataSource:this.state.searchResult,dataSourceConfig:{text:"displayName",value:"id"},onUpdateInput:this.updateInput,onRequestAdd:e=>this.onSuggestionClick(e),onRequestDelete:e=>this.onRemoveChip(e)}))}}var Ze=Qe;const $e={subheaderTitle:{height:"32px",color:"black",paddingLeft:0,paddingRight:16},subheader:(e,t)=>({height:"32px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:0,color:e,fontWeight:t})};var et=({showTitle:e,title:t,label:s,color:a,fontWeight:n})=>{const r=s&&"NONE"!==s?"Assignee"===t?s:"".concat(s.charAt(0)).concat(s.toLowerCase().substr(1,s.length)):"-";return i.a.createElement("div",{style:{flex:2,paddingLeft:10,maxWidth:200}},e&&i.a.createElement(ae.a,{style:$e.subheaderTitle}," ",t," "),i.a.createElement(ae.a,{style:$e.subheader(a,n)},r))};const tt={canvas:{flex:"3 0",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)",paddingTop:"10px"},innerCanvas:{display:"flex",flexDirection:"column",margin:"0px 10px 0px 10px"},header:{display:"flex"},iconButton:{display:"flex",alignSelf:"center"},subjectSubheader:{display:"flex",alignSelf:"center",fontSize:"20px",fontFamily:y},participantsCanvas:{display:"flex",flexDirection:"column"},participants:{paddingLeft:"12px",paddingTop:"10px",display:"flex",flexWrap:"wrap"},chip:{height:"32px",marginRight:"3px",marginBottom:"3px"},participantAddRow:{display:"flex"},participantsSuggestionField:{paddingLeft:"12px",marginBottom:"0px",flex:1},participantsAdd:{alignSelf:"flex-end",marginBottom:"28px",paddingLeft:"12px"},messagesCanvas:{marginBottom:"50px",display:"flex",flexDirection:"column",backgroundColor:J.palette.accent2Color,margin:"0px 10px 10px 10px"},messagesInnerCanvas:{padding:"0px"}};const st=["TICKET","VALIDATION_RESULT"];class at extends a.Component{constructor(e){super(e),this.backToList=()=>{const{clearSelectedMessageConversation:e,messageConversation:t}=this.props;ce.push("/".concat(t.messageType)),e()},this.addRecipients=()=>{const e=this.state.recipients.filter(e=>"user"===e.type),t=this.state.recipients.filter(e=>"userGroup"===e.type),s=this.state.recipients.filter(e=>"organisationUnit"===e.type),{messageConversation:a,selectedMessageType:i}=this.props;this.props.addRecipients({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i}),this.setState({recipients:[]})},this.updateRecipients=e=>{this.setState({recipients:e})},this.state={recipients:[],cursor:"auto"}}render(){const{messageConversation:e,currentUser:t}=this.props,s=e.messages,a=!!(st.indexOf(e.messageType)+1),n=e.userMessages.slice(0,30).map(e=>!t.id||this.state.recipientsExpanded||t.id!==e.user.id?e.user.displayName:oe.a.t("me")),r=e.userMessages.length;return r>30&&n.push(" + ".concat(r-30)),i.a.createElement("div",{id:"messageconversation",style:tt.canvas},i.a.createElement("div",{style:tt.innerCanvas},i.a.createElement("div",{style:tt.header},i.a.createElement(Ee.a,{style:tt.iconButton,tooltipPosition:"bottom-right",onClick:this.backToList,tooltip:oe.a.t("Show all messages")},i.a.createElement(ge.a,null)),i.a.createElement(ae.a,{style:tt.subjectSubheader},e.subject),this.props.displayExtendedChoices&&i.a.createElement(et,{color:J.palette.darkGray,showTitle:!0,title:oe.a.t("Status"),label:e.status}),this.props.displayExtendedChoices&&i.a.createElement(et,{color:J.palette.darkGray,showTitle:!0,title:oe.a.t("Priority"),label:e.priority}),a&&i.a.createElement(et,{color:J.palette.darkGray,showTitle:!0,title:oe.a.t("Assignee"),label:e.assignee?e.assignee.displayName:void 0})),i.a.createElement("div",{style:tt.participantsCanvas},i.a.createElement(ae.a,{style:{paddingLeft:"12px",paddingTop:"10px"}},oe.a.t("Participants")),i.a.createElement("div",{style:tt.participants},n.map(e=>i.a.createElement(Se.a,{key:e,style:tt.chip},e)))),i.a.createElement("div",{style:tt.participantAddRow},i.a.createElement(Ze,{style:tt.participantsSuggestionField,label:oe.a.t("Add participants to conversation"),messageConversation:e,recipients:this.state.recipients,updateRecipients:this.updateRecipients,limitSearchArray:e.userMessages}),i.a.createElement("div",{style:tt.participantsAdd},i.a.createElement(ue.a,{icon:i.a.createElement(de.a,null),onClick:()=>this.addRecipients(),label:oe.a.t("Add")})))),i.a.createElement("div",{style:tt.messagesCanvas},i.a.createElement(ve.a,{style:tt.messagesInnerCanvas},s.map((t,n)=>i.a.createElement(Le,{key:t.id,displayTimeDiff:this.props.displayTimeDiff,message:t,messageConversation:e,notification:a,currentUser:this.state.currentUser,lastMessage:n+1===s.length,downloadAttachment:s=>this.props.downloadAttachment(e.id,t.id,s.id),cancelAttachment:this.props.cancelAttachment,enableAttachments:this.props.enableAttachments}))),i.a.createElement(ze,Object.assign({},this.props,{messageConversation:e}))))}}var it=Object(l.b)(e=>({currentUser:e.messaging.currentUser,selectedMessageType:e.messaging.selectedMessageType,displayTimeDiff:e.messaging.displayTimeDiff,enableAttachments:S(e.messaging.dhis2CoreVersion)}),{addRecipients:({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i})=>async n=>{try{const{id:r}=a;await b({users:e,userGroups:t,organisationUnits:s,messageConversationId:r}),n(F("ADD_RECIPIENTS_SUCCESS",{messageConversation:a,messageType:i,page:1})),n(O(a))}catch(r){n(F("ADD_RECIPIENTS_ERROR",{error:r}))}},downloadAttachment:(e,t,s)=>async a=>{try{await I(e,t,s),a(F("DOWNLOAD_ATTACHMENT_SUCCESS"))}catch(i){a(F("DOWNLOAD_ATTACHMENT_ERROR",{error:i}))}},cancelAttachment:B,clearSelectedMessageConversation:L})(at),nt=s(291),rt=s(307),ot=s.n(rt),lt=s(246),ct=s.n(lt),pt=s(279),dt=s.n(pt);class ht extends a.Component{constructor(e){super(e),this.onClick=()=>{this.props.onClick()},this.onMouseEnter=()=>{this.setHoverText(),this.setState({cursor:"pointer"})},this.onMouseLeave=()=>{this.setNeutralText(),this.setState({cursor:"auto"})},this.setNeutralText=()=>this.setTextColor(J.palette.accent2Color),this.setHoverText=()=>this.setTextColor(J.palette.accent3Color),this.setTextColor=e=>{this.setState({backgroundColor:e})},this.getBackgroundColor=(e,t)=>e&&t===e.id?J.palette.accent3Color:this.state.backgroundColor,this.state={backgroundColor:J.palette.accent2Color,textColor:J.palette.darkGray}}render(){return i.a.createElement("div",{role:"presentation",style:{...this.state,backgroundColor:this.getBackgroundColor(this.props.selectedMessageType,this.props.messageType.id),cursor:this.state.cursor,alignItems:"center",height:"49px",display:"flex",flexDirection:"row",justifyContent:"space-between"},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:()=>this.onClick()},i.a.createElement(ae.a,{style:{marginLeft:"5px",fontSize:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?"18px":"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?J.palette.primary1Color:this.state.textColor}},oe.a.t(this.props.messageType.displayName)),this.props.loading?i.a.createElement(ct.a,{style:{marginRight:"10px"},color:J.palette.primary1Color,size:24}):this.props.messageType.unread>0&&i.a.createElement(dt.a,{style:{marginTop:"12px",marginRight:"5px"},badgeContent:this.props.messageType.unread>100?"99+":this.props.messageType.unread,secondary:!0,badgeStyle:{backgroundColor:"#439E8E"}}))}}var gt=ht;const mt={canvas:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"calc(100vh - 95px)",borderLeftStyle:"solid",borderLeftWidth:"0.5px",borderLeftColor:J.palette.accent4Color,borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:J.palette.accent4Color,overflowY:"auto",overflowX:"hidden",minWidth:"200px"}};class ut extends a.Component{constructor(e){super(e),this.props.setSelectedMessageType(this.props.match.params.messageType)}render(){const e=this.props.messageTypes;return i.a.createElement("div",{style:mt.canvas},i.a.createElement(nt.List,{style:{padding:"0px"}},e&&e.map(e=>i.a.createElement("div",{key:e.id},i.a.createElement(gt,{messageType:e,onClick:()=>{this.props.setSelectedMessageType(e.id),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),ce.push("/".concat(e.id))},selectedMessageType:this.props.selectedMessageType,loading:e.loading}),i.a.createElement(ke.a,null)))),i.a.createElement(ot.a,{style:{width:"",margin:"20px"},label:"".concat(oe.a.t("Auto refresh")," (").concat(w()(this.props.refreshTimer).format("mm:ss"),")"),toggled:this.props.autoRefresh,onToggle:()=>this.props.setAutoRefresh(!this.props.autoRefresh)}))}}var yt=Object(q.a)(Object(l.b)(e=>({selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes}),{setSelectedMessageType:H,clearCheckedIds:D},null,{pure:!1}))(ut);const Et={overflowY:"scroll",overflowX:"hidden",borderRightWidth:"1px",borderRightColor:J.palette.accent4Color,height:"calc(100vh - 95px)"},Ct={paddingLeft:"0px",fontSize:"20px"};var St=s(216),Tt=s.n(St);const vt={canvas:e=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",alignSelf:"center",boxShadow:"none",borderBottom:"1px solid #dfdfdf"}),checkBox:{flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:"12px"},sender:{fontFamily:y,fontSize:"16px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"black",paddingLeft:10,alignSelf:"center"},subject:{flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:y,fontSize:"16px",color:"black",paddingLeft:10},extendedLabel:{flex:2,color:"black",fontSize:"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 0 0 10px"}};class ft extends a.Component{constructor(e){super(e),this.state={cursor:"auto",allChecked:!1}}componentDidUpdate(){this.state.allChecked&&this.props.checkedIds.length<this.props.messages.length&&this.setState({allChecked:!1})}render(){const e=this.props.displayExtendedChoices;return i.a.createElement(ve.a,{style:vt.canvas(J.palette.canvasColor)},i.a.createElement(Tt.a,{checked:this.state.allChecked,style:vt.checkBox,onCheck:()=>{this.state.allChecked?this.props.clearCheckedIds():this.props.setAllChecked(this.props.messages.map(e=>({id:e.id}))),this.setState({allChecked:!this.state.allChecked})}}),i.a.createElement("div",{style:vt.sender},oe.a.t("Sender")),i.a.createElement(ae.a,{style:vt.subject},oe.a.t("Subject")),e&&i.a.createElement(ae.a,{style:vt.extendedLabel},oe.a.t("Status")),e&&i.a.createElement(ae.a,{style:vt.extendedLabel},oe.a.t("Priority")),this.props.notification&&i.a.createElement(ae.a,{style:vt.extendedLabel},oe.a.t("Assignee")),i.a.createElement(ae.a,{style:vt.extendedLabel},oe.a.t("Date")))}}var kt=Object(q.a)(Object(l.b)(e=>({checkedIds:e.messaging.checkedIds,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup}),{setAllChecked:e=>F("SET_ALL_CHECKED",{messageConversationIds:e}),clearCheckedIds:D}))(ft),Mt=s(776),At=s.n(Mt);const bt={container:(e,t,s)=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",cursor:s,boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",boxShadow:"none",borderBottom:"1px solid #dfdfdf",flexWrap:t?"nowrap":"wrap"}),checkBox:e=>({flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:e?12:6}),flag:{color:J.palette.followUp,marginRight:4},sender:(e,t)=>({fontFamily:y,fontSize:"14px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",color:"black",paddingLeft:e?10:0,fontWeight:t}),subject:(e,t,s)=>({flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingLeft:10,fontFamily:y,color:t,fontWeight:s,order:e?"inherit":10,marginTop:e?0:-10,flexBasis:e?"0%":"100%"}),dateFormat:(e,t,s)=>({flex:2,fontFamily:y,paddingLeft:e?10:0,paddingRight:e?0:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:e?"":"end",color:t,fontWeight:s})};class xt extends a.Component{constructor(e){super(e),this.onClick=e=>{this.props.setSelectedMessageConversation(e),e&&!e.read&&this.props.markMessageConversations("read",[e.id],this.props.selectedMessageType),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),ce.push("/".concat(e.messageType,"/").concat(e.id))},this.onMouseEnter=()=>this.setState({cursor:"pointer",backgroundColor:J.palette.accent2Color}),this.onMouseLeave=()=>this.setState({cursor:"auto",backgroundColor:J.palette.canvasColor}),this.getBackgroundColor=(e,t)=>{const s=this.props.selectedMessageConversation&&e.id===this.props.selectedMessageConversation.id;return t&&!s?J.palette.blue50:s?J.palette.accent3Color:this.state.backgroundColor},this.state={backgroundColor:J.palette.canvasColor,cursor:"auto"}}render(){const e=this.props.messageConversation,t=e.lastSender?e.lastSender.displayName:this.props.selectedMessageType.displayName,s=!!this.props.checkedIds.find(t=>t.id===e.id),a=this.props.displayExtendedChoices,n=this.props.displayTimeDiff,r=w()(),o=w()(e.lastMessage).add(n),l=e.read?"":"bold",c=this.props.messageConversation.read?"black":J.palette.darkGray,p=this.getBackgroundColor(e,s);return i.a.createElement(ve.a,{style:bt.container(p,this.props.wideview,this.state.cursor),onClick:t=>{void 0!==t.target.innerText&&""!==t.target.innerText&&!this.props.settingSelectedMessageConversation&&(this.onClick(e),this.props.checkedIds.length>0&&this.props.clearCheckedIds(),!this.props.wideview||void 0===this.props.messageFilter&&void 0===this.props.priorityFilter&&void 0===this.props.statusFilter||this.props.setFilter(void 0,"MESSAGE"))},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},i.a.createElement(Tt.a,{checked:s,style:bt.checkBox(this.props.wideview),onCheck:()=>{this.props.setChecked(e,!s)}}),i.a.createElement("div",{style:bt.sender(this.props.wideview,l)},e.followUp&&i.a.createElement(At.a,{style:bt.flag}),i.a.createElement("span",null,t)),i.a.createElement(ae.a,{style:bt.subject(this.props.wideview,c,l)},e.subject),a&&i.a.createElement(et,{showTitle:!1,title:oe.a.t("Status"),color:c,fontWeight:l,label:e.status}),a&&i.a.createElement(et,{showTitle:!1,title:oe.a.t("Priority"),color:c,fontWeight:l,label:e.priority}),this.props.notification&&this.props.wideview&&i.a.createElement(et,{showTitle:!1,title:oe.a.t("Assignee"),color:c,fontWeight:l,label:e.assignee?e.assignee.displayName:void 0}),i.a.createElement(ae.a,{style:bt.dateFormat(this.props.wideview,c,l)},r.diff(o,"hours")<72?o.from(r):r.year()===o.year()?o.format("MMM DD"):o.format("ll")))}}var It=Object(q.a)(Object(l.b)(e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,checkedIds:e.messaging.checkedIds,displayTimeDiff:e.messaging.displayTimeDiff,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,attachments:e.messaging.attachments}),{setChecked:(e,t)=>F("SET_CHECKED",{messageConversation:e,selectedValue:t}),setSelectedMessageConversation:O,markMessageConversations:N,clearCheckedIds:D,setFilter:j,updateInputFields:P,clearAttachments:V},null,{pure:!1}))(xt);const Rt=["VALIDATION_RESULT","TICKET"],wt={canvas:e=>({flex:"1 0",maxWidth:e?"none":"350px",minWidth:e?"none":"250px",borderRightStyle:e?"":"solid",...Et}),loading:{backgroundColor:J.palette.accent2Color,height:"".concat(50,"px"),transition:"all 0.2s ease-in-out",display:"flex",justifyContent:"center"}};class Ft extends a.Component{constructor(...e){super(...e),this.onScroll=e=>{const t=document.getElementById("messagelist");!this.props.selectedMessageType.loading&&this.isBottom(t)&&e.loaded<e.total&&this.props.loadMessageConversations(e,e.id,!0)},this.debouncedOnScroll=C(this.onScroll,150),this.isBottom=e=>e.scrollHeight-e.scrollTop<window.outerHeight}render(){const e=function(e){if(!Array.isArray(e))return;const t=new Set;return e.filter(e=>!t.has(e.id)&&(t.add(e.id),!0))}(this.props.messageConversations[this.props.selectedMessageType.id]),t=this.props.selectedMessageType?this.props.selectedMessageType:"",s=this.props.selectedMessageConversation?this.props.selectedMessageConversation.id:"",a=!!(Rt.indexOf(t.id)+1);return i.a.createElement("div",{id:"messagelist",onScroll:()=>this.debouncedOnScroll(this.props.selectedMessageType),style:wt.canvas(this.props.wideview)},this.props.wideview&&i.a.createElement(kt,{notification:a,displayExtendedChoices:this.props.displayExtendedChoices,messages:e}),e&&0!==e.length?e.map(e=>i.a.createElement(It,{key:e.id,messageConversation:e,wideview:this.props.wideview,selectedValue:s,notification:a,displayExtendedChoices:this.props.displayExtendedChoices})):!this.props.selectedMessageType.loading&&i.a.createElement(ae.a,null,oe.a.t("No ".concat(t.displayName.toLowerCase()," messages"))),this.props.selectedMessageType.loading&&i.a.createElement("div",{style:wt.loading},i.a.createElement(ct.a,{style:{marginTop:"10px"},color:J.palette.primary1Color})))}}var Ot=Object(q.a)(Object(l.b)(e=>({messageTypes:e.messaging.messageTypes,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,messageConversations:e.messaging.messageConversations,selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType}),{loadMessageConversations:_},null,{pure:!1}))(Ft),_t=s(296),Nt=s.n(_t);const Ut={canvas:{flex:"3 0",margin:"10px",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)"},messageTypeField:{display:"flex",flexDirection:"row"},messageType:{width:"300px",marginTop:"10px"}};class Dt extends a.Component{constructor(e){super(e),this.subjectUpdate=(e,t)=>{this.props.updateInputFields(t,this.props.input,this.props.recipients)},this.inputUpdate=(e,t)=>{this.props.updateInputFields(this.props.subject,t,this.props.recipients)},this.updateRecipients=e=>{this.props.updateInputFields(this.props.subject,this.props.input,e)},this.sendMessage=()=>{const e=this.state.isMessageFeedback?"TICKET":"PRIVATE",t=this.props.messageTypes.find(t=>t.id===e);if(this.state.isMessageFeedback)this.props.sendFeedbackMessage(t),ce.push("/TICKET");else{const e=this.props.recipients.filter(e=>"user"===e.type),s=this.props.recipients.filter(e=>"userGroup"===e.type),a=this.props.recipients.filter(e=>"organisationUnit"===e.type);this.props.sendMessage({users:e,userGroups:s,organisationUnits:a,messageType:t}),ce.push("/PRIVATE")}},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments()},this.handleDiscard=()=>{const e=oe.a.t("Message discarded");this.props.displaySnackMessage({message:e,onSnackActionClick:()=>ce.push("/PRIVATE/create"),onSnackRequestClose:()=>this.wipeInput(),snackType:"NEGATIVE"}),ce.push("/PRIVATE")},this.state={isMessageFeedback:!1}}componentDidMount(){const{addRecipientByUserId:e}=this.props,{messageId:t,recipientId:s}=this.props.match.params;"create"===t&&s&&e(s)}render(){const e=""===this.props.subject||""===this.props.input||!this.state.isMessageFeedback&&0===this.props.recipients.length,t=""===this.props.subject&&""===this.props.input&&!this.state.isMessageFeedback&&0===this.props.recipients.length;return i.a.createElement("div",{style:Ut.canvas},i.a.createElement(ae.a,{style:Ct}," ",oe.a.t("Create")),i.a.createElement(Ge.Card,null,i.a.createElement(Ge.CardText,null,i.a.createElement(Ze,{style:{margin:"0px"},label:oe.a.t("To"),disabled:this.state.isMessageFeedback,recipients:this.state.isMessageFeedback?[{id:"id",displayName:oe.a.t("Feedback recipient group")}]:this.props.recipients,updateRecipients:this.updateRecipients,inputHeight:"100px"}),i.a.createElement("div",{style:Ut.messageTypeField},i.a.createElement("div",{style:Ut.messageType},i.a.createElement(Nt.a,{label:oe.a.t("Private message"),checked:!this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}})),i.a.createElement("div",{style:Ut.messageType},i.a.createElement(Nt.a,{label:oe.a.t("Feedback message"),checked:this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}}))),i.a.createElement(He.a,{floatingLabelText:oe.a.t("Subject"),fullWidth:!0,value:this.props.subject,onChange:this.subjectUpdate}),i.a.createElement(He.a,{key:"createMessage",id:"createMessage",rows:5,underlineShow:!1,value:this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:oe.a.t("Message"),onChange:this.inputUpdate}),this.props.enableAttachments&&i.a.createElement(_e,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(Ge.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(Pe.a,{primary:!0,disabled:e,label:oe.a.t("Send"),onClick:()=>this.sendMessage()}),i.a.createElement(ue.a,{label:oe.a.t("Discard"),disabled:t,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(Ye,{addAttachment:e=>{this.props.addAttachment(e)}})))))}}var Lt=Object(q.a)(Object(l.b)(e=>({messageTypes:e.messaging.messageTypes,subject:e.messaging.subject,input:e.messaging.input,recipients:e.messaging.recipients,attachments:e.messaging.attachments,enableAttachments:S(e.messaging.dhis2CoreVersion)}),{sendMessage:({users:e,userGroups:t,organisationUnits:s,messageType:a})=>async(i,n)=>{try{const{messaging:{subject:r,input:o,attachments:l}}=n();await(({subject:e,users:t,userGroups:s,organisationUnits:a,text:i,attachments:n})=>Object(u.getInstance)().then(r=>r.Api.getApi().post("messageConversations",{subject:e,users:t,userGroups:s,organisationUnits:a,attachments:n,text:i})).catch(e=>{throw e}))({subject:r,users:e,userGroups:t,organisationUnits:s,text:o,attachments:l}),i(F("SEND_MESSAGE_SUCCESS",{messageType:a,page:1})),i(_())}catch(r){i(F("SEND_MESSAGE_ERROR",{error:r}))}},sendFeedbackMessage:e=>async(t,s)=>{const a=s();try{await(i=a.messaging.subject,n=a.messaging.input,Object(u.getInstance)().then(e=>e.Api.getApi().post("messageConversations/feedback?subject=".concat(i),n,{headers:{"Content-Type":"text/plain"}})).then(e=>e).catch(e=>{throw e})),t(F("SEND_MESSAGE_SUCCESS",{messageType:e,page:1})),t(_())}catch(r){t(F("SEND_MESSAGE_ERROR",{error:r}))}var i,n},displaySnackMessage:G,updateInputFields:P,addAttachment:U,removeAttachment:W,cancelAttachment:B,addRecipientByUserId:e=>async t=>{try{const s=await(e=>Object(u.getInstance)().then(t=>t.Api.getApi().get("users/".concat(e),{fields:"id,displayName"})).then(({id:e,displayName:t})=>({id:e,displayName:t,type:"user"})).catch(e=>{throw e}))(e);t(F("ADD_RECIPIENT_BY_ID_SUCCESS",s))}catch(s){console.error(s)}}},null,{pure:!1}))(Dt),Gt=s(783),jt=s.n(Gt),Pt=s(782),Vt=s.n(Pt),Ht=s(299),Wt=s.n(Ht),Bt=s(213),qt=s.n(Bt),Yt=s(225),Kt=s.n(Yt),zt=s(247),Xt=s.n(zt),Jt=s(362),Qt=s.n(Jt),Zt=s(422),$t=s.n(Zt);var es={STATUS:[{key:"NONE",value:"NONE",primaryText:oe.a.t("No status")},{key:"OPEN",value:"OPEN",primaryText:oe.a.t("Open")},{key:"PENDING",value:"PENDING",primaryText:oe.a.t("Pending")},{key:"INVALID",value:"INVALID",primaryText:oe.a.t("Invalid")},{key:"SOLVED",value:"SOLVED",primaryText:oe.a.t("Solved")}],PRIORITY:[{key:"NONE",value:"NONE",primaryText:oe.a.t("No priority")},{key:"HIGH",value:"HIGH",primaryText:oe.a.t("High")},{key:"MEDIUM",value:"MEDIUM",primaryText:oe.a.t("Medium")},{key:"LOW",value:"LOW",primaryText:oe.a.t("Low")}]},ts=s(217),ss=s.n(ts),as=s(777),is=s.n(as),ns=s(781),rs=s.n(ns),os=s(778),ls=s.n(os),cs=s(779),ps=s.n(cs),ds=s(780),hs=s.n(ds);var gs=({open:e,onRequestClose:t,updateMessageConversations:s,messageType:a,feedbackRecipientsId:n})=>i.a.createElement(ss.a,{open:e,onRequestClose:()=>{t()}},i.a.createElement(Ze,{onSuggestionClick:e=>{s([e.id]),t()},searchOnlyUsers:!0,searchOnlyFeedbackRecipients:"TICKET"===a.id,feedbackRecipientsId:n,recipients:[],key:"suggestionField",label:oe.a.t("Assignee")}));const ms={canvas:{width:"400px",display:"flex"},extendedChoices:{display:"flex",justifyContent:"flex-start"},nrSelected:{padding:"0px 0px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}};class us extends a.Component{constructor(e){super(e),this.getIds=()=>this.props.selectedMessageConversation&&0===this.props.checkedIds.length?[this.props.selectedMessageConversation.id]:this.props.checkedIds.map(e=>e.id),this.updateMessageConversation=(e,t)=>{const{selectedMessageType:s,selectedMessageConversation:a}=this.props,i=this.getIds();this.props.updateMessageConversations({messageConversationIds:i,identifier:e,value:t,messageType:s,selectedMessageConversation:a}),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.markMessageConversations=e=>{const t=this.getIds();this.props.markMessageConversations(e,t,this.props.selectedMessageType),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.toggleDialog=()=>{this.setState({dialogOpen:!this.state.dialogOpen})},this.state={checkedItems:!1,dialogOpen:!1,assignToOpen:!1}}render(){const e=this.props.selectedMessageConversation,t=this.props.checkedIds.length>0,s=t||void 0!==e,a=i.a.createElement(i.a.Fragment,null,i.a.createElement(ue.a,{label:oe.a.t("Cancel"),primary:!0,onClick:()=>this.toggleDialog()}),i.a.createElement(ue.a,{label:oe.a.t("Submit"),primary:!0,keyboardFocused:!0,onClick:()=>{this.props.deleteMessageConversations(this.getIds(),this.props.selectedMessageType),this.props.clearCheckedIds(),this.toggleDialog(),this.props.selectedMessageConversation&&(this.props.clearSelectedMessageConversation(),ce.push("/".concat(this.props.selectedMessageType.id)))}})),n=this.props.checkedIds.length>99?"".concat(99,"+"):this.props.checkedIds.length;return s?i.a.createElement("div",{style:ms.canvas},i.a.createElement(ss.a,{title:oe.a.t("Are you sure you want to delete selected message conversation(s)?"),actions:a,modal:!1,open:this.state.dialogOpen,onRequestClose:this.toggleDialog}),i.a.createElement(gs,{open:this.state.assignToOpen,onRequestClose:()=>this.setState({assignToOpen:!this.state.assignToOpen}),updateMessageConversations:e=>this.updateMessageConversation("ASSIGNEE",e),messageType:this.props.selectedMessageType,feedbackRecipientsId:this.props.feedbackRecipientsId}),i.a.createElement("div",{style:ms.extendedChoices},i.a.createElement(Ee.a,{tooltip:oe.a.t("Delete selected"),onClick:()=>{this.toggleDialog()}},i.a.createElement(ls.a,null)),i.a.createElement(Ee.a,{tooltip:oe.a.t("Mark selected as unread"),onClick:()=>{this.markMessageConversations("unread")}},i.a.createElement(ps.a,null)),i.a.createElement(Ee.a,{tooltip:oe.a.t("Mark selected as read"),onClick:()=>{this.markMessageConversations("read")}},i.a.createElement(hs.a,null)),this.props.displayExtendedChoices&&i.a.createElement(Ee.a,{onClick:()=>this.setState({assignToOpen:!this.state.assignToOpen}),tooltip:oe.a.t("Assign selected")},i.a.createElement(rs.a,null)),i.a.createElement(Xt.a,{iconButtonElement:i.a.createElement(Ee.a,null,i.a.createElement($t.a,null)),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"}},i.a.createElement(qt.a,{key:"markFollowUp",value:"markFollowUp",primaryText:oe.a.t("Mark for followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!0)}),i.a.createElement(qt.a,{key:"clearFollowUp",value:"clearFollowUp",primaryText:oe.a.t("Clear followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!1)}),this.props.displayExtendedChoices&&i.a.createElement(ke.a,null),this.props.displayExtendedChoices&&i.a.createElement(qt.a,{key:"clearAssigned",value:"clearAssigned",primaryText:oe.a.t("Clear assignee"),onClick:()=>this.updateMessageConversation("ASSIGNEE",void 0)}),this.props.displayExtendedChoices&&i.a.createElement(qt.a,{primaryText:oe.a.t("Set status"),key:"setStatus",rightIcon:i.a.createElement(is.a,null),menuItems:es.STATUS.map(e=>i.a.createElement(qt.a,{key:"".concat(e.key,"_status"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("STATUS",e.key)}))}),this.props.displayExtendedChoices&&i.a.createElement(qt.a,{primaryText:oe.a.t("Set priority"),key:"setPriority",rightIcon:i.a.createElement(is.a,null),menuItems:es.PRIORITY.map(e=>i.a.createElement(qt.a,{key:"".concat(e.key,"_priority"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("PRIORITY",e.key)}))}))),t&&i.a.createElement(Kt.a,{style:ms.nrSelected},"".concat(n," ").concat(oe.a.t("selected")))):i.a.createElement("div",null)}}var ys=Object(q.a)(Object(l.b)(e=>({selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,checkedIds:e.messaging.checkedIds,feedbackRecipientsId:e.messaging.feedbackRecipientsId}),{clearCheckedIds:D,clearSelectedMessageConversation:L,deleteMessageConversations:(e,t)=>async s=>{try{const a=e.map(e=>(e=>Object(u.getInstance)().then(t=>t.Api.getApi().delete("messageConversations/".concat(e,"/").concat(t.currentUser.id))).then(e=>e).catch(e=>{throw e}))(e));await Promise.all(a),s(F("MESSAGE_CONVERSATIONS_DELETE_SUCCESS",{messageType:t,page:1})),s(_())}catch(a){s(F("MESSAGE_CONVERSATIONS_DELETE_ERROR",{error:a}))}},updateMessageConversations:({messageConversationIds:e,identifier:t,value:s,messageType:a,selectedMessageConversation:i})=>async n=>{if("FOLLOW_UP"===t)try{await((e,t)=>Object(u.getInstance)().then(s=>s.Api.getApi().post("messageConversations/".concat(t?"followup":"unfollowup"),e)).then(e=>e).catch(e=>{throw e}))(e,s),n(F("MESSAGE_CONVERSATION_UPDATE_SUCCESS",{messageType:a,page:1,identifier:t})),n(_())}catch(r){n(F("MESSAGE_CONVERSATION_UPDATE_ERROR",{error:r}))}else{const i=e.map(e=>{let i;switch(t){case"STATUS":i=((e,t)=>Object(u.getInstance)().then(s=>s.Api.getApi().post("messageConversations/".concat(e,"/status?messageConversationStatus=").concat(t))).then(e=>e).catch(e=>{throw e}))(e,s);break;case"PRIORITY":i=((e,t)=>Object(u.getInstance)().then(s=>s.Api.getApi().post("messageConversations/".concat(e,"/priority?messageConversationPriority=").concat(t))).then(e=>e).catch(e=>{throw e}))(e,s);break;case"ASSIGNEE":i=void 0!==s&&"VALIDATION_RESULT"===a.id?b({users:s.map(e=>({id:e})),userGroups:[],organisationUnits:[],messageConversationId:e}).then(()=>M(e,s)):M(e,s);break;default:m.a.error("Unexpected identifier for updateMessageConversations")}return i});try{await Promise.all(i),n(F("MESSAGE_CONVERSATION_UPDATE_SUCCESS",{messageType:a,page:1,identifier:t})),n(_())}catch(r){n(F("MESSAGE_CONVERSATION_UPDATE_ERROR",{error:r}))}}i&&n(O(i))},markMessageConversations:N},null,{pure:!1}))(us);const Es={canvas:e=>({display:"flex",justifyContent:"flex-start",alignItems:"center",backgroundColor:e?J.palette.blue50:J.palette.accent2Color,zIndex:10}),checkedOption:{display:"flex",justifyContent:"flex-start",minWidth:"200px",margin:"6px 0"},filterControl:{flex:2,height:"48px",marginRight:16,maxWidth:256},rightHandCanvas:{flex:"2 0",display:"flex",paddingLeft:16},ie11Spacer:{flexGrow:1},iconMenu:{width:"30px",display:"flex"}};class Cs extends a.Component{constructor(...e){super(...e),this.state={lastMessageFilter:""},this.debouncedSearch=C(this.search,300)}search(e){this.props.selectedMessageType&&this.state.lastMessageFilter!==e&&(this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id),this.setState({lastMessageFilter:e}))}componentDidUpdate(e){e.selectedMessageType&&this.props.selectedMessageType.id!==e.selectedMessageType.id&&(this.debouncedSearch(""),void 0!==this.props.messageFilter&&this.props.setFilter(void 0,"MESSAGE"),void 0!==this.props.statusFilter&&this.props.setFilter(void 0,"STATUS"),void 0!==this.props.priorityFilter&&this.props.setFilter(void 0,"PRIORITY"),this.props.assignedToMeFilter&&this.props.setFilter(!1,"ASSIGNED_TO_ME"),this.props.markedForFollowUpFilter&&this.props.setFilter(!1,"MARKED_FOR_FOLLOWUP"),this.props.unreadFilter&&this.props.setFilter(!1,"UNREAD")),void 0===this.props.selectedMessageType||this.props.selectedMessageType.loading||e.statusFilter===this.props.statusFilter&&e.priorityFilter===this.props.priorityFilter&&e.assignedToMeFilter===this.props.assignedToMeFilter&&e.markedForFollowUpFilter===this.props.markedForFollowUpFilter&&e.unreadFilter===this.props.unreadFilter&&void 0!==e.selectedMessageType&&e.selectedMessageType.id===this.props.selectedMessageType.id||this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id)}render(){const e=this.props.id,t=this.props.displayExtendedChoices,s=this.props.checkedOptions,a=!this.props.wideview||void 0===this.props.selectedMessageConversation&&"create"!==e;return i.a.createElement(ve.a,{style:Es.canvas(s)},i.a.createElement("div",null,!s&&i.a.createElement(ue.a,{style:Es.checkedOption,icon:i.a.createElement(de.a,null),onClick:()=>ce.push("/PRIVATE/create"),label:oe.a.t("Compose")}),s&&i.a.createElement(ue.a,{style:Es.checkedOption,icon:i.a.createElement(ge.a,null),onClick:()=>this.props.clearCheckedIds(),label:oe.a.t("Deselect all")})),i.a.createElement(ys,{displayExtendedChoices:t}),i.a.createElement("div",{style:Es.rightHandCanvas},i.a.createElement("div",{style:Es.ie11Spacer}),t&&a&&!s&&i.a.createElement(Wt.a,{style:Es.filterControl,labelStyle:{color:void 0===this.props.statusFilter?"lightGray":"black",top:void 0===this.props.statusFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:J.palette.primary1Color},floatingLabelText:void 0===this.props.statusFilter?oe.a.t("Status"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.statusFilter?"-15px":"0px"},value:this.props.statusFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"STATUS")}},i.a.createElement(qt.a,{key:null,value:null,primaryText:""}),es.STATUS.map(e=>i.a.createElement(qt.a,{key:e.key,value:e.value,primaryText:e.primaryText}))),t&&a&&!s&&i.a.createElement(Wt.a,{style:Es.filterControl,labelStyle:{color:void 0===this.props.priorityFilter?"lightGray":"black",top:void 0===this.props.priorityFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:J.palette.primary1Color},floatingLabelText:void 0===this.props.priorityFilter?oe.a.t("Priority"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.priorityFilter?"-15px":"0px"},value:this.props.priorityFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"PRIORITY")}},i.a.createElement(qt.a,{key:null,value:null,primaryText:""}),es.PRIORITY.map(e=>i.a.createElement(qt.a,{key:e.key,value:e.value,primaryText:e.primaryText}))),!s&&a&&i.a.createElement(He.a,{style:Es.filterControl,fullWidth:!0,hintText:oe.a.t("Search"),value:this.props.messageFilter||"",onChange:(e,t)=>{this.debouncedSearch(t),this.props.setFilter(t,"MESSAGE")},type:"search"}),!s&&a&&i.a.createElement(Xt.a,{iconButtonElement:i.a.createElement(Ee.a,null,i.a.createElement($t.a,null)),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},style:Es.iconMenu,menuStyle:{overflowX:"hidden"}},i.a.createElement(Kt.a,{style:{padding:"0px 16px"}},oe.a.t("Set filter")),this.props.displayExtendedChoices&&i.a.createElement(Qt.a,{style:{padding:"0px 16px"},key:"assignedToMeFilter",label:oe.a.t("Assigned to me"),checked:this.props.assignedToMeFilter,onClick:()=>{this.props.setFilter(!this.props.assignedToMeFilter,"ASSIGNED_TO_ME")}}),i.a.createElement(Qt.a,{style:{padding:"0px 16px"},key:"markedForFollowUpFilter",label:oe.a.t("Marked for followup"),checked:this.props.markedForFollowUpFilter,onClick:()=>{this.props.setFilter(!this.props.markedForFollowUpFilter,"MARKED_FOR_FOLLOWUP")}}),i.a.createElement(Qt.a,{style:{padding:"0px 16px"},key:"unreadFilter",label:oe.a.t("Unread messages"),checked:this.props.unreadFilter,onClick:()=>{this.props.setFilter(!this.props.unreadFilter,"UNREAD")}})),i.a.createElement(ue.a,{style:{width:"50px",alignSelf:"center"},icon:this.props.wideview?i.a.createElement(jt.a,null):i.a.createElement(Vt.a,null),onClick:()=>this.props.toogleWideview()})))}}var Ss=Cs;s(784);const Ts=["TICKET","VALIDATION_RESULT"];class vs extends a.Component{constructor(e){super(e),this.setAutoRefresh=e=>{!e&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),e&&(this.intervalId=setInterval(this.tick,1e4)),this.setState({autoRefresh:e,refreshTimer:3e5})},this.tick=()=>{this.state.refreshTimer-1e4<=0?(this.refresh(),this.setState({refreshTimer:3e5})):this.setState(e=>({refreshTimer:e.refreshTimer-1e4}))},this.refresh=()=>{this.props.messageTypes.map(e=>this.props.loadMessageConversations(e,this.props.selectedMessageType)),this.props.selectedMessageConversation&&this.props.setSelectedMessageConversation(this.props.selectedMessageConversation)},this.toogleWideview=()=>{this.setState({wideview:!this.state.wideview})},this.intervalId=null,this.state={autoRefresh:!1,checkedItems:!1,refreshTimer:3e5,wideview:!0}}componentDidMount(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(this.props.setDhis2CoreVersion(this.context.d2.system.version.minor),t&&t!==e&&"create"!==t){const e={id:t};this.props.setSelectedMessageConversation(e)}Object(u.getInstance)().then(e=>e.Api.getApi().get("me",{fields:"userGroups[id]"})).then(e=>Object(u.getInstance)().then(e=>({configuration:e.Api.getApi().get("configuration").then(e=>e),instance:e})).then(({configuration:t,instance:s})=>{const a=(i=s.currentUser.authorities,Array.from(i[Object.getOwnPropertySymbols(i)[0]]));var i;return t.then(t=>({authorized:a.includes("ALL")||!!e.userGroups.find(e=>e.id===t.feedbackRecipients.id),feedbackRecipientsId:t.feedbackRecipients.id}))}).catch(e=>{throw e})).catch(e=>{throw e}).then(e=>this.props.setIsInFeedbackRecipientGroup(e)),this.props.messageTypes.map(t=>this.props.loadMessageConversations(t,e)),this.props.setDisplayTimeDiff()}componentDidUpdate(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(!this.props.settingSelectedMessageConversation&&t&&e!==t&&"create"!==t&&(void 0===this.props.selectedMessageConversation||t!==this.props.selectedMessageConversation.id)){const e={id:t};this.props.setSelectedMessageConversation(e)}e===t&&e!==this.props.selectedMessageType.id&&this.props.setSelectedMessageType(e),e!==t&&"create"!==t||void 0===this.props.selectedMessageConversation||this.props.clearSelectedMessageConversation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId)}render(){const e=this.props.match.params.messageId,t=!!this.props.selectedMessageType&&!!(Ts.indexOf(this.props.selectedMessageType.id)+1)&&this.props.isInFeedbackRecipientGroup;return i.a.createElement("div",{className:"messaging-center"},i.a.createElement(Ss,Object.assign({},this.props,{id:e,wideview:this.state.wideview,displayExtendedChoices:t,toogleWideview:this.toogleWideview})),i.a.createElement("div",{className:"messaging-center__main-content"},i.a.createElement(yt,Object.assign({},this.props,{drawerOpen:this.state.drawerOpen,messageTypes:this.props.messageTypes,autoRefresh:this.state.autoRefresh,refreshTimer:this.state.refreshTimer,setAutoRefresh:this.setAutoRefresh})),void 0===this.props.selectedMessageConversation&&!(this.state.wideview&&"create"===e)&&i.a.createElement(Ot,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),"create"===e&&i.a.createElement(Lt,Object.assign({},this.props,{wideview:this.state.wideview})),void 0!==this.props.selectedMessageConversation&&!this.state.wideview&&i.a.createElement(Ot,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),this.props.selectedMessageConversation&&"create"!==e?void 0!==this.props.selectedMessageConversation&&i.a.createElement(it,Object.assign({},this.props,{messageConversation:this.props.selectedMessageConversation,wideview:this.state.wideview,disableLink:!0,displayExtendedChoices:t})):!this.state.wideview&&"create"!==e&&i.a.createElement("div",{className:"messaging-center__no-message-selected"},i.a.createElement(ae.a,{style:Ct},oe.a.t("Select a message")),i.a.createElement(ne.a,{style:{color:J.palette.primary1Color,width:120,height:120}}))))}}vs.contextTypes={d2:te.default.object};var fs=Object(q.a)(Object(l.b)(e=>({snackMessage:e.messaging.snackMessage,messageTypes:e.messaging.messageTypes,messageConversations:e.messaging.messageConversations,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,assignedToMeFilter:e.messaging.assignedToMeFilter,markedForFollowUpFilter:e.messaging.markedForFollowUpFilter,unreadFilter:e.messaging.unreadFilter,selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,checkedIds:e.messaging.checkedIds,checkedOptions:e.messaging.checkedIds.length>0,loaded:e.messaging.loaded,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments}),{loadMessageConversations:_,setIsInFeedbackRecipientGroup:e=>F("SET_IN_FEEDBACK_RECIPIENT_GROUP",{isInFeedbackRecipientGroup:e}),clearCheckedIds:D,setSelectedMessageConversation:O,setSelectedMessageType:H,clearSelectedMessageConversation:L,updateInputFields:P,setFilter:j,setDisplayTimeDiff:()=>async e=>{try{const t=await(async()=>{const{systemInfo:e}=await f.query({systemInfo:{resource:"system/info"}});return e.serverDate})(),s=w()().diff(w()(t))-5e3;e(F("SET_DISPLAY_TIME_DIFF_SUCCESS",s))}catch(t){e(F("SET_DISPLAY_TIME_DIFF_ERROR",{error:t}))}},clearAttachments:V,setDhis2CoreVersion:e=>F("SET_DHIS2_CORE_VERSION",e)},null,{pure:!1}))(vs);var ks=()=>i.a.createElement(ee.c,{history:ce},i.a.createElement("div",null,i.a.createElement(ee.b,{exact:!0,path:"/",component:()=>i.a.createElement(ee.a,{to:"/PRIVATE"})}),i.a.createElement(ee.b,{path:"/:messageType/:messageId?/:recipientId?",component:fs}))),Ms=s(792),As=s.n(Ms);var bs=Object(l.b)(e=>({currentUser:e.messaging.currentUser}),{setCurrentUser:()=>async e=>{e(F("SET_CURRENT_USER"));try{const{currentUser:t}=await f.query({currentUser:{resource:"me",params:{fields:["id","authorities"]}}});e(F("SET_CURRENT_USER_SUCCESS",t))}catch{e(F("SET_CURRENT_USER_ERROR","Could not load current user"))}}})(({currentUser:e,setCurrentUser:t})=>{const{loading:s,error:n}=e;return Object(a.useEffect)(()=>{t()},[]),s?i.a.createElement("div",{className:As.a.center},i.a.createElement(o.a,{size:48})):n?i.a.createElement("div",{className:p()(As.a.center,As.a.error)},n):i.a.createElement("div",null,i.a.createElement($,null),i.a.createElement(ks,null))}),xs=s(388),Is=s(793);var Rs=[{id:"PRIVATE",displayName:"Inbox",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"VALIDATION_RESULT",displayName:"Validation",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"TICKET",displayName:"Ticket",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"SYSTEM",displayName:"System",unread:0,loaded:0,loading:!1,total:0,page:1}];const ws={currentUser:{loading:!1,error:null,id:null,authorities:null},messageConversations:{},messageTypes:Rs,selectedMessageType:void 0,selectedMessageConversation:void 0,settingSelectedMessageConversation:!1,checkedIds:[],messageFilter:void 0,statusFilter:void 0,priorityFilter:void 0,assignedToMeFilter:!1,markedForFollowUpFilter:!1,unreadFilter:!1,isInFeedbackRecipientGroup:!1,feedbackRecipientsId:void 0,displayTimeDiff:0,subject:"",input:"",recipients:[],attachments:[],snackMessage:"",onSnackActionClick:void 0,onSnackRequestClose:void 0,snackType:"NEUTRAL"};var Fs=function(e=ws,t){const s=e.messageTypes,a=e.attachments;switch(t.type){case"SET_CURRENT_USER":return{...e,currentUser:{loading:!0,error:null,id:null,authorities:null}};case"SET_CURRENT_USER_SUCCESS":return{...e,currentUser:{loading:!1,error:null,id:t.payload.id,authorities:t.payload.authorities}};case"SET_CURRENT_USER_ERROR":return{...e,currentUser:{loading:!1,error:t.payload,id:null,authorities:null}};case"SET_DISPLAY_TIME_DIFF_SUCCESS":return{...e,displayTimeDiff:t.payload,error:t.payload,id:null,authorities:null};case"MESSAGE_CONVERSATIONS_LOAD_SUCCESS":{const a=s.find(e=>e.id===t.payload.messageType.id);a.loaded=t.payload.messageConversations.length,a.total=t.payload.pager.total,a.unread=t.payload.nrOfUnread,a.page=t.payload.pager.page,a.loading=!1,Rs.splice([E(s,a.id)],1,a);const i=t.payload.selectedMessageType===a.id&&(t.payload.selectedMessageType===e.selectedMessageType||void 0===e.selectedMessageType);return{...e,messageTypes:Rs,messageConversations:{...e.messageConversations,[a.id]:t.payload.messageConversations},selectedMessageType:i?a:e.selectedMessageType}}case"MESSAGE_CONVERSATION_UPDATE_ERROR":return{...e,snackMessage:t.payload.error.message,snackType:"NEGATIVE"};case"MESSAGE_CONVERSATION_UPDATE_SUCCESS":{let s="";switch(t.payload.identifier){case"STATUS":s=oe.a.t("Successfully updated status");break;case"PRIORITY":s=oe.a.t("Successfully updated priority");break;case"ASSIGNEE":s=oe.a.t("Successfully updated assignee");break;case"FOLLOW_UP":s=oe.a.t("Successfully changed followup");break;default:m.a.error("Unexpected identifier for updateMessageConversations success")}return{...e,snackMessage:s,snackType:"POSITIVE"}}case"SEND_MESSAGE_ERROR":case"MESSAGE_CONVERSATIONS_DELETE_ERROR":return{...e,snackMessage:t.payload.error.message,snackType:"NEGATIVE"};case"MESSAGE_CONVERSATIONS_DELETE_SUCCESS":return{...e,snackMessage:oe.a.t("Successfully deleted message conversation(s)"),snackType:"POSITIVE"};case"DISPLAY_SNACK_MESSAGE;":return{...e,snackMessage:t.payload.message,snackType:t.payload.snackType,onSnackActionClick:t.payload.onSnackActionClick,onSnackRequestClose:t.payload.onSnackRequestClose};case"CLEAR_SNACK_MESSAGE":return{...e,snackMessage:"",snackType:"NEUTRAL"};case"SET_CHECKED":{const s=t.payload.messageConversation;let a=e.checkedIds;return t.payload.selectedValue?a.push(s):a=a.filter(e=>e.id!==s.id),{...e,checkedIds:a}}case"SET_ALL_CHECKED":return{...e,checkedIds:t.payload.messageConversationIds};case"CLEAR_CHECKED":return{...e,checkedIds:[]};case"SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS":return{...e,selectedMessageConversation:t.payload.messageConversation,settingSelectedMessageConversation:!1};case"SET_SELECTED_MESSAGE_CONVERSATION":return{...e,settingSelectedMessageConversation:!0};case"CLEAR_SELECTED_MESSAGE_CONVERSATION":return{...e,selectedMessageConversation:void 0};case"SET_SELECTED_MESSAGE_TYPE":return{...e,checkedIds:[],selectedMessageType:s.find(e=>e.id===t.payload.messageTypeId),selectedMessageConversations:e.messageConversations[t.payload.messageTypeId],selectedMessageConversation:void 0};case"UPDATE_INPUT_FIELDS":return{...e,subject:t.payload.subject,input:t.payload.input,recipients:t.payload.recipients};case"ADD_RECIPIENT_BY_ID_SUCCESS":return{...e,recipients:[...e.recipients,t.payload]};case"SET_FILTER":return{...e,messageFilter:"MESSAGE"===t.payload.filterType?t.payload.filter:e.messageFilter,statusFilter:"STATUS"===t.payload.filterType?t.payload.filter:e.statusFilter,priorityFilter:"PRIORITY"===t.payload.filterType?t.payload.filter:e.priorityFilter,assignedToMeFilter:"ASSIGNED_TO_ME"===t.payload.filterType?t.payload.filter:e.assignedToMeFilter,markedForFollowUpFilter:"MARKED_FOR_FOLLOWUP"===t.payload.filterType?t.payload.filter:e.markedForFollowUpFilter,unreadFilter:"UNREAD"===t.payload.filterType?t.payload.filter:e.unreadFilter};case"LOAD_MESSAGE_CONVERSATIONS":{const s=t.payload.messageType;s.loading=!0,t.payload.loadMore&&s.page++,Rs[E(Rs,s.id)]=s;const a=e.selectedMessageType;return a&&(a.loading=!0,t.payload.loadMore&&a.page++),{...e,messageTypes:Rs,selectedMessageType:a}}case"SET_IN_FEEDBACK_RECIPIENT_GROUP":return{...e,isInFeedbackRecipientGroup:t.payload.isInFeedbackRecipientGroup.authorized,feedbackRecipientsId:t.payload.isInFeedbackRecipientGroup.feedbackRecipientsId};case"ADD_ATTACHMENT_SUCCESS":return{...e,attachments:e.attachments.map(e=>e.name===t.payload.name?{id:t.payload.id,name:e.name,contentLength:e.contentLength,loading:!1}:e)};case"ADD_ATTACHMENT_ERROR":return{...e,attachments:a.filter(e=>e.id!==t.payload.attachmentId),snackMessage:t.payload.error.message,snackType:"NEGATIVE"};case"ADD_ATTACHMENT":return{...e,attachments:e.attachments.concat({name:t.payload.name,contentLength:t.payload.size,loading:!0})};case"REMOVE_ATTACHMENT":return{...e,attachments:a.filter(e=>e.id!==t.payload.attachmentId)};case"CANCEL_ATTACHMENT":return{...e,attachments:a.filter(e=>e.name!==t.payload.attachmentName)};case"CLEAR_ATTACHMENTS":return{...e,attachments:[]};case"SET_DHIS2_CORE_VERSION":return{...e,dhis2CoreVersion:t.payload};default:return e}};const Os=[Is.a],_s=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||xs.d,Ns=Object(xs.c)({messaging:Fs});var Us=Object(xs.e)(Ns,_s(Object(xs.a)(...Os))),Ds=s(293),Ls=s.n(Ds);class Gs extends i.a.Component{constructor(...e){super(...e),this.getChildContext=()=>({d2:this.props.d2}),this.render=()=>i.a.createElement(Ls.a,{muiTheme:J},this.props.children)}}Gs.childContextTypes={d2:te.default.object};var js=Gs;s(794),s(17);t.default=()=>{const{baseUrl:e}=Object(n.b)(),t=Object(n.c)(),{d2:s}=Object(r.a)({d2Config:{schemas:["messageConversation"],baseUrl:"".concat(e,"/api")}});return s?(f=t,i.a.createElement(l.a,{store:Us},i.a.createElement(js,{d2:s},i.a.createElement(bs,null)))):i.a.createElement(js,null,i.a.createElement("div",{className:"page-loader-wrap"},i.a.createElement(o.a,{size:48})))}}}]);
//# sourceMappingURL=app.8ba5c17c.chunk.js.map