(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[127],{753:function(e,t,s){},773:function(e,t,s){},784:function(e,t,s){},792:function(e,t,s){e.exports={center:"App_center__1snml",error:"App_error__1usCm"}},794:function(e,t,s){},800:function(e,t,s){"use strict";s.r(t);var a=s(1),i=s.n(a),r=s(7),n=s(795),o=s(328),l=s(183),c=s(4),p=s.n(c),d=s(301),h=s.n(d);var g=s(390),m=s.n(g);s(391);const u="Roboto, Helvetica, Arial, sans-serif";function y(e,t){const s=e.length;for(let a=0;a<s;a++)if(e[a].id===t)return a}function E(e,t){let s=null;return function(){const a=this,i=arguments;clearTimeout(s),s=setTimeout((function(){e.apply(a,i)}),t)}}function C(e){return e>30}function S(e){return{resource:"organisationUnits",params:{fields:["id","displayName"],pageSize:10,filter:["displayName:token:".concat(e),"users:gte:1"]}}}function T(e){return{resource:"userGroups",params:{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e)]}}}const v=["id","displayName","subject","messageType","lastSender[id, displayName]","assignee[id, displayName]","status","priority","lastUpdated","read","lastMessage","followUp"],f=["*","assignee[id, displayName]","messages[*,sender[id,displayName]","attachments[id, name, contentLength]]","userMessages[user[id, displayName]]"];let k=null;const M=async({messageType:e,page:t,messageFilter:s,status:a,priority:i,assignedToMeFilter:r,markedForFollowUpFilter:n,unreadFilter:o,currentUser:l})=>{const c=["messageType:eq:".concat(e)];a&&c.push("status:eq:".concat(a)),i&&c.push("priority:eq:".concat(i)),n&&c.push("followUp:eq:true"),o&&c.push("read:eq:false"),r&&c.push("assignee.id:eq:".concat(l.id));const p={resource:"messageConversations",params:{filter:c,pageSize:35,page:t,fields:v,order:"lastMessage:desc"}};s&&(p.params.queryString=s);const{messageConversations:d}=await k.query({messageConversations:p});return d},x=async(e,t)=>{const s=t?{resource:"messageConversations/".concat(e,"/assign"),type:"create",params:{userId:t}}:{resource:"messageConversations",id:"".concat(e,"/assign"),type:"delete"};return await k.mutate(s)},b=async({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i})=>{const r=function({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i}){const r=function({searchValue:e,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:s,dhis2CoreVersion:a}){if(function(e){return e>34}(a))return{resource:t?"userLookup/feedbackRecipients":"userLookup",params:{query:e}};{const a=["displayName:token:".concat(e)];return t&&a.push("userGroups.id:eq:".concat(s)),{resouce:"users",params:{filter:a,pageSize:10}}}}({searchValue:e,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i});return t?{users:r}:{users:r,organisationUnits:S(e),userGroups:T(e)}}({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i}),n=await k.query(r);return{users:n.users.users,organisationUnits:n.organisationUnits&&n.organisationUnits.organisationUnits,userGroups:n.userGroups&&n.userGroups.userGroups}},A=async({users:e,userGroups:t,organisationUnits:s,messageConversationId:a})=>await k.mutate({resource:"messageConversations/".concat(a,"/recipients"),type:"create",data:{users:e,userGroups:t,organisationUnits:s}});var R=s(10),I=s.n(R);const w=(e,t)=>({type:e,payload:t}),F=e=>async t=>{t(w("SET_SELECTED_MESSAGE_CONVERSATION"));try{const s=await(async({id:e})=>{const{messageConversation:t}=await k.query({messageConversation:{resource:"messageConversations",id:e,params:{fields:f}}});return t})(e);t(w("SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS",{messageConversation:s}))}catch(s){t(w("SET_SELECTED_MESSAGE_CONVERSATION_ERROR",{error:s}))}},_=(e,t,s=!1)=>async(a,i)=>{const r=[],n=i(),{messageFilter:o,statusFilter:l,priorityFilter:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}=n.messaging;e=e||n.messaging.selectedMessageType,t=t||n.messaging.selectedMessageType.id,a(w("LOAD_MESSAGE_CONVERSATIONS",{messageType:e,loadMore:s}));try{for(let t=1;t<=e.page;t++){const s=M({messageType:e.id,page:t,messageFilter:o,status:l,priority:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}).then(e=>({messageConversations:e.messageConversations,pager:e.pager}));r.push(s)}const s=await Promise.all(r),i=await(async e=>{const{messageConversations:t}=await k.query({messageConversations:{resource:"messageConversations",params:{fields:["read"],filter:["read:eq:false","messageType:eq:".concat(e)],pageSize:1}}});return t.pager.total})(e.id),n=s.reduce((e,t)=>e.concat(t.messageConversations),[]);a(w("MESSAGE_CONVERSATIONS_LOAD_SUCCESS",{messageConversations:n,pager:s[s.length-1].pager,messageType:e,selectedMessageType:t,nrOfUnread:i}))}catch(m){a(w("MESSAGE_CONVERSATIONS_LOAD_ERROR",{error:m}))}},O=(e,t,s)=>async a=>{try{await("read"===e?(async e=>await k.mutate({resource:"messageConversations/read",type:"create",data:e}))(t):(async e=>await k.mutate({resource:"messageConversations/unread",type:"create",data:e}))(t)),a(w("MARK_MESSAGE_CONVERSATIONS_SUCCESS",{messageType:s,page:1})),a(_())}catch(i){a(w("MARK_MESSAGE_CONVERSATIONS_ERROR",{error:i}))}},N=e=>async t=>{t(w("ADD_ATTACHMENT",e));try{const s=await(async e=>await k.mutate({resource:"fileResources",type:"create",params:{domain:"MESSAGE_ATTACHMENT"},data:{file:e}}))(e);t(w("ADD_ATTACHMENT_SUCCESS",{id:s.response.fileResource.id,name:e.name,contentLength:s.response.fileResource.contentLength}))}catch(s){t(w("ADD_ATTACHMENT_ERROR",{error:s}))}},U=()=>w("CLEAR_CHECKED"),D=()=>w("CLEAR_SELECTED_MESSAGE_CONVERSATION"),L=({message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a})=>w("DISPLAY_SNACK_MESSAGE;",{message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a}),G=(e,t)=>w("SET_FILTER",{filter:e,filterType:t}),V=(e,t,s)=>w("UPDATE_INPUT_FIELDS",{subject:e,input:t,recipients:s}),P=()=>w("CLEAR_ATTACHMENTS"),j=e=>w("SET_SELECTED_MESSAGE_TYPE",{messageTypeId:e}),H=e=>w("REMOVE_ATTACHMENT",{attachmentId:e}),W=e=>w("CANCEL_ATTACHMENT",{attachmentName:e});var q=s(198),B=s(369),Y=s.n(B),z=s(196),K=s(227),X=Y()({palette:{negative:K.pinkA200,blue50:K.blue50,primary1Color:"#1D8BF1",primary2Color:K.blue100,primary3Color:K.blue300,primary4Color:K.blue500,accent1Color:K.grey50,accent2Color:K.grey100,accent3Color:K.grey300,accent4Color:K.grey500,followUp:K.orange500,darkGray:K.grey700,superDarkGray:K.grey900,textColor:K.darkBlack,alternateTextColor:K.white,canvasColor:K.white,borderColor:K.grey300,clockCircleColor:Object(z.fade)(K.darkBlack,.07),shadowColor:K.fullBlack}});const J={NEGATIVE:X.palette.negative,NEUTRAL:X.palette.primary1Color,POSITIVE:X.palette.alternateTextColor};class Q extends a.Component{constructor(e){super(e),this.closeMessage=()=>{this.props.clearSnackMessage(),this.setState({show:!1}),this.props.onSnackRequestClose&&this.props.onSnackRequestClose()},this.state={show:!1}}componentDidUpdate(e,t){!t.show&&this.props.message&&this.setState({show:!0})}render(){return i.a.createElement(h.a,{open:""!==this.props.message&&this.state.show,message:this.props.message||"Missing snackbar message",autoHideDuration:4e3,onRequestClose:this.closeMessage,action:this.props.onSnackActionClick&&"undo",onActionClick:()=>{this.props.onSnackActionClick(),this.setState({show:!1})},contentStyle:{color:J[this.props.type]},style:{pointerEvents:"none",whiteSpace:"nowrap"},bodyStyle:{pointerEvents:"initial",maxWidth:"none"}})}}var Z=Object(q.a)(Object(l.c)(e=>({message:e.messaging.snackMessage,type:e.messaging.snackType,onSnackActionClick:e.messaging.onSnackActionClick,onSnackRequestClose:e.messaging.onSnackRequestClose}),{clearSnackMessage:()=>w("CLEAR_SNACK_MESSAGE")}),q.b)(Q),$=s(796),ee=s(0),te=s(195),se=s.n(te),ae=s(785),ie=s.n(ae),re=s(5),ne=s.n(re),oe=s(797),le=Object(oe.a)(),ce=s(421),pe=s.n(ce),de=s(420),he=s.n(de),ge=s(187),me=s.n(ge),ue=s(191),ye=s.n(ue),Ee=s(245),Ce=s.n(Ee),Se=s(179),Te=s.n(Se),ve=s(215),fe=s.n(ve),ke=s(244),Me=s.n(ke),xe=s(290),be=s.n(xe),Ae=s(759),Re=s.n(Ae),Ie=s(754),we=s.n(Ie);s(753);const Fe=({dataDirection:e,attachment:t,removeAttachment:s,downloadAttachment:a,cancelAttachment:r})=>i.a.createElement(me.a,{className:"attachment__button",backgroundColor:X.palette.accent2Color,label:"".concat(t.name," (").concat(parseFloat(parseInt(t.contentLength,10)/1e6).toFixed(2)," MB)"),labelPosition:"after",onClick:()=>{"download"===e?a(t):t.loading?r(t.name):s(t)},icon:"download"===e?i.a.createElement(we.a,null):i.a.createElement(Re.a,null)},t.loading&&i.a.createElement(be.a,{className:"attachment__progress",mode:"indeterminate"}));var _e=({dataDirection:e,attachments:t,style:s,removeAttachment:a,downloadAttachment:r,cancelAttachment:n})=>i.a.createElement("div",{className:"attachment",style:{...s}},t.map((t,s)=>i.a.createElement(Fe,{key:"".concat(t.name,"-").concat(s),dataDirection:e,attachment:t,removeAttachment:a,downloadAttachment:r,cancelAttachment:n}))),Oe=s(760),Ne=s.n(Oe);const Ue={canvas:e=>({backgroundColor:e,padding:"16px 16px 16px 16px"}),innerCanvas:{margin:"",paddingBottom:"0px"},cardText:{padding:"16px 0px 16px 0px",fontFamily:u,whiteSpace:"pre-wrap",wordBreak:"break-word"},fromFormat:{fontFamily:u},datePlacement:{display:"flex",justifyContent:"flex-end",marginRight:"10px"},dateFormat:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:u}};var De=({displayTimeDiff:e,message:t,currentUser:s,lastMessage:a,downloadAttachment:r,cancelAttachment:n,enableAttachments:o})=>{const l=t.sender?s&&s.id===t.sender.id?"me":t.sender.displayName:"system",c=I()(),p=I()(t.created).add(e);return i.a.createElement("div",{style:Ue.canvas(X.palette.canvasColor)},i.a.createElement("div",{style:Ue.innerCanvas},i.a.createElement("div",{style:Ue.fromFormat},t.internal?ne.a.t("Internal message from ".concat(l)):ne.a.t("Message from ".concat(l))),i.a.createElement("div",{placement:"bottom",style:Ue.datePlacement},i.a.createElement("div",{style:Ue.dateFormat},c.diff(p,"hours")<72?"".concat(p.from(c),", ").concat(p.format("HH:mm")):c.year()===p.year()?p.format("MMM DD, HH:mm"):p.format("MMM DD, YYYY HH:mm"))),o&&i.a.createElement(_e,{dataDirection:"download",style:{paddingLeft:0},attachments:t.attachments,downloadAttachment:r,cancelAttachment:n}),i.a.createElement(Me.a,{style:Ue.cardText},i.a.createElement(Ne.a,null,t.text))),!a&&i.a.createElement(fe.a,null))},Le=s(243),Ge=s(248),Ve=s.n(Ge),Pe=s(193),je=s.n(Pe),He=s(774),We=s.n(He);s(773);const qe=e=>t=>{const s=t.target.files;s.length>0&&e(s[0])};var Be=({addAttachment:e})=>i.a.createElement(me.a,{className:"attachment__upload-button",label:ne.a.t("Upload attachment"),labelPosition:"after",containerElement:"label",icon:i.a.createElement(We.a,null)},i.a.createElement("input",{className:"attachment__upload-button--input",type:"file",onChange:qe(e)}));class Ye extends a.Component{constructor(e){super(e),this.replyMessage=e=>{const{input:t,selectedMessageConversation:s,selectedMessageType:a}=this.props;this.props.replyMessage({message:t,internalReply:e,messageConversation:s,messageType:a}),this.wipeInput()},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),this.setState({inputError:!1})},this.texFieldUpdate=(e,t)=>{this.props.updateInputFields("",t,[])},this.handleDiscard=()=>{const e=ne.a.t("Reply discarded");this.setState({discardState:!0}),this.props.displaySnackMessage({message:e,onSnackActionClick:()=>this.setState({discardState:!1}),onSnackRequestClose:()=>{this.setState({discardState:!1}),this.wipeInput()},snackType:"NEGATIVE"}),this.setState({expanded:!1})},this.state={discardState:!1}}componentWillUnmount(){this.wipeInput()}render(){return i.a.createElement(Le.Card,{style:{marginTop:"5px"},expanded:!0},i.a.createElement(Le.CardText,{style:{padding:"0px 0px 0px 16px"}},i.a.createElement(je.a,{key:this.props.messageConversation.id,id:this.props.messageConversation.id,rows:5,underlineShow:!1,value:this.state.discardState?"":this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:ne.a.t("Message"),onChange:this.texFieldUpdate}),this.props.enableAttachments&&!this.state.discardState&&i.a.createElement(_e,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(Le.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(Ve.a,{primary:!0,label:ne.a.t("Reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!1)}),this.props.isInFeedbackRecipientGroup&&"TICKET"===this.props.selectedMessageType.id&&i.a.createElement(me.a,{primary:!0,label:ne.a.t("Internal reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!0)}),i.a.createElement(me.a,{label:ne.a.t("Discard"),disabled:""===this.props.input||this.state.discardState,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(Be,{addAttachment:e=>{this.props.addAttachment(e)}}),")")))}}var ze=Object(q.a)(Object(l.c)(e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes,input:e.messaging.input,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments,enableAttachments:C(e.messaging.dhis2CoreVersion)}),{replyMessage:({message:e,internalReply:t,messageConversation:s,messageType:a})=>async(i,r)=>{try{const{id:n}=s,o=r().messaging.attachments.map(e=>e.id);await(async({message:e,internalReply:t,attachments:s,id:a})=>{const i={internal:t};return s.length>0&&(i.attachments=s),await k.mutate({resource:"messageConversations/".concat(a),type:"create",params:i,data:e})})({message:e,internalReply:t,attachments:o,id:n}),i(w("REPLY_MESSAGE_SUCCESS",{messageConversation:s,messageType:a,page:1})),i(_()),i(F(s))}catch(n){i(w("REPLY_MESSAGE_ERROR",{error:n}))}},setSelectedMessageType:j,updateInputFields:V,displaySnackMessage:L,addAttachment:N,removeAttachment:H,cancelAttachment:W},null,{pure:!1}))(Ye),Ke=s(775),Xe=s.n(Ke);class Je extends a.Component{constructor(...e){super(...e),this.state={input:"",searchResult:[],searchOnlyUsers:this.props.searchOnlyUsers,searchOnlyFeedbackRecipients:this.props.searchOnlyFeedbackRecipients,lastSearch:"",errorText:void 0},this.debouncedSearch=E(this.search.bind(this),300),this.onSuggestionClick=e=>{if(void 0!==this.props.onSuggestionClick)this.props.onSuggestionClick(e);else{this.wipeInput(),this.debouncedSearch("");!this.props.recipients.find(t=>t.id===e.id)&&this.props.updateRecipients([...this.props.recipients,this.state.searchResult.find(t=>t.id===e.id)])}},this.onRemoveChip=e=>{this.props.updateRecipients(this.props.recipients.filter(t=>t.id!==e))},this.wipeInput=()=>{this.setState({input:"",searchResult:[]})},this.updateInput=e=>{this.debouncedSearch(e),this.setState({input:e})}}search(e){if(!this.state.searchResult.find(t=>t.displayName===e)&&""!==e&&e.length>=2){const{feedbackRecipientsId:t,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a,dhis2CoreVersion:i}=this.props;b({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a,feedbackRecipientsId:t,dhis2CoreVersion:i}).then(({users:e,userGroups:t,organisationUnits:s})=>{const a=e=>t=>({...t,type:e});let i=e.map(a("user"));this.state.searchOnlyUsers||(i=i.concat(t.map(a("userGroup"))).concat(s.map(a("organisationUnit")))),this.setState({searchResult:i,errorText:0===i.length?ne.a.t("No results found"):void 0})})}else this.setState({lastSearch:e,searchResult:""!==this.state.lastSearch&&""===e||e.length<2?[]:this.state.searchResult,errorText:""!==e&&e.length<2?ne.a.t("Please enter at least ".concat(2," characters")):this.state.searchWarning})}render(){return i.a.createElement("div",{style:{...this.props.style,height:this.props.inputHeight}},i.a.createElement(Xe.a,{style:{marginBottom:16},disabled:void 0!==this.props.disabled&&this.props.disabled,errorText:this.props.errorText||this.state.errorText,value:this.props.recipients,fullWidth:!0,openOnFocus:!0,searchText:this.state.input,floatingLabelText:this.props.label,dataSource:this.state.searchResult,dataSourceConfig:{text:"displayName",value:"id"},onUpdateInput:this.updateInput,onRequestAdd:e=>this.onSuggestionClick(e),onRequestDelete:e=>this.onRemoveChip(e)}))}}var Qe=Object(l.c)(e=>({dhis2CoreVersion:e.messaging.dhis2CoreVersion}))(Je);const Ze={subheaderTitle:{height:"32px",color:"black",paddingLeft:0,paddingRight:16},subheader:(e,t)=>({height:"32px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:0,color:e,fontWeight:t})};var $e=({showTitle:e,title:t,label:s,color:a,fontWeight:r})=>{const n=s&&"NONE"!==s?"Assignee"===t?s:"".concat(s.charAt(0)).concat(s.toLowerCase().substr(1,s.length)):"-";return i.a.createElement("div",{style:{flex:2,paddingLeft:10,maxWidth:200}},e&&i.a.createElement(se.a,{style:Ze.subheaderTitle}," ",t," "),i.a.createElement(se.a,{style:Ze.subheader(a,r)},n))};const et={canvas:{flex:"3 0",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)",paddingTop:"10px"},innerCanvas:{display:"flex",flexDirection:"column",margin:"0px 10px 0px 10px"},header:{display:"flex"},iconButton:{display:"flex",alignSelf:"center"},subjectSubheader:{display:"flex",alignSelf:"center",fontSize:"20px",fontFamily:u},participantsCanvas:{display:"flex",flexDirection:"column"},participants:{paddingLeft:"12px",paddingTop:"10px",display:"flex",flexWrap:"wrap"},chip:{height:"32px",marginRight:"3px",marginBottom:"3px"},participantAddRow:{display:"flex"},participantsSuggestionField:{paddingLeft:"12px",marginBottom:"0px",flex:1},participantsAdd:{alignSelf:"flex-end",marginBottom:"28px",paddingLeft:"12px"},messagesCanvas:{marginBottom:"50px",display:"flex",flexDirection:"column",backgroundColor:X.palette.accent2Color,margin:"0px 10px 10px 10px"},messagesInnerCanvas:{padding:"0px"}};const tt=["TICKET","VALIDATION_RESULT"];class st extends a.Component{constructor(e){super(e),this.backToList=()=>{const{clearSelectedMessageConversation:e,messageConversation:t}=this.props;le.push("/".concat(t.messageType)),e()},this.addRecipients=()=>{const e=this.state.recipients.filter(e=>"user"===e.type),t=this.state.recipients.filter(e=>"userGroup"===e.type),s=this.state.recipients.filter(e=>"organisationUnit"===e.type),{messageConversation:a,selectedMessageType:i}=this.props;this.props.addRecipients({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i}),this.setState({recipients:[]})},this.updateRecipients=e=>{this.setState({recipients:e})},this.state={recipients:[],cursor:"auto"}}render(){const{messageConversation:e,currentUser:t}=this.props,s=e.messages,a=!!(tt.indexOf(e.messageType)+1),r=e.userMessages.slice(0,30).map(e=>!t.id||this.state.recipientsExpanded||t.id!==e.user.id?e.user.displayName:ne.a.t("me")),n=e.userMessages.length;return n>30&&r.push(" + ".concat(n-30)),i.a.createElement("div",{id:"messageconversation",style:et.canvas},i.a.createElement("div",{style:et.innerCanvas},i.a.createElement("div",{style:et.header},i.a.createElement(ye.a,{style:et.iconButton,tooltipPosition:"bottom-right",onClick:this.backToList,tooltip:ne.a.t("Show all messages")},i.a.createElement(he.a,null)),i.a.createElement(se.a,{style:et.subjectSubheader},e.subject),this.props.displayExtendedChoices&&i.a.createElement($e,{color:X.palette.darkGray,showTitle:!0,title:ne.a.t("Status"),label:e.status}),this.props.displayExtendedChoices&&i.a.createElement($e,{color:X.palette.darkGray,showTitle:!0,title:ne.a.t("Priority"),label:e.priority}),a&&i.a.createElement($e,{color:X.palette.darkGray,showTitle:!0,title:ne.a.t("Assignee"),label:e.assignee?e.assignee.displayName:void 0})),i.a.createElement("div",{style:et.participantsCanvas},i.a.createElement(se.a,{style:{paddingLeft:"12px",paddingTop:"10px"}},ne.a.t("Participants")),i.a.createElement("div",{style:et.participants},r.map(e=>i.a.createElement(Ce.a,{key:e,style:et.chip},e)))),i.a.createElement("div",{style:et.participantAddRow},i.a.createElement(Qe,{style:et.participantsSuggestionField,label:ne.a.t("Add participants to conversation"),messageConversation:e,recipients:this.state.recipients,updateRecipients:this.updateRecipients,limitSearchArray:e.userMessages}),i.a.createElement("div",{style:et.participantsAdd},i.a.createElement(me.a,{icon:i.a.createElement(pe.a,null),onClick:()=>this.addRecipients(),label:ne.a.t("Add")})))),i.a.createElement("div",{style:et.messagesCanvas},i.a.createElement(Te.a,{style:et.messagesInnerCanvas},s.map((t,r)=>i.a.createElement(De,{key:t.id,displayTimeDiff:this.props.displayTimeDiff,message:t,messageConversation:e,notification:a,currentUser:this.state.currentUser,lastMessage:r+1===s.length,downloadAttachment:s=>this.props.downloadAttachment(e.id,t.id,s.id),cancelAttachment:this.props.cancelAttachment,enableAttachments:this.props.enableAttachments}))),i.a.createElement(ze,Object.assign({},this.props,{messageConversation:e}))))}}var at=Object(l.c)(e=>({currentUser:e.messaging.currentUser,selectedMessageType:e.messaging.selectedMessageType,displayTimeDiff:e.messaging.displayTimeDiff,enableAttachments:C(e.messaging.dhis2CoreVersion)}),{addRecipients:({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i})=>async r=>{try{const{id:n}=a;await A({users:e,userGroups:t,organisationUnits:s,messageConversationId:n}),r(w("ADD_RECIPIENTS_SUCCESS",{messageConversation:a,messageType:i,page:1})),r(F(a))}catch(n){r(w("ADD_RECIPIENTS_ERROR",{error:n}))}},downloadAttachment:(e,t,s)=>a=>{((e,t,s)=>{const a=[k.link.baseUrl,k.link.apiPath,"messageConversations",e,t,"attachments",s].join("/"),i=document.createElement("a");i.href=a,i.download=a.split("/").pop(),i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)})(e,t,s),a(w("DOWNLOAD_ATTACHMENT_SUCCESS"))},cancelAttachment:W,clearSelectedMessageConversation:D})(st),it=s(291),rt=s(307),nt=s.n(rt),ot=s(246),lt=s.n(ot),ct=s(279),pt=s.n(ct);class dt extends a.Component{constructor(e){super(e),this.onClick=()=>{this.props.onClick()},this.onMouseEnter=()=>{this.setHoverText(),this.setState({cursor:"pointer"})},this.onMouseLeave=()=>{this.setNeutralText(),this.setState({cursor:"auto"})},this.setNeutralText=()=>this.setTextColor(X.palette.accent2Color),this.setHoverText=()=>this.setTextColor(X.palette.accent3Color),this.setTextColor=e=>{this.setState({backgroundColor:e})},this.getBackgroundColor=(e,t)=>e&&t===e.id?X.palette.accent3Color:this.state.backgroundColor,this.state={backgroundColor:X.palette.accent2Color,textColor:X.palette.darkGray}}render(){return i.a.createElement("div",{role:"presentation",style:{...this.state,backgroundColor:this.getBackgroundColor(this.props.selectedMessageType,this.props.messageType.id),cursor:this.state.cursor,alignItems:"center",height:"49px",display:"flex",flexDirection:"row",justifyContent:"space-between"},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:()=>this.onClick()},i.a.createElement(se.a,{style:{marginLeft:"5px",fontSize:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?"18px":"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?X.palette.primary1Color:this.state.textColor}},ne.a.t(this.props.messageType.displayName)),this.props.loading?i.a.createElement(lt.a,{style:{marginRight:"10px"},color:X.palette.primary1Color,size:24}):this.props.messageType.unread>0&&i.a.createElement(pt.a,{style:{marginTop:"12px",marginRight:"5px"},badgeContent:this.props.messageType.unread>100?"99+":this.props.messageType.unread,secondary:!0,badgeStyle:{backgroundColor:"#439E8E"}}))}}var ht=dt;const gt={canvas:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"calc(100vh - 95px)",borderLeftStyle:"solid",borderLeftWidth:"0.5px",borderLeftColor:X.palette.accent4Color,borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:X.palette.accent4Color,overflowY:"auto",overflowX:"hidden",minWidth:"200px"}};class mt extends a.Component{constructor(e){super(e),this.props.setSelectedMessageType(this.props.match.params.messageType)}render(){const e=this.props.messageTypes;return i.a.createElement("div",{style:gt.canvas},i.a.createElement(it.List,{style:{padding:"0px"}},e&&e.map(e=>i.a.createElement("div",{key:e.id},i.a.createElement(ht,{messageType:e,onClick:()=>{this.props.setSelectedMessageType(e.id),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),le.push("/".concat(e.id))},selectedMessageType:this.props.selectedMessageType,loading:e.loading}),i.a.createElement(fe.a,null)))),i.a.createElement(nt.a,{style:{width:"",margin:"20px"},label:"".concat(ne.a.t("Auto refresh")," (").concat(I()(this.props.refreshTimer).format("mm:ss"),")"),toggled:this.props.autoRefresh,onToggle:()=>this.props.setAutoRefresh(!this.props.autoRefresh)}))}}var ut=Object(q.a)(Object(l.c)(e=>({selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes}),{setSelectedMessageType:j,clearCheckedIds:U},null,{pure:!1}))(mt);const yt={overflowY:"scroll",overflowX:"hidden",borderRightWidth:"1px",borderRightColor:X.palette.accent4Color,height:"calc(100vh - 95px)"},Et={paddingLeft:"0px",fontSize:"20px"};var Ct=s(216),St=s.n(Ct);const Tt={canvas:e=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",alignSelf:"center",boxShadow:"none",borderBottom:"1px solid #dfdfdf"}),checkBox:{flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:"12px"},sender:{fontFamily:u,fontSize:"16px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"black",paddingLeft:10,alignSelf:"center"},subject:{flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:u,fontSize:"16px",color:"black",paddingLeft:10},extendedLabel:{flex:2,color:"black",fontSize:"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 0 0 10px"}};class vt extends a.Component{constructor(e){super(e),this.state={cursor:"auto",allChecked:!1}}componentDidUpdate(){this.state.allChecked&&this.props.checkedIds.length<this.props.messages.length&&this.setState({allChecked:!1})}render(){const e=this.props.displayExtendedChoices;return i.a.createElement(Te.a,{style:Tt.canvas(X.palette.canvasColor)},i.a.createElement(St.a,{checked:this.state.allChecked,style:Tt.checkBox,onCheck:()=>{this.state.allChecked?this.props.clearCheckedIds():this.props.setAllChecked(this.props.messages.map(e=>({id:e.id}))),this.setState({allChecked:!this.state.allChecked})}}),i.a.createElement("div",{style:Tt.sender},ne.a.t("Sender")),i.a.createElement(se.a,{style:Tt.subject},ne.a.t("Subject")),e&&i.a.createElement(se.a,{style:Tt.extendedLabel},ne.a.t("Status")),e&&i.a.createElement(se.a,{style:Tt.extendedLabel},ne.a.t("Priority")),this.props.notification&&i.a.createElement(se.a,{style:Tt.extendedLabel},ne.a.t("Assignee")),i.a.createElement(se.a,{style:Tt.extendedLabel},ne.a.t("Date")))}}var ft=Object(q.a)(Object(l.c)(e=>({checkedIds:e.messaging.checkedIds,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup}),{setAllChecked:e=>w("SET_ALL_CHECKED",{messageConversationIds:e}),clearCheckedIds:U}))(vt),kt=s(776),Mt=s.n(kt);const xt={container:(e,t,s)=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",cursor:s,boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",boxShadow:"none",borderBottom:"1px solid #dfdfdf",flexWrap:t?"nowrap":"wrap"}),checkBox:e=>({flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:e?12:6}),flag:{color:X.palette.followUp,marginRight:4},sender:(e,t)=>({fontFamily:u,fontSize:"14px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",color:"black",paddingLeft:e?10:0,fontWeight:t}),subject:(e,t,s)=>({flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingLeft:10,fontFamily:u,color:t,fontWeight:s,order:e?"inherit":10,marginTop:e?0:-10,flexBasis:e?"0%":"100%"}),dateFormat:(e,t,s)=>({flex:2,fontFamily:u,paddingLeft:e?10:0,paddingRight:e?0:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:e?"":"end",color:t,fontWeight:s})};class bt extends a.Component{constructor(e){super(e),this.onClick=e=>{this.props.setSelectedMessageConversation(e),e&&!e.read&&this.props.markMessageConversations("read",[e.id],this.props.selectedMessageType),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),le.push("/".concat(e.messageType,"/").concat(e.id))},this.onMouseEnter=()=>this.setState({cursor:"pointer",backgroundColor:X.palette.accent2Color}),this.onMouseLeave=()=>this.setState({cursor:"auto",backgroundColor:X.palette.canvasColor}),this.getBackgroundColor=(e,t)=>{const s=this.props.selectedMessageConversation&&e.id===this.props.selectedMessageConversation.id;return t&&!s?X.palette.blue50:s?X.palette.accent3Color:this.state.backgroundColor},this.state={backgroundColor:X.palette.canvasColor,cursor:"auto"}}render(){const e=this.props.messageConversation,t=e.lastSender?e.lastSender.displayName:this.props.selectedMessageType.displayName,s=!!this.props.checkedIds.find(t=>t.id===e.id),a=this.props.displayExtendedChoices,r=this.props.displayTimeDiff,n=I()(),o=I()(e.lastMessage).add(r),l=e.read?"":"bold",c=this.props.messageConversation.read?"black":X.palette.darkGray,p=this.getBackgroundColor(e,s);return i.a.createElement(Te.a,{style:xt.container(p,this.props.wideview,this.state.cursor),onClick:t=>{void 0!==t.target.innerText&&""!==t.target.innerText&&!this.props.settingSelectedMessageConversation&&(this.onClick(e),this.props.checkedIds.length>0&&this.props.clearCheckedIds(),!this.props.wideview||void 0===this.props.messageFilter&&void 0===this.props.priorityFilter&&void 0===this.props.statusFilter||this.props.setFilter(void 0,"MESSAGE"))},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},i.a.createElement(St.a,{checked:s,style:xt.checkBox(this.props.wideview),onCheck:()=>{this.props.setChecked(e,!s)}}),i.a.createElement("div",{style:xt.sender(this.props.wideview,l)},e.followUp&&i.a.createElement(Mt.a,{style:xt.flag}),i.a.createElement("span",null,t)),i.a.createElement(se.a,{style:xt.subject(this.props.wideview,c,l)},e.subject),a&&i.a.createElement($e,{showTitle:!1,title:ne.a.t("Status"),color:c,fontWeight:l,label:e.status}),a&&i.a.createElement($e,{showTitle:!1,title:ne.a.t("Priority"),color:c,fontWeight:l,label:e.priority}),this.props.notification&&this.props.wideview&&i.a.createElement($e,{showTitle:!1,title:ne.a.t("Assignee"),color:c,fontWeight:l,label:e.assignee?e.assignee.displayName:void 0}),i.a.createElement(se.a,{style:xt.dateFormat(this.props.wideview,c,l)},n.diff(o,"hours")<72?o.from(n):n.year()===o.year()?o.format("MMM DD"):o.format("ll")))}}var At=Object(q.a)(Object(l.c)(e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,checkedIds:e.messaging.checkedIds,displayTimeDiff:e.messaging.displayTimeDiff,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,attachments:e.messaging.attachments}),{setChecked:(e,t)=>w("SET_CHECKED",{messageConversation:e,selectedValue:t}),setSelectedMessageConversation:F,markMessageConversations:O,clearCheckedIds:U,setFilter:G,updateInputFields:V,clearAttachments:P},null,{pure:!1}))(bt);const Rt=["VALIDATION_RESULT","TICKET"],It={canvas:e=>({flex:"1 0",maxWidth:e?"none":"350px",minWidth:e?"none":"250px",borderRightStyle:e?"":"solid",...yt}),loading:{backgroundColor:X.palette.accent2Color,height:"".concat(50,"px"),transition:"all 0.2s ease-in-out",display:"flex",justifyContent:"center"}};class wt extends a.Component{constructor(...e){super(...e),this.onScroll=e=>{const t=document.getElementById("messagelist");!this.props.selectedMessageType.loading&&this.isBottom(t)&&e.loaded<e.total&&this.props.loadMessageConversations(e,e.id,!0)},this.debouncedOnScroll=E(this.onScroll,150),this.isBottom=e=>e.scrollHeight-e.scrollTop<window.outerHeight}render(){const e=function(e){if(!Array.isArray(e))return;const t=new Set;return e.filter(e=>!t.has(e.id)&&(t.add(e.id),!0))}(this.props.messageConversations[this.props.selectedMessageType.id]),t=this.props.selectedMessageType?this.props.selectedMessageType:"",s=this.props.selectedMessageConversation?this.props.selectedMessageConversation.id:"",a=!!(Rt.indexOf(t.id)+1);return i.a.createElement("div",{id:"messagelist",onScroll:()=>this.debouncedOnScroll(this.props.selectedMessageType),style:It.canvas(this.props.wideview)},this.props.wideview&&i.a.createElement(ft,{notification:a,displayExtendedChoices:this.props.displayExtendedChoices,messages:e}),e&&0!==e.length?e.map(e=>i.a.createElement(At,{key:e.id,messageConversation:e,wideview:this.props.wideview,selectedValue:s,notification:a,displayExtendedChoices:this.props.displayExtendedChoices})):!this.props.selectedMessageType.loading&&i.a.createElement(se.a,null,ne.a.t("No ".concat(t.displayName.toLowerCase()," messages"))),this.props.selectedMessageType.loading&&i.a.createElement("div",{style:It.loading},i.a.createElement(lt.a,{style:{marginTop:"10px"},color:X.palette.primary1Color})))}}var Ft=Object(q.a)(Object(l.c)(e=>({messageTypes:e.messaging.messageTypes,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,messageConversations:e.messaging.messageConversations,selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType}),{loadMessageConversations:_},null,{pure:!1}))(wt),_t=s(296),Ot=s.n(_t);const Nt={canvas:{flex:"3 0",margin:"10px",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)"},messageTypeField:{display:"flex",flexDirection:"row"},messageType:{width:"300px",marginTop:"10px"}};class Ut extends a.Component{constructor(e){super(e),this.subjectUpdate=(e,t)=>{this.props.updateInputFields(t,this.props.input,this.props.recipients)},this.inputUpdate=(e,t)=>{this.props.updateInputFields(this.props.subject,t,this.props.recipients)},this.updateRecipients=e=>{this.props.updateInputFields(this.props.subject,this.props.input,e)},this.sendMessage=()=>{const e=this.state.isMessageFeedback?"TICKET":"PRIVATE",t=this.props.messageTypes.find(t=>t.id===e);if(this.state.isMessageFeedback)this.props.sendFeedbackMessage(t),le.push("/TICKET");else{const e=this.props.recipients.filter(e=>"user"===e.type),s=this.props.recipients.filter(e=>"userGroup"===e.type),a=this.props.recipients.filter(e=>"organisationUnit"===e.type);this.props.sendMessage({users:e,userGroups:s,organisationUnits:a,messageType:t}),le.push("/PRIVATE")}},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments()},this.handleDiscard=()=>{const e=ne.a.t("Message discarded");this.props.displaySnackMessage({message:e,onSnackActionClick:()=>le.push("/PRIVATE/create"),onSnackRequestClose:()=>this.wipeInput(),snackType:"NEGATIVE"}),le.push("/PRIVATE")},this.state={isMessageFeedback:!1}}componentDidMount(){const{addRecipientByUserId:e}=this.props,{messageId:t,recipientId:s}=this.props.match.params;"create"===t&&s&&e(s)}render(){const e=""===this.props.subject||""===this.props.input||!this.state.isMessageFeedback&&0===this.props.recipients.length,t=""===this.props.subject&&""===this.props.input&&!this.state.isMessageFeedback&&0===this.props.recipients.length;return i.a.createElement("div",{style:Nt.canvas},i.a.createElement(se.a,{style:Et}," ",ne.a.t("Create")),i.a.createElement(Le.Card,null,i.a.createElement(Le.CardText,null,i.a.createElement(Qe,{style:{margin:"0px"},label:ne.a.t("To"),disabled:this.state.isMessageFeedback,recipients:this.state.isMessageFeedback?[{id:"id",displayName:ne.a.t("Feedback recipient group")}]:this.props.recipients,updateRecipients:this.updateRecipients,inputHeight:"100px"}),i.a.createElement("div",{style:Nt.messageTypeField},i.a.createElement("div",{style:Nt.messageType},i.a.createElement(Ot.a,{label:ne.a.t("Private message"),checked:!this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}})),i.a.createElement("div",{style:Nt.messageType},i.a.createElement(Ot.a,{label:ne.a.t("Feedback message"),checked:this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}}))),i.a.createElement(je.a,{floatingLabelText:ne.a.t("Subject"),fullWidth:!0,value:this.props.subject,onChange:this.subjectUpdate}),i.a.createElement(je.a,{key:"createMessage",id:"createMessage",rows:5,underlineShow:!1,value:this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:ne.a.t("Message"),onChange:this.inputUpdate}),this.props.enableAttachments&&i.a.createElement(_e,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(Le.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(Ve.a,{primary:!0,disabled:e,label:ne.a.t("Send"),onClick:()=>this.sendMessage()}),i.a.createElement(me.a,{label:ne.a.t("Discard"),disabled:t,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(Be,{addAttachment:e=>{this.props.addAttachment(e)}})))))}}var Dt=Object(q.a)(Object(l.c)(e=>({messageTypes:e.messaging.messageTypes,subject:e.messaging.subject,input:e.messaging.input,recipients:e.messaging.recipients,attachments:e.messaging.attachments,enableAttachments:C(e.messaging.dhis2CoreVersion)}),{sendMessage:({users:e,userGroups:t,organisationUnits:s,messageType:a})=>async(i,r)=>{try{const{messaging:{subject:n,input:o,attachments:l}}=r();await(async({subject:e,users:t,userGroups:s,organisationUnits:a,text:i,attachments:r})=>await k.mutate({resource:"messageConversations",type:"create",data:{subject:e,users:t,userGroups:s,organisationUnits:a,text:i,attachments:r}}))({subject:n,users:e,userGroups:t,organisationUnits:s,text:o,attachments:l}),i(w("SEND_MESSAGE_SUCCESS",{messageType:a,page:1})),i(_())}catch(n){i(w("SEND_MESSAGE_ERROR",{error:n}))}},sendFeedbackMessage:e=>async(t,s)=>{const a=s();try{await(async(e,t)=>await k.mutate({resource:"messageConversations/feedback",type:"create",params:{subject:e},data:t}))(a.messaging.subject,a.messaging.input),t(w("SEND_MESSAGE_SUCCESS",{messageType:e,page:1})),t(_())}catch(i){t(w("SEND_MESSAGE_ERROR",{error:i}))}},displaySnackMessage:L,updateInputFields:V,addAttachment:N,removeAttachment:H,cancelAttachment:W,addRecipientByUserId:e=>async t=>{try{const s=await(async e=>{const{user:t}=await k.query({user:{resource:"users",id:e,params:{fields:"id,displayName"}}});return{...t,type:"user"}})(e);t(w("ADD_RECIPIENT_BY_ID_SUCCESS",s))}catch(s){console.error(s)}}},null,{pure:!1}))(Ut),Lt=s(783),Gt=s.n(Lt),Vt=s(782),Pt=s.n(Vt),jt=s(299),Ht=s.n(jt),Wt=s(213),qt=s.n(Wt),Bt=s(224),Yt=s.n(Bt),zt=s(247),Kt=s.n(zt),Xt=s(362),Jt=s.n(Xt),Qt=s(422),Zt=s.n(Qt);var $t={STATUS:[{key:"NONE",value:"NONE",primaryText:ne.a.t("No status")},{key:"OPEN",value:"OPEN",primaryText:ne.a.t("Open")},{key:"PENDING",value:"PENDING",primaryText:ne.a.t("Pending")},{key:"INVALID",value:"INVALID",primaryText:ne.a.t("Invalid")},{key:"SOLVED",value:"SOLVED",primaryText:ne.a.t("Solved")}],PRIORITY:[{key:"NONE",value:"NONE",primaryText:ne.a.t("No priority")},{key:"HIGH",value:"HIGH",primaryText:ne.a.t("High")},{key:"MEDIUM",value:"MEDIUM",primaryText:ne.a.t("Medium")},{key:"LOW",value:"LOW",primaryText:ne.a.t("Low")}]},es=s(777),ts=s.n(es),ss=s(781),as=s.n(ss),is=s(778),rs=s.n(is),ns=s(779),os=s.n(ns),ls=s(780),cs=s.n(ls),ps=s(226),ds=s.n(ps);function hs(e){return i.a.createElement(l.b.Consumer,null,t=>i.a.createElement(ds.a,e,i.a.createElement(l.a,{store:t.store},e.children)))}var gs=({open:e,onRequestClose:t,updateMessageConversations:s,messageType:a,feedbackRecipientsId:r})=>i.a.createElement(hs,{open:e,onRequestClose:()=>{t()}},i.a.createElement(Qe,{onSuggestionClick:e=>{s([e.id]),t()},searchOnlyUsers:!0,searchOnlyFeedbackRecipients:"TICKET"===a.id,feedbackRecipientsId:r,recipients:[],key:"suggestionField",label:ne.a.t("Assignee")}));const ms={canvas:{width:"400px",display:"flex"},extendedChoices:{display:"flex",justifyContent:"flex-start"},nrSelected:{padding:"0px 0px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}};class us extends a.Component{constructor(e){super(e),this.getIds=()=>this.props.selectedMessageConversation&&0===this.props.checkedIds.length?[this.props.selectedMessageConversation.id]:this.props.checkedIds.map(e=>e.id),this.updateMessageConversation=(e,t)=>{const{selectedMessageType:s,selectedMessageConversation:a}=this.props,i=this.getIds();this.props.updateMessageConversations({messageConversationIds:i,identifier:e,value:t,messageType:s,selectedMessageConversation:a}),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.markMessageConversations=e=>{const t=this.getIds();this.props.markMessageConversations(e,t,this.props.selectedMessageType),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.toggleDialog=()=>{this.setState({dialogOpen:!this.state.dialogOpen})},this.state={checkedItems:!1,dialogOpen:!1,assignToOpen:!1}}render(){const e=this.props.selectedMessageConversation,t=this.props.checkedIds.length>0,s=t||void 0!==e,a=i.a.createElement(i.a.Fragment,null,i.a.createElement(me.a,{label:ne.a.t("Cancel"),primary:!0,onClick:()=>this.toggleDialog()}),i.a.createElement(me.a,{label:ne.a.t("Submit"),primary:!0,keyboardFocused:!0,onClick:()=>{this.props.deleteMessageConversations(this.getIds(),this.props.selectedMessageType),this.props.clearCheckedIds(),this.toggleDialog(),this.props.selectedMessageConversation&&(this.props.clearSelectedMessageConversation(),le.push("/".concat(this.props.selectedMessageType.id)))}})),r=this.props.checkedIds.length>99?"".concat(99,"+"):this.props.checkedIds.length;return s?i.a.createElement("div",{style:ms.canvas},i.a.createElement(hs,{title:ne.a.t("Are you sure you want to delete selected message conversation(s)?"),actions:a,modal:!1,open:this.state.dialogOpen,onRequestClose:this.toggleDialog}),i.a.createElement(gs,{open:this.state.assignToOpen,onRequestClose:()=>this.setState({assignToOpen:!this.state.assignToOpen}),updateMessageConversations:e=>this.updateMessageConversation("ASSIGNEE",e),messageType:this.props.selectedMessageType,feedbackRecipientsId:this.props.feedbackRecipientsId}),i.a.createElement("div",{style:ms.extendedChoices},i.a.createElement(ye.a,{tooltip:ne.a.t("Delete selected"),onClick:()=>{this.toggleDialog()}},i.a.createElement(rs.a,null)),i.a.createElement(ye.a,{tooltip:ne.a.t("Mark selected as unread"),onClick:()=>{this.markMessageConversations("unread")}},i.a.createElement(os.a,null)),i.a.createElement(ye.a,{tooltip:ne.a.t("Mark selected as read"),onClick:()=>{this.markMessageConversations("read")}},i.a.createElement(cs.a,null)),this.props.displayExtendedChoices&&i.a.createElement(ye.a,{onClick:()=>this.setState({assignToOpen:!this.state.assignToOpen}),tooltip:ne.a.t("Assign selected")},i.a.createElement(as.a,null)),i.a.createElement(Kt.a,{iconButtonElement:i.a.createElement(ye.a,null,i.a.createElement(Zt.a,null)),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"}},i.a.createElement(qt.a,{key:"markFollowUp",value:"markFollowUp",primaryText:ne.a.t("Mark for followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!0)}),i.a.createElement(qt.a,{key:"clearFollowUp",value:"clearFollowUp",primaryText:ne.a.t("Clear followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!1)}),this.props.displayExtendedChoices&&i.a.createElement(fe.a,null),this.props.displayExtendedChoices&&i.a.createElement(qt.a,{key:"clearAssigned",value:"clearAssigned",primaryText:ne.a.t("Clear assignee"),onClick:()=>this.updateMessageConversation("ASSIGNEE",void 0)}),this.props.displayExtendedChoices&&i.a.createElement(qt.a,{primaryText:ne.a.t("Set status"),key:"setStatus",rightIcon:i.a.createElement(ts.a,null),menuItems:$t.STATUS.map(e=>i.a.createElement(qt.a,{key:"".concat(e.key,"_status"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("STATUS",e.key)}))}),this.props.displayExtendedChoices&&i.a.createElement(qt.a,{primaryText:ne.a.t("Set priority"),key:"setPriority",rightIcon:i.a.createElement(ts.a,null),menuItems:$t.PRIORITY.map(e=>i.a.createElement(qt.a,{key:"".concat(e.key,"_priority"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("PRIORITY",e.key)}))}))),t&&i.a.createElement(Yt.a,{style:ms.nrSelected},"".concat(r," ").concat(ne.a.t("selected")))):i.a.createElement("div",null)}}var ys=Object(q.a)(Object(l.c)(e=>({selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,checkedIds:e.messaging.checkedIds,feedbackRecipientsId:e.messaging.feedbackRecipientsId}),{clearCheckedIds:U,clearSelectedMessageConversation:D,deleteMessageConversations:(e,t)=>async(s,a)=>{try{const i=a(),{currentUser:r}=i.messaging,n=e.map(e=>(async(e,t)=>await k.mutate({resource:"messageConversations/".concat(e,"/").concat(t),type:"delete"}))(e,r.id));await Promise.all(n),s(w("MESSAGE_CONVERSATIONS_DELETE_SUCCESS",{messageType:t,page:1})),s(_())}catch(i){s(w("MESSAGE_CONVERSATIONS_DELETE_ERROR",{error:i}))}},updateMessageConversations:({messageConversationIds:e,identifier:t,value:s,messageType:a,selectedMessageConversation:i})=>async r=>{if("FOLLOW_UP"===t)try{await(async(e,t)=>await k.mutate({resource:"messageConversations/".concat(t?"followup":"unfollowup"),type:"create",data:e}))(e,s),r(w("MESSAGE_CONVERSATION_UPDATE_SUCCESS",{messageType:a,page:1,identifier:t})),r(_())}catch(n){r(w("MESSAGE_CONVERSATION_UPDATE_ERROR",{error:n}))}else{const i=e.map(e=>{let i;switch(t){case"STATUS":i=(async(e,t)=>await k.mutate({resource:"messageConversations/".concat(e,"/status"),type:"create",params:{messageConversationStatus:t}}))(e,s);break;case"PRIORITY":i=(async(e,t)=>await k.mutate({resource:"messageConversations/".concat(e,"/priority"),type:"create",params:{messageConversationPriority:t}}))(e,s);break;case"ASSIGNEE":i=void 0!==s&&"VALIDATION_RESULT"===a.id?A({users:s.map(e=>({id:e})),userGroups:[],organisationUnits:[],messageConversationId:e}).then(()=>x(e,s)):x(e,s);break;default:m.a.error("Unexpected identifier for updateMessageConversations")}return i});try{await Promise.all(i),r(w("MESSAGE_CONVERSATION_UPDATE_SUCCESS",{messageType:a,page:1,identifier:t})),r(_())}catch(n){r(w("MESSAGE_CONVERSATION_UPDATE_ERROR",{error:n}))}}i&&r(F(i))},markMessageConversations:O},null,{pure:!1}))(us);const Es={canvas:e=>({display:"flex",justifyContent:"flex-start",alignItems:"center",backgroundColor:e?X.palette.blue50:X.palette.accent2Color,zIndex:10}),checkedOption:{display:"flex",justifyContent:"flex-start",minWidth:"200px",margin:"6px 0"},filterControl:{flex:2,height:"48px",marginRight:16,maxWidth:256},rightHandCanvas:{flex:"2 0",display:"flex",paddingLeft:16},ie11Spacer:{flexGrow:1},iconMenu:{width:"30px",display:"flex"}};class Cs extends a.Component{constructor(...e){super(...e),this.state={lastMessageFilter:""},this.debouncedSearch=E(this.search,300)}search(e){this.props.selectedMessageType&&this.state.lastMessageFilter!==e&&(this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id),this.setState({lastMessageFilter:e}))}componentDidUpdate(e){e.selectedMessageType&&this.props.selectedMessageType.id!==e.selectedMessageType.id&&(this.debouncedSearch(""),void 0!==this.props.messageFilter&&this.props.setFilter(void 0,"MESSAGE"),void 0!==this.props.statusFilter&&this.props.setFilter(void 0,"STATUS"),void 0!==this.props.priorityFilter&&this.props.setFilter(void 0,"PRIORITY"),this.props.assignedToMeFilter&&this.props.setFilter(!1,"ASSIGNED_TO_ME"),this.props.markedForFollowUpFilter&&this.props.setFilter(!1,"MARKED_FOR_FOLLOWUP"),this.props.unreadFilter&&this.props.setFilter(!1,"UNREAD")),void 0===this.props.selectedMessageType||this.props.selectedMessageType.loading||e.statusFilter===this.props.statusFilter&&e.priorityFilter===this.props.priorityFilter&&e.assignedToMeFilter===this.props.assignedToMeFilter&&e.markedForFollowUpFilter===this.props.markedForFollowUpFilter&&e.unreadFilter===this.props.unreadFilter&&void 0!==e.selectedMessageType&&e.selectedMessageType.id===this.props.selectedMessageType.id||this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id)}render(){const e=this.props.id,t=this.props.displayExtendedChoices,s=this.props.checkedOptions,a=!this.props.wideview||void 0===this.props.selectedMessageConversation&&"create"!==e;return i.a.createElement(Te.a,{style:Es.canvas(s)},i.a.createElement("div",null,!s&&i.a.createElement(me.a,{style:Es.checkedOption,icon:i.a.createElement(pe.a,null),onClick:()=>le.push("/PRIVATE/create"),label:ne.a.t("Compose")}),s&&i.a.createElement(me.a,{style:Es.checkedOption,icon:i.a.createElement(he.a,null),onClick:()=>this.props.clearCheckedIds(),label:ne.a.t("Deselect all")})),i.a.createElement(ys,{displayExtendedChoices:t}),i.a.createElement("div",{style:Es.rightHandCanvas},i.a.createElement("div",{style:Es.ie11Spacer}),t&&a&&!s&&i.a.createElement(Ht.a,{style:Es.filterControl,labelStyle:{color:void 0===this.props.statusFilter?"lightGray":"black",top:void 0===this.props.statusFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:X.palette.primary1Color},floatingLabelText:void 0===this.props.statusFilter?ne.a.t("Status"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.statusFilter?"-15px":"0px"},value:this.props.statusFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"STATUS")}},i.a.createElement(qt.a,{key:null,value:null,primaryText:""}),$t.STATUS.map(e=>i.a.createElement(qt.a,{key:e.key,value:e.value,primaryText:e.primaryText}))),t&&a&&!s&&i.a.createElement(Ht.a,{style:Es.filterControl,labelStyle:{color:void 0===this.props.priorityFilter?"lightGray":"black",top:void 0===this.props.priorityFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:X.palette.primary1Color},floatingLabelText:void 0===this.props.priorityFilter?ne.a.t("Priority"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.priorityFilter?"-15px":"0px"},value:this.props.priorityFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"PRIORITY")}},i.a.createElement(qt.a,{key:null,value:null,primaryText:""}),$t.PRIORITY.map(e=>i.a.createElement(qt.a,{key:e.key,value:e.value,primaryText:e.primaryText}))),!s&&a&&i.a.createElement(je.a,{style:Es.filterControl,fullWidth:!0,hintText:ne.a.t("Search"),value:this.props.messageFilter||"",onChange:(e,t)=>{this.debouncedSearch(t),this.props.setFilter(t,"MESSAGE")},type:"search"}),!s&&a&&i.a.createElement(Kt.a,{iconButtonElement:i.a.createElement(ye.a,null,i.a.createElement(Zt.a,null)),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},style:Es.iconMenu,menuStyle:{overflowX:"hidden"}},i.a.createElement(Yt.a,{style:{padding:"0px 16px"}},ne.a.t("Set filter")),this.props.displayExtendedChoices&&i.a.createElement(Jt.a,{style:{padding:"0px 16px"},key:"assignedToMeFilter",label:ne.a.t("Assigned to me"),checked:this.props.assignedToMeFilter,onClick:()=>{this.props.setFilter(!this.props.assignedToMeFilter,"ASSIGNED_TO_ME")}}),i.a.createElement(Jt.a,{style:{padding:"0px 16px"},key:"markedForFollowUpFilter",label:ne.a.t("Marked for followup"),checked:this.props.markedForFollowUpFilter,onClick:()=>{this.props.setFilter(!this.props.markedForFollowUpFilter,"MARKED_FOR_FOLLOWUP")}}),i.a.createElement(Jt.a,{style:{padding:"0px 16px"},key:"unreadFilter",label:ne.a.t("Unread messages"),checked:this.props.unreadFilter,onClick:()=>{this.props.setFilter(!this.props.unreadFilter,"UNREAD")}})),i.a.createElement(me.a,{style:{width:"50px",alignSelf:"center"},icon:this.props.wideview?i.a.createElement(Gt.a,null):i.a.createElement(Pt.a,null),onClick:()=>this.props.toogleWideview()})))}}var Ss=Cs;s(784);const Ts=["TICKET","VALIDATION_RESULT"];class vs extends a.Component{constructor(e){super(e),this.setAutoRefresh=e=>{!e&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),e&&(this.intervalId=setInterval(this.tick,1e4)),this.setState({autoRefresh:e,refreshTimer:3e5})},this.tick=()=>{this.state.refreshTimer-1e4<=0?(this.refresh(),this.setState({refreshTimer:3e5})):this.setState(e=>({refreshTimer:e.refreshTimer-1e4}))},this.refresh=()=>{this.props.messageTypes.map(e=>this.props.loadMessageConversations(e,this.props.selectedMessageType)),this.props.selectedMessageConversation&&this.props.setSelectedMessageConversation(this.props.selectedMessageConversation)},this.toogleWideview=()=>{this.setState({wideview:!this.state.wideview})},this.intervalId=null,this.state={autoRefresh:!1,checkedItems:!1,refreshTimer:3e5,wideview:!0}}componentDidMount(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(this.props.setDhis2CoreVersion(this.context.d2.system.version.minor),t&&t!==e&&"create"!==t){const e={id:t};this.props.setSelectedMessageConversation(e)}(async e=>{const{configuration:{feedbackRecipients:t}}=await k.query({configuration:{resource:"configuration"}});return{authorized:e.authorities.includes("ALL")||e.userGroups.some(({id:e})=>e===t.id),feedbackRecipientsId:t.id}})(this.props.currentUser).then(e=>this.props.setIsInFeedbackRecipientGroup(e)),this.props.messageTypes.map(t=>this.props.loadMessageConversations(t,e)),this.props.setDisplayTimeDiff()}componentDidUpdate(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(!this.props.settingSelectedMessageConversation&&t&&e!==t&&"create"!==t&&(void 0===this.props.selectedMessageConversation||t!==this.props.selectedMessageConversation.id)){const e={id:t};this.props.setSelectedMessageConversation(e)}e===t&&e!==this.props.selectedMessageType.id&&this.props.setSelectedMessageType(e),e!==t&&"create"!==t||void 0===this.props.selectedMessageConversation||this.props.clearSelectedMessageConversation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId)}render(){const e=this.props.match.params.messageId,t=!!this.props.selectedMessageType&&!!(Ts.indexOf(this.props.selectedMessageType.id)+1)&&this.props.isInFeedbackRecipientGroup;return i.a.createElement("div",{className:"messaging-center"},i.a.createElement(Ss,Object.assign({},this.props,{id:e,wideview:this.state.wideview,displayExtendedChoices:t,toogleWideview:this.toogleWideview})),i.a.createElement("div",{className:"messaging-center__main-content"},i.a.createElement(ut,Object.assign({},this.props,{drawerOpen:this.state.drawerOpen,messageTypes:this.props.messageTypes,autoRefresh:this.state.autoRefresh,refreshTimer:this.state.refreshTimer,setAutoRefresh:this.setAutoRefresh})),void 0===this.props.selectedMessageConversation&&!(this.state.wideview&&"create"===e)&&i.a.createElement(Ft,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),"create"===e&&i.a.createElement(Dt,Object.assign({},this.props,{wideview:this.state.wideview})),void 0!==this.props.selectedMessageConversation&&!this.state.wideview&&i.a.createElement(Ft,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),this.props.selectedMessageConversation&&"create"!==e?void 0!==this.props.selectedMessageConversation&&i.a.createElement(at,Object.assign({},this.props,{messageConversation:this.props.selectedMessageConversation,wideview:this.state.wideview,disableLink:!0,displayExtendedChoices:t})):!this.state.wideview&&"create"!==e&&i.a.createElement("div",{className:"messaging-center__no-message-selected"},i.a.createElement(se.a,{style:Et},ne.a.t("Select a message")),i.a.createElement(ie.a,{style:{color:X.palette.primary1Color,width:120,height:120}}))))}}vs.contextTypes={d2:ee.default.object};var fs=Object(q.a)(Object(l.c)(e=>({currentUser:e.messaging.currentUser,snackMessage:e.messaging.snackMessage,messageTypes:e.messaging.messageTypes,messageConversations:e.messaging.messageConversations,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,assignedToMeFilter:e.messaging.assignedToMeFilter,markedForFollowUpFilter:e.messaging.markedForFollowUpFilter,unreadFilter:e.messaging.unreadFilter,selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,checkedIds:e.messaging.checkedIds,checkedOptions:e.messaging.checkedIds.length>0,loaded:e.messaging.loaded,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments}),{loadMessageConversations:_,setIsInFeedbackRecipientGroup:e=>w("SET_IN_FEEDBACK_RECIPIENT_GROUP",{isInFeedbackRecipientGroup:e}),clearCheckedIds:U,setSelectedMessageConversation:F,setSelectedMessageType:j,clearSelectedMessageConversation:D,updateInputFields:V,setFilter:G,setDisplayTimeDiff:()=>async e=>{try{const t=await(async()=>{const{systemInfo:e}=await k.query({systemInfo:{resource:"system/info"}});return e.serverDate})(),s=I()().diff(I()(t))-5e3;e(w("SET_DISPLAY_TIME_DIFF_SUCCESS",s))}catch(t){e(w("SET_DISPLAY_TIME_DIFF_ERROR",{error:t}))}},clearAttachments:P,setDhis2CoreVersion:e=>w("SET_DHIS2_CORE_VERSION",e)},null,{pure:!1}))(vs);var ks=()=>i.a.createElement($.c,{history:le},i.a.createElement("div",null,i.a.createElement($.b,{exact:!0,path:"/",component:()=>i.a.createElement($.a,{to:"/PRIVATE"})}),i.a.createElement($.b,{path:"/:messageType/:messageId?/:recipientId?",component:fs}))),Ms=s(792),xs=s.n(Ms);var bs=Object(l.c)(e=>({currentUser:e.messaging.currentUser}),{setCurrentUser:()=>async e=>{e(w("SET_CURRENT_USER"));try{const{currentUser:t}=await k.query({currentUser:{resource:"me",params:{fields:["id","authorities","userGroups[id]"]}}});e(w("SET_CURRENT_USER_SUCCESS",t))}catch{e(w("SET_CURRENT_USER_ERROR","Could not load current user"))}}})(({currentUser:e,setCurrentUser:t})=>{const{loading:s,error:r}=e;return Object(a.useEffect)(()=>{t()},[]),s?i.a.createElement("div",{className:xs.a.center},i.a.createElement(o.a,{size:48})):r?i.a.createElement("div",{className:p()(xs.a.center,xs.a.error)},r):i.a.createElement("div",null,i.a.createElement(Z,null),i.a.createElement(ks,null))}),As=s(388),Rs=s(793);var Is=[{id:"PRIVATE",displayName:"Inbox",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"VALIDATION_RESULT",displayName:"Validation",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"TICKET",displayName:"Ticket",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"SYSTEM",displayName:"System",unread:0,loaded:0,loading:!1,total:0,page:1}];const ws={currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null},messageConversations:{},messageTypes:Is,selectedMessageType:void 0,selectedMessageConversation:void 0,settingSelectedMessageConversation:!1,checkedIds:[],messageFilter:void 0,statusFilter:void 0,priorityFilter:void 0,assignedToMeFilter:!1,markedForFollowUpFilter:!1,unreadFilter:!1,isInFeedbackRecipientGroup:!1,feedbackRecipientsId:void 0,displayTimeDiff:0,subject:"",input:"",recipients:[],attachments:[],snackMessage:"",onSnackActionClick:void 0,onSnackRequestClose:void 0,snackType:"NEUTRAL"};var Fs=function(e=ws,t){const s=e.messageTypes,a=e.attachments;switch(t.type){case"SET_CURRENT_USER":return{...e,currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null}};case"SET_CURRENT_USER_SUCCESS":return{...e,currentUser:{loading:!1,error:null,id:t.payload.id,authorities:t.payload.authorities,userGroups:t.payload.userGroups}};case"SET_CURRENT_USER_ERROR":return{...e,currentUser:{loading:!1,error:t.payload,id:null,authorities:null,userGroups:null}};case"SET_DISPLAY_TIME_DIFF_SUCCESS":return{...e,displayTimeDiff:t.payload,error:t.payload,id:null,authorities:null};case"MESSAGE_CONVERSATIONS_LOAD_SUCCESS":{const a=s.find(e=>e.id===t.payload.messageType.id);a.loaded=t.payload.messageConversations.length,a.total=t.payload.pager.total,a.unread=t.payload.nrOfUnread,a.page=t.payload.pager.page,a.loading=!1,Is.splice([y(s,a.id)],1,a);const i=t.payload.selectedMessageType===a.id&&(t.payload.selectedMessageType===e.selectedMessageType||void 0===e.selectedMessageType);return{...e,messageTypes:Is,messageConversations:{...e.messageConversations,[a.id]:t.payload.messageConversations},selectedMessageType:i?a:e.selectedMessageType}}case"MESSAGE_CONVERSATION_UPDATE_ERROR":return{...e,snackMessage:t.payload.error.message,snackType:"NEGATIVE"};case"MESSAGE_CONVERSATION_UPDATE_SUCCESS":{let s="";switch(t.payload.identifier){case"STATUS":s=ne.a.t("Successfully updated status");break;case"PRIORITY":s=ne.a.t("Successfully updated priority");break;case"ASSIGNEE":s=ne.a.t("Successfully updated assignee");break;case"FOLLOW_UP":s=ne.a.t("Successfully changed followup");break;default:m.a.error("Unexpected identifier for updateMessageConversations success")}return{...e,snackMessage:s,snackType:"POSITIVE"}}case"SEND_MESSAGE_ERROR":case"MESSAGE_CONVERSATIONS_DELETE_ERROR":return{...e,snackMessage:t.payload.error.message,snackType:"NEGATIVE"};case"MESSAGE_CONVERSATIONS_DELETE_SUCCESS":return{...e,snackMessage:ne.a.t("Successfully deleted message conversation(s)"),snackType:"POSITIVE"};case"DISPLAY_SNACK_MESSAGE;":return{...e,snackMessage:t.payload.message,snackType:t.payload.snackType,onSnackActionClick:t.payload.onSnackActionClick,onSnackRequestClose:t.payload.onSnackRequestClose};case"CLEAR_SNACK_MESSAGE":return{...e,snackMessage:"",snackType:"NEUTRAL"};case"SET_CHECKED":{const s=t.payload.messageConversation;let a=e.checkedIds;return t.payload.selectedValue?a.push(s):a=a.filter(e=>e.id!==s.id),{...e,checkedIds:a}}case"SET_ALL_CHECKED":return{...e,checkedIds:t.payload.messageConversationIds};case"CLEAR_CHECKED":return{...e,checkedIds:[]};case"SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS":return{...e,selectedMessageConversation:t.payload.messageConversation,settingSelectedMessageConversation:!1};case"SET_SELECTED_MESSAGE_CONVERSATION":return{...e,settingSelectedMessageConversation:!0};case"CLEAR_SELECTED_MESSAGE_CONVERSATION":return{...e,selectedMessageConversation:void 0};case"SET_SELECTED_MESSAGE_TYPE":return{...e,checkedIds:[],selectedMessageType:s.find(e=>e.id===t.payload.messageTypeId),selectedMessageConversations:e.messageConversations[t.payload.messageTypeId],selectedMessageConversation:void 0};case"UPDATE_INPUT_FIELDS":return{...e,subject:t.payload.subject,input:t.payload.input,recipients:t.payload.recipients};case"ADD_RECIPIENT_BY_ID_SUCCESS":return{...e,recipients:[...e.recipients,t.payload]};case"SET_FILTER":return{...e,messageFilter:"MESSAGE"===t.payload.filterType?t.payload.filter:e.messageFilter,statusFilter:"STATUS"===t.payload.filterType?t.payload.filter:e.statusFilter,priorityFilter:"PRIORITY"===t.payload.filterType?t.payload.filter:e.priorityFilter,assignedToMeFilter:"ASSIGNED_TO_ME"===t.payload.filterType?t.payload.filter:e.assignedToMeFilter,markedForFollowUpFilter:"MARKED_FOR_FOLLOWUP"===t.payload.filterType?t.payload.filter:e.markedForFollowUpFilter,unreadFilter:"UNREAD"===t.payload.filterType?t.payload.filter:e.unreadFilter};case"LOAD_MESSAGE_CONVERSATIONS":{const s=t.payload.messageType;s.loading=!0,t.payload.loadMore&&s.page++,Is[y(Is,s.id)]=s;const a=e.selectedMessageType;return a&&(a.loading=!0,t.payload.loadMore&&a.page++),{...e,messageTypes:Is,selectedMessageType:a}}case"SET_IN_FEEDBACK_RECIPIENT_GROUP":return{...e,isInFeedbackRecipientGroup:t.payload.isInFeedbackRecipientGroup.authorized,feedbackRecipientsId:t.payload.isInFeedbackRecipientGroup.feedbackRecipientsId};case"ADD_ATTACHMENT_SUCCESS":return{...e,attachments:e.attachments.map(e=>e.name===t.payload.name?{id:t.payload.id,name:e.name,contentLength:e.contentLength,loading:!1}:e)};case"ADD_ATTACHMENT_ERROR":return{...e,attachments:a.filter(e=>e.id!==t.payload.attachmentId),snackMessage:t.payload.error.message,snackType:"NEGATIVE"};case"ADD_ATTACHMENT":return{...e,attachments:e.attachments.concat({name:t.payload.name,contentLength:t.payload.size,loading:!0})};case"REMOVE_ATTACHMENT":return{...e,attachments:a.filter(e=>e.id!==t.payload.attachmentId)};case"CANCEL_ATTACHMENT":return{...e,attachments:a.filter(e=>e.name!==t.payload.attachmentName)};case"CLEAR_ATTACHMENTS":return{...e,attachments:[]};case"SET_DHIS2_CORE_VERSION":return{...e,dhis2CoreVersion:t.payload};default:return e}};const _s=[Rs.a],Os=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||As.d,Ns=Object(As.c)({messaging:Fs});var Us=Object(As.e)(Ns,Os(Object(As.a)(..._s))),Ds=s(293),Ls=s.n(Ds);class Gs extends i.a.Component{constructor(...e){super(...e),this.getChildContext=()=>({d2:this.props.d2}),this.render=()=>i.a.createElement(Ls.a,{muiTheme:X},this.props.children)}}Gs.childContextTypes={d2:ee.default.object};var Vs=Gs;s(794),s(17);t.default=()=>{const{baseUrl:e}=Object(r.b)(),t=Object(r.c)(),{d2:s}=Object(n.a)({d2Config:{schemas:["messageConversation"],baseUrl:"".concat(e,"/api")}});return s?(k=t,i.a.createElement(l.a,{store:Us},i.a.createElement(Vs,{d2:s},i.a.createElement(bs,null)))):i.a.createElement(Vs,null,i.a.createElement("div",{className:"page-loader-wrap"},i.a.createElement(o.a,{size:48})))}}}]);
//# sourceMappingURL=app.f7ad57c9.chunk.js.map