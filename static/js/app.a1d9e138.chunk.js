(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{576:function(e,t,s){},596:function(e,t,s){},607:function(e,t,s){},614:function(e,t,s){e.exports={center:"App_center__1snml",error:"App_error__1usCm"}},616:function(e,t,s){},618:function(e,t,s){"use strict";s.r(t);var a=s(1),i=s.n(a),r=s(203),n=s(265),o=s.n(n),l=s(7),c=s(333),p=s.n(c),d=s(211),h=s(241),g=p()({palette:{negative:h.pinkA200,blue50:h.blue50,primary1Color:"#1D8BF1",primary2Color:h.blue100,primary3Color:h.blue300,primary4Color:h.blue500,accent1Color:h.grey50,accent2Color:h.grey100,accent3Color:h.grey300,accent4Color:h.grey500,followUp:h.orange500,darkGray:h.grey700,superDarkGray:h.grey900,textColor:h.darkBlack,alternateTextColor:h.white,canvasColor:h.white,borderColor:h.grey300,clockCircleColor:Object(d.fade)(h.darkBlack,.07),shadowColor:h.fullBlack}}),m=s(4),u=s.n(m),y=s(466),C=s(307),v=s.n(C);const E="SET_CURRENT_USER",f="SET_CURRENT_USER_SUCCESS",T="SET_CURRENT_USER_ERROR",S="LOAD_MESSAGE_CONVERSATIONS",k="MESSAGE_CONVERSATIONS_LOAD_SUCCESS",b="MESSAGE_CONVERSATIONS_DELETE_SUCCESS",M="MESSAGE_CONVERSATIONS_DELETE_ERROR",x="MESSAGE_CONVERSATION_UPDATE_SUCCESS",w="MESSAGE_CONVERSATION_UPDATE_ERROR",I="SEND_MESSAGE_SUCCESS",F="SEND_MESSAGE_ERROR",R="SET_FILTER",A="DISPLAY_SNACK_MESSAGE;",O="CLEAR_SNACK_MESSAGE",_="SET_CHECKED",U="SET_ALL_CHECKED",N="CLEAR_CHECKED",D="SET_SELECTED_MESSAGE_TYPE",L="CLEAR_SELECTED_MESSAGE_CONVERSATION",G="SET_SELECTED_MESSAGE_CONVERSATION",j="SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS",P="UPDATE_INPUT_FIELDS",V="SET_IN_FEEDBACK_RECIPIENT_GROUP",W="SET_DISPLAY_TIME_DIFF_SUCCESS",q="ADD_RECIPIENT_BY_ID_SUCCESS",B="ADD_ATTACHMENT",H="ADD_ATTACHMENT_SUCCESS",Y="ADD_ATTACHMENT_ERROR",z="REMOVE_ATTACHMENT",K="CLEAR_ATTACHMENTS",X="CANCEL_ATTACHMENT",J="SET_DHIS2_CORE_VERSION";var $=s(380),Q=s.n($);const Z="Roboto, Helvetica, Arial, sans-serif",ee="NEUTRAL",te="POSITIVE",se="NEGATIVE";function ae(e,t){const s=e.length;for(let a=0;a<s;a++)if(e[a].id===t)return a}function ie(e,t){let s=null;return function(){const a=this,i=arguments;clearTimeout(s),s=setTimeout((function(){e.apply(a,i)}),t)}}function re(e){return e>30}function ne(e){return{resource:"organisationUnits",params:{fields:["id","displayName"],pageSize:10,filter:["displayName:token:".concat(e),"users:gte:1"]}}}function oe(e){return{resource:"userGroups",params:{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e)]}}}const le=["id","displayName","subject","messageType","lastSender[id, displayName]","assignee[id, displayName]","status","priority","lastUpdated","read","lastMessage","followUp"],ce=["*","assignee[id, displayName]","messages[*,sender[id,displayName]","attachments[id, name, contentLength]]","userMessages[user[id, displayName]]"];let pe=null;const de=async({messageType:e,page:t,messageFilter:s,status:a,priority:i,assignedToMeFilter:r,markedForFollowUpFilter:n,unreadFilter:o,currentUser:l})=>{const c=["messageType:eq:".concat(e)];a&&c.push("status:eq:".concat(a)),i&&c.push("priority:eq:".concat(i)),n&&c.push("followUp:eq:true"),o&&c.push("read:eq:false"),r&&c.push("assignee.id:eq:".concat(l.id));const p={resource:"messageConversations",params:{filter:c,pageSize:35,page:t,fields:le,order:"lastMessage:desc",queryString:s}},{messageConversations:d}=await pe.query({messageConversations:p});return d},he=async(e,t)=>{const s=t?{resource:"messageConversations/".concat(e,"/assign"),type:"create",params:{userId:t}}:{resource:"messageConversations",id:"".concat(e,"/assign"),type:"delete"};return await pe.mutate(s)},ge=async({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i})=>{var r,n,o;const l=function({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i}){const r=function({searchValue:e,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:s,dhis2CoreVersion:a}){if(function(e){return e>34}(a))return{resource:t?"userLookup/feedbackRecipients":"userLookup",params:{query:e}};{const a=["displayName:token:".concat(e)];return t&&a.push("userGroups.id:eq:".concat(s)),{resource:"users",params:{filter:a,pageSize:10}}}}({searchValue:e,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i});return t?{users:r}:{users:r,organisationUnits:ne(e),userGroups:oe(e)}}({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:a,dhis2CoreVersion:i}),c=await pe.query(l);return{users:null===(r=c.users)||void 0===r?void 0:r.users,organisationUnits:null===c||void 0===c||null===(n=c.organisationUnits)||void 0===n?void 0:n.organisationUnits,userGroups:null===c||void 0===c||null===(o=c.userGroups)||void 0===o?void 0:o.userGroups}},me=({users:e,userGroups:t,organisationUnits:s,messageConversationId:a})=>pe.mutate({resource:"messageConversations/".concat(a,"/recipients"),type:"create",data:{users:e,userGroups:t,organisationUnits:s}});var ue=s(12),ye=s.n(ue);const Ce=(e,t)=>({type:e,payload:t}),ve=e=>async t=>{t(Ce(G));try{const s=await(async({id:e})=>{const{messageConversation:t}=await pe.query({messageConversation:{resource:"messageConversations",id:e,params:{fields:ce}}});return t})(e);t(Ce(j,{messageConversation:s}))}catch(s){t(Ce("SET_SELECTED_MESSAGE_CONVERSATION_ERROR",{error:s}))}},Ee=(e,t,s=!1)=>async(a,i)=>{const r=[],n=i(),{messageFilter:o,statusFilter:l,priorityFilter:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}=n.messaging;e=e||n.messaging.selectedMessageType,t=t||n.messaging.selectedMessageType.id,a(Ce(S,{messageType:e,loadMore:s}));try{for(let t=1;t<=e.page;t++){const s=de({messageType:e.id,page:t,messageFilter:o,status:l,priority:c,assignedToMeFilter:p,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}).then((e=>({messageConversations:e.messageConversations,pager:e.pager})));r.push(s)}const s=await Promise.all(r),i=await(async e=>{const{messageConversations:t}=await pe.query({messageConversations:{resource:"messageConversations",params:{fields:["read"],filter:["read:eq:false","messageType:eq:".concat(e)],pageSize:1}}});return t.pager.total})(e.id),n=s.reduce(((e,t)=>e.concat(t.messageConversations)),[]);a(Ce(k,{messageConversations:n,pager:s[s.length-1].pager,messageType:e,selectedMessageType:t,nrOfUnread:i}))}catch(m){a(Ce("MESSAGE_CONVERSATIONS_LOAD_ERROR",{error:m}))}},fe=(e,t,s)=>async a=>{try{await("read"===e?(r=t,pe.mutate({resource:"messageConversations/read",type:"create",data:r})):(i=t,pe.mutate({resource:"messageConversations/unread",type:"create",data:i}))),a(Ce("MARK_MESSAGE_CONVERSATIONS_SUCCESS",{messageType:s,page:1})),a(Ee())}catch(n){a(Ce("MARK_MESSAGE_CONVERSATIONS_ERROR",{error:n}))}var i,r},Te=e=>async t=>{t(Ce(B,e));try{const s=await(e=>pe.mutate({resource:"fileResources",type:"create",params:{domain:"MESSAGE_ATTACHMENT"},data:{file:e}}))(e);t(Ce(H,{id:s.response.fileResource.id,name:e.name,contentLength:s.response.fileResource.contentLength}))}catch(s){t(Ce(Y,{error:s}))}},Se=()=>Ce(N),ke=()=>Ce(L),be=({message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a})=>Ce(A,{message:e,onSnackActionClick:t,onSnackRequestClose:s,snackType:a}),Me=(e,t)=>Ce(R,{filter:e,filterType:t}),xe=(e,t,s)=>Ce(P,{subject:e,input:t,recipients:s}),we=()=>Ce(K),Ie=e=>Ce(D,{messageTypeId:e}),Fe=e=>Ce(z,{attachmentId:e}),Re=e=>Ce(X,{attachmentName:e});var Ae=s(215);const Oe={NEGATIVE:g.palette.negative,NEUTRAL:g.palette.primary1Color,POSITIVE:g.palette.alternateTextColor};class _e extends a.Component{constructor(e){var t,s,a;super(e),a=()=>{this.props.clearSnackMessage(),this.setState({show:!1}),this.props.onSnackRequestClose&&this.props.onSnackRequestClose()},(s="closeMessage")in(t=this)?Object.defineProperty(t,s,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[s]=a,this.state={show:!1}}componentDidUpdate(e,t){!t.show&&this.props.message&&this.setState({show:!0})}render(){return i.a.createElement(v.a,{open:""!==this.props.message&&this.state.show,message:this.props.message||"Missing snackbar message",autoHideDuration:4e3,onRequestClose:this.closeMessage,action:this.props.onSnackActionClick&&"undo",onActionClick:()=>{this.props.onSnackActionClick(),this.setState({show:!1})},contentStyle:{color:Oe[this.props.type]},style:{pointerEvents:"none",whiteSpace:"nowrap"},bodyStyle:{pointerEvents:"initial",maxWidth:"none"}})}}var Ue=Object(Ae.a)(Object(r.c)((e=>({message:e.messaging.snackMessage,type:e.messaging.snackType,onSnackActionClick:e.messaging.onSnackActionClick,onSnackRequestClose:e.messaging.onSnackRequestClose})),{clearSnackMessage:()=>Ce(O)}),Ae.b)(_e),Ne=s(609),De=s(214),Le=s.n(De),Ge=s(608),je=s.n(Ge),Pe=s(5),Ve=s.n(Pe),We=s(387),qe=Object(We.a)(),Be=s(385),He=s.n(Be),Ye=s(384),ze=s.n(Ye),Ke=s(207),Xe=s.n(Ke),Je=s(210),$e=s.n(Je),Qe=s(260),Ze=s.n(Qe),et=s(200),tt=s.n(et),st=s(233),at=s.n(st),it=s(259),rt=s.n(it),nt=s(299),ot=s.n(nt),lt=s(582),ct=s.n(lt),pt=s(577),dt=s.n(pt);s(576);const ht=({dataDirection:e,attachment:t,removeAttachment:s,downloadAttachment:a,cancelAttachment:r})=>i.a.createElement(Xe.a,{className:"attachment__button",backgroundColor:g.palette.accent2Color,label:"".concat(t.name," (").concat(parseFloat(parseInt(t.contentLength,10)/1e6).toFixed(2)," MB)"),labelPosition:"after",onClick:()=>{"download"===e?a(t):t.loading?r(t.name):s(t)},icon:"download"===e?i.a.createElement(dt.a,null):i.a.createElement(ct.a,null)},t.loading&&i.a.createElement(ot.a,{className:"attachment__progress",mode:"indeterminate"}));var gt=({dataDirection:e,attachments:t,style:s,removeAttachment:a,downloadAttachment:r,cancelAttachment:n})=>i.a.createElement("div",{className:"attachment",style:{...s}},t.map(((t,s)=>i.a.createElement(ht,{key:"".concat(t.name,"-").concat(s),dataDirection:e,attachment:t,removeAttachment:a,downloadAttachment:r,cancelAttachment:n})))),mt=s(583),ut=s.n(mt);const yt={canvas:e=>({backgroundColor:e,padding:"16px 16px 16px 16px"}),innerCanvas:{margin:"",paddingBottom:"0px"},cardText:{padding:"16px 0px 16px 0px",fontFamily:Z,whiteSpace:"pre-wrap",wordBreak:"break-word"},fromFormat:{fontFamily:Z},datePlacement:{display:"flex",justifyContent:"flex-end",marginRight:"10px"},dateFormat:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:Z}};var Ct=({displayTimeDiff:e,message:t,currentUser:s,lastMessage:a,downloadAttachment:r,cancelAttachment:n,enableAttachments:o})=>{const l=t.sender?s&&s.id===t.sender.id?"me":t.sender.displayName:"system",c=ye()(),p=ye()(t.created).add(e);return i.a.createElement("div",{style:yt.canvas(g.palette.canvasColor)},i.a.createElement("div",{style:yt.innerCanvas},i.a.createElement("div",{style:yt.fromFormat},t.internal?Ve.a.t("Internal message from ".concat(l)):Ve.a.t("Message from ".concat(l))),i.a.createElement("div",{placement:"bottom",style:yt.datePlacement},i.a.createElement("div",{style:yt.dateFormat},c.diff(p,"hours")<72?"".concat(p.from(c),", ").concat(p.format("HH:mm")):c.year()===p.year()?p.format("MMM DD, HH:mm"):p.format("MMM DD, YYYY HH:mm"))),o&&i.a.createElement(gt,{dataDirection:"download",style:{paddingLeft:0},attachments:t.attachments,downloadAttachment:r,cancelAttachment:n}),i.a.createElement(rt.a,{style:yt.cardText},i.a.createElement(ut.a,null,t.text))),!a&&i.a.createElement(at.a,null))},vt=s(258),Et=s(263),ft=s.n(Et),Tt=s(212),St=s.n(Tt),kt=s(597),bt=s.n(kt);s(596);const Mt=e=>t=>{const s=t.target.files;s.length>0&&e(s[0])};var xt=({addAttachment:e})=>i.a.createElement(Xe.a,{className:"attachment__upload-button",label:Ve.a.t("Upload attachment"),labelPosition:"after",containerElement:"label",icon:i.a.createElement(bt.a,null)},i.a.createElement("input",{className:"attachment__upload-button--input",type:"file",onChange:Mt(e)}));function wt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class It extends a.Component{constructor(e){super(e),wt(this,"replyMessage",(e=>{const{input:t,selectedMessageConversation:s,selectedMessageType:a}=this.props;this.props.replyMessage({message:t,internalReply:e,messageConversation:s,messageType:a}),this.wipeInput()})),wt(this,"wipeInput",(()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),this.setState({inputError:!1})})),wt(this,"texFieldUpdate",((e,t)=>{this.props.updateInputFields("",t,[])})),wt(this,"handleDiscard",(()=>{const e=Ve.a.t("Reply discarded");this.setState({discardState:!0}),this.props.displaySnackMessage({message:e,onSnackActionClick:()=>this.setState({discardState:!1}),onSnackRequestClose:()=>{this.setState({discardState:!1}),this.wipeInput()},snackType:"NEGATIVE"}),this.setState({expanded:!1})})),this.state={discardState:!1}}componentWillUnmount(){this.wipeInput()}render(){return i.a.createElement(vt.Card,{style:{marginTop:"5px"},expanded:!0},i.a.createElement(vt.CardText,{style:{padding:"0px 0px 0px 16px"}},i.a.createElement(St.a,{key:this.props.messageConversation.id,id:this.props.messageConversation.id,rows:5,underlineShow:!1,value:this.state.discardState?"":this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:Ve.a.t("Message"),onChange:this.texFieldUpdate}),this.props.enableAttachments&&!this.state.discardState&&i.a.createElement(gt,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(vt.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(ft.a,{primary:!0,label:Ve.a.t("Reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!1)}),this.props.isInFeedbackRecipientGroup&&"TICKET"===this.props.selectedMessageType.id&&i.a.createElement(Xe.a,{primary:!0,label:Ve.a.t("Internal reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!0)}),i.a.createElement(Xe.a,{label:Ve.a.t("Discard"),disabled:""===this.props.input||this.state.discardState,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(xt,{addAttachment:e=>{this.props.addAttachment(e)}}),")")))}}var Ft=Object(Ae.a)(Object(r.c)((e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes,input:e.messaging.input,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments,enableAttachments:re(e.messaging.dhis2CoreVersion)})),{replyMessage:({message:e,internalReply:t,messageConversation:s,messageType:a})=>async(i,r)=>{try{const{id:n}=s,o=r().messaging.attachments.map((e=>e.id));await(async({message:e,internalReply:t,attachments:s,id:a})=>{const i={internal:t};return s.length>0&&(i.attachments=s),await pe.mutate({resource:"messageConversations/".concat(a),type:"create",params:i,data:e})})({message:e,internalReply:t,attachments:o,id:n}),i(Ce("REPLY_MESSAGE_SUCCESS",{messageConversation:s,messageType:a,page:1})),i(Ee()),i(ve(s))}catch(n){i(Ce("REPLY_MESSAGE_ERROR",{error:n}))}},setSelectedMessageType:Ie,updateInputFields:xe,displaySnackMessage:be,addAttachment:Te,removeAttachment:Fe,cancelAttachment:Re},null,{pure:!1}))(It),Rt=s(598),At=s.n(Rt);function Ot(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class _t extends a.Component{constructor(...e){super(...e),Ot(this,"state",{input:"",searchResult:[],searchOnlyUsers:this.props.searchOnlyUsers,searchOnlyFeedbackRecipients:this.props.searchOnlyFeedbackRecipients,lastSearch:"",errorText:void 0}),Ot(this,"debouncedSearch",ie(this.search.bind(this),300)),Ot(this,"onSuggestionClick",(e=>{if(void 0!==this.props.onSuggestionClick)this.props.onSuggestionClick(e);else{this.wipeInput(),this.debouncedSearch("");!this.props.recipients.find((t=>t.id===e.id))&&this.props.updateRecipients([...this.props.recipients,this.state.searchResult.find((t=>t.id===e.id))])}})),Ot(this,"onRemoveChip",(e=>{this.props.updateRecipients(this.props.recipients.filter((t=>t.id!==e)))})),Ot(this,"wipeInput",(()=>{this.setState({input:"",searchResult:[]})})),Ot(this,"updateInput",(e=>{this.debouncedSearch(e),this.setState({input:e})}))}search(e){if(!this.state.searchResult.find((t=>t.displayName===e))&&""!==e&&e.length>=2){const{feedbackRecipientsId:t,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a,dhis2CoreVersion:i}=this.props;ge({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:a,feedbackRecipientsId:t,dhis2CoreVersion:i}).then((({users:e,userGroups:t,organisationUnits:s})=>{const a=e=>t=>({...t,type:e});let i=e.map(a("user"));this.state.searchOnlyUsers||(i=i.concat(t.map(a("userGroup"))).concat(s.map(a("organisationUnit")))),this.setState({searchResult:i,errorText:0===i.length?Ve.a.t("No results found"):void 0})}))}else this.setState({lastSearch:e,searchResult:""!==this.state.lastSearch&&""===e||e.length<2?[]:this.state.searchResult,errorText:""!==e&&e.length<2?Ve.a.t("Please enter at least ".concat(2," characters")):this.state.searchWarning})}render(){return i.a.createElement("div",{style:{...this.props.style,height:this.props.inputHeight}},i.a.createElement(At.a,{style:{marginBottom:16},disabled:void 0!==this.props.disabled&&this.props.disabled,errorText:this.props.errorText||this.state.errorText,value:this.props.recipients,fullWidth:!0,openOnFocus:!0,searchText:this.state.input,floatingLabelText:this.props.label,dataSource:this.state.searchResult,dataSourceConfig:{text:"displayName",value:"id"},onUpdateInput:this.updateInput,onRequestAdd:e=>this.onSuggestionClick(e),onRequestDelete:e=>this.onRemoveChip(e)}))}}var Ut=Object(r.c)((e=>({dhis2CoreVersion:e.messaging.dhis2CoreVersion})))(_t);const Nt={subheaderTitle:{height:"32px",color:"black",paddingLeft:0,paddingRight:16},subheader:(e,t)=>({height:"32px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:0,color:e,fontWeight:t})};var Dt=({showTitle:e,title:t,label:s,color:a,fontWeight:r})=>{const n=s&&"NONE"!==s?"Assignee"===t?s:"".concat(s.charAt(0)).concat(s.toLowerCase().substr(1,s.length)):"-";return i.a.createElement("div",{style:{flex:2,paddingLeft:10,maxWidth:200}},e&&i.a.createElement(Le.a,{style:Nt.subheaderTitle}," ",t," "),i.a.createElement(Le.a,{style:Nt.subheader(a,r)},n))};const Lt={canvas:{flex:"3 0",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)",paddingTop:"10px"},innerCanvas:{display:"flex",flexDirection:"column",margin:"0px 10px 0px 10px"},header:{display:"flex"},iconButton:{display:"flex",alignSelf:"center"},subjectSubheader:{display:"flex",alignSelf:"center",fontSize:"20px",fontFamily:Z},participantsCanvas:{display:"flex",flexDirection:"column"},participants:{paddingLeft:"12px",paddingTop:"10px",display:"flex",flexWrap:"wrap"},chip:{height:"32px",marginRight:"3px",marginBottom:"3px"},participantAddRow:{display:"flex"},participantsSuggestionField:{paddingLeft:"12px",marginBottom:"0px",flex:1},participantsAdd:{alignSelf:"flex-end",marginBottom:"28px",paddingLeft:"12px"},messagesCanvas:{marginBottom:"50px",display:"flex",flexDirection:"column",backgroundColor:g.palette.accent2Color,margin:"0px 10px 10px 10px"},messagesInnerCanvas:{padding:"0px"}};function Gt(){return(Gt=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function jt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Pt=["TICKET","VALIDATION_RESULT"];class Vt extends a.Component{constructor(e){super(e),jt(this,"backToList",(()=>{const{clearSelectedMessageConversation:e,messageConversation:t}=this.props;qe.push("/".concat(t.messageType)),e()})),jt(this,"addRecipients",(()=>{const e=this.state.recipients.filter((e=>"user"===e.type)),t=this.state.recipients.filter((e=>"userGroup"===e.type)),s=this.state.recipients.filter((e=>"organisationUnit"===e.type)),{messageConversation:a,selectedMessageType:i}=this.props;this.props.addRecipients({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i}),this.setState({recipients:[]})})),jt(this,"updateRecipients",(e=>{this.setState({recipients:e})})),this.state={recipients:[],cursor:"auto"}}render(){const{messageConversation:e,currentUser:t}=this.props,s=e.messages,a=!!(Pt.indexOf(e.messageType)+1),r=e.userMessages.slice(0,30).map((e=>!t.id||this.state.recipientsExpanded||t.id!==e.user.id?e.user.displayName:Ve.a.t("me"))),n=e.userMessages.length;return n>30&&r.push(" + ".concat(n-30)),i.a.createElement("div",{id:"messageconversation",style:Lt.canvas},i.a.createElement("div",{style:Lt.innerCanvas},i.a.createElement("div",{style:Lt.header},i.a.createElement($e.a,{style:Lt.iconButton,tooltipPosition:"bottom-right",onClick:this.backToList,tooltip:Ve.a.t("Show all messages")},i.a.createElement(ze.a,null)),i.a.createElement(Le.a,{style:Lt.subjectSubheader},e.subject),this.props.displayExtendedChoices&&i.a.createElement(Dt,{color:g.palette.darkGray,showTitle:!0,title:Ve.a.t("Status"),label:e.status}),this.props.displayExtendedChoices&&i.a.createElement(Dt,{color:g.palette.darkGray,showTitle:!0,title:Ve.a.t("Priority"),label:e.priority}),a&&i.a.createElement(Dt,{color:g.palette.darkGray,showTitle:!0,title:Ve.a.t("Assignee"),label:e.assignee?e.assignee.displayName:void 0})),i.a.createElement("div",{style:Lt.participantsCanvas},i.a.createElement(Le.a,{style:{paddingLeft:"12px",paddingTop:"10px"}},Ve.a.t("Participants")),i.a.createElement("div",{style:Lt.participants},r.map((e=>i.a.createElement(Ze.a,{key:e,style:Lt.chip},e))))),i.a.createElement("div",{style:Lt.participantAddRow},i.a.createElement(Ut,{style:Lt.participantsSuggestionField,label:Ve.a.t("Add participants to conversation"),messageConversation:e,recipients:this.state.recipients,updateRecipients:this.updateRecipients,limitSearchArray:e.userMessages}),i.a.createElement("div",{style:Lt.participantsAdd},i.a.createElement(Xe.a,{icon:i.a.createElement(He.a,null),onClick:()=>this.addRecipients(),label:Ve.a.t("Add")})))),i.a.createElement("div",{style:Lt.messagesCanvas},i.a.createElement(tt.a,{style:Lt.messagesInnerCanvas},s.map(((t,r)=>i.a.createElement(Ct,{key:t.id,displayTimeDiff:this.props.displayTimeDiff,message:t,messageConversation:e,notification:a,currentUser:this.state.currentUser,lastMessage:r+1===s.length,downloadAttachment:s=>this.props.downloadAttachment(e.id,t.id,s.id),cancelAttachment:this.props.cancelAttachment,enableAttachments:this.props.enableAttachments})))),i.a.createElement(Ft,Gt({},this.props,{messageConversation:e}))))}}var Wt=Object(r.c)((e=>({currentUser:e.messaging.currentUser,selectedMessageType:e.messaging.selectedMessageType,displayTimeDiff:e.messaging.displayTimeDiff,enableAttachments:re(e.messaging.dhis2CoreVersion)})),{addRecipients:({users:e,userGroups:t,organisationUnits:s,messageConversation:a,messageType:i})=>async r=>{try{const{id:n}=a;await me({users:e,userGroups:t,organisationUnits:s,messageConversationId:n}),r(Ce("ADD_RECIPIENTS_SUCCESS",{messageConversation:a,messageType:i,page:1})),r(ve(a))}catch(n){r(Ce("ADD_RECIPIENTS_ERROR",{error:n}))}},downloadAttachment:(e,t,s)=>a=>{((e,t,s)=>{const a=((...e)=>e.filter((e=>!!e)).map((e=>e.replace(/^\/+|\/+$/g,""))).join("/"))(pe.link.baseUrl,pe.link.apiPath,"messageConversations",e,t,"attachments",s),i=document.createElement("a");i.href=a,i.download=a.split("/").pop(),i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)})(e,t,s),a(Ce("DOWNLOAD_ATTACHMENT_SUCCESS"))},cancelAttachment:Re,clearSelectedMessageConversation:ke})(Vt),qt=s(300),Bt=s(313),Ht=s.n(Bt),Yt=s(261),zt=s.n(Yt),Kt=s(288),Xt=s.n(Kt);function Jt(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}class $t extends a.Component{constructor(e){super(e),Jt(this,"onClick",(()=>{this.props.onClick()})),Jt(this,"onMouseEnter",(()=>{this.setHoverText(),this.setState({cursor:"pointer"})})),Jt(this,"onMouseLeave",(()=>{this.setNeutralText(),this.setState({cursor:"auto"})})),Jt(this,"setNeutralText",(()=>this.setTextColor(g.palette.accent2Color))),Jt(this,"setHoverText",(()=>this.setTextColor(g.palette.accent3Color))),Jt(this,"setTextColor",(e=>{this.setState({backgroundColor:e})})),Jt(this,"getBackgroundColor",((e,t)=>e&&t===e.id?g.palette.accent3Color:this.state.backgroundColor)),this.state={backgroundColor:g.palette.accent2Color,textColor:g.palette.darkGray}}render(){return i.a.createElement("div",{role:"presentation",style:{...this.state,backgroundColor:this.getBackgroundColor(this.props.selectedMessageType,this.props.messageType.id),cursor:this.state.cursor,alignItems:"center",height:"49px",display:"flex",flexDirection:"row",justifyContent:"space-between"},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:()=>this.onClick()},i.a.createElement(Le.a,{style:{marginLeft:"5px",fontSize:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?"18px":"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?g.palette.primary1Color:this.state.textColor}},Ve.a.t(this.props.messageType.displayName)),this.props.loading?i.a.createElement(zt.a,{style:{marginRight:"10px"},color:g.palette.primary1Color,size:24}):this.props.messageType.unread>0&&i.a.createElement(Xt.a,{style:{marginTop:"12px",marginRight:"5px"},badgeContent:this.props.messageType.unread>100?"99+":this.props.messageType.unread,secondary:!0,badgeStyle:{backgroundColor:"#439E8E"}}))}}var Qt=$t;const Zt={canvas:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"calc(100vh - 95px)",borderLeftStyle:"solid",borderLeftWidth:"0.5px",borderLeftColor:g.palette.accent4Color,borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:g.palette.accent4Color,overflowY:"auto",overflowX:"hidden",minWidth:"200px"}};class es extends a.Component{constructor(e){super(e),this.props.setSelectedMessageType(this.props.match.params.messageType)}render(){const e=this.props.messageTypes;return i.a.createElement("div",{style:Zt.canvas},i.a.createElement(qt.List,{style:{padding:"0px"}},e&&e.map((e=>i.a.createElement("div",{key:e.id},i.a.createElement(Qt,{messageType:e,onClick:()=>{this.props.setSelectedMessageType(e.id),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),qe.push("/".concat(e.id))},selectedMessageType:this.props.selectedMessageType,loading:e.loading}),i.a.createElement(at.a,null))))),i.a.createElement(Ht.a,{style:{width:"",margin:"20px"},label:"".concat(Ve.a.t("Auto refresh")," (").concat(ye()(this.props.refreshTimer).format("mm:ss"),")"),toggled:this.props.autoRefresh,onToggle:()=>this.props.setAutoRefresh(!this.props.autoRefresh)}))}}var ts=Object(Ae.a)(Object(r.c)((e=>({selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes})),{setSelectedMessageType:Ie,clearCheckedIds:Se},null,{pure:!1}))(es);const ss={overflowY:"scroll",overflowX:"hidden",borderRightWidth:"1px",borderRightColor:g.palette.accent4Color,height:"calc(100vh - 95px)"},as={paddingLeft:"0px",fontSize:"20px"};var is=s(234),rs=s.n(is);const ns="16px",os={canvas:e=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",alignSelf:"center",boxShadow:"none",borderBottom:"1px solid #dfdfdf"}),checkBox:{flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:"12px"},sender:{fontFamily:Z,fontSize:ns,flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"black",paddingLeft:10,alignSelf:"center"},subject:{flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:Z,fontSize:ns,color:"black",paddingLeft:10},extendedLabel:{flex:2,color:"black",fontSize:ns,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 0 0 10px"}};class ls extends a.Component{constructor(e){super(e),this.state={cursor:"auto",allChecked:!1}}componentDidUpdate(){this.state.allChecked&&this.props.checkedIds.length<this.props.messages.length&&this.setState({allChecked:!1})}render(){const e=this.props.displayExtendedChoices;return i.a.createElement(tt.a,{style:os.canvas(g.palette.canvasColor)},i.a.createElement(rs.a,{checked:this.state.allChecked,style:os.checkBox,onCheck:()=>{this.state.allChecked?this.props.clearCheckedIds():this.props.setAllChecked(this.props.messages.map((e=>({id:e.id})))),this.setState({allChecked:!this.state.allChecked})}}),i.a.createElement("div",{style:os.sender},Ve.a.t("Sender")),i.a.createElement(Le.a,{style:os.subject},Ve.a.t("Subject")),e&&i.a.createElement(Le.a,{style:os.extendedLabel},Ve.a.t("Status")),e&&i.a.createElement(Le.a,{style:os.extendedLabel},Ve.a.t("Priority")),this.props.notification&&i.a.createElement(Le.a,{style:os.extendedLabel},Ve.a.t("Assignee")),i.a.createElement(Le.a,{style:os.extendedLabel},Ve.a.t("Date")))}}var cs=Object(Ae.a)(Object(r.c)((e=>({checkedIds:e.messaging.checkedIds,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup})),{setAllChecked:e=>Ce(U,{messageConversationIds:e}),clearCheckedIds:Se}))(ls),ps=s(599),ds=s.n(ps);function hs(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const gs={container:(e,t,s)=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",cursor:s,boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",boxShadow:"none",borderBottom:"1px solid #dfdfdf",flexWrap:t?"nowrap":"wrap"}),checkBox:e=>({flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:e?12:6}),flag:{color:g.palette.followUp,marginRight:4},sender:(e,t)=>({fontFamily:Z,fontSize:"14px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",color:"black",paddingLeft:e?10:0,fontWeight:t}),subject:(e,t,s)=>({flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingLeft:10,fontFamily:Z,color:t,fontWeight:s,order:e?"inherit":10,marginTop:e?0:-10,flexBasis:e?"0%":"100%"}),dateFormat:(e,t,s)=>({flex:2,fontFamily:Z,paddingLeft:e?10:0,paddingRight:e?0:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:e?"":"end",color:t,fontWeight:s})};class ms extends a.Component{constructor(e){super(e),hs(this,"onClick",(e=>{this.props.setSelectedMessageConversation(e),e&&!e.read&&this.props.markMessageConversations("read",[e.id],this.props.selectedMessageType),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),qe.push("/".concat(e.messageType,"/").concat(e.id))})),hs(this,"onMouseEnter",(()=>this.setState({cursor:"pointer",backgroundColor:g.palette.accent2Color}))),hs(this,"onMouseLeave",(()=>this.setState({cursor:"auto",backgroundColor:g.palette.canvasColor}))),hs(this,"getBackgroundColor",((e,t)=>{const s=this.props.selectedMessageConversation&&e.id===this.props.selectedMessageConversation.id;return t&&!s?g.palette.blue50:s?g.palette.accent3Color:this.state.backgroundColor})),this.state={backgroundColor:g.palette.canvasColor,cursor:"auto"}}render(){const e=this.props.messageConversation,t=e.lastSender?e.lastSender.displayName:this.props.selectedMessageType.displayName,s=!!this.props.checkedIds.find((t=>t.id===e.id)),a=this.props.displayExtendedChoices,r=this.props.displayTimeDiff,n=ye()(),o=ye()(e.lastMessage).add(r),l=e.read?"":"bold",c=this.props.messageConversation.read?"black":g.palette.darkGray,p=this.getBackgroundColor(e,s);return i.a.createElement(tt.a,{style:gs.container(p,this.props.wideview,this.state.cursor),onClick:t=>{void 0!==t.target.innerText&&""!==t.target.innerText&&!this.props.settingSelectedMessageConversation&&(this.onClick(e),this.props.checkedIds.length>0&&this.props.clearCheckedIds(),!this.props.wideview||void 0===this.props.messageFilter&&void 0===this.props.priorityFilter&&void 0===this.props.statusFilter||this.props.setFilter(void 0,"MESSAGE"))},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave},i.a.createElement(rs.a,{checked:s,style:gs.checkBox(this.props.wideview),onCheck:()=>{this.props.setChecked(e,!s)}}),i.a.createElement("div",{style:gs.sender(this.props.wideview,l)},e.followUp&&i.a.createElement(ds.a,{style:gs.flag}),i.a.createElement("span",null,t)),i.a.createElement(Le.a,{style:gs.subject(this.props.wideview,c,l)},e.subject),a&&i.a.createElement(Dt,{showTitle:!1,title:Ve.a.t("Status"),color:c,fontWeight:l,label:e.status}),a&&i.a.createElement(Dt,{showTitle:!1,title:Ve.a.t("Priority"),color:c,fontWeight:l,label:e.priority}),this.props.notification&&this.props.wideview&&i.a.createElement(Dt,{showTitle:!1,title:Ve.a.t("Assignee"),color:c,fontWeight:l,label:e.assignee?e.assignee.displayName:void 0}),i.a.createElement(Le.a,{style:gs.dateFormat(this.props.wideview,c,l)},n.diff(o,"hours")<72?o.from(n):n.year()===o.year()?o.format("MMM DD"):o.format("ll")))}}var us=Object(Ae.a)(Object(r.c)((e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,checkedIds:e.messaging.checkedIds,displayTimeDiff:e.messaging.displayTimeDiff,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,attachments:e.messaging.attachments})),{setChecked:(e,t)=>Ce(_,{messageConversation:e,selectedValue:t}),setSelectedMessageConversation:ve,markMessageConversations:fe,clearCheckedIds:Se,setFilter:Me,updateInputFields:xe,clearAttachments:we},null,{pure:!1}))(ms);function ys(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const Cs=["VALIDATION_RESULT","TICKET"],vs={canvas:e=>({flex:"1 0",maxWidth:e?"none":"350px",minWidth:e?"none":"250px",borderRightStyle:e?"":"solid",...ss}),loading:{backgroundColor:g.palette.accent2Color,height:"".concat(50,"px"),transition:"all 0.2s ease-in-out",display:"flex",justifyContent:"center"}};class Es extends a.Component{constructor(...e){super(...e),ys(this,"onScroll",(e=>{const t=document.getElementById("messagelist");!this.props.selectedMessageType.loading&&this.isBottom(t)&&e.loaded<e.total&&this.props.loadMessageConversations(e,e.id,!0)})),ys(this,"debouncedOnScroll",ie(this.onScroll,150)),ys(this,"isBottom",(e=>e.scrollHeight-e.scrollTop<window.outerHeight))}render(){const e=function(e){if(!Array.isArray(e))return;const t=new Set;return e.filter((e=>!t.has(e.id)&&(t.add(e.id),!0)))}(this.props.messageConversations[this.props.selectedMessageType.id]),t=this.props.selectedMessageType?this.props.selectedMessageType:"",s=this.props.selectedMessageConversation?this.props.selectedMessageConversation.id:"",a=!!(Cs.indexOf(t.id)+1);return i.a.createElement("div",{id:"messagelist",onScroll:()=>this.debouncedOnScroll(this.props.selectedMessageType),style:vs.canvas(this.props.wideview)},this.props.wideview&&i.a.createElement(cs,{notification:a,displayExtendedChoices:this.props.displayExtendedChoices,messages:e}),e&&0!==e.length?e.map((e=>i.a.createElement(us,{key:e.id,messageConversation:e,wideview:this.props.wideview,selectedValue:s,notification:a,displayExtendedChoices:this.props.displayExtendedChoices}))):!this.props.selectedMessageType.loading&&i.a.createElement(Le.a,null,Ve.a.t("No ".concat(t.displayName.toLowerCase()," messages"))),this.props.selectedMessageType.loading&&i.a.createElement("div",{style:vs.loading},i.a.createElement(zt.a,{style:{marginTop:"10px"},color:g.palette.primary1Color})))}}var fs=Object(Ae.a)(Object(r.c)((e=>({messageTypes:e.messaging.messageTypes,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,messageConversations:e.messaging.messageConversations,selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType})),{loadMessageConversations:Ee},null,{pure:!1}))(Es),Ts=s(302),Ss=s.n(Ts);function ks(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const bs={canvas:{flex:"3 0",margin:"10px",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)"},messageTypeField:{display:"flex",flexDirection:"row"},messageType:{width:"300px",marginTop:"10px"}};class Ms extends a.Component{constructor(e){super(e),ks(this,"subjectUpdate",((e,t)=>{this.props.updateInputFields(t,this.props.input,this.props.recipients)})),ks(this,"inputUpdate",((e,t)=>{this.props.updateInputFields(this.props.subject,t,this.props.recipients)})),ks(this,"updateRecipients",(e=>{this.props.updateInputFields(this.props.subject,this.props.input,e)})),ks(this,"sendMessage",(()=>{const e=this.state.isMessageFeedback?"TICKET":"PRIVATE",t=this.props.messageTypes.find((t=>t.id===e));if(this.state.isMessageFeedback)this.props.sendFeedbackMessage(t),qe.push("/TICKET");else{const e=this.props.recipients.filter((e=>"user"===e.type)),s=this.props.recipients.filter((e=>"userGroup"===e.type)),a=this.props.recipients.filter((e=>"organisationUnit"===e.type));this.props.sendMessage({users:e,userGroups:s,organisationUnits:a,messageType:t}),qe.push("/PRIVATE")}})),ks(this,"wipeInput",(()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments()})),ks(this,"handleDiscard",(()=>{const e=Ve.a.t("Message discarded");this.props.displaySnackMessage({message:e,onSnackActionClick:()=>qe.push("/PRIVATE/create"),onSnackRequestClose:()=>this.wipeInput(),snackType:"NEGATIVE"}),qe.push("/PRIVATE")})),this.state={isMessageFeedback:!1}}componentDidMount(){const{addRecipientByUserId:e}=this.props,{messageId:t,recipientId:s}=this.props.match.params;"create"===t&&s&&e(s)}render(){const e=""===this.props.subject||""===this.props.input||!this.state.isMessageFeedback&&0===this.props.recipients.length,t=""===this.props.subject&&""===this.props.input&&!this.state.isMessageFeedback&&0===this.props.recipients.length;return i.a.createElement("div",{style:bs.canvas},i.a.createElement(Le.a,{style:as}," ",Ve.a.t("Create")),i.a.createElement(vt.Card,null,i.a.createElement(vt.CardText,null,i.a.createElement(Ut,{style:{margin:"0px"},label:Ve.a.t("To"),disabled:this.state.isMessageFeedback,recipients:this.state.isMessageFeedback?[{id:"id",displayName:Ve.a.t("Feedback recipient group")}]:this.props.recipients,updateRecipients:this.updateRecipients,inputHeight:"100px"}),i.a.createElement("div",{style:bs.messageTypeField},i.a.createElement("div",{style:bs.messageType},i.a.createElement(Ss.a,{label:Ve.a.t("Private message"),checked:!this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}})),i.a.createElement("div",{style:bs.messageType},i.a.createElement(Ss.a,{label:Ve.a.t("Feedback message"),checked:this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}}))),i.a.createElement(St.a,{floatingLabelText:Ve.a.t("Subject"),fullWidth:!0,value:this.props.subject,onChange:this.subjectUpdate}),i.a.createElement(St.a,{key:"createMessage",id:"createMessage",rows:5,underlineShow:!1,value:this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:Ve.a.t("Message"),onChange:this.inputUpdate}),this.props.enableAttachments&&i.a.createElement(gt,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),i.a.createElement(vt.CardActions,{style:{paddingLeft:"0px"}},i.a.createElement(ft.a,{primary:!0,disabled:e,label:Ve.a.t("Send"),onClick:()=>this.sendMessage()}),i.a.createElement(Xe.a,{label:Ve.a.t("Discard"),disabled:t,onClick:this.handleDiscard}),this.props.enableAttachments&&i.a.createElement(xt,{addAttachment:e=>{this.props.addAttachment(e)}})))))}}var xs=Object(Ae.a)(Object(r.c)((e=>({messageTypes:e.messaging.messageTypes,subject:e.messaging.subject,input:e.messaging.input,recipients:e.messaging.recipients,attachments:e.messaging.attachments,enableAttachments:re(e.messaging.dhis2CoreVersion)})),{sendMessage:({users:e,userGroups:t,organisationUnits:s,messageType:a})=>async(i,r)=>{try{const{messaging:{subject:n,input:o,attachments:l}}=r();await(({subject:e,users:t,userGroups:s,organisationUnits:a,text:i,attachments:r})=>pe.mutate({resource:"messageConversations",type:"create",data:{subject:e,users:t,userGroups:s,organisationUnits:a,text:i,attachments:r}}))({subject:n,users:e,userGroups:t,organisationUnits:s,text:o,attachments:l}),i(Ce(I,{messageType:a,page:1})),i(Ee())}catch(n){i(Ce(F,{error:n}))}},sendFeedbackMessage:e=>async(t,s)=>{const a=s();try{await(i=a.messaging.subject,r=a.messaging.input,pe.mutate({resource:"messageConversations/feedback",type:"create",params:{subject:i},data:r})),t(Ce(I,{messageType:e,page:1})),t(Ee())}catch(n){t(Ce(F,{error:n}))}var i,r},displaySnackMessage:be,updateInputFields:xe,addAttachment:Te,removeAttachment:Fe,cancelAttachment:Re,addRecipientByUserId:e=>async t=>{try{const s=await(async e=>{const{user:t}=await pe.query({user:{resource:"users",id:e,params:{fields:"id,displayName"}}});return{...t,type:"user"}})(e);t(Ce(q,s))}catch(s){console.error(s)}}},null,{pure:!1}))(Ms),ws=s(606),Is=s.n(ws),Fs=s(605),Rs=s.n(Fs),As=s(305),Os=s.n(As),_s=s(231),Us=s.n(_s),Ns=s(243),Ds=s.n(Ns),Ls=s(262),Gs=s.n(Ls),js=s(359),Ps=s.n(js),Vs=s(386),Ws=s.n(Vs);var qs={STATUS:[{key:"NONE",value:"NONE",primaryText:Ve.a.t("No status")},{key:"OPEN",value:"OPEN",primaryText:Ve.a.t("Open")},{key:"PENDING",value:"PENDING",primaryText:Ve.a.t("Pending")},{key:"INVALID",value:"INVALID",primaryText:Ve.a.t("Invalid")},{key:"SOLVED",value:"SOLVED",primaryText:Ve.a.t("Solved")}],PRIORITY:[{key:"NONE",value:"NONE",primaryText:Ve.a.t("No priority")},{key:"HIGH",value:"HIGH",primaryText:Ve.a.t("High")},{key:"MEDIUM",value:"MEDIUM",primaryText:Ve.a.t("Medium")},{key:"LOW",value:"LOW",primaryText:Ve.a.t("Low")}]},Bs=s(600),Hs=s.n(Bs),Ys=s(604),zs=s.n(Ys),Ks=s(601),Xs=s.n(Ks),Js=s(602),$s=s.n(Js),Qs=s(603),Zs=s.n(Qs),ea=s(245),ta=s.n(ea);function sa(e){return i.a.createElement(r.b.Consumer,null,(t=>i.a.createElement(ta.a,e,i.a.createElement(r.a,{store:t.store},e.children))))}var aa=({open:e,onRequestClose:t,updateMessageConversations:s,messageType:a,feedbackRecipientsId:r})=>i.a.createElement(sa,{open:e,onRequestClose:()=>{t()}},i.a.createElement(Ut,{onSuggestionClick:e=>{s([e.id]),t()},searchOnlyUsers:!0,searchOnlyFeedbackRecipients:"TICKET"===a.id,feedbackRecipientsId:r,recipients:[],key:"suggestionField",label:Ve.a.t("Assignee")}));function ia(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ra={canvas:{width:"400px",display:"flex"},extendedChoices:{display:"flex",justifyContent:"flex-start"},nrSelected:{padding:"0px 0px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}};class na extends a.Component{constructor(e){super(e),ia(this,"getIds",(()=>this.props.selectedMessageConversation&&0===this.props.checkedIds.length?[this.props.selectedMessageConversation.id]:this.props.checkedIds.map((e=>e.id)))),ia(this,"updateMessageConversation",((e,t)=>{const{selectedMessageType:s,selectedMessageConversation:a}=this.props,i=this.getIds();this.props.updateMessageConversations({messageConversationIds:i,identifier:e,value:t,messageType:s,selectedMessageConversation:a}),this.props.checkedIds.length>0&&this.props.clearCheckedIds()})),ia(this,"markMessageConversations",(e=>{const t=this.getIds();this.props.markMessageConversations(e,t,this.props.selectedMessageType),this.props.checkedIds.length>0&&this.props.clearCheckedIds()})),ia(this,"toggleDialog",(()=>{this.setState({dialogOpen:!this.state.dialogOpen})})),this.state={checkedItems:!1,dialogOpen:!1,assignToOpen:!1}}render(){const e=this.props.selectedMessageConversation,t=this.props.checkedIds.length>0,s=t||void 0!==e,a=i.a.createElement(i.a.Fragment,null,i.a.createElement(Xe.a,{label:Ve.a.t("Cancel"),primary:!0,onClick:()=>this.toggleDialog()}),i.a.createElement(Xe.a,{label:Ve.a.t("Submit"),primary:!0,keyboardFocused:!0,onClick:()=>{this.props.deleteMessageConversations(this.getIds(),this.props.selectedMessageType),this.props.clearCheckedIds(),this.toggleDialog(),this.props.selectedMessageConversation&&(this.props.clearSelectedMessageConversation(),qe.push("/".concat(this.props.selectedMessageType.id)))}})),r=this.props.checkedIds.length>99?"".concat(99,"+"):this.props.checkedIds.length;return s?i.a.createElement("div",{style:ra.canvas},i.a.createElement(sa,{title:Ve.a.t("Are you sure you want to delete selected message conversation(s)?"),actions:a,modal:!1,open:this.state.dialogOpen,onRequestClose:this.toggleDialog}),i.a.createElement(aa,{open:this.state.assignToOpen,onRequestClose:()=>this.setState({assignToOpen:!this.state.assignToOpen}),updateMessageConversations:e=>this.updateMessageConversation("ASSIGNEE",e),messageType:this.props.selectedMessageType,feedbackRecipientsId:this.props.feedbackRecipientsId}),i.a.createElement("div",{style:ra.extendedChoices},i.a.createElement($e.a,{tooltip:Ve.a.t("Delete selected"),onClick:()=>{this.toggleDialog()}},i.a.createElement(Xs.a,null)),i.a.createElement($e.a,{tooltip:Ve.a.t("Mark selected as unread"),onClick:()=>{this.markMessageConversations("unread")}},i.a.createElement($s.a,null)),i.a.createElement($e.a,{tooltip:Ve.a.t("Mark selected as read"),onClick:()=>{this.markMessageConversations("read")}},i.a.createElement(Zs.a,null)),this.props.displayExtendedChoices&&i.a.createElement($e.a,{onClick:()=>this.setState({assignToOpen:!this.state.assignToOpen}),tooltip:Ve.a.t("Assign selected")},i.a.createElement(zs.a,null)),i.a.createElement(Gs.a,{iconButtonElement:i.a.createElement($e.a,null,i.a.createElement(Ws.a,null)),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"}},i.a.createElement(Us.a,{key:"markFollowUp",value:"markFollowUp",primaryText:Ve.a.t("Mark for followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!0)}),i.a.createElement(Us.a,{key:"clearFollowUp",value:"clearFollowUp",primaryText:Ve.a.t("Clear followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!1)}),this.props.displayExtendedChoices&&i.a.createElement(at.a,null),this.props.displayExtendedChoices&&i.a.createElement(Us.a,{key:"clearAssigned",value:"clearAssigned",primaryText:Ve.a.t("Clear assignee"),onClick:()=>this.updateMessageConversation("ASSIGNEE",void 0)}),this.props.displayExtendedChoices&&i.a.createElement(Us.a,{primaryText:Ve.a.t("Set status"),key:"setStatus",rightIcon:i.a.createElement(Hs.a,null),menuItems:qs.STATUS.map((e=>i.a.createElement(Us.a,{key:"".concat(e.key,"_status"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("STATUS",e.key)})))}),this.props.displayExtendedChoices&&i.a.createElement(Us.a,{primaryText:Ve.a.t("Set priority"),key:"setPriority",rightIcon:i.a.createElement(Hs.a,null),menuItems:qs.PRIORITY.map((e=>i.a.createElement(Us.a,{key:"".concat(e.key,"_priority"),value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("PRIORITY",e.key)})))}))),t&&i.a.createElement(Ds.a,{style:ra.nrSelected},"".concat(r," ").concat(Ve.a.t("selected")))):i.a.createElement("div",null)}}var oa=Object(Ae.a)(Object(r.c)((e=>({selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,checkedIds:e.messaging.checkedIds,feedbackRecipientsId:e.messaging.feedbackRecipientsId})),{clearCheckedIds:Se,clearSelectedMessageConversation:ke,deleteMessageConversations:(e,t)=>async(s,a)=>{try{const i=a(),{currentUser:r}=i.messaging,n=e.map((e=>((e,t)=>pe.mutate({resource:"messageConversations/".concat(e,"/").concat(t),type:"delete"}))(e,r.id)));await Promise.all(n),s(Ce(b,{messageType:t,page:1})),s(Ee())}catch(i){s(Ce(M,{error:i}))}},updateMessageConversations:({messageConversationIds:e,identifier:t,value:s,messageType:a,selectedMessageConversation:i})=>async r=>{if("FOLLOW_UP"===t)try{await((e,t)=>pe.mutate({resource:"messageConversations/".concat(t?"followup":"unfollowup"),type:"create",data:e}))(e,s),r(Ce(x,{messageType:a,page:1,identifier:t})),r(Ee())}catch(n){r(Ce(w,{error:n}))}else{const i=e.map((e=>{let i;switch(t){case"STATUS":i=((e,t)=>pe.mutate({resource:"messageConversations/".concat(e,"/status"),type:"create",params:{messageConversationStatus:t}}))(e,s);break;case"PRIORITY":i=((e,t)=>pe.mutate({resource:"messageConversations/".concat(e,"/priority"),type:"create",params:{messageConversationPriority:t}}))(e,s);break;case"ASSIGNEE":i=void 0!==s&&"VALIDATION_RESULT"===a.id?me({users:s.map((e=>({id:e}))),userGroups:[],organisationUnits:[],messageConversationId:e}).then((()=>he(e,s))):he(e,s);break;default:Q.a.error("Unexpected identifier for updateMessageConversations")}return i}));try{await Promise.all(i),r(Ce(x,{messageType:a,page:1,identifier:t})),r(Ee())}catch(n){r(Ce(w,{error:n}))}}i&&r(ve(i))},markMessageConversations:fe},null,{pure:!1}))(na);function la(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ca={canvas:e=>({display:"flex",justifyContent:"flex-start",alignItems:"center",backgroundColor:e?g.palette.blue50:g.palette.accent2Color,zIndex:10}),checkedOption:{display:"flex",justifyContent:"flex-start",minWidth:"200px",margin:"6px 0"},filterControl:{flex:2,height:"48px",marginRight:16,maxWidth:256},rightHandCanvas:{flex:"2 0",display:"flex",paddingLeft:16},ie11Spacer:{flexGrow:1},iconMenu:{width:"30px",display:"flex"}};class pa extends a.Component{constructor(...e){super(...e),la(this,"state",{lastMessageFilter:""}),la(this,"debouncedSearch",ie(this.search,300))}search(e){this.props.selectedMessageType&&this.state.lastMessageFilter!==e&&(this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id),this.setState({lastMessageFilter:e}))}componentDidUpdate(e){e.selectedMessageType&&this.props.selectedMessageType.id!==e.selectedMessageType.id&&(this.debouncedSearch(""),void 0!==this.props.messageFilter&&this.props.setFilter(void 0,"MESSAGE"),void 0!==this.props.statusFilter&&this.props.setFilter(void 0,"STATUS"),void 0!==this.props.priorityFilter&&this.props.setFilter(void 0,"PRIORITY"),this.props.assignedToMeFilter&&this.props.setFilter(!1,"ASSIGNED_TO_ME"),this.props.markedForFollowUpFilter&&this.props.setFilter(!1,"MARKED_FOR_FOLLOWUP"),this.props.unreadFilter&&this.props.setFilter(!1,"UNREAD")),void 0===this.props.selectedMessageType||this.props.selectedMessageType.loading||e.statusFilter===this.props.statusFilter&&e.priorityFilter===this.props.priorityFilter&&e.assignedToMeFilter===this.props.assignedToMeFilter&&e.markedForFollowUpFilter===this.props.markedForFollowUpFilter&&e.unreadFilter===this.props.unreadFilter&&void 0!==e.selectedMessageType&&e.selectedMessageType.id===this.props.selectedMessageType.id||this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id)}render(){const e=this.props.id,t=this.props.displayExtendedChoices,s=this.props.checkedOptions,a=!this.props.wideview||void 0===this.props.selectedMessageConversation&&"create"!==e;return i.a.createElement(tt.a,{style:ca.canvas(s)},i.a.createElement("div",null,!s&&i.a.createElement(Xe.a,{style:ca.checkedOption,icon:i.a.createElement(He.a,null),onClick:()=>qe.push("/PRIVATE/create"),label:Ve.a.t("Compose")}),s&&i.a.createElement(Xe.a,{style:ca.checkedOption,icon:i.a.createElement(ze.a,null),onClick:()=>this.props.clearCheckedIds(),label:Ve.a.t("Deselect all")})),i.a.createElement(oa,{displayExtendedChoices:t}),i.a.createElement("div",{style:ca.rightHandCanvas},i.a.createElement("div",{style:ca.ie11Spacer}),t&&a&&!s&&i.a.createElement(Os.a,{style:ca.filterControl,labelStyle:{color:void 0===this.props.statusFilter?"lightGray":"black",top:void 0===this.props.statusFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:g.palette.primary1Color},floatingLabelText:void 0===this.props.statusFilter?Ve.a.t("Status"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.statusFilter?"-15px":"0px"},value:this.props.statusFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"STATUS")}},i.a.createElement(Us.a,{key:null,value:null,primaryText:""}),qs.STATUS.map((e=>i.a.createElement(Us.a,{key:e.key,value:e.value,primaryText:e.primaryText})))),t&&a&&!s&&i.a.createElement(Os.a,{style:ca.filterControl,labelStyle:{color:void 0===this.props.priorityFilter?"lightGray":"black",top:void 0===this.props.priorityFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:g.palette.primary1Color},floatingLabelText:void 0===this.props.priorityFilter?Ve.a.t("Priority"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.priorityFilter?"-15px":"0px"},value:this.props.priorityFilter,onChange:(e,t,s)=>{this.props.setFilter(null===s?void 0:s,"PRIORITY")}},i.a.createElement(Us.a,{key:null,value:null,primaryText:""}),qs.PRIORITY.map((e=>i.a.createElement(Us.a,{key:e.key,value:e.value,primaryText:e.primaryText})))),!s&&a&&i.a.createElement(St.a,{style:ca.filterControl,fullWidth:!0,hintText:Ve.a.t("Search"),value:this.props.messageFilter||"",onChange:(e,t)=>{this.debouncedSearch(t),this.props.setFilter(t,"MESSAGE")},type:"search"}),!s&&a&&i.a.createElement(Gs.a,{iconButtonElement:i.a.createElement($e.a,null,i.a.createElement(Ws.a,null)),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},style:ca.iconMenu,menuStyle:{overflowX:"hidden"}},i.a.createElement(Ds.a,{style:{padding:"0px 16px"}},Ve.a.t("Set filter")),this.props.displayExtendedChoices&&i.a.createElement(Ps.a,{style:{padding:"0px 16px"},key:"assignedToMeFilter",label:Ve.a.t("Assigned to me"),checked:this.props.assignedToMeFilter,onClick:()=>{this.props.setFilter(!this.props.assignedToMeFilter,"ASSIGNED_TO_ME")}}),i.a.createElement(Ps.a,{style:{padding:"0px 16px"},key:"markedForFollowUpFilter",label:Ve.a.t("Marked for followup"),checked:this.props.markedForFollowUpFilter,onClick:()=>{this.props.setFilter(!this.props.markedForFollowUpFilter,"MARKED_FOR_FOLLOWUP")}}),i.a.createElement(Ps.a,{style:{padding:"0px 16px"},key:"unreadFilter",label:Ve.a.t("Unread messages"),checked:this.props.unreadFilter,onClick:()=>{this.props.setFilter(!this.props.unreadFilter,"UNREAD")}})),i.a.createElement(Xe.a,{style:{width:"50px",alignSelf:"center"},icon:this.props.wideview?i.a.createElement(Is.a,null):i.a.createElement(Rs.a,null),onClick:()=>this.props.toogleWideview()})))}}var da=pa;s(607);function ha(){return(ha=Object.assign||function(e){for(var t=1;t<arguments.length;t++){var s=arguments[t];for(var a in s)Object.prototype.hasOwnProperty.call(s,a)&&(e[a]=s[a])}return e}).apply(this,arguments)}function ga(e,t,s){return t in e?Object.defineProperty(e,t,{value:s,enumerable:!0,configurable:!0,writable:!0}):e[t]=s,e}const ma=["TICKET","VALIDATION_RESULT"],ua=3e5,ya=1e4;class Ca extends a.Component{constructor(e){super(e),ga(this,"setAutoRefresh",(e=>{!e&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),e&&(this.intervalId=setInterval(this.tick,ya)),this.setState({autoRefresh:e,refreshTimer:ua})})),ga(this,"tick",(()=>{this.state.refreshTimer-ya<=0?(this.refresh(),this.setState({refreshTimer:ua})):this.setState((e=>({refreshTimer:e.refreshTimer-ya})))})),ga(this,"refresh",(()=>{this.props.messageTypes.map((e=>this.props.loadMessageConversations(e,this.props.selectedMessageType))),this.props.selectedMessageConversation&&this.props.setSelectedMessageConversation(this.props.selectedMessageConversation)})),ga(this,"toogleWideview",(()=>{this.setState({wideview:!this.state.wideview})})),this.intervalId=null,this.state={autoRefresh:!1,checkedItems:!1,refreshTimer:ua,wideview:!0}}componentDidMount(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(t&&t!==e&&"create"!==t){const e={id:t};this.props.setSelectedMessageConversation(e)}(async e=>{const{configuration:{feedbackRecipients:t}}=await pe.query({configuration:{resource:"configuration"}});return{authorized:e.authorities.includes("ALL")||e.userGroups.some((({id:e})=>e===t.id)),feedbackRecipientsId:t.id}})(this.props.currentUser).then((e=>this.props.setIsInFeedbackRecipientGroup(e))),this.props.messageTypes.map((t=>this.props.loadMessageConversations(t,e))),this.props.setDisplayTimeDiff()}componentDidUpdate(){const e=this.props.match.params.messageType,t=this.props.match.params.messageId;if(!this.props.settingSelectedMessageConversation&&t&&e!==t&&"create"!==t&&(void 0===this.props.selectedMessageConversation||t!==this.props.selectedMessageConversation.id)){const e={id:t};this.props.setSelectedMessageConversation(e)}e===t&&e!==this.props.selectedMessageType.id&&this.props.setSelectedMessageType(e),e!==t&&"create"!==t||void 0===this.props.selectedMessageConversation||this.props.clearSelectedMessageConversation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId)}render(){const e=this.props.match.params.messageId,t=!!this.props.selectedMessageType&&!!(ma.indexOf(this.props.selectedMessageType.id)+1)&&this.props.isInFeedbackRecipientGroup;return i.a.createElement("div",{className:"messaging-center"},i.a.createElement(da,ha({},this.props,{id:e,wideview:this.state.wideview,displayExtendedChoices:t,toogleWideview:this.toogleWideview})),i.a.createElement("div",{className:"messaging-center__main-content"},i.a.createElement(ts,ha({},this.props,{drawerOpen:this.state.drawerOpen,messageTypes:this.props.messageTypes,autoRefresh:this.state.autoRefresh,refreshTimer:this.state.refreshTimer,setAutoRefresh:this.setAutoRefresh})),void 0===this.props.selectedMessageConversation&&!(this.state.wideview&&"create"===e)&&i.a.createElement(fs,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),"create"===e&&i.a.createElement(xs,ha({},this.props,{wideview:this.state.wideview})),void 0!==this.props.selectedMessageConversation&&!this.state.wideview&&i.a.createElement(fs,{wideview:this.state.wideview,displayExtendedChoices:t&&this.state.wideview}),this.props.selectedMessageConversation&&"create"!==e?void 0!==this.props.selectedMessageConversation&&i.a.createElement(Wt,ha({},this.props,{messageConversation:this.props.selectedMessageConversation,wideview:this.state.wideview,disableLink:!0,displayExtendedChoices:t})):!this.state.wideview&&"create"!==e&&i.a.createElement("div",{className:"messaging-center__no-message-selected"},i.a.createElement(Le.a,{style:as},Ve.a.t("Select a message")),i.a.createElement(je.a,{style:{color:g.palette.primary1Color,width:120,height:120}}))))}}var va=Object(Ae.a)(Object(r.c)((e=>({currentUser:e.messaging.currentUser,snackMessage:e.messaging.snackMessage,messageTypes:e.messaging.messageTypes,messageConversations:e.messaging.messageConversations,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,assignedToMeFilter:e.messaging.assignedToMeFilter,markedForFollowUpFilter:e.messaging.markedForFollowUpFilter,unreadFilter:e.messaging.unreadFilter,selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,checkedIds:e.messaging.checkedIds,checkedOptions:e.messaging.checkedIds.length>0,loaded:e.messaging.loaded,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments})),{loadMessageConversations:Ee,setIsInFeedbackRecipientGroup:e=>Ce(V,{isInFeedbackRecipientGroup:e}),clearCheckedIds:Se,setSelectedMessageConversation:ve,setSelectedMessageType:Ie,clearSelectedMessageConversation:ke,updateInputFields:xe,setFilter:Me,setDisplayTimeDiff:()=>async e=>{try{const t=await(async()=>{const{systemInfo:e}=await pe.query({systemInfo:{resource:"system/info"}});return e.serverDate})(),s=ye()().diff(ye()(t))-5e3;e(Ce(W,s))}catch(t){e(Ce("SET_DISPLAY_TIME_DIFF_ERROR",{error:t}))}},clearAttachments:we},null,{pure:!1}))(Ca);var Ea=()=>i.a.createElement(Ne.c,{history:qe},i.a.createElement("div",null,i.a.createElement(Ne.b,{exact:!0,path:"/",component:()=>i.a.createElement(Ne.a,{to:"/PRIVATE"})}),i.a.createElement(Ne.b,{path:"/:messageType/:messageId?/:recipientId?",component:va}))),fa=s(614),Ta=s.n(fa);var Sa=Object(r.c)((e=>({currentUser:e.messaging.currentUser})),{setCurrentUser:()=>async e=>{e(Ce(E));try{const{currentUser:t}=await pe.query({currentUser:{resource:"me",params:{fields:["id","authorities","userGroups[id]"]}}});e(Ce(f,t))}catch{e(Ce(T,"Could not load current user"))}},setDhis2CoreVersion:e=>Ce(J,e)})((({currentUser:e,setCurrentUser:t,setDhis2CoreVersion:s})=>{const{loading:r,error:n}=e,{serverVersion:o}=Object(l.c)();return Object(a.useEffect)((()=>{s(o.minor),t()}),[]),r?i.a.createElement("div",{className:Ta.a.center},i.a.createElement(y.a,{size:48})):n?i.a.createElement("div",{className:u()(Ta.a.center,Ta.a.error)},n):i.a.createElement("div",null,i.a.createElement(Ue,null),i.a.createElement(Ea,null))})),ka=s(319),ba=s(615);var Ma=[{id:"PRIVATE",displayName:"Inbox",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"VALIDATION_RESULT",displayName:"Validation",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"TICKET",displayName:"Ticket",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"SYSTEM",displayName:"System",unread:0,loaded:0,loading:!1,total:0,page:1}];const xa={currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null},messageConversations:{},messageTypes:Ma,selectedMessageType:void 0,selectedMessageConversation:void 0,settingSelectedMessageConversation:!1,checkedIds:[],messageFilter:void 0,statusFilter:void 0,priorityFilter:void 0,assignedToMeFilter:!1,markedForFollowUpFilter:!1,unreadFilter:!1,isInFeedbackRecipientGroup:!1,feedbackRecipientsId:void 0,displayTimeDiff:0,subject:"",input:"",recipients:[],attachments:[],snackMessage:"",onSnackActionClick:void 0,onSnackRequestClose:void 0,snackType:ee};var wa=function(e=xa,t){const s=e.messageTypes,a=e.attachments;switch(t.type){case E:return{...e,currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null}};case f:return{...e,currentUser:{loading:!1,error:null,id:t.payload.id,authorities:t.payload.authorities,userGroups:t.payload.userGroups}};case T:return{...e,currentUser:{loading:!1,error:t.payload,id:null,authorities:null,userGroups:null}};case W:return{...e,displayTimeDiff:t.payload};case k:{const a=s.find((e=>e.id===t.payload.messageType.id));a.loaded=t.payload.messageConversations.length,a.total=t.payload.pager.total,a.unread=t.payload.nrOfUnread,a.page=t.payload.pager.page,a.loading=!1,Ma.splice([ae(s,a.id)],1,a);const i=t.payload.selectedMessageType===a.id&&(t.payload.selectedMessageType===e.selectedMessageType||void 0===e.selectedMessageType);return{...e,messageTypes:Ma,messageConversations:{...e.messageConversations,[a.id]:t.payload.messageConversations},selectedMessageType:i?a:e.selectedMessageType}}case w:return{...e,snackMessage:t.payload.error.message,snackType:se};case x:{let s="";switch(t.payload.identifier){case"STATUS":s=Ve.a.t("Successfully updated status");break;case"PRIORITY":s=Ve.a.t("Successfully updated priority");break;case"ASSIGNEE":s=Ve.a.t("Successfully updated assignee");break;case"FOLLOW_UP":s=Ve.a.t("Successfully changed followup");break;default:Q.a.error("Unexpected identifier for updateMessageConversations success")}return{...e,snackMessage:s,snackType:te}}case F:case M:return{...e,snackMessage:t.payload.error.message,snackType:se};case b:return{...e,snackMessage:Ve.a.t("Successfully deleted message conversation(s)"),snackType:te};case A:return{...e,snackMessage:t.payload.message,snackType:t.payload.snackType,onSnackActionClick:t.payload.onSnackActionClick,onSnackRequestClose:t.payload.onSnackRequestClose};case O:return{...e,snackMessage:"",snackType:ee};case _:{const s=t.payload.messageConversation;let a=e.checkedIds;return t.payload.selectedValue?a.push(s):a=a.filter((e=>e.id!==s.id)),{...e,checkedIds:a}}case U:return{...e,checkedIds:t.payload.messageConversationIds};case N:return{...e,checkedIds:[]};case j:return{...e,selectedMessageConversation:t.payload.messageConversation,settingSelectedMessageConversation:!1};case G:return{...e,settingSelectedMessageConversation:!0};case L:return{...e,selectedMessageConversation:void 0};case D:return{...e,checkedIds:[],selectedMessageType:s.find((e=>e.id===t.payload.messageTypeId)),selectedMessageConversations:e.messageConversations[t.payload.messageTypeId],selectedMessageConversation:void 0};case P:return{...e,subject:t.payload.subject,input:t.payload.input,recipients:t.payload.recipients};case q:return{...e,recipients:[...e.recipients,t.payload]};case R:return{...e,messageFilter:"MESSAGE"===t.payload.filterType?t.payload.filter:e.messageFilter,statusFilter:"STATUS"===t.payload.filterType?t.payload.filter:e.statusFilter,priorityFilter:"PRIORITY"===t.payload.filterType?t.payload.filter:e.priorityFilter,assignedToMeFilter:"ASSIGNED_TO_ME"===t.payload.filterType?t.payload.filter:e.assignedToMeFilter,markedForFollowUpFilter:"MARKED_FOR_FOLLOWUP"===t.payload.filterType?t.payload.filter:e.markedForFollowUpFilter,unreadFilter:"UNREAD"===t.payload.filterType?t.payload.filter:e.unreadFilter};case S:{const s=t.payload.messageType;s.loading=!0,t.payload.loadMore&&s.page++,Ma[ae(Ma,s.id)]=s;const a=e.selectedMessageType;return a&&(a.loading=!0,t.payload.loadMore&&a.page++),{...e,messageTypes:Ma,selectedMessageType:a}}case V:return{...e,isInFeedbackRecipientGroup:t.payload.isInFeedbackRecipientGroup.authorized,feedbackRecipientsId:t.payload.isInFeedbackRecipientGroup.feedbackRecipientsId};case H:return{...e,attachments:e.attachments.map((e=>e.name===t.payload.name?{id:t.payload.id,name:e.name,contentLength:e.contentLength,loading:!1}:e))};case Y:return{...e,attachments:a.filter((e=>e.id!==t.payload.attachmentId)),snackMessage:t.payload.error.message,snackType:se};case B:return{...e,attachments:e.attachments.concat({name:t.payload.name,contentLength:t.payload.size,loading:!0})};case z:return{...e,attachments:a.filter((e=>e.id!==t.payload.attachmentId))};case X:return{...e,attachments:a.filter((e=>e.name!==t.payload.attachmentName))};case K:return{...e,attachments:[]};case J:return{...e,dhis2CoreVersion:t.payload};default:return e}};const Ia=[ba.a],Fa=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||ka.d,Ra=Object(ka.c)({messaging:wa});var Aa=Object(ka.e)(Ra,Fa(Object(ka.a)(...Ia)));s(616),s(31);t.default=()=>{const e=Object(l.d)();return pe=e,i.a.createElement(r.a,{store:Aa},i.a.createElement(o.a,{muiTheme:g},i.a.createElement(Sa,null)))}}}]);
//# sourceMappingURL=app.a1d9e138.chunk.js.map