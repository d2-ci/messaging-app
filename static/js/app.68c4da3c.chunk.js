(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{563:function(e,s,t){},583:function(e,s,t){},594:function(e,s,t){},601:function(e,s,t){e.exports={center:"App_center__1snml",error:"App_error__1usCm"}},603:function(e,s,t){},605:function(e,s,t){"use strict";t.r(s);var a=t(7),i=t(1),r=t(190),n=t(252),o=t.n(n),c=t(8),p=t(320),l=t.n(p),d=t(198),h=t(228),g=l()({palette:{negative:h.pinkA200,blue50:h.blue50,primary1Color:"#1D8BF1",primary2Color:h.blue100,primary3Color:h.blue300,primary4Color:h.blue500,accent1Color:h.grey50,accent2Color:h.grey100,accent3Color:h.grey300,accent4Color:h.grey500,followUp:h.orange500,darkGray:h.grey700,superDarkGray:h.grey900,textColor:h.darkBlack,alternateTextColor:h.white,canvasColor:h.white,borderColor:h.grey300,clockCircleColor:Object(d.fade)(h.darkBlack,.07),shadowColor:h.fullBlack}}),u=t(4),m=t.n(u),y=t(453),C=t(294),x=t.n(C);const b="SET_CURRENT_USER",v="SET_CURRENT_USER_SUCCESS",j="SET_CURRENT_USER_ERROR",T="LOAD_MESSAGE_CONVERSATIONS",S="MESSAGE_CONVERSATIONS_LOAD_SUCCESS",f="MESSAGE_CONVERSATIONS_DELETE_SUCCESS",O="MESSAGE_CONVERSATIONS_DELETE_ERROR",k="MESSAGE_CONVERSATION_UPDATE_SUCCESS",M="MESSAGE_CONVERSATION_UPDATE_ERROR",E="SEND_MESSAGE_SUCCESS",w="SEND_MESSAGE_ERROR",I="SET_FILTER",F="DISPLAY_SNACK_MESSAGE;",R="CLEAR_SNACK_MESSAGE",A="SET_CHECKED",U="SET_ALL_CHECKED",_="CLEAR_CHECKED",N="SET_SELECTED_MESSAGE_TYPE",D="CLEAR_SELECTED_MESSAGE_CONVERSATION",L="SET_SELECTED_MESSAGE_CONVERSATION",G="SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS",P="UPDATE_INPUT_FIELDS",V="SET_IN_FEEDBACK_RECIPIENT_GROUP",W="SET_DISPLAY_TIME_DIFF_SUCCESS",q="ADD_RECIPIENT_BY_ID_SUCCESS",B="ADD_ATTACHMENT",H="ADD_ATTACHMENT_SUCCESS",Y="ADD_ATTACHMENT_ERROR",z="REMOVE_ATTACHMENT",K="CLEAR_ATTACHMENTS",X="CANCEL_ATTACHMENT",J="SET_DHIS2_CORE_VERSION";var Q=t(367),Z=t.n(Q);const $="Roboto, Helvetica, Arial, sans-serif",ee="NEUTRAL",se="POSITIVE",te="NEGATIVE";function ae(e,s){const t=e.length;for(let a=0;a<t;a++)if(e[a].id===s)return a}function ie(e,s){let t=null;return function(){const a=this,i=arguments;clearTimeout(t),t=setTimeout((function(){e.apply(a,i)}),s)}}function re(e){return e>30}function ne(e){return{resource:"organisationUnits",params:{fields:["id","displayName"],pageSize:10,filter:["displayName:token:".concat(e),"users:gte:1"]}}}function oe(e){return{resource:"userGroups",params:{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e)]}}}const ce=["id","displayName","subject","messageType","lastSender[id, displayName]","assignee[id, displayName]","status","priority","lastUpdated","read","lastMessage","followUp"],pe=["*","assignee[id, displayName]","messages[*,sender[id,displayName]","attachments[id, name, contentLength]]","userMessages[user[id, displayName]]"];let le=null;const de=async({messageType:e,page:s,messageFilter:t,status:a,priority:i,assignedToMeFilter:r,markedForFollowUpFilter:n,unreadFilter:o,currentUser:c})=>{const p=["messageType:eq:".concat(e)];a&&p.push("status:eq:".concat(a)),i&&p.push("priority:eq:".concat(i)),n&&p.push("followUp:eq:true"),o&&p.push("read:eq:false"),r&&p.push("assignee.id:eq:".concat(c.id));const l={resource:"messageConversations",params:{filter:p,pageSize:35,page:s,fields:ce,order:"lastMessage:desc"}};t&&(l.params.queryString=t);const{messageConversations:d}=await le.query({messageConversations:l});return d},he=async(e,s)=>{const t=s?{resource:"messageConversations/".concat(e,"/assign"),type:"create",params:{userId:s}}:{resource:"messageConversations",id:"".concat(e,"/assign"),type:"delete"};return await le.mutate(t)},ge=async({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:a,dhis2CoreVersion:i})=>{const r=function({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:a,dhis2CoreVersion:i}){const r=function({searchValue:e,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:t,dhis2CoreVersion:a}){if(function(e){return e>34}(a))return{resource:s?"userLookup/feedbackRecipients":"userLookup",params:{query:e}};{const a=["displayName:token:".concat(e)];return s&&a.push("userGroups.id:eq:".concat(t)),{resouce:"users",params:{filter:a,pageSize:10}}}}({searchValue:e,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:a,dhis2CoreVersion:i});return s?{users:r}:{users:r,organisationUnits:ne(e),userGroups:oe(e)}}({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:a,dhis2CoreVersion:i}),n=await le.query(r);return{users:n.users.users,organisationUnits:n.organisationUnits&&n.organisationUnits.organisationUnits,userGroups:n.userGroups&&n.userGroups.userGroups}},ue=async({users:e,userGroups:s,organisationUnits:t,messageConversationId:a})=>await le.mutate({resource:"messageConversations/".concat(a,"/recipients"),type:"create",data:{users:e,userGroups:s,organisationUnits:t}});var me=t(11),ye=t.n(me);const Ce=(e,s)=>({type:e,payload:s}),xe=e=>async s=>{s(Ce(L));try{const t=await(async({id:e})=>{const{messageConversation:s}=await le.query({messageConversation:{resource:"messageConversations",id:e,params:{fields:pe}}});return s})(e);s(Ce(G,{messageConversation:t}))}catch(t){s(Ce("SET_SELECTED_MESSAGE_CONVERSATION_ERROR",{error:t}))}},be=(e,s,t=!1)=>async(a,i)=>{const r=[],n=i(),{messageFilter:o,statusFilter:c,priorityFilter:p,assignedToMeFilter:l,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}=n.messaging;e=e||n.messaging.selectedMessageType,s=s||n.messaging.selectedMessageType.id,a(Ce(T,{messageType:e,loadMore:t}));try{for(let s=1;s<=e.page;s++){const t=de({messageType:e.id,page:s,messageFilter:o,status:c,priority:p,assignedToMeFilter:l,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}).then((e=>({messageConversations:e.messageConversations,pager:e.pager})));r.push(t)}const t=await Promise.all(r),i=await(async e=>{const{messageConversations:s}=await le.query({messageConversations:{resource:"messageConversations",params:{fields:["read"],filter:["read:eq:false","messageType:eq:".concat(e)],pageSize:1}}});return s.pager.total})(e.id),n=t.reduce(((e,s)=>e.concat(s.messageConversations)),[]);a(Ce(S,{messageConversations:n,pager:t[t.length-1].pager,messageType:e,selectedMessageType:s,nrOfUnread:i}))}catch(u){a(Ce("MESSAGE_CONVERSATIONS_LOAD_ERROR",{error:u}))}},ve=(e,s,t)=>async a=>{try{await("read"===e?(async e=>await le.mutate({resource:"messageConversations/read",type:"create",data:e}))(s):(async e=>await le.mutate({resource:"messageConversations/unread",type:"create",data:e}))(s)),a(Ce("MARK_MESSAGE_CONVERSATIONS_SUCCESS",{messageType:t,page:1})),a(be())}catch(i){a(Ce("MARK_MESSAGE_CONVERSATIONS_ERROR",{error:i}))}},je=e=>async s=>{s(Ce(B,e));try{const t=await(async e=>await le.mutate({resource:"fileResources",type:"create",params:{domain:"MESSAGE_ATTACHMENT"},data:{file:e}}))(e);s(Ce(H,{id:t.response.fileResource.id,name:e.name,contentLength:t.response.fileResource.contentLength}))}catch(t){s(Ce(Y,{error:t}))}},Te=()=>Ce(_),Se=()=>Ce(D),fe=({message:e,onSnackActionClick:s,onSnackRequestClose:t,snackType:a})=>Ce(F,{message:e,onSnackActionClick:s,onSnackRequestClose:t,snackType:a}),Oe=(e,s)=>Ce(I,{filter:e,filterType:s}),ke=(e,s,t)=>Ce(P,{subject:e,input:s,recipients:t}),Me=()=>Ce(K),Ee=e=>Ce(N,{messageTypeId:e}),we=e=>Ce(z,{attachmentId:e}),Ie=e=>Ce(X,{attachmentName:e});var Fe=t(202);const Re={NEGATIVE:g.palette.negative,NEUTRAL:g.palette.primary1Color,POSITIVE:g.palette.alternateTextColor};class Ae extends i.Component{constructor(e){super(e),this.closeMessage=()=>{this.props.clearSnackMessage(),this.setState({show:!1}),this.props.onSnackRequestClose&&this.props.onSnackRequestClose()},this.state={show:!1}}componentDidUpdate(e,s){!s.show&&this.props.message&&this.setState({show:!0})}render(){return Object(a.jsx)(x.a,{open:""!==this.props.message&&this.state.show,message:this.props.message||"Missing snackbar message",autoHideDuration:4e3,onRequestClose:this.closeMessage,action:this.props.onSnackActionClick&&"undo",onActionClick:()=>{this.props.onSnackActionClick(),this.setState({show:!1})},contentStyle:{color:Re[this.props.type]},style:{pointerEvents:"none",whiteSpace:"nowrap"},bodyStyle:{pointerEvents:"initial",maxWidth:"none"}})}}var Ue=Object(Fe.a)(Object(r.c)((e=>({message:e.messaging.snackMessage,type:e.messaging.snackType,onSnackActionClick:e.messaging.onSnackActionClick,onSnackRequestClose:e.messaging.onSnackRequestClose})),{clearSnackMessage:()=>Ce(R)}),Fe.b)(Ae),_e=t(596),Ne=t(201),De=t.n(Ne),Le=t(595),Ge=t.n(Le),Pe=t(5),Ve=t.n(Pe),We=t(374),qe=Object(We.a)(),Be=t(372),He=t.n(Be),Ye=t(371),ze=t.n(Ye),Ke=t(194),Xe=t.n(Ke),Je=t(197),Qe=t.n(Je),Ze=t(247),$e=t.n(Ze),es=t(187),ss=t.n(es),ts=t(220),as=t.n(ts),is=t(246),rs=t.n(is),ns=t(286),os=t.n(ns),cs=t(569),ps=t.n(cs),ls=t(564),ds=t.n(ls);t(563);const hs=({dataDirection:e,attachment:s,removeAttachment:t,downloadAttachment:i,cancelAttachment:r})=>Object(a.jsx)(Xe.a,{className:"attachment__button",backgroundColor:g.palette.accent2Color,label:"".concat(s.name," (").concat(parseFloat(parseInt(s.contentLength,10)/1e6).toFixed(2)," MB)"),labelPosition:"after",onClick:()=>{"download"===e?i(s):s.loading?r(s.name):t(s)},icon:"download"===e?Object(a.jsx)(ds.a,{}):Object(a.jsx)(ps.a,{}),children:s.loading&&Object(a.jsx)(os.a,{className:"attachment__progress",mode:"indeterminate"})});var gs=({dataDirection:e,attachments:s,style:t,removeAttachment:i,downloadAttachment:r,cancelAttachment:n})=>Object(a.jsx)("div",{className:"attachment",style:{...t},children:s.map(((s,t)=>Object(a.jsx)(hs,{dataDirection:e,attachment:s,removeAttachment:i,downloadAttachment:r,cancelAttachment:n},"".concat(s.name,"-").concat(t))))}),us=t(570),ms=t.n(us);const ys={canvas:e=>({backgroundColor:e,padding:"16px 16px 16px 16px"}),innerCanvas:{margin:"",paddingBottom:"0px"},cardText:{padding:"16px 0px 16px 0px",fontFamily:$,whiteSpace:"pre-wrap",wordBreak:"break-word"},fromFormat:{fontFamily:$},datePlacement:{display:"flex",justifyContent:"flex-end",marginRight:"10px"},dateFormat:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:$}};var Cs=({displayTimeDiff:e,message:s,currentUser:t,lastMessage:i,downloadAttachment:r,cancelAttachment:n,enableAttachments:o})=>{const c=s.sender?t&&t.id===s.sender.id?"me":s.sender.displayName:"system",p=ye()(),l=ye()(s.created).add(e);return Object(a.jsxs)("div",{style:ys.canvas(g.palette.canvasColor),children:[Object(a.jsxs)("div",{style:ys.innerCanvas,children:[Object(a.jsx)("div",{style:ys.fromFormat,children:s.internal?Ve.a.t("Internal message from ".concat(c)):Ve.a.t("Message from ".concat(c))}),Object(a.jsx)("div",{placement:"bottom",style:ys.datePlacement,children:Object(a.jsx)("div",{style:ys.dateFormat,children:p.diff(l,"hours")<72?"".concat(l.from(p),", ").concat(l.format("HH:mm")):p.year()===l.year()?l.format("MMM DD, HH:mm"):l.format("MMM DD, YYYY HH:mm")})}),o&&Object(a.jsx)(gs,{dataDirection:"download",style:{paddingLeft:0},attachments:s.attachments,downloadAttachment:r,cancelAttachment:n}),Object(a.jsx)(rs.a,{style:ys.cardText,children:Object(a.jsx)(ms.a,{children:s.text})})]}),!i&&Object(a.jsx)(as.a,{})]})},xs=t(245),bs=t(250),vs=t.n(bs),js=t(199),Ts=t.n(js),Ss=t(584),fs=t.n(Ss);t(583);const Os=e=>s=>{const t=s.target.files;t.length>0&&e(t[0])};var ks=({addAttachment:e})=>Object(a.jsx)(Xe.a,{className:"attachment__upload-button",label:Ve.a.t("Upload attachment"),labelPosition:"after",containerElement:"label",icon:Object(a.jsx)(fs.a,{}),children:Object(a.jsx)("input",{className:"attachment__upload-button--input",type:"file",onChange:Os(e)})});class Ms extends i.Component{constructor(e){super(e),this.replyMessage=e=>{const{input:s,selectedMessageConversation:t,selectedMessageType:a}=this.props;this.props.replyMessage({message:s,internalReply:e,messageConversation:t,messageType:a}),this.wipeInput()},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),this.setState({inputError:!1})},this.texFieldUpdate=(e,s)=>{this.props.updateInputFields("",s,[])},this.handleDiscard=()=>{const e=Ve.a.t("Reply discarded");this.setState({discardState:!0}),this.props.displaySnackMessage({message:e,onSnackActionClick:()=>this.setState({discardState:!1}),onSnackRequestClose:()=>{this.setState({discardState:!1}),this.wipeInput()},snackType:"NEGATIVE"}),this.setState({expanded:!1})},this.state={discardState:!1}}componentWillUnmount(){this.wipeInput()}render(){return Object(a.jsx)(xs.Card,{style:{marginTop:"5px"},expanded:!0,children:Object(a.jsxs)(xs.CardText,{style:{padding:"0px 0px 0px 16px"},children:[Object(a.jsx)(Ts.a,{id:this.props.messageConversation.id,rows:5,underlineShow:!1,value:this.state.discardState?"":this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:Ve.a.t("Message"),onChange:this.texFieldUpdate},this.props.messageConversation.id),this.props.enableAttachments&&!this.state.discardState&&Object(a.jsx)(gs,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),Object(a.jsxs)(xs.CardActions,{style:{paddingLeft:"0px"},children:[Object(a.jsx)(vs.a,{primary:!0,label:Ve.a.t("Reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!1)}),this.props.isInFeedbackRecipientGroup&&"TICKET"===this.props.selectedMessageType.id&&Object(a.jsx)(Xe.a,{primary:!0,label:Ve.a.t("Internal reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!0)}),Object(a.jsx)(Xe.a,{label:Ve.a.t("Discard"),disabled:""===this.props.input||this.state.discardState,onClick:this.handleDiscard}),this.props.enableAttachments&&Object(a.jsx)(ks,{addAttachment:e=>{this.props.addAttachment(e)}}),")"]})]})})}}var Es=Object(Fe.a)(Object(r.c)((e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes,input:e.messaging.input,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments,enableAttachments:re(e.messaging.dhis2CoreVersion)})),{replyMessage:({message:e,internalReply:s,messageConversation:t,messageType:a})=>async(i,r)=>{try{const{id:n}=t,o=r().messaging.attachments.map((e=>e.id));await(async({message:e,internalReply:s,attachments:t,id:a})=>{const i={internal:s};return t.length>0&&(i.attachments=t),await le.mutate({resource:"messageConversations/".concat(a),type:"create",params:i,data:e})})({message:e,internalReply:s,attachments:o,id:n}),i(Ce("REPLY_MESSAGE_SUCCESS",{messageConversation:t,messageType:a,page:1})),i(be()),i(xe(t))}catch(n){i(Ce("REPLY_MESSAGE_ERROR",{error:n}))}},setSelectedMessageType:Ee,updateInputFields:ke,displaySnackMessage:fe,addAttachment:je,removeAttachment:we,cancelAttachment:Ie},null,{pure:!1}))(Ms),ws=t(585),Is=t.n(ws);class Fs extends i.Component{constructor(...e){super(...e),this.state={input:"",searchResult:[],searchOnlyUsers:this.props.searchOnlyUsers,searchOnlyFeedbackRecipients:this.props.searchOnlyFeedbackRecipients,lastSearch:"",errorText:void 0},this.debouncedSearch=ie(this.search.bind(this),300),this.onSuggestionClick=e=>{if(void 0!==this.props.onSuggestionClick)this.props.onSuggestionClick(e);else{this.wipeInput(),this.debouncedSearch("");!this.props.recipients.find((s=>s.id===e.id))&&this.props.updateRecipients([...this.props.recipients,this.state.searchResult.find((s=>s.id===e.id))])}},this.onRemoveChip=e=>{this.props.updateRecipients(this.props.recipients.filter((s=>s.id!==e)))},this.wipeInput=()=>{this.setState({input:"",searchResult:[]})},this.updateInput=e=>{this.debouncedSearch(e),this.setState({input:e})}}search(e){if(!this.state.searchResult.find((s=>s.displayName===e))&&""!==e&&e.length>=2){const{feedbackRecipientsId:s,searchOnlyUsers:t,searchOnlyFeedbackRecipients:a,dhis2CoreVersion:i}=this.props;ge({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:a,feedbackRecipientsId:s,dhis2CoreVersion:i}).then((({users:e,userGroups:s,organisationUnits:t})=>{const a=e=>s=>({...s,type:e});let i=e.map(a("user"));this.state.searchOnlyUsers||(i=i.concat(s.map(a("userGroup"))).concat(t.map(a("organisationUnit")))),this.setState({searchResult:i,errorText:0===i.length?Ve.a.t("No results found"):void 0})}))}else this.setState({lastSearch:e,searchResult:""!==this.state.lastSearch&&""===e||e.length<2?[]:this.state.searchResult,errorText:""!==e&&e.length<2?Ve.a.t("Please enter at least ".concat(2," characters")):this.state.searchWarning})}render(){return Object(a.jsx)("div",{style:{...this.props.style,height:this.props.inputHeight},children:Object(a.jsx)(Is.a,{style:{marginBottom:16},disabled:void 0!==this.props.disabled&&this.props.disabled,errorText:this.props.errorText||this.state.errorText,value:this.props.recipients,fullWidth:!0,openOnFocus:!0,searchText:this.state.input,floatingLabelText:this.props.label,dataSource:this.state.searchResult,dataSourceConfig:{text:"displayName",value:"id"},onUpdateInput:this.updateInput,onRequestAdd:e=>this.onSuggestionClick(e),onRequestDelete:e=>this.onRemoveChip(e)})})}}var Rs=Object(r.c)((e=>({dhis2CoreVersion:e.messaging.dhis2CoreVersion})))(Fs);const As={subheaderTitle:{height:"32px",color:"black",paddingLeft:0,paddingRight:16},subheader:(e,s)=>({height:"32px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:0,color:e,fontWeight:s})};var Us=({showTitle:e,title:s,label:t,color:i,fontWeight:r})=>{const n=t&&"NONE"!==t?"Assignee"===s?t:"".concat(t.charAt(0)).concat(t.toLowerCase().substr(1,t.length)):"-";return Object(a.jsxs)("div",{style:{flex:2,paddingLeft:10,maxWidth:200},children:[e&&Object(a.jsxs)(De.a,{style:As.subheaderTitle,children:[" ",s," "]}),Object(a.jsx)(De.a,{style:As.subheader(i,r),children:n})]})};const _s={canvas:{flex:"3 0",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)",paddingTop:"10px"},innerCanvas:{display:"flex",flexDirection:"column",margin:"0px 10px 0px 10px"},header:{display:"flex"},iconButton:{display:"flex",alignSelf:"center"},subjectSubheader:{display:"flex",alignSelf:"center",fontSize:"20px",fontFamily:$},participantsCanvas:{display:"flex",flexDirection:"column"},participants:{paddingLeft:"12px",paddingTop:"10px",display:"flex",flexWrap:"wrap"},chip:{height:"32px",marginRight:"3px",marginBottom:"3px"},participantAddRow:{display:"flex"},participantsSuggestionField:{paddingLeft:"12px",marginBottom:"0px",flex:1},participantsAdd:{alignSelf:"flex-end",marginBottom:"28px",paddingLeft:"12px"},messagesCanvas:{marginBottom:"50px",display:"flex",flexDirection:"column",backgroundColor:g.palette.accent2Color,margin:"0px 10px 10px 10px"},messagesInnerCanvas:{padding:"0px"}};const Ns=["TICKET","VALIDATION_RESULT"];class Ds extends i.Component{constructor(e){super(e),this.backToList=()=>{const{clearSelectedMessageConversation:e,messageConversation:s}=this.props;qe.push("/".concat(s.messageType)),e()},this.addRecipients=()=>{const e=this.state.recipients.filter((e=>"user"===e.type)),s=this.state.recipients.filter((e=>"userGroup"===e.type)),t=this.state.recipients.filter((e=>"organisationUnit"===e.type)),{messageConversation:a,selectedMessageType:i}=this.props;this.props.addRecipients({users:e,userGroups:s,organisationUnits:t,messageConversation:a,messageType:i}),this.setState({recipients:[]})},this.updateRecipients=e=>{this.setState({recipients:e})},this.state={recipients:[],cursor:"auto"}}render(){const{messageConversation:e,currentUser:s}=this.props,t=e.messages,i=!!(Ns.indexOf(e.messageType)+1),r=e.userMessages.slice(0,30).map((e=>!s.id||this.state.recipientsExpanded||s.id!==e.user.id?e.user.displayName:Ve.a.t("me"))),n=e.userMessages.length;return n>30&&r.push(" + ".concat(n-30)),Object(a.jsxs)("div",{id:"messageconversation",style:_s.canvas,children:[Object(a.jsxs)("div",{style:_s.innerCanvas,children:[Object(a.jsxs)("div",{style:_s.header,children:[Object(a.jsx)(Qe.a,{style:_s.iconButton,tooltipPosition:"bottom-right",onClick:this.backToList,tooltip:Ve.a.t("Show all messages"),children:Object(a.jsx)(ze.a,{})}),Object(a.jsx)(De.a,{style:_s.subjectSubheader,children:e.subject}),this.props.displayExtendedChoices&&Object(a.jsx)(Us,{color:g.palette.darkGray,showTitle:!0,title:Ve.a.t("Status"),label:e.status}),this.props.displayExtendedChoices&&Object(a.jsx)(Us,{color:g.palette.darkGray,showTitle:!0,title:Ve.a.t("Priority"),label:e.priority}),i&&Object(a.jsx)(Us,{color:g.palette.darkGray,showTitle:!0,title:Ve.a.t("Assignee"),label:e.assignee?e.assignee.displayName:void 0})]}),Object(a.jsxs)("div",{style:_s.participantsCanvas,children:[Object(a.jsx)(De.a,{style:{paddingLeft:"12px",paddingTop:"10px"},children:Ve.a.t("Participants")}),Object(a.jsx)("div",{style:_s.participants,children:r.map((e=>Object(a.jsx)($e.a,{style:_s.chip,children:e},e)))})]}),Object(a.jsxs)("div",{style:_s.participantAddRow,children:[Object(a.jsx)(Rs,{style:_s.participantsSuggestionField,label:Ve.a.t("Add participants to conversation"),messageConversation:e,recipients:this.state.recipients,updateRecipients:this.updateRecipients,limitSearchArray:e.userMessages}),Object(a.jsx)("div",{style:_s.participantsAdd,children:Object(a.jsx)(Xe.a,{icon:Object(a.jsx)(He.a,{}),onClick:()=>this.addRecipients(),label:Ve.a.t("Add")})})]})]}),Object(a.jsxs)("div",{style:_s.messagesCanvas,children:[Object(a.jsx)(ss.a,{style:_s.messagesInnerCanvas,children:t.map(((s,r)=>Object(a.jsx)(Cs,{displayTimeDiff:this.props.displayTimeDiff,message:s,messageConversation:e,notification:i,currentUser:this.state.currentUser,lastMessage:r+1===t.length,downloadAttachment:t=>this.props.downloadAttachment(e.id,s.id,t.id),cancelAttachment:this.props.cancelAttachment,enableAttachments:this.props.enableAttachments},s.id)))}),Object(a.jsx)(Es,{...this.props,messageConversation:e})]})]})}}var Ls=Object(r.c)((e=>({currentUser:e.messaging.currentUser,selectedMessageType:e.messaging.selectedMessageType,displayTimeDiff:e.messaging.displayTimeDiff,enableAttachments:re(e.messaging.dhis2CoreVersion)})),{addRecipients:({users:e,userGroups:s,organisationUnits:t,messageConversation:a,messageType:i})=>async r=>{try{const{id:n}=a;await ue({users:e,userGroups:s,organisationUnits:t,messageConversationId:n}),r(Ce("ADD_RECIPIENTS_SUCCESS",{messageConversation:a,messageType:i,page:1})),r(xe(a))}catch(n){r(Ce("ADD_RECIPIENTS_ERROR",{error:n}))}},downloadAttachment:(e,s,t)=>a=>{((e,s,t)=>{const a=[le.link.baseUrl,le.link.apiPath,"messageConversations",e,s,"attachments",t].join("/"),i=document.createElement("a");i.href=a,i.download=a.split("/").pop(),i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)})(e,s,t),a(Ce("DOWNLOAD_ATTACHMENT_SUCCESS"))},cancelAttachment:Ie,clearSelectedMessageConversation:Se})(Ds),Gs=t(287),Ps=t(300),Vs=t.n(Ps),Ws=t(248),qs=t.n(Ws),Bs=t(275),Hs=t.n(Bs);class Ys extends i.Component{constructor(e){super(e),this.onClick=()=>{this.props.onClick()},this.onMouseEnter=()=>{this.setHoverText(),this.setState({cursor:"pointer"})},this.onMouseLeave=()=>{this.setNeutralText(),this.setState({cursor:"auto"})},this.setNeutralText=()=>this.setTextColor(g.palette.accent2Color),this.setHoverText=()=>this.setTextColor(g.palette.accent3Color),this.setTextColor=e=>{this.setState({backgroundColor:e})},this.getBackgroundColor=(e,s)=>e&&s===e.id?g.palette.accent3Color:this.state.backgroundColor,this.state={backgroundColor:g.palette.accent2Color,textColor:g.palette.darkGray}}render(){return Object(a.jsxs)("div",{role:"presentation",style:{...this.state,backgroundColor:this.getBackgroundColor(this.props.selectedMessageType,this.props.messageType.id),cursor:this.state.cursor,alignItems:"center",height:"49px",display:"flex",flexDirection:"row",justifyContent:"space-between"},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:()=>this.onClick(),children:[Object(a.jsx)(De.a,{style:{marginLeft:"5px",fontSize:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?"18px":"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?g.palette.primary1Color:this.state.textColor},children:Ve.a.t(this.props.messageType.displayName)}),this.props.loading?Object(a.jsx)(qs.a,{style:{marginRight:"10px"},color:g.palette.primary1Color,size:24}):this.props.messageType.unread>0&&Object(a.jsx)(Hs.a,{style:{marginTop:"12px",marginRight:"5px"},badgeContent:this.props.messageType.unread>100?"99+":this.props.messageType.unread,secondary:!0,badgeStyle:{backgroundColor:"#439E8E"}})]})}}var zs=Ys;const Ks={canvas:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"calc(100vh - 95px)",borderLeftStyle:"solid",borderLeftWidth:"0.5px",borderLeftColor:g.palette.accent4Color,borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:g.palette.accent4Color,overflowY:"auto",overflowX:"hidden",minWidth:"200px"}};class Xs extends i.Component{constructor(e){super(e),this.props.setSelectedMessageType(this.props.match.params.messageType)}render(){const e=this.props.messageTypes;return Object(a.jsxs)("div",{style:Ks.canvas,children:[Object(a.jsx)(Gs.List,{style:{padding:"0px"},children:e&&e.map((e=>Object(a.jsxs)("div",{children:[Object(a.jsx)(zs,{messageType:e,onClick:()=>{this.props.setSelectedMessageType(e.id),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),qe.push("/".concat(e.id))},selectedMessageType:this.props.selectedMessageType,loading:e.loading}),Object(a.jsx)(as.a,{})]},e.id)))}),Object(a.jsx)(Vs.a,{style:{width:"",margin:"20px"},label:"".concat(Ve.a.t("Auto refresh")," (").concat(ye()(this.props.refreshTimer).format("mm:ss"),")"),toggled:this.props.autoRefresh,onToggle:()=>this.props.setAutoRefresh(!this.props.autoRefresh)})]})}}var Js=Object(Fe.a)(Object(r.c)((e=>({selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes})),{setSelectedMessageType:Ee,clearCheckedIds:Te},null,{pure:!1}))(Xs);const Qs={overflowY:"scroll",overflowX:"hidden",borderRightWidth:"1px",borderRightColor:g.palette.accent4Color,height:"calc(100vh - 95px)"},Zs={paddingLeft:"0px",fontSize:"20px"};var $s=t(221),et=t.n($s);const st="16px",tt={canvas:e=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",alignSelf:"center",boxShadow:"none",borderBottom:"1px solid #dfdfdf"}),checkBox:{flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:"12px"},sender:{fontFamily:$,fontSize:st,flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"black",paddingLeft:10,alignSelf:"center"},subject:{flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:$,fontSize:st,color:"black",paddingLeft:10},extendedLabel:{flex:2,color:"black",fontSize:st,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 0 0 10px"}};class at extends i.Component{constructor(e){super(e),this.state={cursor:"auto",allChecked:!1}}componentDidUpdate(){this.state.allChecked&&this.props.checkedIds.length<this.props.messages.length&&this.setState({allChecked:!1})}render(){const e=this.props.displayExtendedChoices;return Object(a.jsxs)(ss.a,{style:tt.canvas(g.palette.canvasColor),children:[Object(a.jsx)(et.a,{checked:this.state.allChecked,style:tt.checkBox,onCheck:()=>{this.state.allChecked?this.props.clearCheckedIds():this.props.setAllChecked(this.props.messages.map((e=>({id:e.id})))),this.setState({allChecked:!this.state.allChecked})}}),Object(a.jsx)("div",{style:tt.sender,children:Ve.a.t("Sender")}),Object(a.jsx)(De.a,{style:tt.subject,children:Ve.a.t("Subject")}),e&&Object(a.jsx)(De.a,{style:tt.extendedLabel,children:Ve.a.t("Status")}),e&&Object(a.jsx)(De.a,{style:tt.extendedLabel,children:Ve.a.t("Priority")}),this.props.notification&&Object(a.jsx)(De.a,{style:tt.extendedLabel,children:Ve.a.t("Assignee")}),Object(a.jsx)(De.a,{style:tt.extendedLabel,children:Ve.a.t("Date")})]})}}var it=Object(Fe.a)(Object(r.c)((e=>({checkedIds:e.messaging.checkedIds,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup})),{setAllChecked:e=>Ce(U,{messageConversationIds:e}),clearCheckedIds:Te}))(at),rt=t(586),nt=t.n(rt);const ot={container:(e,s,t)=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",cursor:t,boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",boxShadow:"none",borderBottom:"1px solid #dfdfdf",flexWrap:s?"nowrap":"wrap"}),checkBox:e=>({flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:e?12:6}),flag:{color:g.palette.followUp,marginRight:4},sender:(e,s)=>({fontFamily:$,fontSize:"14px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",color:"black",paddingLeft:e?10:0,fontWeight:s}),subject:(e,s,t)=>({flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingLeft:10,fontFamily:$,color:s,fontWeight:t,order:e?"inherit":10,marginTop:e?0:-10,flexBasis:e?"0%":"100%"}),dateFormat:(e,s,t)=>({flex:2,fontFamily:$,paddingLeft:e?10:0,paddingRight:e?0:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:e?"":"end",color:s,fontWeight:t})};class ct extends i.Component{constructor(e){super(e),this.onClick=e=>{this.props.setSelectedMessageConversation(e),e&&!e.read&&this.props.markMessageConversations("read",[e.id],this.props.selectedMessageType),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),qe.push("/".concat(e.messageType,"/").concat(e.id))},this.onMouseEnter=()=>this.setState({cursor:"pointer",backgroundColor:g.palette.accent2Color}),this.onMouseLeave=()=>this.setState({cursor:"auto",backgroundColor:g.palette.canvasColor}),this.getBackgroundColor=(e,s)=>{const t=this.props.selectedMessageConversation&&e.id===this.props.selectedMessageConversation.id;return s&&!t?g.palette.blue50:t?g.palette.accent3Color:this.state.backgroundColor},this.state={backgroundColor:g.palette.canvasColor,cursor:"auto"}}render(){const e=this.props.messageConversation,s=e.lastSender?e.lastSender.displayName:this.props.selectedMessageType.displayName,t=!!this.props.checkedIds.find((s=>s.id===e.id)),i=this.props.displayExtendedChoices,r=this.props.displayTimeDiff,n=ye()(),o=ye()(e.lastMessage).add(r),c=e.read?"":"bold",p=this.props.messageConversation.read?"black":g.palette.darkGray,l=this.getBackgroundColor(e,t);return Object(a.jsxs)(ss.a,{style:ot.container(l,this.props.wideview,this.state.cursor),onClick:s=>{void 0!==s.target.innerText&&""!==s.target.innerText&&!this.props.settingSelectedMessageConversation&&(this.onClick(e),this.props.checkedIds.length>0&&this.props.clearCheckedIds(),!this.props.wideview||void 0===this.props.messageFilter&&void 0===this.props.priorityFilter&&void 0===this.props.statusFilter||this.props.setFilter(void 0,"MESSAGE"))},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[Object(a.jsx)(et.a,{checked:t,style:ot.checkBox(this.props.wideview),onCheck:()=>{this.props.setChecked(e,!t)}}),Object(a.jsxs)("div",{style:ot.sender(this.props.wideview,c),children:[e.followUp&&Object(a.jsx)(nt.a,{style:ot.flag}),Object(a.jsx)("span",{children:s})]}),Object(a.jsx)(De.a,{style:ot.subject(this.props.wideview,p,c),children:e.subject}),i&&Object(a.jsx)(Us,{showTitle:!1,title:Ve.a.t("Status"),color:p,fontWeight:c,label:e.status}),i&&Object(a.jsx)(Us,{showTitle:!1,title:Ve.a.t("Priority"),color:p,fontWeight:c,label:e.priority}),this.props.notification&&this.props.wideview&&Object(a.jsx)(Us,{showTitle:!1,title:Ve.a.t("Assignee"),color:p,fontWeight:c,label:e.assignee?e.assignee.displayName:void 0}),Object(a.jsx)(De.a,{style:ot.dateFormat(this.props.wideview,p,c),children:n.diff(o,"hours")<72?o.from(n):n.year()===o.year()?o.format("MMM DD"):o.format("ll")})]})}}var pt=Object(Fe.a)(Object(r.c)((e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,checkedIds:e.messaging.checkedIds,displayTimeDiff:e.messaging.displayTimeDiff,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,attachments:e.messaging.attachments})),{setChecked:(e,s)=>Ce(A,{messageConversation:e,selectedValue:s}),setSelectedMessageConversation:xe,markMessageConversations:ve,clearCheckedIds:Te,setFilter:Oe,updateInputFields:ke,clearAttachments:Me},null,{pure:!1}))(ct);const lt=["VALIDATION_RESULT","TICKET"],dt={canvas:e=>({flex:"1 0",maxWidth:e?"none":"350px",minWidth:e?"none":"250px",borderRightStyle:e?"":"solid",...Qs}),loading:{backgroundColor:g.palette.accent2Color,height:"".concat(50,"px"),transition:"all 0.2s ease-in-out",display:"flex",justifyContent:"center"}};class ht extends i.Component{constructor(...e){super(...e),this.onScroll=e=>{const s=document.getElementById("messagelist");!this.props.selectedMessageType.loading&&this.isBottom(s)&&e.loaded<e.total&&this.props.loadMessageConversations(e,e.id,!0)},this.debouncedOnScroll=ie(this.onScroll,150),this.isBottom=e=>e.scrollHeight-e.scrollTop<window.outerHeight}render(){const e=function(e){if(!Array.isArray(e))return;const s=new Set;return e.filter((e=>!s.has(e.id)&&(s.add(e.id),!0)))}(this.props.messageConversations[this.props.selectedMessageType.id]),s=this.props.selectedMessageType?this.props.selectedMessageType:"",t=this.props.selectedMessageConversation?this.props.selectedMessageConversation.id:"",i=!!(lt.indexOf(s.id)+1);return Object(a.jsxs)("div",{id:"messagelist",onScroll:()=>this.debouncedOnScroll(this.props.selectedMessageType),style:dt.canvas(this.props.wideview),children:[this.props.wideview&&Object(a.jsx)(it,{notification:i,displayExtendedChoices:this.props.displayExtendedChoices,messages:e}),e&&0!==e.length?e.map((e=>Object(a.jsx)(pt,{messageConversation:e,wideview:this.props.wideview,selectedValue:t,notification:i,displayExtendedChoices:this.props.displayExtendedChoices},e.id))):!this.props.selectedMessageType.loading&&Object(a.jsx)(De.a,{children:Ve.a.t("No ".concat(s.displayName.toLowerCase()," messages"))}),this.props.selectedMessageType.loading&&Object(a.jsx)("div",{style:dt.loading,children:Object(a.jsx)(qs.a,{style:{marginTop:"10px"},color:g.palette.primary1Color})})]})}}var gt=Object(Fe.a)(Object(r.c)((e=>({messageTypes:e.messaging.messageTypes,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,messageConversations:e.messaging.messageConversations,selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType})),{loadMessageConversations:be},null,{pure:!1}))(ht),ut=t(289),mt=t.n(ut);const yt={canvas:{flex:"3 0",margin:"10px",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)"},messageTypeField:{display:"flex",flexDirection:"row"},messageType:{width:"300px",marginTop:"10px"}};class Ct extends i.Component{constructor(e){super(e),this.subjectUpdate=(e,s)=>{this.props.updateInputFields(s,this.props.input,this.props.recipients)},this.inputUpdate=(e,s)=>{this.props.updateInputFields(this.props.subject,s,this.props.recipients)},this.updateRecipients=e=>{this.props.updateInputFields(this.props.subject,this.props.input,e)},this.sendMessage=()=>{const e=this.state.isMessageFeedback?"TICKET":"PRIVATE",s=this.props.messageTypes.find((s=>s.id===e));if(this.state.isMessageFeedback)this.props.sendFeedbackMessage(s),qe.push("/TICKET");else{const e=this.props.recipients.filter((e=>"user"===e.type)),t=this.props.recipients.filter((e=>"userGroup"===e.type)),a=this.props.recipients.filter((e=>"organisationUnit"===e.type));this.props.sendMessage({users:e,userGroups:t,organisationUnits:a,messageType:s}),qe.push("/PRIVATE")}},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments()},this.handleDiscard=()=>{const e=Ve.a.t("Message discarded");this.props.displaySnackMessage({message:e,onSnackActionClick:()=>qe.push("/PRIVATE/create"),onSnackRequestClose:()=>this.wipeInput(),snackType:"NEGATIVE"}),qe.push("/PRIVATE")},this.state={isMessageFeedback:!1}}componentDidMount(){const{addRecipientByUserId:e}=this.props,{messageId:s,recipientId:t}=this.props.match.params;"create"===s&&t&&e(t)}render(){const e=""===this.props.subject||""===this.props.input||!this.state.isMessageFeedback&&0===this.props.recipients.length,s=""===this.props.subject&&""===this.props.input&&!this.state.isMessageFeedback&&0===this.props.recipients.length;return Object(a.jsxs)("div",{style:yt.canvas,children:[Object(a.jsxs)(De.a,{style:Zs,children:[" ",Ve.a.t("Create")]}),Object(a.jsx)(xs.Card,{children:Object(a.jsxs)(xs.CardText,{children:[Object(a.jsx)(Rs,{style:{margin:"0px"},label:Ve.a.t("To"),disabled:this.state.isMessageFeedback,recipients:this.state.isMessageFeedback?[{id:"id",displayName:Ve.a.t("Feedback recipient group")}]:this.props.recipients,updateRecipients:this.updateRecipients,inputHeight:"100px"}),Object(a.jsxs)("div",{style:yt.messageTypeField,children:[Object(a.jsx)("div",{style:yt.messageType,children:Object(a.jsx)(mt.a,{label:Ve.a.t("Private message"),checked:!this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}})}),Object(a.jsx)("div",{style:yt.messageType,children:Object(a.jsx)(mt.a,{label:Ve.a.t("Feedback message"),checked:this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}})})]}),Object(a.jsx)(Ts.a,{floatingLabelText:Ve.a.t("Subject"),fullWidth:!0,value:this.props.subject,onChange:this.subjectUpdate}),Object(a.jsx)(Ts.a,{id:"createMessage",rows:5,underlineShow:!1,value:this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:Ve.a.t("Message"),onChange:this.inputUpdate},"createMessage"),this.props.enableAttachments&&Object(a.jsx)(gs,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),Object(a.jsxs)(xs.CardActions,{style:{paddingLeft:"0px"},children:[Object(a.jsx)(vs.a,{primary:!0,disabled:e,label:Ve.a.t("Send"),onClick:()=>this.sendMessage()}),Object(a.jsx)(Xe.a,{label:Ve.a.t("Discard"),disabled:s,onClick:this.handleDiscard}),this.props.enableAttachments&&Object(a.jsx)(ks,{addAttachment:e=>{this.props.addAttachment(e)}})]})]})})]})}}var xt=Object(Fe.a)(Object(r.c)((e=>({messageTypes:e.messaging.messageTypes,subject:e.messaging.subject,input:e.messaging.input,recipients:e.messaging.recipients,attachments:e.messaging.attachments,enableAttachments:re(e.messaging.dhis2CoreVersion)})),{sendMessage:({users:e,userGroups:s,organisationUnits:t,messageType:a})=>async(i,r)=>{try{const{messaging:{subject:n,input:o,attachments:c}}=r();await(async({subject:e,users:s,userGroups:t,organisationUnits:a,text:i,attachments:r})=>await le.mutate({resource:"messageConversations",type:"create",data:{subject:e,users:s,userGroups:t,organisationUnits:a,text:i,attachments:r}}))({subject:n,users:e,userGroups:s,organisationUnits:t,text:o,attachments:c}),i(Ce(E,{messageType:a,page:1})),i(be())}catch(n){i(Ce(w,{error:n}))}},sendFeedbackMessage:e=>async(s,t)=>{const a=t();try{await(async(e,s)=>await le.mutate({resource:"messageConversations/feedback",type:"create",params:{subject:e},data:s}))(a.messaging.subject,a.messaging.input),s(Ce(E,{messageType:e,page:1})),s(be())}catch(i){s(Ce(w,{error:i}))}},displaySnackMessage:fe,updateInputFields:ke,addAttachment:je,removeAttachment:we,cancelAttachment:Ie,addRecipientByUserId:e=>async s=>{try{const t=await(async e=>{const{user:s}=await le.query({user:{resource:"users",id:e,params:{fields:"id,displayName"}}});return{...s,type:"user"}})(e);s(Ce(q,t))}catch(t){console.error(t)}}},null,{pure:!1}))(Ct),bt=t(593),vt=t.n(bt),jt=t(592),Tt=t.n(jt),St=t(292),ft=t.n(St),Ot=t(218),kt=t.n(Ot),Mt=t(230),Et=t.n(Mt),wt=t(249),It=t.n(wt),Ft=t(346),Rt=t.n(Ft),At=t(373),Ut=t.n(At);var _t={STATUS:[{key:"NONE",value:"NONE",primaryText:Ve.a.t("No status")},{key:"OPEN",value:"OPEN",primaryText:Ve.a.t("Open")},{key:"PENDING",value:"PENDING",primaryText:Ve.a.t("Pending")},{key:"INVALID",value:"INVALID",primaryText:Ve.a.t("Invalid")},{key:"SOLVED",value:"SOLVED",primaryText:Ve.a.t("Solved")}],PRIORITY:[{key:"NONE",value:"NONE",primaryText:Ve.a.t("No priority")},{key:"HIGH",value:"HIGH",primaryText:Ve.a.t("High")},{key:"MEDIUM",value:"MEDIUM",primaryText:Ve.a.t("Medium")},{key:"LOW",value:"LOW",primaryText:Ve.a.t("Low")}]},Nt=t(587),Dt=t.n(Nt),Lt=t(591),Gt=t.n(Lt),Pt=t(588),Vt=t.n(Pt),Wt=t(589),qt=t.n(Wt),Bt=t(590),Ht=t.n(Bt),Yt=t(232),zt=t.n(Yt);function Kt(e){return Object(a.jsx)(r.b.Consumer,{children:s=>Object(a.jsx)(zt.a,{...e,children:Object(a.jsx)(r.a,{store:s.store,children:e.children})})})}var Xt=({open:e,onRequestClose:s,updateMessageConversations:t,messageType:i,feedbackRecipientsId:r})=>Object(a.jsx)(Kt,{open:e,onRequestClose:()=>{s()},children:Object(a.jsx)(Rs,{onSuggestionClick:e=>{t([e.id]),s()},searchOnlyUsers:!0,searchOnlyFeedbackRecipients:"TICKET"===i.id,feedbackRecipientsId:r,recipients:[],label:Ve.a.t("Assignee")},"suggestionField")});const Jt={canvas:{width:"400px",display:"flex"},extendedChoices:{display:"flex",justifyContent:"flex-start"},nrSelected:{padding:"0px 0px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}};class Qt extends i.Component{constructor(e){super(e),this.getIds=()=>this.props.selectedMessageConversation&&0===this.props.checkedIds.length?[this.props.selectedMessageConversation.id]:this.props.checkedIds.map((e=>e.id)),this.updateMessageConversation=(e,s)=>{const{selectedMessageType:t,selectedMessageConversation:a}=this.props,i=this.getIds();this.props.updateMessageConversations({messageConversationIds:i,identifier:e,value:s,messageType:t,selectedMessageConversation:a}),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.markMessageConversations=e=>{const s=this.getIds();this.props.markMessageConversations(e,s,this.props.selectedMessageType),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.toggleDialog=()=>{this.setState({dialogOpen:!this.state.dialogOpen})},this.state={checkedItems:!1,dialogOpen:!1,assignToOpen:!1}}render(){const e=this.props.selectedMessageConversation,s=this.props.checkedIds.length>0,t=s||void 0!==e,i=Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(Xe.a,{label:Ve.a.t("Cancel"),primary:!0,onClick:()=>this.toggleDialog()}),Object(a.jsx)(Xe.a,{label:Ve.a.t("Submit"),primary:!0,keyboardFocused:!0,onClick:()=>{this.props.deleteMessageConversations(this.getIds(),this.props.selectedMessageType),this.props.clearCheckedIds(),this.toggleDialog(),this.props.selectedMessageConversation&&(this.props.clearSelectedMessageConversation(),qe.push("/".concat(this.props.selectedMessageType.id)))}})]}),r=this.props.checkedIds.length>99?"".concat(99,"+"):this.props.checkedIds.length;return t?Object(a.jsxs)("div",{style:Jt.canvas,children:[Object(a.jsx)(Kt,{title:Ve.a.t("Are you sure you want to delete selected message conversation(s)?"),actions:i,modal:!1,open:this.state.dialogOpen,onRequestClose:this.toggleDialog}),Object(a.jsx)(Xt,{open:this.state.assignToOpen,onRequestClose:()=>this.setState({assignToOpen:!this.state.assignToOpen}),updateMessageConversations:e=>this.updateMessageConversation("ASSIGNEE",e),messageType:this.props.selectedMessageType,feedbackRecipientsId:this.props.feedbackRecipientsId}),Object(a.jsxs)("div",{style:Jt.extendedChoices,children:[Object(a.jsx)(Qe.a,{tooltip:Ve.a.t("Delete selected"),onClick:()=>{this.toggleDialog()},children:Object(a.jsx)(Vt.a,{})}),Object(a.jsx)(Qe.a,{tooltip:Ve.a.t("Mark selected as unread"),onClick:()=>{this.markMessageConversations("unread")},children:Object(a.jsx)(qt.a,{})}),Object(a.jsx)(Qe.a,{tooltip:Ve.a.t("Mark selected as read"),onClick:()=>{this.markMessageConversations("read")},children:Object(a.jsx)(Ht.a,{})}),this.props.displayExtendedChoices&&Object(a.jsx)(Qe.a,{onClick:()=>this.setState({assignToOpen:!this.state.assignToOpen}),tooltip:Ve.a.t("Assign selected"),children:Object(a.jsx)(Gt.a,{})}),Object(a.jsxs)(It.a,{iconButtonElement:Object(a.jsx)(Qe.a,{children:Object(a.jsx)(Ut.a,{})}),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"},children:[Object(a.jsx)(kt.a,{value:"markFollowUp",primaryText:Ve.a.t("Mark for followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!0)},"markFollowUp"),Object(a.jsx)(kt.a,{value:"clearFollowUp",primaryText:Ve.a.t("Clear followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!1)},"clearFollowUp"),this.props.displayExtendedChoices&&Object(a.jsx)(as.a,{}),this.props.displayExtendedChoices&&Object(a.jsx)(kt.a,{value:"clearAssigned",primaryText:Ve.a.t("Clear assignee"),onClick:()=>this.updateMessageConversation("ASSIGNEE",void 0)},"clearAssigned"),this.props.displayExtendedChoices&&Object(a.jsx)(kt.a,{primaryText:Ve.a.t("Set status"),rightIcon:Object(a.jsx)(Dt.a,{}),menuItems:_t.STATUS.map((e=>Object(a.jsx)(kt.a,{value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("STATUS",e.key)},"".concat(e.key,"_status"))))},"setStatus"),this.props.displayExtendedChoices&&Object(a.jsx)(kt.a,{primaryText:Ve.a.t("Set priority"),rightIcon:Object(a.jsx)(Dt.a,{}),menuItems:_t.PRIORITY.map((e=>Object(a.jsx)(kt.a,{value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("PRIORITY",e.key)},"".concat(e.key,"_priority"))))},"setPriority")]})]}),s&&Object(a.jsx)(Et.a,{style:Jt.nrSelected,children:"".concat(r," ").concat(Ve.a.t("selected"))})]}):Object(a.jsx)("div",{})}}var Zt=Object(Fe.a)(Object(r.c)((e=>({selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,checkedIds:e.messaging.checkedIds,feedbackRecipientsId:e.messaging.feedbackRecipientsId})),{clearCheckedIds:Te,clearSelectedMessageConversation:Se,deleteMessageConversations:(e,s)=>async(t,a)=>{try{const i=a(),{currentUser:r}=i.messaging,n=e.map((e=>(async(e,s)=>await le.mutate({resource:"messageConversations/".concat(e,"/").concat(s),type:"delete"}))(e,r.id)));await Promise.all(n),t(Ce(f,{messageType:s,page:1})),t(be())}catch(i){t(Ce(O,{error:i}))}},updateMessageConversations:({messageConversationIds:e,identifier:s,value:t,messageType:a,selectedMessageConversation:i})=>async r=>{if("FOLLOW_UP"===s)try{await(async(e,s)=>await le.mutate({resource:"messageConversations/".concat(s?"followup":"unfollowup"),type:"create",data:e}))(e,t),r(Ce(k,{messageType:a,page:1,identifier:s})),r(be())}catch(n){r(Ce(M,{error:n}))}else{const i=e.map((e=>{let i;switch(s){case"STATUS":i=(async(e,s)=>await le.mutate({resource:"messageConversations/".concat(e,"/status"),type:"create",params:{messageConversationStatus:s}}))(e,t);break;case"PRIORITY":i=(async(e,s)=>await le.mutate({resource:"messageConversations/".concat(e,"/priority"),type:"create",params:{messageConversationPriority:s}}))(e,t);break;case"ASSIGNEE":i=void 0!==t&&"VALIDATION_RESULT"===a.id?ue({users:t.map((e=>({id:e}))),userGroups:[],organisationUnits:[],messageConversationId:e}).then((()=>he(e,t))):he(e,t);break;default:Z.a.error("Unexpected identifier for updateMessageConversations")}return i}));try{await Promise.all(i),r(Ce(k,{messageType:a,page:1,identifier:s})),r(be())}catch(n){r(Ce(M,{error:n}))}}i&&r(xe(i))},markMessageConversations:ve},null,{pure:!1}))(Qt);const $t={canvas:e=>({display:"flex",justifyContent:"flex-start",alignItems:"center",backgroundColor:e?g.palette.blue50:g.palette.accent2Color,zIndex:10}),checkedOption:{display:"flex",justifyContent:"flex-start",minWidth:"200px",margin:"6px 0"},filterControl:{flex:2,height:"48px",marginRight:16,maxWidth:256},rightHandCanvas:{flex:"2 0",display:"flex",paddingLeft:16},ie11Spacer:{flexGrow:1},iconMenu:{width:"30px",display:"flex"}};class ea extends i.Component{constructor(...e){super(...e),this.state={lastMessageFilter:""},this.debouncedSearch=ie(this.search,300)}search(e){this.props.selectedMessageType&&this.state.lastMessageFilter!==e&&(this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id),this.setState({lastMessageFilter:e}))}componentDidUpdate(e){e.selectedMessageType&&this.props.selectedMessageType.id!==e.selectedMessageType.id&&(this.debouncedSearch(""),void 0!==this.props.messageFilter&&this.props.setFilter(void 0,"MESSAGE"),void 0!==this.props.statusFilter&&this.props.setFilter(void 0,"STATUS"),void 0!==this.props.priorityFilter&&this.props.setFilter(void 0,"PRIORITY"),this.props.assignedToMeFilter&&this.props.setFilter(!1,"ASSIGNED_TO_ME"),this.props.markedForFollowUpFilter&&this.props.setFilter(!1,"MARKED_FOR_FOLLOWUP"),this.props.unreadFilter&&this.props.setFilter(!1,"UNREAD")),void 0===this.props.selectedMessageType||this.props.selectedMessageType.loading||e.statusFilter===this.props.statusFilter&&e.priorityFilter===this.props.priorityFilter&&e.assignedToMeFilter===this.props.assignedToMeFilter&&e.markedForFollowUpFilter===this.props.markedForFollowUpFilter&&e.unreadFilter===this.props.unreadFilter&&void 0!==e.selectedMessageType&&e.selectedMessageType.id===this.props.selectedMessageType.id||this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id)}render(){const e=this.props.id,s=this.props.displayExtendedChoices,t=this.props.checkedOptions,i=!this.props.wideview||void 0===this.props.selectedMessageConversation&&"create"!==e;return Object(a.jsxs)(ss.a,{style:$t.canvas(t),children:[Object(a.jsxs)("div",{children:[!t&&Object(a.jsx)(Xe.a,{style:$t.checkedOption,icon:Object(a.jsx)(He.a,{}),onClick:()=>qe.push("/PRIVATE/create"),label:Ve.a.t("Compose")}),t&&Object(a.jsx)(Xe.a,{style:$t.checkedOption,icon:Object(a.jsx)(ze.a,{}),onClick:()=>this.props.clearCheckedIds(),label:Ve.a.t("Deselect all")})]}),Object(a.jsx)(Zt,{displayExtendedChoices:s}),Object(a.jsxs)("div",{style:$t.rightHandCanvas,children:[Object(a.jsx)("div",{style:$t.ie11Spacer}),s&&i&&!t&&Object(a.jsxs)(ft.a,{style:$t.filterControl,labelStyle:{color:void 0===this.props.statusFilter?"lightGray":"black",top:void 0===this.props.statusFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:g.palette.primary1Color},floatingLabelText:void 0===this.props.statusFilter?Ve.a.t("Status"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.statusFilter?"-15px":"0px"},value:this.props.statusFilter,onChange:(e,s,t)=>{this.props.setFilter(null===t?void 0:t,"STATUS")},children:[Object(a.jsx)(kt.a,{value:null,primaryText:""},null),_t.STATUS.map((e=>Object(a.jsx)(kt.a,{value:e.value,primaryText:e.primaryText},e.key)))]}),s&&i&&!t&&Object(a.jsxs)(ft.a,{style:$t.filterControl,labelStyle:{color:void 0===this.props.priorityFilter?"lightGray":"black",top:void 0===this.props.priorityFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:g.palette.primary1Color},floatingLabelText:void 0===this.props.priorityFilter?Ve.a.t("Priority"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.priorityFilter?"-15px":"0px"},value:this.props.priorityFilter,onChange:(e,s,t)=>{this.props.setFilter(null===t?void 0:t,"PRIORITY")},children:[Object(a.jsx)(kt.a,{value:null,primaryText:""},null),_t.PRIORITY.map((e=>Object(a.jsx)(kt.a,{value:e.value,primaryText:e.primaryText},e.key)))]}),!t&&i&&Object(a.jsx)(Ts.a,{style:$t.filterControl,fullWidth:!0,hintText:Ve.a.t("Search"),value:this.props.messageFilter||"",onChange:(e,s)=>{this.debouncedSearch(s),this.props.setFilter(s,"MESSAGE")},type:"search"}),!t&&i&&Object(a.jsxs)(It.a,{iconButtonElement:Object(a.jsx)(Qe.a,{children:Object(a.jsx)(Ut.a,{})}),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},style:$t.iconMenu,menuStyle:{overflowX:"hidden"},children:[Object(a.jsx)(Et.a,{style:{padding:"0px 16px"},children:Ve.a.t("Set filter")}),this.props.displayExtendedChoices&&Object(a.jsx)(Rt.a,{style:{padding:"0px 16px"},label:Ve.a.t("Assigned to me"),checked:this.props.assignedToMeFilter,onClick:()=>{this.props.setFilter(!this.props.assignedToMeFilter,"ASSIGNED_TO_ME")}},"assignedToMeFilter"),Object(a.jsx)(Rt.a,{style:{padding:"0px 16px"},label:Ve.a.t("Marked for followup"),checked:this.props.markedForFollowUpFilter,onClick:()=>{this.props.setFilter(!this.props.markedForFollowUpFilter,"MARKED_FOR_FOLLOWUP")}},"markedForFollowUpFilter"),Object(a.jsx)(Rt.a,{style:{padding:"0px 16px"},label:Ve.a.t("Unread messages"),checked:this.props.unreadFilter,onClick:()=>{this.props.setFilter(!this.props.unreadFilter,"UNREAD")}},"unreadFilter")]}),Object(a.jsx)(Xe.a,{style:{width:"50px",alignSelf:"center"},icon:this.props.wideview?Object(a.jsx)(vt.a,{}):Object(a.jsx)(Tt.a,{}),onClick:()=>this.props.toogleWideview()})]})]})}}var sa=ea;t(594);const ta=["TICKET","VALIDATION_RESULT"],aa=3e5,ia=1e4;class ra extends i.Component{constructor(e){super(e),this.setAutoRefresh=e=>{!e&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),e&&(this.intervalId=setInterval(this.tick,ia)),this.setState({autoRefresh:e,refreshTimer:aa})},this.tick=()=>{this.state.refreshTimer-ia<=0?(this.refresh(),this.setState({refreshTimer:aa})):this.setState((e=>({refreshTimer:e.refreshTimer-ia})))},this.refresh=()=>{this.props.messageTypes.map((e=>this.props.loadMessageConversations(e,this.props.selectedMessageType))),this.props.selectedMessageConversation&&this.props.setSelectedMessageConversation(this.props.selectedMessageConversation)},this.toogleWideview=()=>{this.setState({wideview:!this.state.wideview})},this.intervalId=null,this.state={autoRefresh:!1,checkedItems:!1,refreshTimer:aa,wideview:!0}}componentDidMount(){const e=this.props.match.params.messageType,s=this.props.match.params.messageId;if(s&&s!==e&&"create"!==s){const e={id:s};this.props.setSelectedMessageConversation(e)}(async e=>{const{configuration:{feedbackRecipients:s}}=await le.query({configuration:{resource:"configuration"}});return{authorized:e.authorities.includes("ALL")||e.userGroups.some((({id:e})=>e===s.id)),feedbackRecipientsId:s.id}})(this.props.currentUser).then((e=>this.props.setIsInFeedbackRecipientGroup(e))),this.props.messageTypes.map((s=>this.props.loadMessageConversations(s,e))),this.props.setDisplayTimeDiff()}componentDidUpdate(){const e=this.props.match.params.messageType,s=this.props.match.params.messageId;if(!this.props.settingSelectedMessageConversation&&s&&e!==s&&"create"!==s&&(void 0===this.props.selectedMessageConversation||s!==this.props.selectedMessageConversation.id)){const e={id:s};this.props.setSelectedMessageConversation(e)}e===s&&e!==this.props.selectedMessageType.id&&this.props.setSelectedMessageType(e),e!==s&&"create"!==s||void 0===this.props.selectedMessageConversation||this.props.clearSelectedMessageConversation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId)}render(){const e=this.props.match.params.messageId,s=!!this.props.selectedMessageType&&!!(ta.indexOf(this.props.selectedMessageType.id)+1)&&this.props.isInFeedbackRecipientGroup;return Object(a.jsxs)("div",{className:"messaging-center",children:[Object(a.jsx)(sa,{...this.props,id:e,wideview:this.state.wideview,displayExtendedChoices:s,toogleWideview:this.toogleWideview}),Object(a.jsxs)("div",{className:"messaging-center__main-content",children:[Object(a.jsx)(Js,{...this.props,drawerOpen:this.state.drawerOpen,messageTypes:this.props.messageTypes,autoRefresh:this.state.autoRefresh,refreshTimer:this.state.refreshTimer,setAutoRefresh:this.setAutoRefresh}),void 0===this.props.selectedMessageConversation&&!(this.state.wideview&&"create"===e)&&Object(a.jsx)(gt,{wideview:this.state.wideview,displayExtendedChoices:s&&this.state.wideview}),"create"===e&&Object(a.jsx)(xt,{...this.props,wideview:this.state.wideview}),void 0!==this.props.selectedMessageConversation&&!this.state.wideview&&Object(a.jsx)(gt,{wideview:this.state.wideview,displayExtendedChoices:s&&this.state.wideview}),this.props.selectedMessageConversation&&"create"!==e?void 0!==this.props.selectedMessageConversation&&Object(a.jsx)(Ls,{...this.props,messageConversation:this.props.selectedMessageConversation,wideview:this.state.wideview,disableLink:!0,displayExtendedChoices:s}):!this.state.wideview&&"create"!==e&&Object(a.jsxs)("div",{className:"messaging-center__no-message-selected",children:[Object(a.jsx)(De.a,{style:Zs,children:Ve.a.t("Select a message")}),Object(a.jsx)(Ge.a,{style:{color:g.palette.primary1Color,width:120,height:120}})]})]})]})}}var na=Object(Fe.a)(Object(r.c)((e=>({currentUser:e.messaging.currentUser,snackMessage:e.messaging.snackMessage,messageTypes:e.messaging.messageTypes,messageConversations:e.messaging.messageConversations,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,assignedToMeFilter:e.messaging.assignedToMeFilter,markedForFollowUpFilter:e.messaging.markedForFollowUpFilter,unreadFilter:e.messaging.unreadFilter,selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,checkedIds:e.messaging.checkedIds,checkedOptions:e.messaging.checkedIds.length>0,loaded:e.messaging.loaded,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments})),{loadMessageConversations:be,setIsInFeedbackRecipientGroup:e=>Ce(V,{isInFeedbackRecipientGroup:e}),clearCheckedIds:Te,setSelectedMessageConversation:xe,setSelectedMessageType:Ee,clearSelectedMessageConversation:Se,updateInputFields:ke,setFilter:Oe,setDisplayTimeDiff:()=>async e=>{try{const s=await(async()=>{const{systemInfo:e}=await le.query({systemInfo:{resource:"system/info"}});return e.serverDate})(),t=ye()().diff(ye()(s))-5e3;e(Ce(W,t))}catch(s){e(Ce("SET_DISPLAY_TIME_DIFF_ERROR",{error:s}))}},clearAttachments:Me},null,{pure:!1}))(ra);var oa=()=>Object(a.jsx)(_e.c,{history:qe,children:Object(a.jsxs)("div",{children:[Object(a.jsx)(_e.b,{exact:!0,path:"/",component:()=>Object(a.jsx)(_e.a,{to:"/PRIVATE"})}),Object(a.jsx)(_e.b,{path:"/:messageType/:messageId?/:recipientId?",component:na})]})}),ca=t(601),pa=t.n(ca);var la=Object(r.c)((e=>({currentUser:e.messaging.currentUser})),{setCurrentUser:()=>async e=>{e(Ce(b));try{const{currentUser:s}=await le.query({currentUser:{resource:"me",params:{fields:["id","authorities","userGroups[id]"]}}});e(Ce(v,s))}catch{e(Ce(j,"Could not load current user"))}},setDhis2CoreVersion:e=>Ce(J,e)})((({currentUser:e,setCurrentUser:s,setDhis2CoreVersion:t})=>{const{loading:r,error:n}=e,{serverVersion:o}=Object(c.b)();return Object(i.useEffect)((()=>{t(o.minor),s()}),[]),r?Object(a.jsx)("div",{className:pa.a.center,children:Object(a.jsx)(y.a,{size:48})}):n?Object(a.jsx)("div",{className:m()(pa.a.center,pa.a.error),children:n}):Object(a.jsxs)("div",{children:[Object(a.jsx)(Ue,{}),Object(a.jsx)(oa,{})]})})),da=t(306),ha=t(602);var ga=[{id:"PRIVATE",displayName:"Inbox",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"VALIDATION_RESULT",displayName:"Validation",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"TICKET",displayName:"Ticket",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"SYSTEM",displayName:"System",unread:0,loaded:0,loading:!1,total:0,page:1}];const ua={currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null},messageConversations:{},messageTypes:ga,selectedMessageType:void 0,selectedMessageConversation:void 0,settingSelectedMessageConversation:!1,checkedIds:[],messageFilter:void 0,statusFilter:void 0,priorityFilter:void 0,assignedToMeFilter:!1,markedForFollowUpFilter:!1,unreadFilter:!1,isInFeedbackRecipientGroup:!1,feedbackRecipientsId:void 0,displayTimeDiff:0,subject:"",input:"",recipients:[],attachments:[],snackMessage:"",onSnackActionClick:void 0,onSnackRequestClose:void 0,snackType:ee};var ma=function(e=ua,s){const t=e.messageTypes,a=e.attachments;switch(s.type){case b:return{...e,currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null}};case v:return{...e,currentUser:{loading:!1,error:null,id:s.payload.id,authorities:s.payload.authorities,userGroups:s.payload.userGroups}};case j:return{...e,currentUser:{loading:!1,error:s.payload,id:null,authorities:null,userGroups:null}};case W:return{...e,displayTimeDiff:s.payload};case S:{const a=t.find((e=>e.id===s.payload.messageType.id));a.loaded=s.payload.messageConversations.length,a.total=s.payload.pager.total,a.unread=s.payload.nrOfUnread,a.page=s.payload.pager.page,a.loading=!1,ga.splice([ae(t,a.id)],1,a);const i=s.payload.selectedMessageType===a.id&&(s.payload.selectedMessageType===e.selectedMessageType||void 0===e.selectedMessageType);return{...e,messageTypes:ga,messageConversations:{...e.messageConversations,[a.id]:s.payload.messageConversations},selectedMessageType:i?a:e.selectedMessageType}}case M:return{...e,snackMessage:s.payload.error.message,snackType:te};case k:{let t="";switch(s.payload.identifier){case"STATUS":t=Ve.a.t("Successfully updated status");break;case"PRIORITY":t=Ve.a.t("Successfully updated priority");break;case"ASSIGNEE":t=Ve.a.t("Successfully updated assignee");break;case"FOLLOW_UP":t=Ve.a.t("Successfully changed followup");break;default:Z.a.error("Unexpected identifier for updateMessageConversations success")}return{...e,snackMessage:t,snackType:se}}case w:case O:return{...e,snackMessage:s.payload.error.message,snackType:te};case f:return{...e,snackMessage:Ve.a.t("Successfully deleted message conversation(s)"),snackType:se};case F:return{...e,snackMessage:s.payload.message,snackType:s.payload.snackType,onSnackActionClick:s.payload.onSnackActionClick,onSnackRequestClose:s.payload.onSnackRequestClose};case R:return{...e,snackMessage:"",snackType:ee};case A:{const t=s.payload.messageConversation;let a=e.checkedIds;return s.payload.selectedValue?a.push(t):a=a.filter((e=>e.id!==t.id)),{...e,checkedIds:a}}case U:return{...e,checkedIds:s.payload.messageConversationIds};case _:return{...e,checkedIds:[]};case G:return{...e,selectedMessageConversation:s.payload.messageConversation,settingSelectedMessageConversation:!1};case L:return{...e,settingSelectedMessageConversation:!0};case D:return{...e,selectedMessageConversation:void 0};case N:return{...e,checkedIds:[],selectedMessageType:t.find((e=>e.id===s.payload.messageTypeId)),selectedMessageConversations:e.messageConversations[s.payload.messageTypeId],selectedMessageConversation:void 0};case P:return{...e,subject:s.payload.subject,input:s.payload.input,recipients:s.payload.recipients};case q:return{...e,recipients:[...e.recipients,s.payload]};case I:return{...e,messageFilter:"MESSAGE"===s.payload.filterType?s.payload.filter:e.messageFilter,statusFilter:"STATUS"===s.payload.filterType?s.payload.filter:e.statusFilter,priorityFilter:"PRIORITY"===s.payload.filterType?s.payload.filter:e.priorityFilter,assignedToMeFilter:"ASSIGNED_TO_ME"===s.payload.filterType?s.payload.filter:e.assignedToMeFilter,markedForFollowUpFilter:"MARKED_FOR_FOLLOWUP"===s.payload.filterType?s.payload.filter:e.markedForFollowUpFilter,unreadFilter:"UNREAD"===s.payload.filterType?s.payload.filter:e.unreadFilter};case T:{const t=s.payload.messageType;t.loading=!0,s.payload.loadMore&&t.page++,ga[ae(ga,t.id)]=t;const a=e.selectedMessageType;return a&&(a.loading=!0,s.payload.loadMore&&a.page++),{...e,messageTypes:ga,selectedMessageType:a}}case V:return{...e,isInFeedbackRecipientGroup:s.payload.isInFeedbackRecipientGroup.authorized,feedbackRecipientsId:s.payload.isInFeedbackRecipientGroup.feedbackRecipientsId};case H:return{...e,attachments:e.attachments.map((e=>e.name===s.payload.name?{id:s.payload.id,name:e.name,contentLength:e.contentLength,loading:!1}:e))};case Y:return{...e,attachments:a.filter((e=>e.id!==s.payload.attachmentId)),snackMessage:s.payload.error.message,snackType:te};case B:return{...e,attachments:e.attachments.concat({name:s.payload.name,contentLength:s.payload.size,loading:!0})};case z:return{...e,attachments:a.filter((e=>e.id!==s.payload.attachmentId))};case X:return{...e,attachments:a.filter((e=>e.name!==s.payload.attachmentName))};case K:return{...e,attachments:[]};case J:return{...e,dhis2CoreVersion:s.payload};default:return e}};const ya=[ha.a],Ca=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||da.d,xa=Object(da.c)({messaging:ma});var ba=Object(da.e)(xa,Ca(Object(da.a)(...ya)));t(603),t(18);s.default=()=>{const e=Object(c.c)();return le=e,Object(a.jsx)(r.a,{store:ba,children:Object(a.jsx)(o.a,{muiTheme:g,children:Object(a.jsx)(la,{})})})}}}]);
//# sourceMappingURL=app.68c4da3c.chunk.js.map