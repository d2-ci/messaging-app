(this["webpackJsonp@dhis2/app-shell"]=this["webpackJsonp@dhis2/app-shell"]||[]).push([[135],{564:function(e,s,t){},584:function(e,s,t){},595:function(e,s,t){},602:function(e,s,t){e.exports={center:"App_center__1snml",error:"App_error__1usCm"}},604:function(e,s,t){},606:function(e,s,t){"use strict";t.r(s);var a=t(7),i=t(1),r=t(190),n=t(252),o=t.n(n),c=t(8),p=t(320),l=t.n(p),d=t(198),h=t(228),g=l()({palette:{negative:h.pinkA200,blue50:h.blue50,primary1Color:"#1D8BF1",primary2Color:h.blue100,primary3Color:h.blue300,primary4Color:h.blue500,accent1Color:h.grey50,accent2Color:h.grey100,accent3Color:h.grey300,accent4Color:h.grey500,followUp:h.orange500,darkGray:h.grey700,superDarkGray:h.grey900,textColor:h.darkBlack,alternateTextColor:h.white,canvasColor:h.white,borderColor:h.grey300,clockCircleColor:Object(d.fade)(h.darkBlack,.07),shadowColor:h.fullBlack}}),u=t(4),m=t.n(u),y=t(453),C=t(294),x=t.n(C);const b="SET_CURRENT_USER",v="SET_CURRENT_USER_SUCCESS",j="SET_CURRENT_USER_ERROR",T="LOAD_MESSAGE_CONVERSATIONS",S="MESSAGE_CONVERSATIONS_LOAD_SUCCESS",f="MESSAGE_CONVERSATIONS_DELETE_SUCCESS",O="MESSAGE_CONVERSATIONS_DELETE_ERROR",k="MESSAGE_CONVERSATION_UPDATE_SUCCESS",M="MESSAGE_CONVERSATION_UPDATE_ERROR",E="SEND_MESSAGE_SUCCESS",I="SEND_MESSAGE_ERROR",w="SET_FILTER",F="DISPLAY_SNACK_MESSAGE;",R="CLEAR_SNACK_MESSAGE",A="SET_CHECKED",_="SET_ALL_CHECKED",U="CLEAR_CHECKED",N="SET_SELECTED_MESSAGE_TYPE",D="CLEAR_SELECTED_MESSAGE_CONVERSATION",L="SET_SELECTED_MESSAGE_CONVERSATION",G="SET_SELECTED_MESSAGE_CONVERSATION_SUCCESS",P="UPDATE_INPUT_FIELDS",V="SET_IN_FEEDBACK_RECIPIENT_GROUP",W="SET_DISPLAY_TIME_DIFF_SUCCESS",q="ADD_RECIPIENT_BY_ID_SUCCESS",B="ADD_ATTACHMENT",H="ADD_ATTACHMENT_SUCCESS",Y="ADD_ATTACHMENT_ERROR",z="REMOVE_ATTACHMENT",K="CLEAR_ATTACHMENTS",X="CANCEL_ATTACHMENT",J="SET_DHIS2_CORE_VERSION";var Q=t(367),Z=t.n(Q),$=t(561),ee=t.n($);const se="Roboto, Helvetica, Arial, sans-serif",te="NEUTRAL",ae="POSITIVE",ie="NEGATIVE";function re(e,s){const t=e.length;for(let a=0;a<t;a++)if(e[a].id===s)return a}function ne(e,s){let t=null;return function(){const a=this,i=arguments;clearTimeout(t),t=setTimeout((function(){e.apply(a,i)}),s)}}function oe(e){return e>30}function ce(e){return{resource:"organisationUnits",params:{fields:["id","displayName"],pageSize:10,filter:["displayName:token:".concat(e),"users:gte:1"]}}}function pe(e){return{resource:"userGroups",params:{fields:"id, displayName",pageSize:10,filter:["displayName:token:".concat(e)]}}}const le=["id","displayName","subject","messageType","lastSender[id, displayName]","assignee[id, displayName]","status","priority","lastUpdated","read","lastMessage","followUp"],de=["*","assignee[id, displayName]","messages[*,sender[id,displayName]","attachments[id, name, contentLength]]","userMessages[user[id, displayName]]"];let he=null;const ge=async({messageType:e,page:s,messageFilter:t,status:a,priority:i,assignedToMeFilter:r,markedForFollowUpFilter:n,unreadFilter:o,currentUser:c})=>{const p=["messageType:eq:".concat(e)];a&&p.push("status:eq:".concat(a)),i&&p.push("priority:eq:".concat(i)),n&&p.push("followUp:eq:true"),o&&p.push("read:eq:false"),r&&p.push("assignee.id:eq:".concat(c.id));const l={resource:"messageConversations",params:{filter:p,pageSize:35,page:s,fields:le,order:"lastMessage:desc",queryString:t}},{messageConversations:d}=await he.query({messageConversations:l});return d},ue=async(e,s)=>{const t=s?{resource:"messageConversations/".concat(e,"/assign"),type:"create",params:{userId:s}}:{resource:"messageConversations",id:"".concat(e,"/assign"),type:"delete"};return await he.mutate(t)},me=async({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:a,dhis2CoreVersion:i})=>{var r,n,o;const c=function({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:a,dhis2CoreVersion:i}){const r=function({searchValue:e,searchOnlyFeedbackRecipients:s,feedbackRecipientsId:t,dhis2CoreVersion:a}){if(function(e){return e>34}(a))return{resource:s?"userLookup/feedbackRecipients":"userLookup",params:{query:e}};{const a=["displayName:token:".concat(e)];return s&&a.push("userGroups.id:eq:".concat(t)),{resouce:"users",params:{filter:a,pageSize:10}}}}({searchValue:e,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:a,dhis2CoreVersion:i});return s?{users:r}:{users:r,organisationUnits:ce(e),userGroups:pe(e)}}({searchValue:e,searchOnlyUsers:s,searchOnlyFeedbackRecipients:t,feedbackRecipientsId:a,dhis2CoreVersion:i}),p=await he.query(c);return{users:null===(r=p.users)||void 0===r?void 0:r.users,organisationUnits:null===p||void 0===p||null===(n=p.organisationUnits)||void 0===n?void 0:n.organisationUnits,userGroups:null===p||void 0===p||null===(o=p.userGroups)||void 0===o?void 0:o.userGroups}},ye=({users:e,userGroups:s,organisationUnits:t,messageConversationId:a})=>he.mutate({resource:"messageConversations/".concat(a,"/recipients"),type:"create",data:{users:e,userGroups:s,organisationUnits:t}});var Ce=t(11),xe=t.n(Ce);const be=(e,s)=>({type:e,payload:s}),ve=e=>async s=>{s(be(L));try{const t=await(async({id:e})=>{const{messageConversation:s}=await he.query({messageConversation:{resource:"messageConversations",id:e,params:{fields:de}}});return s})(e);s(be(G,{messageConversation:t}))}catch(t){s(be("SET_SELECTED_MESSAGE_CONVERSATION_ERROR",{error:t}))}},je=(e,s,t=!1)=>async(a,i)=>{const r=[],n=i(),{messageFilter:o,statusFilter:c,priorityFilter:p,assignedToMeFilter:l,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}=n.messaging;e=e||n.messaging.selectedMessageType,s=s||n.messaging.selectedMessageType.id,a(be(T,{messageType:e,loadMore:t}));try{for(let s=1;s<=e.page;s++){const t=ge({messageType:e.id,page:s,messageFilter:o,status:c,priority:p,assignedToMeFilter:l,markedForFollowUpFilter:d,unreadFilter:h,currentUser:g}).then((e=>({messageConversations:e.messageConversations,pager:e.pager})));r.push(t)}const t=await Promise.all(r),i=await(async e=>{const{messageConversations:s}=await he.query({messageConversations:{resource:"messageConversations",params:{fields:["read"],filter:["read:eq:false","messageType:eq:".concat(e)],pageSize:1}}});return s.pager.total})(e.id),n=t.reduce(((e,s)=>e.concat(s.messageConversations)),[]);a(be(S,{messageConversations:n,pager:t[t.length-1].pager,messageType:e,selectedMessageType:s,nrOfUnread:i}))}catch(u){a(be("MESSAGE_CONVERSATIONS_LOAD_ERROR",{error:u}))}},Te=(e,s,t)=>async a=>{try{await("read"===e?(r=s,he.mutate({resource:"messageConversations/read",type:"create",data:r})):(i=s,he.mutate({resource:"messageConversations/unread",type:"create",data:i}))),a(be("MARK_MESSAGE_CONVERSATIONS_SUCCESS",{messageType:t,page:1})),a(je())}catch(n){a(be("MARK_MESSAGE_CONVERSATIONS_ERROR",{error:n}))}var i,r},Se=e=>async s=>{s(be(B,e));try{const t=await(e=>he.mutate({resource:"fileResources",type:"create",params:{domain:"MESSAGE_ATTACHMENT"},data:{file:e}}))(e);s(be(H,{id:t.response.fileResource.id,name:e.name,contentLength:t.response.fileResource.contentLength}))}catch(t){s(be(Y,{error:t}))}},fe=()=>be(U),Oe=()=>be(D),ke=({message:e,onSnackActionClick:s,onSnackRequestClose:t,snackType:a})=>be(F,{message:e,onSnackActionClick:s,onSnackRequestClose:t,snackType:a}),Me=(e,s)=>be(w,{filter:e,filterType:s}),Ee=(e,s,t)=>be(P,{subject:e,input:s,recipients:t}),Ie=()=>be(K),we=e=>be(N,{messageTypeId:e}),Fe=e=>be(z,{attachmentId:e}),Re=e=>be(X,{attachmentName:e});var Ae=t(202);const _e={NEGATIVE:g.palette.negative,NEUTRAL:g.palette.primary1Color,POSITIVE:g.palette.alternateTextColor};class Ue extends i.Component{constructor(e){super(e),this.closeMessage=()=>{this.props.clearSnackMessage(),this.setState({show:!1}),this.props.onSnackRequestClose&&this.props.onSnackRequestClose()},this.state={show:!1}}componentDidUpdate(e,s){!s.show&&this.props.message&&this.setState({show:!0})}render(){return Object(a.jsx)(x.a,{open:""!==this.props.message&&this.state.show,message:this.props.message||"Missing snackbar message",autoHideDuration:4e3,onRequestClose:this.closeMessage,action:this.props.onSnackActionClick&&"undo",onActionClick:()=>{this.props.onSnackActionClick(),this.setState({show:!1})},contentStyle:{color:_e[this.props.type]},style:{pointerEvents:"none",whiteSpace:"nowrap"},bodyStyle:{pointerEvents:"initial",maxWidth:"none"}})}}var Ne=Object(Ae.a)(Object(r.c)((e=>({message:e.messaging.snackMessage,type:e.messaging.snackType,onSnackActionClick:e.messaging.onSnackActionClick,onSnackRequestClose:e.messaging.onSnackRequestClose})),{clearSnackMessage:()=>be(R)}),Ae.b)(Ue),De=t(597),Le=t(201),Ge=t.n(Le),Pe=t(596),Ve=t.n(Pe),We=t(5),qe=t.n(We),Be=t(374),He=Object(Be.a)(),Ye=t(372),ze=t.n(Ye),Ke=t(371),Xe=t.n(Ke),Je=t(194),Qe=t.n(Je),Ze=t(197),$e=t.n(Ze),es=t(247),ss=t.n(es),ts=t(187),as=t.n(ts),is=t(220),rs=t.n(is),ns=t(246),os=t.n(ns),cs=t(286),ps=t.n(cs),ls=t(570),ds=t.n(ls),hs=t(565),gs=t.n(hs);t(564);const us=({dataDirection:e,attachment:s,removeAttachment:t,downloadAttachment:i,cancelAttachment:r})=>Object(a.jsx)(Qe.a,{className:"attachment__button",backgroundColor:g.palette.accent2Color,label:"".concat(s.name," (").concat(parseFloat(parseInt(s.contentLength,10)/1e6).toFixed(2)," MB)"),labelPosition:"after",onClick:()=>{"download"===e?i(s):s.loading?r(s.name):t(s)},icon:"download"===e?Object(a.jsx)(gs.a,{}):Object(a.jsx)(ds.a,{}),children:s.loading&&Object(a.jsx)(ps.a,{className:"attachment__progress",mode:"indeterminate"})});var ms=({dataDirection:e,attachments:s,style:t,removeAttachment:i,downloadAttachment:r,cancelAttachment:n})=>Object(a.jsx)("div",{className:"attachment",style:{...t},children:s.map(((s,t)=>Object(a.jsx)(us,{dataDirection:e,attachment:s,removeAttachment:i,downloadAttachment:r,cancelAttachment:n},"".concat(s.name,"-").concat(t))))}),ys=t(571),Cs=t.n(ys);const xs={canvas:e=>({backgroundColor:e,padding:"16px 16px 16px 16px"}),innerCanvas:{margin:"",paddingBottom:"0px"},cardText:{padding:"16px 0px 16px 0px",fontFamily:se,whiteSpace:"pre-wrap",wordBreak:"break-word"},fromFormat:{fontFamily:se},datePlacement:{display:"flex",justifyContent:"flex-end",marginRight:"10px"},dateFormat:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:se}};var bs=({displayTimeDiff:e,message:s,currentUser:t,lastMessage:i,downloadAttachment:r,cancelAttachment:n,enableAttachments:o})=>{const c=s.sender?t&&t.id===s.sender.id?"me":s.sender.displayName:"system",p=xe()(),l=xe()(s.created).add(e);return Object(a.jsxs)("div",{style:xs.canvas(g.palette.canvasColor),children:[Object(a.jsxs)("div",{style:xs.innerCanvas,children:[Object(a.jsx)("div",{style:xs.fromFormat,children:s.internal?qe.a.t("Internal message from ".concat(c)):qe.a.t("Message from ".concat(c))}),Object(a.jsx)("div",{placement:"bottom",style:xs.datePlacement,children:Object(a.jsx)("div",{style:xs.dateFormat,children:p.diff(l,"hours")<72?"".concat(l.from(p),", ").concat(l.format("HH:mm")):p.year()===l.year()?l.format("MMM DD, HH:mm"):l.format("MMM DD, YYYY HH:mm")})}),o&&Object(a.jsx)(ms,{dataDirection:"download",style:{paddingLeft:0},attachments:s.attachments,downloadAttachment:r,cancelAttachment:n}),Object(a.jsx)(os.a,{style:xs.cardText,children:Object(a.jsx)(Cs.a,{children:s.text})})]}),!i&&Object(a.jsx)(rs.a,{})]})},vs=t(245),js=t(250),Ts=t.n(js),Ss=t(199),fs=t.n(Ss),Os=t(585),ks=t.n(Os);t(584);const Ms=e=>s=>{const t=s.target.files;t.length>0&&e(t[0])};var Es=({addAttachment:e})=>Object(a.jsx)(Qe.a,{className:"attachment__upload-button",label:qe.a.t("Upload attachment"),labelPosition:"after",containerElement:"label",icon:Object(a.jsx)(ks.a,{}),children:Object(a.jsx)("input",{className:"attachment__upload-button--input",type:"file",onChange:Ms(e)})});class Is extends i.Component{constructor(e){super(e),this.replyMessage=e=>{const{input:s,selectedMessageConversation:t,selectedMessageType:a}=this.props;this.props.replyMessage({message:s,internalReply:e,messageConversation:t,messageType:a}),this.wipeInput()},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),this.setState({inputError:!1})},this.texFieldUpdate=(e,s)=>{this.props.updateInputFields("",s,[])},this.handleDiscard=()=>{const e=qe.a.t("Reply discarded");this.setState({discardState:!0}),this.props.displaySnackMessage({message:e,onSnackActionClick:()=>this.setState({discardState:!1}),onSnackRequestClose:()=>{this.setState({discardState:!1}),this.wipeInput()},snackType:"NEGATIVE"}),this.setState({expanded:!1})},this.state={discardState:!1}}componentWillUnmount(){this.wipeInput()}render(){return Object(a.jsx)(vs.Card,{style:{marginTop:"5px"},expanded:!0,children:Object(a.jsxs)(vs.CardText,{style:{padding:"0px 0px 0px 16px"},children:[Object(a.jsx)(fs.a,{id:this.props.messageConversation.id,rows:5,underlineShow:!1,value:this.state.discardState?"":this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:qe.a.t("Message"),onChange:this.texFieldUpdate},this.props.messageConversation.id),this.props.enableAttachments&&!this.state.discardState&&Object(a.jsx)(ms,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),Object(a.jsxs)(vs.CardActions,{style:{paddingLeft:"0px"},children:[Object(a.jsx)(Ts.a,{primary:!0,label:qe.a.t("Reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!1)}),this.props.isInFeedbackRecipientGroup&&"TICKET"===this.props.selectedMessageType.id&&Object(a.jsx)(Qe.a,{primary:!0,label:qe.a.t("Internal reply"),disabled:""===this.props.input||this.state.discardState,onClick:()=>this.replyMessage(!0)}),Object(a.jsx)(Qe.a,{label:qe.a.t("Discard"),disabled:""===this.props.input||this.state.discardState,onClick:this.handleDiscard}),this.props.enableAttachments&&Object(a.jsx)(Es,{addAttachment:e=>{this.props.addAttachment(e)}}),")"]})]})})}}var ws=Object(Ae.a)(Object(r.c)((e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes,input:e.messaging.input,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments,enableAttachments:oe(e.messaging.dhis2CoreVersion)})),{replyMessage:({message:e,internalReply:s,messageConversation:t,messageType:a})=>async(i,r)=>{try{const{id:n}=t,o=r().messaging.attachments.map((e=>e.id));await(async({message:e,internalReply:s,attachments:t,id:a})=>{const i={internal:s};return t.length>0&&(i.attachments=t),await he.mutate({resource:"messageConversations/".concat(a),type:"create",params:i,data:e})})({message:e,internalReply:s,attachments:o,id:n}),i(be("REPLY_MESSAGE_SUCCESS",{messageConversation:t,messageType:a,page:1})),i(je()),i(ve(t))}catch(n){i(be("REPLY_MESSAGE_ERROR",{error:n}))}},setSelectedMessageType:we,updateInputFields:Ee,displaySnackMessage:ke,addAttachment:Se,removeAttachment:Fe,cancelAttachment:Re},null,{pure:!1}))(Is),Fs=t(586),Rs=t.n(Fs);class As extends i.Component{constructor(...e){super(...e),this.state={input:"",searchResult:[],searchOnlyUsers:this.props.searchOnlyUsers,searchOnlyFeedbackRecipients:this.props.searchOnlyFeedbackRecipients,lastSearch:"",errorText:void 0},this.debouncedSearch=ne(this.search.bind(this),300),this.onSuggestionClick=e=>{if(void 0!==this.props.onSuggestionClick)this.props.onSuggestionClick(e);else{this.wipeInput(),this.debouncedSearch("");!this.props.recipients.find((s=>s.id===e.id))&&this.props.updateRecipients([...this.props.recipients,this.state.searchResult.find((s=>s.id===e.id))])}},this.onRemoveChip=e=>{this.props.updateRecipients(this.props.recipients.filter((s=>s.id!==e)))},this.wipeInput=()=>{this.setState({input:"",searchResult:[]})},this.updateInput=e=>{this.debouncedSearch(e),this.setState({input:e})}}search(e){if(!this.state.searchResult.find((s=>s.displayName===e))&&""!==e&&e.length>=2){const{feedbackRecipientsId:s,searchOnlyUsers:t,searchOnlyFeedbackRecipients:a,dhis2CoreVersion:i}=this.props;me({searchValue:e,searchOnlyUsers:t,searchOnlyFeedbackRecipients:a,feedbackRecipientsId:s,dhis2CoreVersion:i}).then((({users:e,userGroups:s,organisationUnits:t})=>{const a=e=>s=>({...s,type:e});let i=e.map(a("user"));this.state.searchOnlyUsers||(i=i.concat(s.map(a("userGroup"))).concat(t.map(a("organisationUnit")))),this.setState({searchResult:i,errorText:0===i.length?qe.a.t("No results found"):void 0})}))}else this.setState({lastSearch:e,searchResult:""!==this.state.lastSearch&&""===e||e.length<2?[]:this.state.searchResult,errorText:""!==e&&e.length<2?qe.a.t("Please enter at least ".concat(2," characters")):this.state.searchWarning})}render(){return Object(a.jsx)("div",{style:{...this.props.style,height:this.props.inputHeight},children:Object(a.jsx)(Rs.a,{style:{marginBottom:16},disabled:void 0!==this.props.disabled&&this.props.disabled,errorText:this.props.errorText||this.state.errorText,value:this.props.recipients,fullWidth:!0,openOnFocus:!0,searchText:this.state.input,floatingLabelText:this.props.label,dataSource:this.state.searchResult,dataSourceConfig:{text:"displayName",value:"id"},onUpdateInput:this.updateInput,onRequestAdd:e=>this.onSuggestionClick(e),onRequestDelete:e=>this.onRemoveChip(e)})})}}var _s=Object(r.c)((e=>({dhis2CoreVersion:e.messaging.dhis2CoreVersion})))(As);const Us={subheaderTitle:{height:"32px",color:"black",paddingLeft:0,paddingRight:16},subheader:(e,s)=>({height:"32px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:0,color:e,fontWeight:s})};var Ns=({showTitle:e,title:s,label:t,color:i,fontWeight:r})=>{const n=t&&"NONE"!==t?"Assignee"===s?t:"".concat(t.charAt(0)).concat(t.toLowerCase().substr(1,t.length)):"-";return Object(a.jsxs)("div",{style:{flex:2,paddingLeft:10,maxWidth:200},children:[e&&Object(a.jsxs)(Ge.a,{style:Us.subheaderTitle,children:[" ",s," "]}),Object(a.jsx)(Ge.a,{style:Us.subheader(i,r),children:n})]})};const Ds={canvas:{flex:"3 0",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)",paddingTop:"10px"},innerCanvas:{display:"flex",flexDirection:"column",margin:"0px 10px 0px 10px"},header:{display:"flex"},iconButton:{display:"flex",alignSelf:"center"},subjectSubheader:{display:"flex",alignSelf:"center",fontSize:"20px",fontFamily:se},participantsCanvas:{display:"flex",flexDirection:"column"},participants:{paddingLeft:"12px",paddingTop:"10px",display:"flex",flexWrap:"wrap"},chip:{height:"32px",marginRight:"3px",marginBottom:"3px"},participantAddRow:{display:"flex"},participantsSuggestionField:{paddingLeft:"12px",marginBottom:"0px",flex:1},participantsAdd:{alignSelf:"flex-end",marginBottom:"28px",paddingLeft:"12px"},messagesCanvas:{marginBottom:"50px",display:"flex",flexDirection:"column",backgroundColor:g.palette.accent2Color,margin:"0px 10px 10px 10px"},messagesInnerCanvas:{padding:"0px"}};const Ls=["TICKET","VALIDATION_RESULT"];class Gs extends i.Component{constructor(e){super(e),this.backToList=()=>{const{clearSelectedMessageConversation:e,messageConversation:s}=this.props;He.push("/".concat(s.messageType)),e()},this.addRecipients=()=>{const e=this.state.recipients.filter((e=>"user"===e.type)),s=this.state.recipients.filter((e=>"userGroup"===e.type)),t=this.state.recipients.filter((e=>"organisationUnit"===e.type)),{messageConversation:a,selectedMessageType:i}=this.props;this.props.addRecipients({users:e,userGroups:s,organisationUnits:t,messageConversation:a,messageType:i}),this.setState({recipients:[]})},this.updateRecipients=e=>{this.setState({recipients:e})},this.state={recipients:[],cursor:"auto"}}render(){const{messageConversation:e,currentUser:s}=this.props,t=e.messages,i=!!(Ls.indexOf(e.messageType)+1),r=e.userMessages.slice(0,30).map((e=>!s.id||this.state.recipientsExpanded||s.id!==e.user.id?e.user.displayName:qe.a.t("me"))),n=e.userMessages.length;return n>30&&r.push(" + ".concat(n-30)),Object(a.jsxs)("div",{id:"messageconversation",style:Ds.canvas,children:[Object(a.jsxs)("div",{style:Ds.innerCanvas,children:[Object(a.jsxs)("div",{style:Ds.header,children:[Object(a.jsx)($e.a,{style:Ds.iconButton,tooltipPosition:"bottom-right",onClick:this.backToList,tooltip:qe.a.t("Show all messages"),children:Object(a.jsx)(Xe.a,{})}),Object(a.jsx)(Ge.a,{style:Ds.subjectSubheader,children:e.subject}),this.props.displayExtendedChoices&&Object(a.jsx)(Ns,{color:g.palette.darkGray,showTitle:!0,title:qe.a.t("Status"),label:e.status}),this.props.displayExtendedChoices&&Object(a.jsx)(Ns,{color:g.palette.darkGray,showTitle:!0,title:qe.a.t("Priority"),label:e.priority}),i&&Object(a.jsx)(Ns,{color:g.palette.darkGray,showTitle:!0,title:qe.a.t("Assignee"),label:e.assignee?e.assignee.displayName:void 0})]}),Object(a.jsxs)("div",{style:Ds.participantsCanvas,children:[Object(a.jsx)(Ge.a,{style:{paddingLeft:"12px",paddingTop:"10px"},children:qe.a.t("Participants")}),Object(a.jsx)("div",{style:Ds.participants,children:r.map((e=>Object(a.jsx)(ss.a,{style:Ds.chip,children:e},e)))})]}),Object(a.jsxs)("div",{style:Ds.participantAddRow,children:[Object(a.jsx)(_s,{style:Ds.participantsSuggestionField,label:qe.a.t("Add participants to conversation"),messageConversation:e,recipients:this.state.recipients,updateRecipients:this.updateRecipients,limitSearchArray:e.userMessages}),Object(a.jsx)("div",{style:Ds.participantsAdd,children:Object(a.jsx)(Qe.a,{icon:Object(a.jsx)(ze.a,{}),onClick:()=>this.addRecipients(),label:qe.a.t("Add")})})]})]}),Object(a.jsxs)("div",{style:Ds.messagesCanvas,children:[Object(a.jsx)(as.a,{style:Ds.messagesInnerCanvas,children:t.map(((s,r)=>Object(a.jsx)(bs,{displayTimeDiff:this.props.displayTimeDiff,message:s,messageConversation:e,notification:i,currentUser:this.state.currentUser,lastMessage:r+1===t.length,downloadAttachment:t=>this.props.downloadAttachment(e.id,s.id,t.id),cancelAttachment:this.props.cancelAttachment,enableAttachments:this.props.enableAttachments},s.id)))}),Object(a.jsx)(ws,{...this.props,messageConversation:e})]})]})}}var Ps=Object(r.c)((e=>({currentUser:e.messaging.currentUser,selectedMessageType:e.messaging.selectedMessageType,displayTimeDiff:e.messaging.displayTimeDiff,enableAttachments:oe(e.messaging.dhis2CoreVersion)})),{addRecipients:({users:e,userGroups:s,organisationUnits:t,messageConversation:a,messageType:i})=>async r=>{try{const{id:n}=a;await ye({users:e,userGroups:s,organisationUnits:t,messageConversationId:n}),r(be("ADD_RECIPIENTS_SUCCESS",{messageConversation:a,messageType:i,page:1})),r(ve(a))}catch(n){r(be("ADD_RECIPIENTS_ERROR",{error:n}))}},downloadAttachment:(e,s,t)=>a=>{((e,s,t)=>{const a=ee.a.join(he.link.baseUrl,he.link.apiPath,"messageConversations",e,s,"attachments",t),i=document.createElement("a");i.href=a,i.download=a.split("/").pop(),i.target="_blank",document.body.appendChild(i),i.click(),document.body.removeChild(i)})(e,s,t),a(be("DOWNLOAD_ATTACHMENT_SUCCESS"))},cancelAttachment:Re,clearSelectedMessageConversation:Oe})(Gs),Vs=t(287),Ws=t(300),qs=t.n(Ws),Bs=t(248),Hs=t.n(Bs),Ys=t(275),zs=t.n(Ys);class Ks extends i.Component{constructor(e){super(e),this.onClick=()=>{this.props.onClick()},this.onMouseEnter=()=>{this.setHoverText(),this.setState({cursor:"pointer"})},this.onMouseLeave=()=>{this.setNeutralText(),this.setState({cursor:"auto"})},this.setNeutralText=()=>this.setTextColor(g.palette.accent2Color),this.setHoverText=()=>this.setTextColor(g.palette.accent3Color),this.setTextColor=e=>{this.setState({backgroundColor:e})},this.getBackgroundColor=(e,s)=>e&&s===e.id?g.palette.accent3Color:this.state.backgroundColor,this.state={backgroundColor:g.palette.accent2Color,textColor:g.palette.darkGray}}render(){return Object(a.jsxs)("div",{role:"presentation",style:{...this.state,backgroundColor:this.getBackgroundColor(this.props.selectedMessageType,this.props.messageType.id),cursor:this.state.cursor,alignItems:"center",height:"49px",display:"flex",flexDirection:"row",justifyContent:"space-between"},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,onClick:()=>this.onClick(),children:[Object(a.jsx)(Ge.a,{style:{marginLeft:"5px",fontSize:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?"18px":"16px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:this.props.selectedMessageType&&this.props.messageType.id===this.props.selectedMessageType.id?g.palette.primary1Color:this.state.textColor},children:qe.a.t(this.props.messageType.displayName)}),this.props.loading?Object(a.jsx)(Hs.a,{style:{marginRight:"10px"},color:g.palette.primary1Color,size:24}):this.props.messageType.unread>0&&Object(a.jsx)(zs.a,{style:{marginTop:"12px",marginRight:"5px"},badgeContent:this.props.messageType.unread>100?"99+":this.props.messageType.unread,secondary:!0,badgeStyle:{backgroundColor:"#439E8E"}})]})}}var Xs=Ks;const Js={canvas:{display:"flex",flexDirection:"column",justifyContent:"space-between",height:"calc(100vh - 95px)",borderLeftStyle:"solid",borderLeftWidth:"0.5px",borderLeftColor:g.palette.accent4Color,borderRightStyle:"solid",borderRightWidth:"1px",borderRightColor:g.palette.accent4Color,overflowY:"auto",overflowX:"hidden",minWidth:"200px"}};class Qs extends i.Component{constructor(e){super(e),this.props.setSelectedMessageType(this.props.match.params.messageType)}render(){const e=this.props.messageTypes;return Object(a.jsxs)("div",{style:Js.canvas,children:[Object(a.jsx)(Vs.List,{style:{padding:"0px"},children:e&&e.map((e=>Object(a.jsxs)("div",{children:[Object(a.jsx)(Xs,{messageType:e,onClick:()=>{this.props.setSelectedMessageType(e.id),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),He.push("/".concat(e.id))},selectedMessageType:this.props.selectedMessageType,loading:e.loading}),Object(a.jsx)(rs.a,{})]},e.id)))}),Object(a.jsx)(qs.a,{style:{width:"",margin:"20px"},label:"".concat(qe.a.t("Auto refresh")," (").concat(xe()(this.props.refreshTimer).format("mm:ss"),")"),toggled:this.props.autoRefresh,onToggle:()=>this.props.setAutoRefresh(!this.props.autoRefresh)})]})}}var Zs=Object(Ae.a)(Object(r.c)((e=>({selectedMessageType:e.messaging.selectedMessageType,messageTypes:e.messaging.messageTypes})),{setSelectedMessageType:we,clearCheckedIds:fe},null,{pure:!1}))(Qs);const $s={overflowY:"scroll",overflowX:"hidden",borderRightWidth:"1px",borderRightColor:g.palette.accent4Color,height:"calc(100vh - 95px)"},et={paddingLeft:"0px",fontSize:"20px"};var st=t(221),tt=t.n(st);const at="16px",it={canvas:e=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",alignSelf:"center",boxShadow:"none",borderBottom:"1px solid #dfdfdf"}),checkBox:{flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:"12px"},sender:{fontFamily:se,fontSize:at,flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:"black",paddingLeft:10,alignSelf:"center"},subject:{flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",fontFamily:se,fontSize:at,color:"black",paddingLeft:10},extendedLabel:{flex:2,color:"black",fontSize:at,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",padding:"0 0 0 10px"}};class rt extends i.Component{constructor(e){super(e),this.state={cursor:"auto",allChecked:!1}}componentDidUpdate(){this.state.allChecked&&this.props.checkedIds.length<this.props.messages.length&&this.setState({allChecked:!1})}render(){const e=this.props.displayExtendedChoices;return Object(a.jsxs)(as.a,{style:it.canvas(g.palette.canvasColor),children:[Object(a.jsx)(tt.a,{checked:this.state.allChecked,style:it.checkBox,onCheck:()=>{this.state.allChecked?this.props.clearCheckedIds():this.props.setAllChecked(this.props.messages.map((e=>({id:e.id})))),this.setState({allChecked:!this.state.allChecked})}}),Object(a.jsx)("div",{style:it.sender,children:qe.a.t("Sender")}),Object(a.jsx)(Ge.a,{style:it.subject,children:qe.a.t("Subject")}),e&&Object(a.jsx)(Ge.a,{style:it.extendedLabel,children:qe.a.t("Status")}),e&&Object(a.jsx)(Ge.a,{style:it.extendedLabel,children:qe.a.t("Priority")}),this.props.notification&&Object(a.jsx)(Ge.a,{style:it.extendedLabel,children:qe.a.t("Assignee")}),Object(a.jsx)(Ge.a,{style:it.extendedLabel,children:qe.a.t("Date")})]})}}var nt=Object(Ae.a)(Object(r.c)((e=>({checkedIds:e.messaging.checkedIds,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup})),{setAllChecked:e=>be(_,{messageConversationIds:e}),clearCheckedIds:fe}))(rt),ot=t(587),ct=t.n(ot);const pt={container:(e,s,t)=>({backgroundColor:e,display:"flex",transition:"all 0.2s ease-in-out",cursor:t,boxSizing:"border-box",position:"relative",whiteSpace:"nowrap",boxShadow:"none",borderBottom:"1px solid #dfdfdf",flexWrap:s?"nowrap":"wrap"}),checkBox:e=>({flex:"0 0 32px",display:"flex",alignSelf:"center",paddingLeft:e?12:6}),flag:{color:g.palette.followUp,marginRight:4},sender:(e,s)=>({fontFamily:se,fontSize:"14px",flex:3,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",display:"flex",alignItems:"center",color:"black",paddingLeft:e?10:0,fontWeight:s}),subject:(e,s,t)=>({flex:8,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",paddingLeft:10,fontFamily:se,color:s,fontWeight:t,order:e?"inherit":10,marginTop:e?0:-10,flexBasis:e?"0%":"100%"}),dateFormat:(e,s,t)=>({flex:2,fontFamily:se,paddingLeft:e?10:0,paddingRight:e?0:10,overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",textAlign:e?"":"end",color:s,fontWeight:t})};class lt extends i.Component{constructor(e){super(e),this.onClick=e=>{this.props.setSelectedMessageConversation(e),e&&!e.read&&this.props.markMessageConversations("read",[e.id],this.props.selectedMessageType),this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments(),He.push("/".concat(e.messageType,"/").concat(e.id))},this.onMouseEnter=()=>this.setState({cursor:"pointer",backgroundColor:g.palette.accent2Color}),this.onMouseLeave=()=>this.setState({cursor:"auto",backgroundColor:g.palette.canvasColor}),this.getBackgroundColor=(e,s)=>{const t=this.props.selectedMessageConversation&&e.id===this.props.selectedMessageConversation.id;return s&&!t?g.palette.blue50:t?g.palette.accent3Color:this.state.backgroundColor},this.state={backgroundColor:g.palette.canvasColor,cursor:"auto"}}render(){const e=this.props.messageConversation,s=e.lastSender?e.lastSender.displayName:this.props.selectedMessageType.displayName,t=!!this.props.checkedIds.find((s=>s.id===e.id)),i=this.props.displayExtendedChoices,r=this.props.displayTimeDiff,n=xe()(),o=xe()(e.lastMessage).add(r),c=e.read?"":"bold",p=this.props.messageConversation.read?"black":g.palette.darkGray,l=this.getBackgroundColor(e,t);return Object(a.jsxs)(as.a,{style:pt.container(l,this.props.wideview,this.state.cursor),onClick:s=>{void 0!==s.target.innerText&&""!==s.target.innerText&&!this.props.settingSelectedMessageConversation&&(this.onClick(e),this.props.checkedIds.length>0&&this.props.clearCheckedIds(),!this.props.wideview||void 0===this.props.messageFilter&&void 0===this.props.priorityFilter&&void 0===this.props.statusFilter||this.props.setFilter(void 0,"MESSAGE"))},onMouseEnter:this.onMouseEnter,onMouseLeave:this.onMouseLeave,children:[Object(a.jsx)(tt.a,{checked:t,style:pt.checkBox(this.props.wideview),onCheck:()=>{this.props.setChecked(e,!t)}}),Object(a.jsxs)("div",{style:pt.sender(this.props.wideview,c),children:[e.followUp&&Object(a.jsx)(ct.a,{style:pt.flag}),Object(a.jsx)("span",{children:s})]}),Object(a.jsx)(Ge.a,{style:pt.subject(this.props.wideview,p,c),children:e.subject}),i&&Object(a.jsx)(Ns,{showTitle:!1,title:qe.a.t("Status"),color:p,fontWeight:c,label:e.status}),i&&Object(a.jsx)(Ns,{showTitle:!1,title:qe.a.t("Priority"),color:p,fontWeight:c,label:e.priority}),this.props.notification&&this.props.wideview&&Object(a.jsx)(Ns,{showTitle:!1,title:qe.a.t("Assignee"),color:p,fontWeight:c,label:e.assignee?e.assignee.displayName:void 0}),Object(a.jsx)(Ge.a,{style:pt.dateFormat(this.props.wideview,p,c),children:n.diff(o,"hours")<72?o.from(n):n.year()===o.year()?o.format("MMM DD"):o.format("ll")})]})}}var dt=Object(Ae.a)(Object(r.c)((e=>({selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType,checkedIds:e.messaging.checkedIds,displayTimeDiff:e.messaging.displayTimeDiff,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,attachments:e.messaging.attachments})),{setChecked:(e,s)=>be(A,{messageConversation:e,selectedValue:s}),setSelectedMessageConversation:ve,markMessageConversations:Te,clearCheckedIds:fe,setFilter:Me,updateInputFields:Ee,clearAttachments:Ie},null,{pure:!1}))(lt);const ht=["VALIDATION_RESULT","TICKET"],gt={canvas:e=>({flex:"1 0",maxWidth:e?"none":"350px",minWidth:e?"none":"250px",borderRightStyle:e?"":"solid",...$s}),loading:{backgroundColor:g.palette.accent2Color,height:"".concat(50,"px"),transition:"all 0.2s ease-in-out",display:"flex",justifyContent:"center"}};class ut extends i.Component{constructor(...e){super(...e),this.onScroll=e=>{const s=document.getElementById("messagelist");!this.props.selectedMessageType.loading&&this.isBottom(s)&&e.loaded<e.total&&this.props.loadMessageConversations(e,e.id,!0)},this.debouncedOnScroll=ne(this.onScroll,150),this.isBottom=e=>e.scrollHeight-e.scrollTop<window.outerHeight}render(){const e=function(e){if(!Array.isArray(e))return;const s=new Set;return e.filter((e=>!s.has(e.id)&&(s.add(e.id),!0)))}(this.props.messageConversations[this.props.selectedMessageType.id]),s=this.props.selectedMessageType?this.props.selectedMessageType:"",t=this.props.selectedMessageConversation?this.props.selectedMessageConversation.id:"",i=!!(ht.indexOf(s.id)+1);return Object(a.jsxs)("div",{id:"messagelist",onScroll:()=>this.debouncedOnScroll(this.props.selectedMessageType),style:gt.canvas(this.props.wideview),children:[this.props.wideview&&Object(a.jsx)(nt,{notification:i,displayExtendedChoices:this.props.displayExtendedChoices,messages:e}),e&&0!==e.length?e.map((e=>Object(a.jsx)(dt,{messageConversation:e,wideview:this.props.wideview,selectedValue:t,notification:i,displayExtendedChoices:this.props.displayExtendedChoices},e.id))):!this.props.selectedMessageType.loading&&Object(a.jsx)(Ge.a,{children:qe.a.t("No ".concat(s.displayName.toLowerCase()," messages"))}),this.props.selectedMessageType.loading&&Object(a.jsx)("div",{style:gt.loading,children:Object(a.jsx)(Hs.a,{style:{marginTop:"10px"},color:g.palette.primary1Color})})]})}}var mt=Object(Ae.a)(Object(r.c)((e=>({messageTypes:e.messaging.messageTypes,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,messageConversations:e.messaging.messageConversations,selectedMessageConversation:e.messaging.selectedMessageConversation,selectedMessageType:e.messaging.selectedMessageType})),{loadMessageConversations:je},null,{pure:!1}))(ut),yt=t(289),Ct=t.n(yt);const xt={canvas:{flex:"3 0",margin:"10px",overflowY:"scroll",overflowX:"hidden",height:"calc(100vh - 110px)"},messageTypeField:{display:"flex",flexDirection:"row"},messageType:{width:"300px",marginTop:"10px"}};class bt extends i.Component{constructor(e){super(e),this.subjectUpdate=(e,s)=>{this.props.updateInputFields(s,this.props.input,this.props.recipients)},this.inputUpdate=(e,s)=>{this.props.updateInputFields(this.props.subject,s,this.props.recipients)},this.updateRecipients=e=>{this.props.updateInputFields(this.props.subject,this.props.input,e)},this.sendMessage=()=>{const e=this.state.isMessageFeedback?"TICKET":"PRIVATE",s=this.props.messageTypes.find((s=>s.id===e));if(this.state.isMessageFeedback)this.props.sendFeedbackMessage(s),He.push("/TICKET");else{const e=this.props.recipients.filter((e=>"user"===e.type)),t=this.props.recipients.filter((e=>"userGroup"===e.type)),a=this.props.recipients.filter((e=>"organisationUnit"===e.type));this.props.sendMessage({users:e,userGroups:t,organisationUnits:a,messageType:s}),He.push("/PRIVATE")}},this.wipeInput=()=>{this.props.updateInputFields("","",[]),this.props.attachments.length>0&&this.props.clearAttachments()},this.handleDiscard=()=>{const e=qe.a.t("Message discarded");this.props.displaySnackMessage({message:e,onSnackActionClick:()=>He.push("/PRIVATE/create"),onSnackRequestClose:()=>this.wipeInput(),snackType:"NEGATIVE"}),He.push("/PRIVATE")},this.state={isMessageFeedback:!1}}componentDidMount(){const{addRecipientByUserId:e}=this.props,{messageId:s,recipientId:t}=this.props.match.params;"create"===s&&t&&e(t)}render(){const e=""===this.props.subject||""===this.props.input||!this.state.isMessageFeedback&&0===this.props.recipients.length,s=""===this.props.subject&&""===this.props.input&&!this.state.isMessageFeedback&&0===this.props.recipients.length;return Object(a.jsxs)("div",{style:xt.canvas,children:[Object(a.jsxs)(Ge.a,{style:et,children:[" ",qe.a.t("Create")]}),Object(a.jsx)(vs.Card,{children:Object(a.jsxs)(vs.CardText,{children:[Object(a.jsx)(_s,{style:{margin:"0px"},label:qe.a.t("To"),disabled:this.state.isMessageFeedback,recipients:this.state.isMessageFeedback?[{id:"id",displayName:qe.a.t("Feedback recipient group")}]:this.props.recipients,updateRecipients:this.updateRecipients,inputHeight:"100px"}),Object(a.jsxs)("div",{style:xt.messageTypeField,children:[Object(a.jsx)("div",{style:xt.messageType,children:Object(a.jsx)(Ct.a,{label:qe.a.t("Private message"),checked:!this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}})}),Object(a.jsx)("div",{style:xt.messageType,children:Object(a.jsx)(Ct.a,{label:qe.a.t("Feedback message"),checked:this.state.isMessageFeedback,onCheck:()=>{this.setState({isMessageFeedback:!this.state.isMessageFeedback})}})})]}),Object(a.jsx)(fs.a,{floatingLabelText:qe.a.t("Subject"),fullWidth:!0,value:this.props.subject,onChange:this.subjectUpdate}),Object(a.jsx)(fs.a,{id:"createMessage",rows:5,underlineShow:!1,value:this.props.input,multiLine:!0,fullWidth:!0,floatingLabelText:qe.a.t("Message"),onChange:this.inputUpdate},"createMessage"),this.props.enableAttachments&&Object(a.jsx)(ms,{dataDirection:"upload",attachments:this.props.attachments,removeAttachment:e=>this.props.removeAttachment(e.id),cancelAttachment:this.props.cancelAttachment}),Object(a.jsxs)(vs.CardActions,{style:{paddingLeft:"0px"},children:[Object(a.jsx)(Ts.a,{primary:!0,disabled:e,label:qe.a.t("Send"),onClick:()=>this.sendMessage()}),Object(a.jsx)(Qe.a,{label:qe.a.t("Discard"),disabled:s,onClick:this.handleDiscard}),this.props.enableAttachments&&Object(a.jsx)(Es,{addAttachment:e=>{this.props.addAttachment(e)}})]})]})})]})}}var vt=Object(Ae.a)(Object(r.c)((e=>({messageTypes:e.messaging.messageTypes,subject:e.messaging.subject,input:e.messaging.input,recipients:e.messaging.recipients,attachments:e.messaging.attachments,enableAttachments:oe(e.messaging.dhis2CoreVersion)})),{sendMessage:({users:e,userGroups:s,organisationUnits:t,messageType:a})=>async(i,r)=>{try{const{messaging:{subject:n,input:o,attachments:c}}=r();await(({subject:e,users:s,userGroups:t,organisationUnits:a,text:i,attachments:r})=>he.mutate({resource:"messageConversations",type:"create",data:{subject:e,users:s,userGroups:t,organisationUnits:a,text:i,attachments:r}}))({subject:n,users:e,userGroups:s,organisationUnits:t,text:o,attachments:c}),i(be(E,{messageType:a,page:1})),i(je())}catch(n){i(be(I,{error:n}))}},sendFeedbackMessage:e=>async(s,t)=>{const a=t();try{await(i=a.messaging.subject,r=a.messaging.input,he.mutate({resource:"messageConversations/feedback",type:"create",params:{subject:i},data:r})),s(be(E,{messageType:e,page:1})),s(je())}catch(n){s(be(I,{error:n}))}var i,r},displaySnackMessage:ke,updateInputFields:Ee,addAttachment:Se,removeAttachment:Fe,cancelAttachment:Re,addRecipientByUserId:e=>async s=>{try{const t=await(async e=>{const{user:s}=await he.query({user:{resource:"users",id:e,params:{fields:"id,displayName"}}});return{...s,type:"user"}})(e);s(be(q,t))}catch(t){console.error(t)}}},null,{pure:!1}))(bt),jt=t(594),Tt=t.n(jt),St=t(593),ft=t.n(St),Ot=t(292),kt=t.n(Ot),Mt=t(218),Et=t.n(Mt),It=t(230),wt=t.n(It),Ft=t(249),Rt=t.n(Ft),At=t(346),_t=t.n(At),Ut=t(373),Nt=t.n(Ut);var Dt={STATUS:[{key:"NONE",value:"NONE",primaryText:qe.a.t("No status")},{key:"OPEN",value:"OPEN",primaryText:qe.a.t("Open")},{key:"PENDING",value:"PENDING",primaryText:qe.a.t("Pending")},{key:"INVALID",value:"INVALID",primaryText:qe.a.t("Invalid")},{key:"SOLVED",value:"SOLVED",primaryText:qe.a.t("Solved")}],PRIORITY:[{key:"NONE",value:"NONE",primaryText:qe.a.t("No priority")},{key:"HIGH",value:"HIGH",primaryText:qe.a.t("High")},{key:"MEDIUM",value:"MEDIUM",primaryText:qe.a.t("Medium")},{key:"LOW",value:"LOW",primaryText:qe.a.t("Low")}]},Lt=t(588),Gt=t.n(Lt),Pt=t(592),Vt=t.n(Pt),Wt=t(589),qt=t.n(Wt),Bt=t(590),Ht=t.n(Bt),Yt=t(591),zt=t.n(Yt),Kt=t(232),Xt=t.n(Kt);function Jt(e){return Object(a.jsx)(r.b.Consumer,{children:s=>Object(a.jsx)(Xt.a,{...e,children:Object(a.jsx)(r.a,{store:s.store,children:e.children})})})}var Qt=({open:e,onRequestClose:s,updateMessageConversations:t,messageType:i,feedbackRecipientsId:r})=>Object(a.jsx)(Jt,{open:e,onRequestClose:()=>{s()},children:Object(a.jsx)(_s,{onSuggestionClick:e=>{t([e.id]),s()},searchOnlyUsers:!0,searchOnlyFeedbackRecipients:"TICKET"===i.id,feedbackRecipientsId:r,recipients:[],label:qe.a.t("Assignee")},"suggestionField")});const Zt={canvas:{width:"400px",display:"flex"},extendedChoices:{display:"flex",justifyContent:"flex-start"},nrSelected:{padding:"0px 0px",overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"}};class $t extends i.Component{constructor(e){super(e),this.getIds=()=>this.props.selectedMessageConversation&&0===this.props.checkedIds.length?[this.props.selectedMessageConversation.id]:this.props.checkedIds.map((e=>e.id)),this.updateMessageConversation=(e,s)=>{const{selectedMessageType:t,selectedMessageConversation:a}=this.props,i=this.getIds();this.props.updateMessageConversations({messageConversationIds:i,identifier:e,value:s,messageType:t,selectedMessageConversation:a}),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.markMessageConversations=e=>{const s=this.getIds();this.props.markMessageConversations(e,s,this.props.selectedMessageType),this.props.checkedIds.length>0&&this.props.clearCheckedIds()},this.toggleDialog=()=>{this.setState({dialogOpen:!this.state.dialogOpen})},this.state={checkedItems:!1,dialogOpen:!1,assignToOpen:!1}}render(){const e=this.props.selectedMessageConversation,s=this.props.checkedIds.length>0,t=s||void 0!==e,i=Object(a.jsxs)(a.Fragment,{children:[Object(a.jsx)(Qe.a,{label:qe.a.t("Cancel"),primary:!0,onClick:()=>this.toggleDialog()}),Object(a.jsx)(Qe.a,{label:qe.a.t("Submit"),primary:!0,keyboardFocused:!0,onClick:()=>{this.props.deleteMessageConversations(this.getIds(),this.props.selectedMessageType),this.props.clearCheckedIds(),this.toggleDialog(),this.props.selectedMessageConversation&&(this.props.clearSelectedMessageConversation(),He.push("/".concat(this.props.selectedMessageType.id)))}})]}),r=this.props.checkedIds.length>99?"".concat(99,"+"):this.props.checkedIds.length;return t?Object(a.jsxs)("div",{style:Zt.canvas,children:[Object(a.jsx)(Jt,{title:qe.a.t("Are you sure you want to delete selected message conversation(s)?"),actions:i,modal:!1,open:this.state.dialogOpen,onRequestClose:this.toggleDialog}),Object(a.jsx)(Qt,{open:this.state.assignToOpen,onRequestClose:()=>this.setState({assignToOpen:!this.state.assignToOpen}),updateMessageConversations:e=>this.updateMessageConversation("ASSIGNEE",e),messageType:this.props.selectedMessageType,feedbackRecipientsId:this.props.feedbackRecipientsId}),Object(a.jsxs)("div",{style:Zt.extendedChoices,children:[Object(a.jsx)($e.a,{tooltip:qe.a.t("Delete selected"),onClick:()=>{this.toggleDialog()},children:Object(a.jsx)(qt.a,{})}),Object(a.jsx)($e.a,{tooltip:qe.a.t("Mark selected as unread"),onClick:()=>{this.markMessageConversations("unread")},children:Object(a.jsx)(Ht.a,{})}),Object(a.jsx)($e.a,{tooltip:qe.a.t("Mark selected as read"),onClick:()=>{this.markMessageConversations("read")},children:Object(a.jsx)(zt.a,{})}),this.props.displayExtendedChoices&&Object(a.jsx)($e.a,{onClick:()=>this.setState({assignToOpen:!this.state.assignToOpen}),tooltip:qe.a.t("Assign selected"),children:Object(a.jsx)(Vt.a,{})}),Object(a.jsxs)(Rt.a,{iconButtonElement:Object(a.jsx)($e.a,{children:Object(a.jsx)(Nt.a,{})}),anchorOrigin:{horizontal:"left",vertical:"top"},targetOrigin:{horizontal:"left",vertical:"top"},children:[Object(a.jsx)(Et.a,{value:"markFollowUp",primaryText:qe.a.t("Mark for followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!0)},"markFollowUp"),Object(a.jsx)(Et.a,{value:"clearFollowUp",primaryText:qe.a.t("Clear followup"),onClick:()=>this.updateMessageConversation("FOLLOW_UP",!1)},"clearFollowUp"),this.props.displayExtendedChoices&&Object(a.jsx)(rs.a,{}),this.props.displayExtendedChoices&&Object(a.jsx)(Et.a,{value:"clearAssigned",primaryText:qe.a.t("Clear assignee"),onClick:()=>this.updateMessageConversation("ASSIGNEE",void 0)},"clearAssigned"),this.props.displayExtendedChoices&&Object(a.jsx)(Et.a,{primaryText:qe.a.t("Set status"),rightIcon:Object(a.jsx)(Gt.a,{}),menuItems:Dt.STATUS.map((e=>Object(a.jsx)(Et.a,{value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("STATUS",e.key)},"".concat(e.key,"_status"))))},"setStatus"),this.props.displayExtendedChoices&&Object(a.jsx)(Et.a,{primaryText:qe.a.t("Set priority"),rightIcon:Object(a.jsx)(Gt.a,{}),menuItems:Dt.PRIORITY.map((e=>Object(a.jsx)(Et.a,{value:e.value,primaryText:e.primaryText,onClick:()=>this.updateMessageConversation("PRIORITY",e.key)},"".concat(e.key,"_priority"))))},"setPriority")]})]}),s&&Object(a.jsx)(wt.a,{style:Zt.nrSelected,children:"".concat(r," ").concat(qe.a.t("selected"))})]}):Object(a.jsx)("div",{})}}var ea=Object(Ae.a)(Object(r.c)((e=>({selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,checkedIds:e.messaging.checkedIds,feedbackRecipientsId:e.messaging.feedbackRecipientsId})),{clearCheckedIds:fe,clearSelectedMessageConversation:Oe,deleteMessageConversations:(e,s)=>async(t,a)=>{try{const i=a(),{currentUser:r}=i.messaging,n=e.map((e=>((e,s)=>he.mutate({resource:"messageConversations/".concat(e,"/").concat(s),type:"delete"}))(e,r.id)));await Promise.all(n),t(be(f,{messageType:s,page:1})),t(je())}catch(i){t(be(O,{error:i}))}},updateMessageConversations:({messageConversationIds:e,identifier:s,value:t,messageType:a,selectedMessageConversation:i})=>async r=>{if("FOLLOW_UP"===s)try{await((e,s)=>he.mutate({resource:"messageConversations/".concat(s?"followup":"unfollowup"),type:"create",data:e}))(e,t),r(be(k,{messageType:a,page:1,identifier:s})),r(je())}catch(n){r(be(M,{error:n}))}else{const i=e.map((e=>{let i;switch(s){case"STATUS":i=((e,s)=>he.mutate({resource:"messageConversations/".concat(e,"/status"),type:"create",params:{messageConversationStatus:s}}))(e,t);break;case"PRIORITY":i=((e,s)=>he.mutate({resource:"messageConversations/".concat(e,"/priority"),type:"create",params:{messageConversationPriority:s}}))(e,t);break;case"ASSIGNEE":i=void 0!==t&&"VALIDATION_RESULT"===a.id?ye({users:t.map((e=>({id:e}))),userGroups:[],organisationUnits:[],messageConversationId:e}).then((()=>ue(e,t))):ue(e,t);break;default:Z.a.error("Unexpected identifier for updateMessageConversations")}return i}));try{await Promise.all(i),r(be(k,{messageType:a,page:1,identifier:s})),r(je())}catch(n){r(be(M,{error:n}))}}i&&r(ve(i))},markMessageConversations:Te},null,{pure:!1}))($t);const sa={canvas:e=>({display:"flex",justifyContent:"flex-start",alignItems:"center",backgroundColor:e?g.palette.blue50:g.palette.accent2Color,zIndex:10}),checkedOption:{display:"flex",justifyContent:"flex-start",minWidth:"200px",margin:"6px 0"},filterControl:{flex:2,height:"48px",marginRight:16,maxWidth:256},rightHandCanvas:{flex:"2 0",display:"flex",paddingLeft:16},ie11Spacer:{flexGrow:1},iconMenu:{width:"30px",display:"flex"}};class ta extends i.Component{constructor(...e){super(...e),this.state={lastMessageFilter:""},this.debouncedSearch=ne(this.search,300)}search(e){this.props.selectedMessageType&&this.state.lastMessageFilter!==e&&(this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id),this.setState({lastMessageFilter:e}))}componentDidUpdate(e){e.selectedMessageType&&this.props.selectedMessageType.id!==e.selectedMessageType.id&&(this.debouncedSearch(""),void 0!==this.props.messageFilter&&this.props.setFilter(void 0,"MESSAGE"),void 0!==this.props.statusFilter&&this.props.setFilter(void 0,"STATUS"),void 0!==this.props.priorityFilter&&this.props.setFilter(void 0,"PRIORITY"),this.props.assignedToMeFilter&&this.props.setFilter(!1,"ASSIGNED_TO_ME"),this.props.markedForFollowUpFilter&&this.props.setFilter(!1,"MARKED_FOR_FOLLOWUP"),this.props.unreadFilter&&this.props.setFilter(!1,"UNREAD")),void 0===this.props.selectedMessageType||this.props.selectedMessageType.loading||e.statusFilter===this.props.statusFilter&&e.priorityFilter===this.props.priorityFilter&&e.assignedToMeFilter===this.props.assignedToMeFilter&&e.markedForFollowUpFilter===this.props.markedForFollowUpFilter&&e.unreadFilter===this.props.unreadFilter&&void 0!==e.selectedMessageType&&e.selectedMessageType.id===this.props.selectedMessageType.id||this.props.loadMessageConversations(this.props.selectedMessageType,this.props.selectedMessageType.id)}render(){const e=this.props.id,s=this.props.displayExtendedChoices,t=this.props.checkedOptions,i=!this.props.wideview||void 0===this.props.selectedMessageConversation&&"create"!==e;return Object(a.jsxs)(as.a,{style:sa.canvas(t),children:[Object(a.jsxs)("div",{children:[!t&&Object(a.jsx)(Qe.a,{style:sa.checkedOption,icon:Object(a.jsx)(ze.a,{}),onClick:()=>He.push("/PRIVATE/create"),label:qe.a.t("Compose")}),t&&Object(a.jsx)(Qe.a,{style:sa.checkedOption,icon:Object(a.jsx)(Xe.a,{}),onClick:()=>this.props.clearCheckedIds(),label:qe.a.t("Deselect all")})]}),Object(a.jsx)(ea,{displayExtendedChoices:s}),Object(a.jsxs)("div",{style:sa.rightHandCanvas,children:[Object(a.jsx)("div",{style:sa.ie11Spacer}),s&&i&&!t&&Object(a.jsxs)(kt.a,{style:sa.filterControl,labelStyle:{color:void 0===this.props.statusFilter?"lightGray":"black",top:void 0===this.props.statusFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:g.palette.primary1Color},floatingLabelText:void 0===this.props.statusFilter?qe.a.t("Status"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.statusFilter?"-15px":"0px"},value:this.props.statusFilter,onChange:(e,s,t)=>{this.props.setFilter(null===t?void 0:t,"STATUS")},children:[Object(a.jsx)(Et.a,{value:null,primaryText:""},null),Dt.STATUS.map((e=>Object(a.jsx)(Et.a,{value:e.value,primaryText:e.primaryText},e.key)))]}),s&&i&&!t&&Object(a.jsxs)(kt.a,{style:sa.filterControl,labelStyle:{color:void 0===this.props.priorityFilter?"lightGray":"black",top:void 0===this.props.priorityFilter?"-15px":"-2px"},selectedMenuItemStyle:{color:g.palette.primary1Color},floatingLabelText:void 0===this.props.priorityFilter?qe.a.t("Priority"):"",floatingLabelStyle:{top:"15px"},iconStyle:{top:void 0===this.props.priorityFilter?"-15px":"0px"},value:this.props.priorityFilter,onChange:(e,s,t)=>{this.props.setFilter(null===t?void 0:t,"PRIORITY")},children:[Object(a.jsx)(Et.a,{value:null,primaryText:""},null),Dt.PRIORITY.map((e=>Object(a.jsx)(Et.a,{value:e.value,primaryText:e.primaryText},e.key)))]}),!t&&i&&Object(a.jsx)(fs.a,{style:sa.filterControl,fullWidth:!0,hintText:qe.a.t("Search"),value:this.props.messageFilter||"",onChange:(e,s)=>{this.debouncedSearch(s),this.props.setFilter(s,"MESSAGE")},type:"search"}),!t&&i&&Object(a.jsxs)(Rt.a,{iconButtonElement:Object(a.jsx)($e.a,{children:Object(a.jsx)(Nt.a,{})}),anchorOrigin:{horizontal:"right",vertical:"top"},targetOrigin:{horizontal:"right",vertical:"top"},style:sa.iconMenu,menuStyle:{overflowX:"hidden"},children:[Object(a.jsx)(wt.a,{style:{padding:"0px 16px"},children:qe.a.t("Set filter")}),this.props.displayExtendedChoices&&Object(a.jsx)(_t.a,{style:{padding:"0px 16px"},label:qe.a.t("Assigned to me"),checked:this.props.assignedToMeFilter,onClick:()=>{this.props.setFilter(!this.props.assignedToMeFilter,"ASSIGNED_TO_ME")}},"assignedToMeFilter"),Object(a.jsx)(_t.a,{style:{padding:"0px 16px"},label:qe.a.t("Marked for followup"),checked:this.props.markedForFollowUpFilter,onClick:()=>{this.props.setFilter(!this.props.markedForFollowUpFilter,"MARKED_FOR_FOLLOWUP")}},"markedForFollowUpFilter"),Object(a.jsx)(_t.a,{style:{padding:"0px 16px"},label:qe.a.t("Unread messages"),checked:this.props.unreadFilter,onClick:()=>{this.props.setFilter(!this.props.unreadFilter,"UNREAD")}},"unreadFilter")]}),Object(a.jsx)(Qe.a,{style:{width:"50px",alignSelf:"center"},icon:this.props.wideview?Object(a.jsx)(Tt.a,{}):Object(a.jsx)(ft.a,{}),onClick:()=>this.props.toogleWideview()})]})]})}}var aa=ta;t(595);const ia=["TICKET","VALIDATION_RESULT"],ra=3e5,na=1e4;class oa extends i.Component{constructor(e){super(e),this.setAutoRefresh=e=>{!e&&this.intervalId&&(clearInterval(this.intervalId),this.intervalId=null),e&&(this.intervalId=setInterval(this.tick,na)),this.setState({autoRefresh:e,refreshTimer:ra})},this.tick=()=>{this.state.refreshTimer-na<=0?(this.refresh(),this.setState({refreshTimer:ra})):this.setState((e=>({refreshTimer:e.refreshTimer-na})))},this.refresh=()=>{this.props.messageTypes.map((e=>this.props.loadMessageConversations(e,this.props.selectedMessageType))),this.props.selectedMessageConversation&&this.props.setSelectedMessageConversation(this.props.selectedMessageConversation)},this.toogleWideview=()=>{this.setState({wideview:!this.state.wideview})},this.intervalId=null,this.state={autoRefresh:!1,checkedItems:!1,refreshTimer:ra,wideview:!0}}componentDidMount(){const e=this.props.match.params.messageType,s=this.props.match.params.messageId;if(s&&s!==e&&"create"!==s){const e={id:s};this.props.setSelectedMessageConversation(e)}(async e=>{const{configuration:{feedbackRecipients:s}}=await he.query({configuration:{resource:"configuration"}});return{authorized:e.authorities.includes("ALL")||e.userGroups.some((({id:e})=>e===s.id)),feedbackRecipientsId:s.id}})(this.props.currentUser).then((e=>this.props.setIsInFeedbackRecipientGroup(e))),this.props.messageTypes.map((s=>this.props.loadMessageConversations(s,e))),this.props.setDisplayTimeDiff()}componentDidUpdate(){const e=this.props.match.params.messageType,s=this.props.match.params.messageId;if(!this.props.settingSelectedMessageConversation&&s&&e!==s&&"create"!==s&&(void 0===this.props.selectedMessageConversation||s!==this.props.selectedMessageConversation.id)){const e={id:s};this.props.setSelectedMessageConversation(e)}e===s&&e!==this.props.selectedMessageType.id&&this.props.setSelectedMessageType(e),e!==s&&"create"!==s||void 0===this.props.selectedMessageConversation||this.props.clearSelectedMessageConversation()}componentWillUnmount(){this.intervalId&&clearInterval(this.intervalId)}render(){const e=this.props.match.params.messageId,s=!!this.props.selectedMessageType&&!!(ia.indexOf(this.props.selectedMessageType.id)+1)&&this.props.isInFeedbackRecipientGroup;return Object(a.jsxs)("div",{className:"messaging-center",children:[Object(a.jsx)(aa,{...this.props,id:e,wideview:this.state.wideview,displayExtendedChoices:s,toogleWideview:this.toogleWideview}),Object(a.jsxs)("div",{className:"messaging-center__main-content",children:[Object(a.jsx)(Zs,{...this.props,drawerOpen:this.state.drawerOpen,messageTypes:this.props.messageTypes,autoRefresh:this.state.autoRefresh,refreshTimer:this.state.refreshTimer,setAutoRefresh:this.setAutoRefresh}),void 0===this.props.selectedMessageConversation&&!(this.state.wideview&&"create"===e)&&Object(a.jsx)(mt,{wideview:this.state.wideview,displayExtendedChoices:s&&this.state.wideview}),"create"===e&&Object(a.jsx)(vt,{...this.props,wideview:this.state.wideview}),void 0!==this.props.selectedMessageConversation&&!this.state.wideview&&Object(a.jsx)(mt,{wideview:this.state.wideview,displayExtendedChoices:s&&this.state.wideview}),this.props.selectedMessageConversation&&"create"!==e?void 0!==this.props.selectedMessageConversation&&Object(a.jsx)(Ps,{...this.props,messageConversation:this.props.selectedMessageConversation,wideview:this.state.wideview,disableLink:!0,displayExtendedChoices:s}):!this.state.wideview&&"create"!==e&&Object(a.jsxs)("div",{className:"messaging-center__no-message-selected",children:[Object(a.jsx)(Ge.a,{style:et,children:qe.a.t("Select a message")}),Object(a.jsx)(Ve.a,{style:{color:g.palette.primary1Color,width:120,height:120}})]})]})]})}}var ca=Object(Ae.a)(Object(r.c)((e=>({currentUser:e.messaging.currentUser,snackMessage:e.messaging.snackMessage,messageTypes:e.messaging.messageTypes,messageConversations:e.messaging.messageConversations,messageFilter:e.messaging.messageFilter,statusFilter:e.messaging.statusFilter,priorityFilter:e.messaging.priorityFilter,assignedToMeFilter:e.messaging.assignedToMeFilter,markedForFollowUpFilter:e.messaging.markedForFollowUpFilter,unreadFilter:e.messaging.unreadFilter,selectedMessageType:e.messaging.selectedMessageType,selectedMessageConversation:e.messaging.selectedMessageConversation,settingSelectedMessageConversation:e.messaging.settingSelectedMessageConversation,checkedIds:e.messaging.checkedIds,checkedOptions:e.messaging.checkedIds.length>0,loaded:e.messaging.loaded,isInFeedbackRecipientGroup:e.messaging.isInFeedbackRecipientGroup,attachments:e.messaging.attachments})),{loadMessageConversations:je,setIsInFeedbackRecipientGroup:e=>be(V,{isInFeedbackRecipientGroup:e}),clearCheckedIds:fe,setSelectedMessageConversation:ve,setSelectedMessageType:we,clearSelectedMessageConversation:Oe,updateInputFields:Ee,setFilter:Me,setDisplayTimeDiff:()=>async e=>{try{const s=await(async()=>{const{systemInfo:e}=await he.query({systemInfo:{resource:"system/info"}});return e.serverDate})(),t=xe()().diff(xe()(s))-5e3;e(be(W,t))}catch(s){e(be("SET_DISPLAY_TIME_DIFF_ERROR",{error:s}))}},clearAttachments:Ie},null,{pure:!1}))(oa);var pa=()=>Object(a.jsx)(De.c,{history:He,children:Object(a.jsxs)("div",{children:[Object(a.jsx)(De.b,{exact:!0,path:"/",component:()=>Object(a.jsx)(De.a,{to:"/PRIVATE"})}),Object(a.jsx)(De.b,{path:"/:messageType/:messageId?/:recipientId?",component:ca})]})}),la=t(602),da=t.n(la);var ha=Object(r.c)((e=>({currentUser:e.messaging.currentUser})),{setCurrentUser:()=>async e=>{e(be(b));try{const{currentUser:s}=await he.query({currentUser:{resource:"me",params:{fields:["id","authorities","userGroups[id]"]}}});e(be(v,s))}catch{e(be(j,"Could not load current user"))}},setDhis2CoreVersion:e=>be(J,e)})((({currentUser:e,setCurrentUser:s,setDhis2CoreVersion:t})=>{const{loading:r,error:n}=e,{serverVersion:o}=Object(c.c)();return Object(i.useEffect)((()=>{t(o.minor),s()}),[]),r?Object(a.jsx)("div",{className:da.a.center,children:Object(a.jsx)(y.a,{size:48})}):n?Object(a.jsx)("div",{className:m()(da.a.center,da.a.error),children:n}):Object(a.jsxs)("div",{children:[Object(a.jsx)(Ne,{}),Object(a.jsx)(pa,{})]})})),ga=t(306),ua=t(603);var ma=[{id:"PRIVATE",displayName:"Inbox",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"VALIDATION_RESULT",displayName:"Validation",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"TICKET",displayName:"Ticket",unread:0,loaded:0,loading:!1,total:0,page:1},{id:"SYSTEM",displayName:"System",unread:0,loaded:0,loading:!1,total:0,page:1}];const ya={currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null},messageConversations:{},messageTypes:ma,selectedMessageType:void 0,selectedMessageConversation:void 0,settingSelectedMessageConversation:!1,checkedIds:[],messageFilter:void 0,statusFilter:void 0,priorityFilter:void 0,assignedToMeFilter:!1,markedForFollowUpFilter:!1,unreadFilter:!1,isInFeedbackRecipientGroup:!1,feedbackRecipientsId:void 0,displayTimeDiff:0,subject:"",input:"",recipients:[],attachments:[],snackMessage:"",onSnackActionClick:void 0,onSnackRequestClose:void 0,snackType:te};var Ca=function(e=ya,s){const t=e.messageTypes,a=e.attachments;switch(s.type){case b:return{...e,currentUser:{loading:!0,error:null,id:null,authorities:null,userGroups:null}};case v:return{...e,currentUser:{loading:!1,error:null,id:s.payload.id,authorities:s.payload.authorities,userGroups:s.payload.userGroups}};case j:return{...e,currentUser:{loading:!1,error:s.payload,id:null,authorities:null,userGroups:null}};case W:return{...e,displayTimeDiff:s.payload};case S:{const a=t.find((e=>e.id===s.payload.messageType.id));a.loaded=s.payload.messageConversations.length,a.total=s.payload.pager.total,a.unread=s.payload.nrOfUnread,a.page=s.payload.pager.page,a.loading=!1,ma.splice([re(t,a.id)],1,a);const i=s.payload.selectedMessageType===a.id&&(s.payload.selectedMessageType===e.selectedMessageType||void 0===e.selectedMessageType);return{...e,messageTypes:ma,messageConversations:{...e.messageConversations,[a.id]:s.payload.messageConversations},selectedMessageType:i?a:e.selectedMessageType}}case M:return{...e,snackMessage:s.payload.error.message,snackType:ie};case k:{let t="";switch(s.payload.identifier){case"STATUS":t=qe.a.t("Successfully updated status");break;case"PRIORITY":t=qe.a.t("Successfully updated priority");break;case"ASSIGNEE":t=qe.a.t("Successfully updated assignee");break;case"FOLLOW_UP":t=qe.a.t("Successfully changed followup");break;default:Z.a.error("Unexpected identifier for updateMessageConversations success")}return{...e,snackMessage:t,snackType:ae}}case I:case O:return{...e,snackMessage:s.payload.error.message,snackType:ie};case f:return{...e,snackMessage:qe.a.t("Successfully deleted message conversation(s)"),snackType:ae};case F:return{...e,snackMessage:s.payload.message,snackType:s.payload.snackType,onSnackActionClick:s.payload.onSnackActionClick,onSnackRequestClose:s.payload.onSnackRequestClose};case R:return{...e,snackMessage:"",snackType:te};case A:{const t=s.payload.messageConversation;let a=e.checkedIds;return s.payload.selectedValue?a.push(t):a=a.filter((e=>e.id!==t.id)),{...e,checkedIds:a}}case _:return{...e,checkedIds:s.payload.messageConversationIds};case U:return{...e,checkedIds:[]};case G:return{...e,selectedMessageConversation:s.payload.messageConversation,settingSelectedMessageConversation:!1};case L:return{...e,settingSelectedMessageConversation:!0};case D:return{...e,selectedMessageConversation:void 0};case N:return{...e,checkedIds:[],selectedMessageType:t.find((e=>e.id===s.payload.messageTypeId)),selectedMessageConversations:e.messageConversations[s.payload.messageTypeId],selectedMessageConversation:void 0};case P:return{...e,subject:s.payload.subject,input:s.payload.input,recipients:s.payload.recipients};case q:return{...e,recipients:[...e.recipients,s.payload]};case w:return{...e,messageFilter:"MESSAGE"===s.payload.filterType?s.payload.filter:e.messageFilter,statusFilter:"STATUS"===s.payload.filterType?s.payload.filter:e.statusFilter,priorityFilter:"PRIORITY"===s.payload.filterType?s.payload.filter:e.priorityFilter,assignedToMeFilter:"ASSIGNED_TO_ME"===s.payload.filterType?s.payload.filter:e.assignedToMeFilter,markedForFollowUpFilter:"MARKED_FOR_FOLLOWUP"===s.payload.filterType?s.payload.filter:e.markedForFollowUpFilter,unreadFilter:"UNREAD"===s.payload.filterType?s.payload.filter:e.unreadFilter};case T:{const t=s.payload.messageType;t.loading=!0,s.payload.loadMore&&t.page++,ma[re(ma,t.id)]=t;const a=e.selectedMessageType;return a&&(a.loading=!0,s.payload.loadMore&&a.page++),{...e,messageTypes:ma,selectedMessageType:a}}case V:return{...e,isInFeedbackRecipientGroup:s.payload.isInFeedbackRecipientGroup.authorized,feedbackRecipientsId:s.payload.isInFeedbackRecipientGroup.feedbackRecipientsId};case H:return{...e,attachments:e.attachments.map((e=>e.name===s.payload.name?{id:s.payload.id,name:e.name,contentLength:e.contentLength,loading:!1}:e))};case Y:return{...e,attachments:a.filter((e=>e.id!==s.payload.attachmentId)),snackMessage:s.payload.error.message,snackType:ie};case B:return{...e,attachments:e.attachments.concat({name:s.payload.name,contentLength:s.payload.size,loading:!0})};case z:return{...e,attachments:a.filter((e=>e.id!==s.payload.attachmentId))};case X:return{...e,attachments:a.filter((e=>e.name!==s.payload.attachmentName))};case K:return{...e,attachments:[]};case J:return{...e,dhis2CoreVersion:s.payload};default:return e}};const xa=[ua.a],ba=window.__REDUX_DEVTOOLS_EXTENSION_COMPOSE__||ga.d,va=Object(ga.c)({messaging:Ca});var ja=Object(ga.e)(va,ba(Object(ga.a)(...xa)));t(604),t(19);s.default=()=>{const e=Object(c.d)();return he=e,Object(a.jsx)(r.a,{store:ja,children:Object(a.jsx)(o.a,{muiTheme:g,children:Object(a.jsx)(ha,{})})})}}}]);
//# sourceMappingURL=app.350bb9e2.chunk.js.map